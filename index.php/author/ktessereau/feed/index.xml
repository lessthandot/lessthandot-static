<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>SQLology ~ Kim Tessereau &#8211; LessthanDot</title>
	<atom:link href="/index.php/author/ktessereau/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>A Technical Community for IT Professionals</description>
	<lastBuildDate>Sat, 09 Mar 2019 12:50:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.6.1</generator>
	<item>
		<title>Removing OS Files Through a Stored Procedure</title>
		<link>/index.php/datamgmt/datadesign/removing-os-files-through-a/</link>
		<comments>/index.php/datamgmt/datadesign/removing-os-files-through-a/#comments</comments>
		<pubDate>Sat, 07 May 2011 13:00:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLology ~ Kim Tessereau]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>

		<guid isPermaLink="false">/index.php/2011/05/removing-os-files-through-a/</guid>
		<description><![CDATA[Deleting OS files from a stored procedure:  
 
Here is one way to remove old backup files from the OS through a stored procedure.  The procedure can be compiled in any database.  Once compiled you can run the stored procedure from a scheduled job to r&#8230;]]></description>
				<content:encoded><![CDATA[<p><strong>Deleting OS files from a stored procedure:  </strong></p>
<p> Here is one way to remove old backup files from the OS through a stored procedure.  The procedure can be compiled in any database.  Once compiled you can run the stored procedure from a scheduled job to remove old backup files from the OS.</p>
<p> </p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">IF</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: gray;">EXISTS</span><span style="color: blue;"> </span><span style="color: gray;">(</span><span style="color: blue;">SELECT</span> [name] <span style="color: blue;">FROM</span> dbo<span style="color: gray;">.</span><span style="color: green;">sysobjects</span> <span style="color: blue;">WHERE</span> [name] <span style="color: gray;">=</span> <span style="color: red;">&#8216;usp_Delete_OS_Files_By_Date&#8217;</span> <span style="color: gray;">AND</span> <span style="color: blue;">TYPE</span> <span style="color: gray;">=</span> <span style="color: red;">&#8216;P&#8217;</span><span style="color: gray;">)</span><span style="mso-spacerun: yes;">  </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">DROP</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">PROCEDURE</span> dbo<span style="color: gray;">.</span>usp_Delete_OS_Files_By_Date</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">GO</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">CREATE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">PROCEDURE</span> dbo<span style="color: gray;">.</span>usp_Delete_OS_Files_By_Date<span style="color: blue;"> </span><span style="color: gray;">(</span>@SourceDir <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">),</span> @SourceFile <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">),</span> @DaysToKeep <span style="color: blue;">int</span><span style="color: gray;">)</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">AS</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">BEGIN</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">/***********************************************************************************<span style="mso-spacerun: yes;">     </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">Description:<span style="mso-spacerun: yes;">  </span>Delete operating system files older than n days<span style="mso-spacerun: yes;">                   </span>****<span style="mso-spacerun: yes;">       </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">Prototype:</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">EXEC dbo.usp_Delete_OS_Files_By_Date<span style="mso-spacerun: yes;">                                      </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">                                      </span>@SourceDir = &#8216;\smpprod01BackupsSGC&#8217;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">                                    </span>, @SourceFile = &#8216;SGC_Backup_*&#8217;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">              </span><span style="mso-spacerun: yes;">                      </span>, @DaysToKeep = 3<span style="mso-spacerun: yes;">                  </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">                                                                                </span>**** </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">History<span style="mso-spacerun: yes;">                                                                         </span>****</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">05/06/2011</span><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;"> Kim Tessereau <span style="mso-tab-count: 1;">     </span>Created <span style="mso-spacerun: yes;">       </span><span style="mso-spacerun: yes;">                                   </span>****</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">************************************************************************************/</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SET</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">NOCOUNT</span> <span style="color: blue;">ON</span><span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">DECLARE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @CurrentFileDate <span style="color: blue;">char</span><span style="color: gray;">(</span>10<span style="color: gray;">),</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;">@OldFileDate <span style="color: blue;">char</span><span style="color: gray;">(</span>10<span style="color: gray;">),</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;">@SourceDirFOR <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">),</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;">@FileName <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">),</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;">@DelCommand <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">);</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SET</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @CurrentFileDate <span style="color: gray;">=</span> <span style="color: fuchsia;">CONVERT</span><span style="color: gray;">(</span><span style="color: blue;">char</span><span style="color: gray;">(</span>10<span style="color: gray;">),</span><span style="color: fuchsia;">getdate</span><span style="color: gray;">(),</span>121<span style="color: gray;">);</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SET</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @OldFileDate <span style="color: gray;">=</span> <span style="color: fuchsia;">CONVERT</span><span style="color: gray;">(</span><span style="color: blue;">char</span><span style="color: gray;">(</span>10<span style="color: gray;">),</span><span style="color: fuchsia;">DATEADD</span><span style="color: gray;">(</span>dd<span style="color: gray;">,-</span>@DaysToKeep<span style="color: gray;">,</span>@CurrentFileDate<span style="color: gray;">),</span>121<span style="color: gray;">);</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SET</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @SourceDirFOR <span style="color: gray;">=</span> <span style="color: red;">&#8216;FOR %I IN (&#8220;&#8216;</span> <span style="color: gray;">+</span> @SourceDir <span style="color: gray;">+</span> @SourceFile <span style="color: gray;">+</span> <span style="color: red;">&#8216;&#8221;) DO @ECHO %~nxtI&#8217;</span><span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">&#8212; Get OS File information from the OS</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">CREATE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">TABLE</span> #Temp_01<span style="color: blue;"><span style="mso-spacerun: yes;">      </span></span><span style="color: gray;">(</span> [lineorder] <span style="color: blue;">int</span> <span style="color: blue;">IDENTITY</span><span style="color: gray;">(</span>1<span style="color: gray;">,</span>1<span style="color: gray;">)</span><span style="mso-spacerun: yes;">   </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">                           </span><span style="color: gray;">,</span> [OSInfo] <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">)</span> <span style="color: gray;">);</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">INSERT</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">INTO</span> #Temp_01</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">EXEC</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">master</span><span style="color: gray;">..</span><span style="color: maroon;">xp_cmdshell</span><span style="color: blue;"> </span>@SourceDirFOR<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">&#8212; Put the OS File info in date order</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">CREATE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">TABLE</span> #Temp_02<span style="color: blue;"><span style="mso-spacerun: yes;">      </span></span><span style="color: gray;">(</span> [lineorder] <span style="color: blue;">int</span><span style="mso-spacerun: yes;">    </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">                           </span><span style="color: gray;">,</span> [TimeStamp] <span style="color: blue;">datetime</span> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">                           </span><span style="color: gray;">,</span> [FileName] <span style="color: blue;">varchar</span><span style="color: gray;">(</span>255<span style="color: gray;">)</span> <span style="color: gray;">);</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">INSERT</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">INTO</span> #Temp_02<span style="color: blue;"> </span><span style="color: gray;">(</span>[lineorder]<span style="color: gray;">,</span> [Timestamp]<span style="color: gray;">,</span> [FileName]<span style="color: gray;">)</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SELECT</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> [lineorder]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">      </span><span style="color: gray;">,</span> <span style="color: fuchsia;">CONVERT</span><span style="color: blue;"> </span><span style="color: gray;">(</span><span style="color: blue;">char</span><span style="color: gray;">(</span>10<span style="color: gray;">),</span><span style="color: fuchsia;">SUBSTRING</span><span style="color: gray;">(</span>[OSInfo]<span style="color: gray;">,</span>1<span style="color: gray;">,</span>10<span style="color: gray;">),</span> 121<span style="color: gray;">)</span> <span style="color: blue;">AS</span> [TimeStamp]<span style="mso-spacerun: yes;">                      </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">      </span><span style="color: gray;">,</span> <span style="color: fuchsia;">SUBSTRING</span><span style="color: gray;">(</span>[OSInfo]<span style="color: gray;">,</span>21<span style="color: gray;">,</span>255<span style="color: gray;">)</span> <span style="color: blue;">AS</span> [FileName]<span style="mso-spacerun: yes;">                       </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">FROM</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> #Temp_01<span style="mso-spacerun: yes;">                   </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">WHERE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> [OSInfo] <span style="color: gray;">IS</span> <span style="color: gray;">NOT</span> <span style="color: gray;">NULL</span><span style="mso-spacerun: yes;">            </span><span style="mso-spacerun: yes;">   </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">ORDER</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">BY</span> [lineorder]<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: green; font-size: 10pt; mso-no-proof: yes;">&#8212; Loop through OS Information and create delete command and execute </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">DECLARE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> DeleteCursor <span style="color: blue;">CURSOR</span> <span style="color: blue;">READ_ONLY</span> <span style="color: blue;">FOR</span><span style="mso-spacerun: yes;">  </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SELECT</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> [FileName]<span style="mso-spacerun: yes;">      </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">FROM</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> #Temp_02 </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">WHERE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> [TimeStamp] <span style="color: gray;">&lt;=</span> @OldFileDate<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">OPEN</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> DeleteCursor<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">FETCH</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">NEXT</span> <span style="color: blue;">FROM</span> DeleteCursor <span style="color: blue;">INTO</span> @FileName<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">WHILE </span><span style="font-family: &amp;amp;amp; color: gray; font-size: 10pt; mso-no-proof: yes;">(</span><span style="font-family: &amp;amp;amp; color: fuchsia; font-size: 10pt; mso-no-proof: yes;">@@fetch_status</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: gray;">&lt;&gt;</span> <span style="color: gray;">&#8211;</span>1<span style="color: gray;">)</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">BEGIN</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">      </span><span style="color: blue;">IF </span><span style="color: gray;">(</span><span style="color: fuchsia;">@@fetch_status</span> <span style="color: gray;">&lt;&gt;</span> <span style="color: gray;">&#8211;</span>2<span style="color: gray;">)</span><span style="mso-spacerun: yes;">    </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">            </span><span style="color: blue;">BEGIN</span><span style="mso-spacerun: yes;">      </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">            </span><span style="color: blue;">SET</span> @DelCommand <span style="color: gray;">=</span> <span style="color: red;">&#8216;</span></span><span style="font-family: &amp;amp;amp; color: red; font-size: 10pt; mso-no-proof: yes;">DEL</span><span style="font-family: &amp;amp;amp; color: red; font-size: 10pt; mso-no-proof: yes;"> /Q &#8220;&#8216;</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: gray;">+</span> @SourceDir <span style="color: gray;">+</span> @FileName <span style="color: gray;">+</span> <span style="color: red;">&#8216;&#8221;&#8216;</span><span style="color: gray;">;</span><span style="mso-spacerun: yes;">     </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">            </span><span style="color: blue;">EXEC</span> <span style="color: blue;">master</span><span style="color: gray;">..</span><span style="color: maroon;">xp_cmdshell</span><span style="color: blue;"> </span>@DelCommand<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 3;">                  </span><span style="color: blue;">END</span><span style="mso-spacerun: yes;">  </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">FETCH</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">NEXT</span> <span style="color: blue;">FROM</span> DeleteCursor <span style="color: blue;">INTO</span> @FileName<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">END</span><span style="font-family: &amp;amp;amp; color: gray; font-size: 10pt; mso-no-proof: yes;">;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;"> </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">CLOSE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> DeleteCursor<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">DEALLOCATE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> DeleteCursor<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: gray; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">END</span><span style="font-family: &amp;amp;amp; color: gray; font-size: 10pt; mso-no-proof: yes;">;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">GO</span></p>
<p> </p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/removing-os-files-through-a/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>BI Interview Questions&#8230;.</title>
		<link>/index.php/datamgmt/datadesign/bi-interview-questions/</link>
		<comments>/index.php/datamgmt/datadesign/bi-interview-questions/#comments</comments>
		<pubDate>Sun, 01 May 2011 14:44:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLology ~ Kim Tessereau]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[SSIS]]></category>

		<guid isPermaLink="false">/index.php/2011/05/bi-interview-questions/</guid>
		<description><![CDATA[Recently I had to find a BI resource to do some ETL work for me.  I wanted to make sure I had the right person for the job so I came up with a list of interview questions that proved out to be spot on.  It really helped me weed out the folks that knew a&#8230;]]></description>
				<content:encoded><![CDATA[<p>Recently I had to find a BI resource to do some ETL work for me.  I wanted to make sure I had the right person for the job so I came up with a list of interview questions that proved out to be spot on.  It really helped me weed out the folks that knew a lot of buzz words versus the folks that had actually worked with the different aspects of the BI ETL process.  I&#8217;ve provided some of the answers to a few of the questions.  You would be surprised at what little people really know when they claim to be an expert at BI.  I did find the perfect person using these questions and the project is well under way and on target! </p>
<p><strong>Can you explain normalization?</strong></p>
<p><strong>First Normal Form (1NF)</strong></p>
<p>First normal form (1NF) sets the very basic rules for an organized database:</p>
<ul>
<li>Eliminate duplicative columns from the same table. </li>
<li>Create separate tables for each group of related data and identify each row with a unique column or set of columns (the primary key). </li>
</ul>
<p><strong>Second Normal Form (2NF)</strong></p>
<p>Second normal form (2NF) further addresses the concept of removing duplicative data:</p>
<ul>
<li>Meet all the requirements of the first normal form. </li>
<li>Remove subsets of data that apply to multiple rows of a table and place them in separate tables. </li>
<li>Create relationships between these new tables and their predecessors through the use of foreign keys. </li>
</ul>
<p><strong>Third Normal Form (3NF)</strong></p>
<p>Third normal form (3NF) goes one large step further:</p>
<ul>
<li>Meet all the requirements of the second normal form. </li>
<li>Remove columns that are not dependent upon the primary key. </li>
</ul>
<p> </p>
<p><strong>What is de-normalization?</strong></p>
<p><strong>What is a surrogate key?</strong></p>
<p><strong>Explain what a star schema is?</strong></p>
<p><strong>Explain snow flaking?</strong></p>
<p><strong>What features in SQL Server do you use to tune queries?</strong></p>
<p><strong>Are clustered index scans beneficial to an execution plan?</strong></p>
<p><strong>Can you explain the MERGE command and how it is used?</strong></p>
<p>Performs insert, update, or delete operations on a target table based on the results of a join with a source table. For example, you can synchronize two tables by inserting, updating, or deleting rows in one table based on differences found in the other table.</p>
<p> </p>
<p><strong>Are there any performance issues with having a lot of indexes on a table?</strong></p>
<p><strong>What’s the difference in using a table variable and a temp table?</strong></p>
<p><strong>The first difference</strong> is that transaction logs are not recorded for the table variables.  <strong>The second</strong> major difference is that any procedure with a temporary table cannot be pre-compiled, while an execution plan of procedures with table variables can be statically compiled in advance. Pre-compiling a script gives a major advantage to its speed of execution.  <strong>Finally</strong>, table variables exist only in the same scope as variables. Contrary to the temporary tables, they are not visible in inner stored procedures and in exec(string) statements.</p>
<p><strong>What are the benefits or detriments to using cursors?</strong></p>
<p><strong>What is foreach-loop container?</strong> Give an example of where it can be used.</p>
<p><strong>What is a sequence container?</strong> Give an example of where it can be used.</p>
<p><strong>What task do you use to send an email?</strong>  Send Mail task.</p>
<p><strong>Mention a few mapping operations that the Character Map transformation supports? </strong></p>
<p>The Character Map transformation applies string functions, such as conversion from lowercase to uppercase, to character data. This transformation operates only on column data with a string data type. The Character Map transformation can convert column data in place or add a column to the transformation output and put the converted data in the new column. You can apply different sets of mapping operations to the same input column and put the results in different columns. For example, you can convert the same column to uppercase and lowercase and put the results in two different columns.</p>
<p> </p>
<p><strong>Explain the functionality of: SCD transformation.</strong></p>
<p>The Slowly Changing Dimension transformation provides the following functionality for managing slowly changing dimensions:</p>
<ul>
<li>Matching incoming rows with rows in the lookup table to identify new and existing rows. </li>
<li>Identifying incoming rows that contain changes when changes are not permitted.</li>
<li>Identifying inferred member records that require updating.</li>
<li>Identifying incoming rows that contain historical changes that require insertion of new records and the updating of expired records.</li>
<li>Detecting incoming rows that contain changes that require the updating of existing records, including expired ones. </li>
</ul>
<p><strong>Explain the functionality of: Union All transformation.</strong></p>
<p><strong>What is the “Lookup” transformation used for?</strong></p>
<p><strong>What is the use of “package configurations” in SSIS?</strong></p>
<p><strong>What are the different ways in which configuration details can be stored?</strong></p>
<p><strong>How to deploy a package from development server to production server?</strong></p>
<p><strong>How to deploy packages to file system?</strong></p>
<p><strong>How to deploy packages to SQL Server? What database will packages be stored?</strong></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/bi-interview-questions/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		</item>
		<item>
		<title>Why do we need error handling?</title>
		<link>/index.php/datamgmt/dbprogramming/why-do-we-need-error/</link>
		<comments>/index.php/datamgmt/dbprogramming/why-do-we-need-error/#comments</comments>
		<pubDate>Sun, 17 Apr 2011 06:00:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLology ~ Kim Tessereau]]></dc:creator>
				<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>

		<guid isPermaLink="false">/index.php/2011/04/why-do-we-need-error/</guid>
		<description><![CDATA[Why do we need error handling?
 
Error handling is something that is often forgot or misunderstood or put off until something goes awry and we try to back peddle and retro fit the error handling logic in the script, stored procedure or function. 
 &#8230;]]></description>
				<content:encoded><![CDATA[<p><strong>Why do we need error handling?</strong></p>
<p> </p>
<p>Error handling is something that is often forgot or misunderstood or put off until something goes awry and we try to back peddle and retro fit the error handling logic in the script, stored procedure or function. </p>
<p> </p>
<p>I think there are quite a few reasons we should engage in handling something other than the happy path of logic.  I’ve listed a few here and I’m sure you can think of some more.</p>
<p> </p>
<p><strong>Inform calling process of situation:  </strong>I’m going to pretend, just for a short moment, that I’m a developer.  Let’s say I’m tasked with the job of writing some new functionality in an existing system.  I want to be efficient and reuse some of the existing stored procedures already written in the system.  So I start looking at some of the logic with the procs and I realize that I can’t tell what the business rules are for a given process because there isn’t any controls, error handling, that helps me understand what is acceptable as far as data values are concerned.  So the calling process that I would be writing would only know about the happy path and not the so called “roads less traveled”.</p>
<p> </p>
<p><strong>Assist in handling transactions:</strong>  The first thing that comes to mind when I think about a transaction is an old example of the ATM machine transactions.  Let’s say that you are going to transfer $100 from your checking account to your saving account.  If you looked at the code to do this it would probably look something like this….</p>
<p> </p>
<p>     UPDATE checking</p>
<p>            SET balance = balance &#8211; @transfer_amount</p>
<p>            WHERE account = @checking_account</p>
<p> </p>
<p>     UPDATE savings</p>
<p>            SET balance= balance + @transfer_amount</p>
<p>            WHERE account = @savings_account</p>
<p> </p>
<p>If these two UPDATE statements are run without any transaction or error handling logic enforced and the first one is successful and the second one fails, then it is going to only withdraw the money from the checking account and the process will stop and return an error to the call process, but the calling process won’t know what actually happened?  Did the transfer successfully take place? </p>
<p> </p>
<p><strong>Alert user there is a problem:</strong>  One thing that I think unnerves a user more than anything is to receive an error that is totally cryptic to them.  And I can’t think of any couple of errors that sounds worse than “a constraint has been violated” or how about the ever popular, “you’ve been chosen as a deadlock victim”.  Sounds pretty impressive and could only end in disaster for the user.  They have no idea whether or not what they just did became permanent in the database or not.  With providing error logic in cases like this will give the user some idea of what just happened and what they need to do to correct the situation.  They would probably much rather see something like, “The customer you are trying to add already exists” or “System error – please resubmit your change”.  These are more descriptive and give the user answer to what happened and to what their next steps are going to be in order to correct the situation.</p>
<p> </p>
<p><strong>Handle unexpected results:  </strong>It might be difficult to plan for every error that comes up, but we can at least trap the unexpected and try to provide additional information about what was happening as the time of the error.  Additional information may include things like how many rows were affected, did the connection fail, was the previous transaction successful, etc… That’s all I have to say about that!</p>
<p> </p>
<p><strong>Helps provide data consistency:  </strong>Data consistency is part of what is called the ACID test.  By using error handling in conjunction with transactions, whether they are implicit or explicit, it can help to determine whether or not the data being manipulated is consistent or not.  Let’s brake apart the acronym ACID first.  A = Atomicity, C = Consistency, I = Isolation and D = Durability.  We are taking about the Consistency in this case.  What does it mean to be consistent?  The transaction must provide valid data to be written to the database.  You seen what happened in the above example with the ATM transaction, if the user doesn’t understand that there was an error and what that error was how can they be assured that the data lives in the database as a correct (consistent) state? </p>
<p> </p>
<p>There are a lot of constructs in SQL that help to assist us with handing errors.  They range from the following…</p>
<p> </p>
<p>     @@Error global variable</p>
<p>     RETURN statement</p>
<p>     User-defined error messages</p>
<p>     RAISERROR command</p>
<p>     TRY/CATCH blocks</p>
<p>     XACT_ABORT</p>
<p> </p>
<p>To see more details on these error handling techniques you can catch my new presentation on error handling titled &#8220;We ain&#8217;t affraid of no errors&#8221;, at the St. Louis SQL Server User Group meeting on June 14<sup>th</sup>, 2011 and after the presentation my slide deck will be available at <a href="http://www.stlssug.org/">http://www.stlssug.org/</a> Hope to see you there!</p>
<p> </p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/dbprogramming/why-do-we-need-error/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>Observing &#8211; Optimize for Ad Hoc Workload server option</title>
		<link>/index.php/datamgmt/dbadmin/observing-optimize-for-ad-hoc/</link>
		<comments>/index.php/datamgmt/dbadmin/observing-optimize-for-ad-hoc/#respond</comments>
		<pubDate>Sat, 09 Apr 2011 11:26:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLology ~ Kim Tessereau]]></dc:creator>
				<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>

		<guid isPermaLink="false">/index.php/2011/04/observing-optimize-for-ad-hoc/</guid>
		<description><![CDATA[Optimize For Ad Hoc Workloads – Observations......
 
I’ve been watching this one particular server that has been throwing alerts for high physical memory usage from Red Gate’s SQL Monitoring tool.  I was discussing this with a friend of mine, Clayton&#8230;]]></description>
				<content:encoded><![CDATA[<p class="MsoNormal" style="margin: 0in 0in 0pt;"><strong style="mso-bidi-font-weight: normal;"><span style="font-family: Calibri; font-size: 11pt;">Optimize For Ad Hoc Workloads – Observations&#8230;&#8230;</span></strong></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><strong style="mso-bidi-font-weight: normal;"><span style="font-family: Calibri; font-size: 11pt;"> </span></strong></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">I’ve been watching this one particular server that has been throwing alerts for high physical memory usage from Red Gate’s SQL Monitoring tool.<span style="mso-spacerun: yes;">  </span>I was discussing this with a friend of mine, Clayton Hoyt and he mentioned that I might want to look at the “Optimize for Ad Hoc Workloads” advanced server configuration options.<span style="mso-spacerun: yes;">  </span>I took him up on his advice and googled for the “Optimize For Ad Hoc Workloads” and “SQLSkills”.<span style="mso-spacerun: yes;">  </span>I found a wonderful article from Kimberly Tripp on just this topic.<span style="mso-spacerun: yes;">  </span>Here is the link.</span></strong></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></strong></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: Calibri; font-size: 11pt;"> <a href="http://www.sqlskills.com/blogs/kimberly/post/procedure-cache-and-optimizing-for-adhoc-workloads.aspx">http://www.sqlskills.com/blogs/kimberly/post/procedure-cache-and-optimizing-for-adhoc-workloads.aspx</a></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: Calibri; font-size: 11pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">The article suggests running the below query to determine the number of plans in cache and the total space that they are taking up.<span style="mso-spacerun: yes;">  </span>So I ran the query on my memory hungry server and the following is what happened&#8230;&#8230;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SELECT</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> objtype <span style="color: blue;">AS</span> [CacheType]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">        </span><span style="color: gray;">,</span> <span style="color: fuchsia;">count_big</span><span style="color: gray;">(*)</span> <span style="color: blue;">AS</span> [Total Plans]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">        </span><span style="color: gray;">,</span> <span style="color: fuchsia;">sum</span><span style="color: gray;">(</span><span style="color: fuchsia;">cast</span><span style="color: gray;">(</span>size_in_bytes <span style="color: blue;">as</span> <span style="color: blue;">decimal</span><span style="color: gray;">(</span>18<span style="color: gray;">,</span>2<span style="color: gray;">)))/</span>1024<span style="color: gray;">/</span>1024 <span style="color: blue;">AS</span> [Total MBs]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">        </span><span style="color: gray;">,</span> <span style="color: fuchsia;">avg</span><span style="color: gray;">(</span>usecounts<span style="color: gray;">)</span> <span style="color: blue;">AS</span> [Avg Use Count]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">        </span><span style="color: gray;">,</span> <span style="color: fuchsia;">sum</span><span style="color: gray;">(</span><span style="color: fuchsia;">cast</span><span style="color: gray;">((</span><span style="color: blue;">CASE</span> <span style="color: blue;">WHEN</span> usecounts <span style="color: gray;">=</span> 1 <span style="color: blue;">THEN</span> size_in_bytes <span style="color: blue;">ELSE</span> 0 <span style="color: blue;">END</span><span style="color: gray;">)</span> <span style="color: blue;">as</span> <span style="color: blue;">decimal</span><span style="color: gray;">(</span>18<span style="color: gray;">,</span>2<span style="color: gray;">)))/</span>1024<span style="color: gray;">/</span>1024 <span style="color: blue;">AS</span> [Total MBs &#8211; USE Count 1]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">        </span><span style="color: gray;">,</span> <span style="color: fuchsia;">sum</span><span style="color: gray;">(</span><span style="color: blue;">CASE</span> <span style="color: blue;">WHEN</span> usecounts <span style="color: gray;">=</span> 1 <span style="color: blue;">THEN</span> 1 <span style="color: blue;">ELSE</span> 0 <span style="color: blue;">END</span><span style="color: gray;">)</span> <span style="color: blue;">AS</span> [Total Plans &#8211; USE Count 1]</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">FROM</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: green;">sys</span><span style="color: gray;">.</span><span style="color: green;">dm_exec_cached_plans</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">GROUP</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">BY</span> objtype</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">ORDER</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">BY</span> [Total MBs &#8211; USE Count 1] <span style="color: blue;">DESC</span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">go</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Initial Query Results:<span style="mso-spacerun: yes;">  </span>This is what I started with.</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">CacheType   Total Plans   Total MBs     Avg Use Count Total MBs &#8211; USE Count 1  Total Plans </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">&#8212;&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; background: yellow; font-size: 8pt; mso-highlight: yellow;">Adhoc       32750        <span style="mso-spacerun: yes;"> </span>2352.641181       927           947.289619                 9167</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Proc        842           387.390625        169428        6.882812                   29</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Prepared    576           69.460937         15176         6.234375                   64</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Trigger     35            21.867187         6154          0.828125                   3</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Check       31            0.812500          11453         0.023437                   1</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">View        327           36.875000         8057          0.000000                   0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">UsrTab      4             0.468750          1473          0.000000                   0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Then I turned on “Optimized for Ad Hoc Workload” and watched the total number of plans decrease along with the total amount of space depleat.<span style="mso-spacerun: yes;">  </span>I kept monitoring during this time as well using SQL Monitor and the only thing that I noticed was the Buffer Free Pages dropped from 1.7 million to .7 million during this 4 hours I spent watching this server.</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">4 hours had passed, Query Results:<span style="mso-spacerun: yes;">  </span></span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">CacheType<span style="mso-spacerun: yes;">   </span>Total Plans<span style="mso-spacerun: yes;">  </span>Total MBs<span style="mso-spacerun: yes;">    </span>Avg Use Count Total MBs &#8211; USE Count 1<span style="mso-spacerun: yes;">   </span>Total Plans </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">&#8212;&#8212;&#8212;-<span style="mso-spacerun: yes;">  </span>&#8212;&#8212;&#8212;&#8211; <span style="mso-spacerun: yes;"> </span>&#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; background: yellow; font-size: 8pt; mso-no-proof: yes; mso-highlight: yellow;">Adhoc<span style="mso-spacerun: yes;">       </span>42270<span style="mso-spacerun: yes;">     </span><span style="mso-spacerun: yes;">   </span>2264.423034<span style="mso-spacerun: yes;">        </span>733<span style="mso-spacerun: yes;">           </span>659.141784<span style="mso-spacerun: yes;">                </span>11827</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Proc<span style="mso-spacerun: yes;">        </span>833<span style="mso-spacerun: yes;">          </span>320.968750<span style="mso-spacerun: yes;">         </span>173396<span style="mso-spacerun: yes;">        </span>6.882812<span style="mso-spacerun: yes;">                  </span>29</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Prepared<span style="mso-spacerun: yes;">    </span>653<span style="mso-spacerun: yes;">          </span>84.187500<span style="mso-spacerun: yes;">          </span>13557<span style="mso-spacerun: yes;">         </span>2.773437<span style="mso-spacerun: yes;">                  </span>26</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Trigger<span style="mso-spacerun: yes;">     </span>35<span style="mso-spacerun: yes;">           </span>21.453125<span style="mso-spacerun: yes;">          </span>6624<span style="mso-spacerun: yes;">          </span>0.609375<span style="mso-spacerun: yes;">                  </span>2</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Check<span style="mso-spacerun: yes;">       </span>31<span style="mso-spacerun: yes;">           </span>0.812500<span style="mso-spacerun: yes;">           </span>11582<span style="mso-spacerun: yes;">         </span>0.023437<span style="mso-spacerun: yes;">                  </span>1</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">View<span style="mso-spacerun: yes;">        </span>327<span style="mso-spacerun: yes;">          </span>36.875000<span style="mso-spacerun: yes;">          </span>8159<span style="mso-spacerun: yes;">          </span>0.000000<span style="mso-spacerun: yes;">                  </span>0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">UsrTab<span style="mso-spacerun: yes;">      </span>4<span style="mso-spacerun: yes;">            </span>0.468750<span style="mso-spacerun: yes;">           </span>1490<span style="mso-spacerun: yes;">          </span>0.000000<span style="mso-spacerun: yes;">                  </span>0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: Times New Roman; font-size: small;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Then I decided instead of waiting for the server to slowly correct itself I would go ahead and issue </span><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">DBCC</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> FREEPROCCACHE</span><span style="font-family: &amp;amp;amp; font-size: 8pt;"> to clear the procedure cache.</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">After DBCC command had run, Query Results:</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">CacheType<span style="mso-spacerun: yes;">  </span>Total Plans<span style="mso-spacerun: yes;">   </span>Total MBs<span style="mso-spacerun: yes;">    </span>Avg Use Count Total MBs &#8211; USE Count 1<span style="mso-spacerun: yes;">    </span>Total Plans</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Proc<span style="mso-spacerun: yes;">       </span>70<span style="mso-spacerun: yes;">            </span>21.031250<span style="mso-spacerun: yes;">          </span>20<span style="mso-spacerun: yes;">            </span>5.804687<span style="mso-spacerun: yes;">                   </span>17</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; background: yellow; font-size: 8pt; mso-no-proof: yes; mso-highlight: yellow;">Adhoc<span style="mso-spacerun: yes;">      </span>215<span style="mso-spacerun: yes;">           </span>5.745986<span style="mso-spacerun: yes;">           </span>3<span style="mso-spacerun: yes;">             </span>0.691299<span style="mso-spacerun: yes;">                   </span>128</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Prepared<span style="mso-spacerun: yes;">   </span>21<span style="mso-spacerun: yes;">            </span>1.625000<span style="mso-spacerun: yes;">           </span>5<span style="mso-spacerun: yes;">             </span>0.523437<span style="mso-spacerun: yes;">                   </span>9</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Trigger<span style="mso-spacerun: yes;">    </span>3<span style="mso-spacerun: yes;">            </span><span style="mso-spacerun: yes;"> </span>1.140625<span style="mso-spacerun: yes;">           </span>6<span style="mso-spacerun: yes;">             </span>0.382812<span style="mso-spacerun: yes;">                   </span>1</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">View<span style="mso-spacerun: yes;">       </span>28<span style="mso-spacerun: yes;">            </span>1.656250<span style="mso-spacerun: yes;">           </span>8<span style="mso-spacerun: yes;">             </span>0.000000<span style="mso-spacerun: yes;">                   </span>0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Buffer Free Pages climbing from .7 million to 1.1 million. I thought I would see Buffer Free Pages go through the roof, but I’m guessing that data cache stepped in and took over what had become available.</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">What I expect to see in the next 12 hours is that the total plans and total MB’s will grow again, but not to the size that it was in the first query.<span style="mso-spacerun: yes;">  </span>I’m going to bed now and I’ll check the server in the morning……</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">And&#8230;I’m back&#8230; </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Results 12 hours after cache was cleared:</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">CacheType<span style="mso-spacerun: yes;">  </span>Total Plans<span style="mso-spacerun: yes;">   </span>Total MBs<span style="mso-spacerun: yes;">    </span>Avg Use Count Total MBs &#8211; USE Count 1<span style="mso-spacerun: yes;">       </span>Total Plans</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212; &#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; background: yellow; font-size: 8pt; mso-no-proof: yes; mso-highlight: yellow;">Adhoc<span style="mso-spacerun: yes;">      </span>61025<span style="mso-spacerun: yes;">         </span>1456.307067<span style="mso-spacerun: yes;">        </span>8<span style="mso-spacerun: yes;">             </span>523.744567<span style="mso-spacerun: yes;">                    </span>46369</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Proc<span style="mso-spacerun: yes;">       </span>348<span style="mso-spacerun: yes;">           </span>138.406250<span style="mso-spacerun: yes;">         </span>4961<span style="mso-spacerun: yes;">          </span>8.828125<span style="mso-spacerun: yes;">            </span><span style="mso-spacerun: yes;">          </span>40</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Prepared<span style="mso-spacerun: yes;">   </span>615<span style="mso-spacerun: yes;">           </span>76.601562<span style="mso-spacerun: yes;">          </span>279<span style="mso-spacerun: yes;">           </span>3.718750<span style="mso-spacerun: yes;">                      </span>46</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Check<span style="mso-spacerun: yes;">      </span>32<span style="mso-spacerun: yes;">            </span>0.781250<span style="mso-spacerun: yes;">           </span>279<span style="mso-spacerun: yes;">           </span>0.218750<span style="mso-spacerun: yes;">                      </span>11</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">Trigger<span style="mso-spacerun: yes;">    </span>16<span style="mso-spacerun: yes;">            </span>6.398437<span style="mso-spacerun: yes;">           </span>1247<span style="mso-spacerun: yes;">          </span>0.000000<span style="mso-spacerun: yes;">                      </span>0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">View<span style="mso-spacerun: yes;">       </span>322<span style="mso-spacerun: yes;">           </span>30.742187<span style="mso-spacerun: yes;">          </span>299<span style="mso-spacerun: yes;">           </span>0.000000<span style="mso-spacerun: yes;">                      </span>0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 8pt; mso-no-proof: yes;">UsrTab<span style="mso-spacerun: yes;">     </span>3<span style="mso-spacerun: yes;">             </span>0.250000<span style="mso-spacerun: yes;">           </span>48<span style="mso-spacerun: yes;">            </span>0.000000<span style="mso-spacerun: yes;">                      </span>0</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;">Conclusion:<span style="mso-spacerun: yes;">  </span>The total number of Adhoc plans in cache were higher than the original baseline, however, the space being used for Adhoc plans was significantly less with the “Optimize For Ad Hoc Workloads” configuration option set on.<span style="mso-spacerun: yes;">  </span>Because this server houses databases that are accessed with an unusual amount of Adhoc queries I will leave this option on.</span></p>
<p class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 8pt;"> </span></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/dbadmin/observing-optimize-for-ad-hoc/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>We ain&#8217;t afraid of no errors!</title>
		<link>/index.php/datamgmt/dbprogramming/we-ain-t-afraid-of-1/</link>
		<comments>/index.php/datamgmt/dbprogramming/we-ain-t-afraid-of-1/#comments</comments>
		<pubDate>Sun, 03 Apr 2011 02:28:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLology ~ Kim Tessereau]]></dc:creator>
				<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>

		<guid isPermaLink="false">/index.php/2011/04/we-ain-t-afraid-of-1/</guid>
		<description><![CDATA[Good old fashion error handling..........This is something that is often skipped over when we code because we don't stop and take the time out to plan it out.  I've put together a presentation on this topic and I'll be submitting it to the next SQL Satu&#8230;]]></description>
				<content:encoded><![CDATA[<p><span style="font-family: &amp;amp;amp; font-size: 10pt;">Good old fashion error handling&#8230;&#8230;&#8230;.This is something that is often skipped over when we code because we don&#8217;t stop and take the time out to plan it out.  I&#8217;ve put together a presentation on this topic and I&#8217;ll be submitting it to the next SQL Saturday that I attend, but would like to share the main points here.</span><span style="font-size: small;"><span style="font-family: Times New Roman;"><span style="mso-spacerun: yes;">  </span>Obviously, there is a lot I left out here, don’t want to spoil the presentation!</span></span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; padding-left: 30px; margin-left: 0.25in; mso-list: l0 level1 lfo2;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><strong><span style="font-family: arial,helvetica,sans-serif;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;">Why do we need error handling?</span></span></strong></p>
<p style="padding-left: 30px;"> <span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"><span style="color: #000000;"><span style="language: en-US; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-bidi-theme-font: minor-bidi; mso-color-index: 3; mso-font-kerning: 12.0pt; mso-style-textfill-type: solid; mso-style-textfill-fill-themecolor: text2; mso-style-textfill-fill-color: #675D59; mso-style-textfill-fill-alpha: 100.0%;">One of the first things that comes to mind is that the calling process needs to be informed if a stored procedure/script has failed or was successful.</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> It is also used to</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;">control the processing of transactions whether they are implicit or explicit.</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> The user needs to be alerted if there is a problem too.</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> Error handling allows us to be able to code for unexpected results and helps to provide data consistency.</span></span></span></span></span></p>
<ul>
<li>
<div style="line-height: 14.25pt; text-indent: -0.25in; margin-left: 0.25in; mso-list: l1 level1 lfo1;"><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="color: #000000;"><span style="font-family: arial,helvetica,sans-serif;"><span><strong><span style="mso-special-format: bullet;">·         </span>@@ERROR Global Variable</strong></span></span></span></span></span></span></div>
</li>
</ul>
<p style="line-height: 14.25pt; margin-left: 0.25in;"><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> </span></span><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="color: #000000;"><span style="language: en-US; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-bidi-theme-font: minor-bidi; mso-color-index: 3; mso-font-kerning: 12.0pt; mso-style-textfill-type: solid; mso-style-textfill-fill-themecolor: text2; mso-style-textfill-fill-color: #675D59; mso-style-textfill-fill-alpha: 100.0%;"><span style="color: #000000;"><span style="font-family: Times New Roman; font-size: small;">@@ERROR is known as a system variable to SQL Server.</span></span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> It is read-only and contains the value of the error number that was generated</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;">in the previous transact SQL statement<strong><span style="font-family: &amp;amp;amp; mso-bidi-font-family: +mn-cs; mso-hansi-font-family: Arial;"> that just processed</span></strong>.</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> Every statement is evaluated to determine whether or not it was successful.</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt;"> </span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> So for example:</span></span></span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">USE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">master</span> <span style="mso-tab-count: 5;">                            </span><span style="color: green;">&#8211;@@ERROR contains 0</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">   </span><span style="color: blue;">SELECT</span> <span style="color: gray;">*</span> <span style="color: blue;">FROM</span> <span style="color: green;">sysobjects</span> <span style="mso-tab-count: 1;">     </span><span style="mso-tab-count: 1;">      </span><span style="color: green;">&#8211;@@ERROR contains 0</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">USE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> model <span style="mso-tab-count: 5;">                             </span><span style="color: green;">&#8211;@@ERROR contains 0</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">   </span><span style="color: blue;">SELECT</span> <span style="color: gray;">*</span> <span style="color: blue;">FROM</span> <span style="color: green;">sysdatabases</span> <span style="mso-tab-count: 1;">   </span><span style="mso-tab-count: 1;">      </span><span style="color: green;">&#8211;@@ERROR contains 208</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">IF</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: gray;">EXISTS</span><span style="color: blue;"> </span><span style="color: gray;">(</span><span style="color: blue;">SELECT</span> <span style="color: gray;">*</span> <span style="color: blue;">FROM</span> <span style="color: green;">sysservers</span><span style="color: gray;">)</span> <span style="mso-tab-count: 1;">  </span><span style="color: green;">&#8211;@@ERROR contains 208</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">   </span><span style="color: blue;">SELECT</span> 1<span style="color: gray;">=</span>1<span style="mso-tab-count: 2;">        </span><span style="mso-tab-count: 3;">                 </span><span style="color: green;">&#8211;@@ERROR contains 102</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">IF</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: fuchsia;">@@ERROR</span> <span style="color: gray;">&gt;</span> 0 <span style="mso-tab-count: 4;">                        </span><span style="color: green;">&#8211;@@ERROR contains 0 </span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">   </span><span style="color: blue;">GOTO</span> somewhere <span style="mso-tab-count: 4;">                     </span><span style="color: green;">&#8211;@@ERROR contains 0</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">somewhere:</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="mso-tab-count: 5;">                            </span><span style="color: green;">&#8211;@@ERROR contains 0</span></span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin-left: 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;">RETURN Statement</span></strong><strong style="mso-bidi-font-weight: normal;"></strong></p>
<p style="line-height: 14.25pt; margin-left: 0.25in;"><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;"> </span></span><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="color: #000000;"><span style="language: en-US; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-bidi-theme-font: minor-bidi; mso-color-index: 3; mso-font-kerning: 12.0pt; mso-style-textfill-type: solid; mso-style-textfill-fill-themecolor: text2; mso-style-textfill-fill-color: #675D59; mso-style-textfill-fill-alpha: 100.0%;"><span style="color: #000000;"><span style="font-size: small;"><span style="font-family: Times New Roman;">The RETURN statement when executed returns control to the call process unconditionally.<span style="mso-spacerun: yes;">  </span>It returns an integer value.<span style="mso-spacerun: yes;">  </span>A warning will be issued it the value is NULL.<span style="mso-spacerun: yes;">  </span></span></span></span></span></span></span></span></span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin-left: 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-font-kerning: 12.0pt; mso-hansi-font-family: Arial;">User-Defined Error Messages</span></strong><strong style="mso-bidi-font-weight: normal;"></strong></p>
<p style="line-height: 14.25pt; margin-left: 0.25in;"><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;"> </span></span><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="color: #000000;"><span style="language: en-US; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-bidi-theme-font: minor-bidi; mso-color-index: 3; mso-font-kerning: 12.0pt; mso-style-textfill-type: solid; mso-style-textfill-fill-themecolor: text2; mso-style-textfill-fill-color: #675D59; mso-style-textfill-fill-alpha: 100.0%;"><span style="color: #000000;"><span style="font-size: small;"><span style="font-family: Times New Roman;">The user-defined error messages are saved in master in sys.messages table.<span style="mso-spacerun: yes;">  </span>They can be used across databases.<span style="mso-spacerun: yes;">  </span>When a user-defined error message is called if can write to the Windows application log.<span style="mso-spacerun: yes;">  </span>The message can be informational or error related, depends on severity level.<span style="mso-spacerun: yes;">  </span>Severity level 20 thru 25 are fatal errors – processing has stopped.</span></span></span></span></span></span></span></span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin-left: 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">RAISERROR Statement</span></strong></p>
<p style="line-height: 14.25pt; margin-left: 0.25in;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">The RAISERROR statement is used to raise user-defined error messages.<span style="mso-spacerun: yes;">  </span>It can be used to raise dynamically built messages.<span style="mso-spacerun: yes;">  </span>The message is returned as a server message.<span style="mso-spacerun: yes;">  </span>It can also raise messages to a Catch block and insert them into the error and application log.<span style="mso-spacerun: yes;">  </span>Here is an example of a RAISERROR statement.</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">DECLARE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @oldname <span style="color: blue;">varchar</span><span style="color: gray;">(</span>15<span style="color: gray;">),</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">   </span><span style="mso-tab-count: 1;">      </span>@newname <span style="color: blue;">varchar</span><span style="color: gray;">(</span>15<span style="color: gray;">)</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 2;">         </span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SET</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @oldname <span style="color: gray;">=</span> <span style="color: red;">&#8216;Cato&#8217;</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">SET</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> @newname <span style="color: gray;">=</span> <span style="color: red;">&#8216;Tessereau&#8217;</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: red; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">RAISERROR </span><span style="font-family: &amp;amp;amp; color: gray; font-size: 10pt; mso-no-proof: yes;">(</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;">50001<span style="color: gray;">,</span><span style="mso-spacerun: yes;">  </span><span style="color: green;">&#8211;user-defined error message number</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 3;">               </span>10<span style="color: gray;">, </span><span style="color: green;">&#8211;severity level</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 3;">               </span>1<span style="color: gray;">,<span style="mso-spacerun: yes;">  </span></span><span style="color: green;">&#8211;error state</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 3;">               </span>@oldname,</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt 0.25in; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 2;">         </span><span style="mso-tab-count: 1;">      </span>@newname<span style="color: gray;">)</span> <span style="color: blue;">WITH</span> <span style="color: fuchsia;">LOG</span><span style="color: gray;">;</span></span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin-left: 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">TRY/CATCH Blocks</span></strong></p>
<p style="line-height: 14.25pt;"><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;"> </span></span><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="color: #000000;"><span style="language: en-US; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-bidi-theme-font: minor-bidi; mso-color-index: 3; mso-font-kerning: 12.0pt; mso-style-textfill-type: solid; mso-style-textfill-fill-themecolor: text2; mso-style-textfill-fill-color: #675D59; mso-style-textfill-fill-alpha: 100.0%;"><span style="color: #000000;"><span style="font-size: small;"><span style="font-family: Times New Roman;">These consist of two parts a TRY block and a CATCH block.<span style="mso-spacerun: yes;">  </span>Logic control is passed to the CATCH block from the TRY block when an error is encountered.<span style="mso-spacerun: yes;">  </span>They can be nested, but be careful when doing this because the logic can get very confusing the deeper you nest.<span style="mso-spacerun: yes;">  </span>Severity 20 or higher not handled by TRY/CATCH because connection is closed.<span style="mso-spacerun: yes;">  </span>Severity 10 or less not handled, these are informational only.<span style="mso-spacerun: yes;">  </span>Here is an example of a simple TRY/CATCH block.</span></span></span></span></span></span></span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">CREATE</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">PROC</span> usp_myproc</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">AS</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">  </span><span style="color: green;">&#8211;just a silly little proc</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-spacerun: yes;">  </span><span style="color: blue;">SELECT</span> <span style="color: gray;">*</span> <span style="color: blue;">FROM</span> <span style="color: gray;">&lt;</span><span style="color: blue;">table</span> that does <span style="color: gray;">not</span> exist<span style="color: gray;">&gt;;</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">GO</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;"> </span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">BEGIN</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">TRY</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">      </span><span style="color: blue;">EXEC</span> usp_myproc</span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">END</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">TRY</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">BEGIN</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">CATCH</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">      </span><span style="color: blue;">SELECT</span> </span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 2;">            </span><span style="color: fuchsia;">ERROR_NUMBER</span><span style="color: gray;">()</span> <span style="color: blue;">as</span> ErrNum<span style="color: gray;">,</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 2;">            </span><span style="color: fuchsia;">ERROR_MESSAGE</span><span style="color: gray;">()</span> <span style="color: blue;">as</span> ErrMsg<span style="color: gray;">;</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">END</span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"> <span style="color: blue;">CATCH</span></span></p>
<p class="MsoNormal" style="line-height: normal; margin: 0in 0in 0pt; mso-layout-grid-align: none;"><span style="font-family: &amp;amp;amp; color: blue; font-size: 10pt; mso-no-proof: yes;">GO</span></p>
<p style="line-height: 14.25pt;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;"><span style="mso-tab-count: 1;">      </span></span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin: 0in 0in 0pt; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-no-proof: yes;">XACT_ABORT statement</span></strong><strong style="mso-bidi-font-weight: normal;"></strong></p>
<p style="line-height: 14.25pt; margin: 0in 0in 0pt;"><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;"> </span></span><span style="font-family: arial,helvetica,sans-serif;"><span style="font-size: x-small;"><span style="color: #000000;"><span style="language: en-US; mso-ascii-font-family: Calibri; mso-fareast-font-family: +mn-ea; mso-bidi-font-family: +mn-cs; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-bidi-theme-font: minor-bidi; mso-color-index: 3; mso-font-kerning: 12.0pt; mso-style-textfill-type: solid; mso-style-textfill-fill-themecolor: text2; mso-style-textfill-fill-color: #675D59; mso-style-textfill-fill-alpha: 100.0%;"><span style="color: #000000;"><span style="font-size: small;"><span style="font-family: Times New Roman;">OFF is the default setting.<span style="mso-spacerun: yes;">  </span>Compile errors are not affected by XACT_ABORT.</span></span></span></span></span></span></span></span></p>
<p style="line-height: 14.25pt; margin: 0in 0in 0pt;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">When set to ON</span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin: 0in 0in 0pt 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">Processing stops when an error is encountered</span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin: 0in 0in 0pt 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">When run-time error is raised, entire transaction is rolled back automatically, no need for ROLLBACK statement.</span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin: 0in 0in 0pt 0.25in; mso-list: l2 level1 lfo3;"><span style="font-family: Symbol; font-size: 10pt; mso-fareast-font-family: Symbol; mso-bidi-font-family: Symbol;"><span style="mso-list: Ignore;">·<span style="font: 7pt &amp;amp;amp;">         </span></span></span><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-ascii-theme-font: minor-latin; mso-bidi-theme-font: minor-latin; mso-hansi-theme-font: minor-latin;">When combined with a TRY/CATCH block you get unexpected behavior</span></p>
<p style="line-height: 14.25pt; text-indent: -0.25in; margin: 0in 0in 0pt 0.75in; mso-list: l2 level2 lfo3;"><span style="font-family: &amp;amp;amp; font-size: 10pt; mso-fareast-font-family: 'Courier New';"><span style="mso-list: Ignore;">o<span style="font: 7pt &amp;amp;amp;">    </span></span></span><span style="font-size: 10pt; mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin;"><span style="font-family: Times New Roman;">SQL Server treats statement level errors as batch level errors</span></span></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/dbprogramming/we-ain-t-afraid-of-1/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>Wow what a week in review&#8230;..</title>
		<link>/index.php/datamgmt/datadesign/wow-what-a-week-in/</link>
		<comments>/index.php/datamgmt/datadesign/wow-what-a-week-in/#comments</comments>
		<pubDate>Wed, 30 Mar 2011 22:43:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLology ~ Kim Tessereau]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[SSIS]]></category>
		<category><![CDATA[SSRS]]></category>

		<guid isPermaLink="false">/index.php/2011/03/wow-what-a-week-in/</guid>
		<description><![CDATA[Well this is my first blog posting and I have plenty to blog about.  Last week was amazing!  It all started on....
Tuesday:  My day started at Microsoft in St. Louis.  I got there nerdy early, as usual.  Microsoft is located on the 11th floor so I rode&#8230;]]></description>
				<content:encoded><![CDATA[<p>Well this is my first blog posting and I have plenty to blog about.  Last week was amazing!  It all started on&#8230;.</p>
<p><strong>Tuesday:</strong> My day started at Microsoft in St. Louis.  I got there nerdy early, as usual.  Microsoft is located on the 11th floor so I rode the elevator up and the doors opened up and there stood two guys and a bunch of bagels!  It was Jose and Austin from PragmaticWorks.  They were waiting for Brian Knight to open up the doors to the office so they could setup for the day.  Today was the first day of an SSAS Workshop and I was eager to get started.  People started filing in right away.  It was good to hook up with lots of folks from our SQL Server User Group in St. Louis, Julie Bloomquist, Pete Williams, John Dempsey, Rosa Johnson and Phil Milner.  And then a semi-familiar face came through the door, it was Bill Fellows from KC!  This was shaping up to be quite a social event as well as a technical one.   Brian Knight started right on que at 8:30am.  He has incredible energy, like you can tell when he is in the house!  Class started out fast and furious and Brian took us from 0 to 60 in no time at all.  Before we knew it we were brousing our first cube.  By the end of the day everyone&#8217;s head was spinning with thoughts of what they could implement back at the ranch.</p>
<p><strong>Wednesday: </strong>Back to Microsoft and I was early again (a little habit I&#8217;ve got).  Brian stopped by and chatted with me for a while and asked if I would help him with his first demo of the day.  Well, of couse, I was excited!  He likes to make things fun so he made up this website called Swank Dating Site.  I work for Swank Motion Pictures and everyone is always asking if it&#8217;s legit!  We had a lot of fun with it and the class was in a roar most of the morning.  I learned a ton and refined most of my BI skillset, which reined from SQL Server 2005.  After class was over myself and John Dempsey invited Brian and his crew out for dinner and a drink at the local pub.  It was great spending time with these guys, they were so full of energy and so much fun!</p>
<p><strong>Thursday: </strong>And we&#8217;re back at Microsoft for another round with Brian and company!  This time it was an executive BI roundtable event.  And the event was being moderated by Jin Cho, Microsoft’s Business Intelligence Technology Solutions Professional.  He was great, giving us good information about how to solve business problems with BI.  Brian also kick in a demo on some of the front-end tools that are part of the Microsoft BI stack.  Lots of great conversation surrounded this event.</p>
<p><strong>Friday: </strong>Back at Swank for the morning and then off at noon to pick up my SQL Saturday buddies!  John Dempsey, Sanil Mhatre and Danielle Beniot.  We were off to Chicago for the next couple of days!  We made great time getting up to Chicago and pulled into town about 5:30pm.  Danielle scouted out a great place for sushi, called Orchid, I thought it was a great name for a primary key!  After dinner it was back to the hotel for a few drinks.  Wendy Pastrick tweeted that she and others were at the pool so off we went to meet up with them.  It turned out to be kind of an unscheduled pre-party for #sqlsat67.   I had a great time seeing a few people I had met before, Wendy, Michelle Ufford and Tom LaRock.  And I got to meet Christina Leo and Jes Borland for the first time.  Well time slipped away from me and before I knew it, it was time to hit the hay.</p>
<p><strong>Saturday:</strong> Up early and heading over to DeVry University for a great day with friends!  We were all very excited to be sitting in on some excellent sessions given by excellent presenter&#8217;s.  The day went by so fast I could hardly believe it.  Before I knew it was lunch time and I was up to speak at the WIT Lunch panel.  I love being involved with the virtual chapter of Women In Technology group.  The topic for the day was &#8220;Energizing the Next Generation&#8221;.  Jes did a great job of moderating and Wendy, Hope Foley and Miyaka Tabe were all so good!  And then, as fast as the morning had went so did the afternoon and there we stood as everyone cheered to close out the second, very successful SQL Saturday Chicago!  I was so proud to be a part of it! </p>
<p><strong>Sunday: </strong>I think I had a SQL Server hangover after all of that!</p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/wow-what-a-week-in/feed/</wfw:commentRss>
		<slash:comments>11</slash:comments>
		</item>
	</channel>
</rss>
