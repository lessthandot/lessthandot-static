<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Inverse Mapped Collections and NHibernate&#8217;s Second-Level Cache</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Inverse Mapped Collections and NHibernate&#8217;s Second-Level Cache" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="In order to simplify saving some entities, I recently changed some mappings in my application to use the inverse attribute.  In less cryptic terms, this means that the collection item is responsible for maintaining the relationship to the collection own&hellip;" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Inverse Mapped Collections and NHibernate&#8217;s Second-Level Cache Comments Feed" href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Not as anonymous as you thought you were&#8230;' href='/index.php/itprofessionals/ethicsit/not-as-anonymous-as-you/' />
<link rel='next' title='24 Hours of PASS, WIT Edition: Register! Learn! Listen to Me!' href='/index.php/datamgmt/dbadmin/24-hours-of-pass-wit-1/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/" />
<link rel='shortlink' href='/?p=1040' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fwebdev%2Fserverprogramming%2Finverse-mapped-collections-and-nhibernate-s-second-level-cache%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fwebdev%2Fserverprogramming%2Finverse-mapped-collections-and-nhibernate-s-second-level-cache%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/datamgmt/dbadmin/24-hours-of-pass-wit-1/" rel="next">24 Hours of PASS, WIT Edition: Register! Learn! Listen to Me!</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/itprofessionals/ethicsit/not-as-anonymous-as-you/" rel="prev">Not as anonymous as you thought you were&#8230;</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/" class="post-title">Inverse Mapped Collections and NHibernate&#8217;s Second-Level Cache</a></h1>
					<div class="post-byline">by <a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich" rel="author">Alex Ullrich</a> on February 14, 2011 in category <a href="/index.php/category/webdev/serverprogramming/aspnet/" rel="category tag">ASP.NET</a> <a href="/index.php/category/webdev/serverprogramming/" rel="category tag">Server Programming</a>. Article views: 13,216 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&text=RT @LessThanDot Blog - Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache by @AlexCuse" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&title=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache&source=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&title=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&quote=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&title=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>In order to simplify saving some entities, I recently changed some mappings in my application to use the <strong>inverse</strong> attribute.  In less cryptic terms, this means that the collection item is responsible for maintaining the relationship to the collection owner.  In contrast, when using a standard relationship the parent entity is responsible for managing the collection items.  The reason for this is that it lets you save the collection items without going to the database (or second level cache) to get the collection&#8217;s owner.</p>
<p>This can make things a little weird &#8211; the primary difference is that both sides of the relationship now need to be aware that they are participants.  Say you have the following two classes, and the corresponding mappings (sorry, I used Fluent NHibernate):</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="de1"><pre class="de1"><span class="kw4">class</span> Recipe <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">long</span> Id <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">string</span> Name <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; IList<span class="sy0">&lt;</span>IngredientUse<span class="sy0">&gt;</span> IngredientsUsed <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">class</span> IngredientUse <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">long</span> Id <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">double</span> Quantity <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> Ingredient Ingredient <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">class</span> RecipeMap <span class="sy0">:</span> ClassMap<span class="sy0">&lt;</span>Recipe<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; Id <span class="br0">&#40;</span>r <span class="sy0">=&gt;</span> r<span class="sy0">.</span><span class="me1">Id</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; Map <span class="br0">&#40;</span>r <span class="sy0">=&gt;</span> r<span class="sy0">.</span><span class="me1">Name</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; HasMany <span class="br0">&#40;</span>i <span class="sy0">=&gt;</span> i<span class="sy0">.</span><span class="me1">IngredientsUsed</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">class</span> IngredientUseMap <span class="sy0">:</span> ClassMap<span class="sy0">&lt;</span>IngredientUse<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; Id <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Id</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; Map <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Quantity</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; References <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Ingredient</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">class Recipe {
    public long Id { get; set; }
    public string Name { get; set; }
    IList&lt;IngredientUse&gt; IngredientsUsed { get; set; }
}

class IngredientUse {
    public long Id { get; set; }
    public double Quantity { get; set; }
    public Ingredient Ingredient { get; set; }
}

class RecipeMap : ClassMap&lt;Recipe&gt; {
    Id (r =&gt; r.Id);
    Map (r =&gt; r.Name);
    HasMany (i =&gt; i.IngredientsUsed);
}

class IngredientUseMap : ClassMap&lt;IngredientUse&gt; {
    Id (iu =&gt; iu.Id);
    Map (iu =&gt; iu.Quantity);
    References (iu =&gt; iu.Ingredient);
}</pre></div></div>

<p>This is pretty straightforward, but it does do a little bit of magic behind the scenes.  For example, even though the IngredientUse entity is not referencing the Recipe, NHibernate will expect a column called &#8220;Recipe_id&#8221; on the IngredientUse table in the database that it can use to maintain the relationship between the two entities.  </p>
<p>When using an inverse relationship, a few changes are needed.  First, you map the collection (from the Recipe&#8217;s perspective) using the inverse attribute.  Also, you need to reference the Recipe from the Ingredient (and the associated mapping).  So the inverse mappings look like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="de1"><pre class="de1"><span class="kw4">class</span> Recipe <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">long</span> Id <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">string</span> Name <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; IList<span class="sy0">&lt;</span>IngredientUse<span class="sy0">&gt;</span> IngredientsUsed <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">class</span> IngredientUse <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">long</span> Id <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">double</span> Quantity <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> Ingredient Ingredient <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="kw1">public</span> Recipe Recipe <span class="br0">&#123;</span> <span class="kw1">get</span><span class="sy0">;</span> <span class="kw1">set</span><span class="sy0">;</span> <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">class</span> RecipeMap <span class="sy0">:</span> ClassMap<span class="sy0">&lt;</span>Recipe<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; Id <span class="br0">&#40;</span>r <span class="sy0">=&gt;</span> r<span class="sy0">.</span><span class="me1">Id</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; Map <span class="br0">&#40;</span>r <span class="sy0">=&gt;</span> r<span class="sy0">.</span><span class="me1">Name</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; HasMany <span class="br0">&#40;</span>i <span class="sy0">=&gt;</span> i<span class="sy0">.</span><span class="me1">IngredientsUsed</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">Inverse</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw4">class</span> RecipeMap <span class="sy0">:</span> ClassMap<span class="sy0">&lt;</span>IngredientUse<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; Id <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Id</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; Map <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Quantity</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; References <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Ingredient</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; References <span class="br0">&#40;</span>iu <span class="sy0">=&gt;</span> iu<span class="sy0">.</span><span class="me1">Recipe</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">class Recipe {
    public long Id { get; set; }
    public string Name { get; set; }
    IList&lt;IngredientUse&gt; IngredientsUsed { get; set; }
}

class IngredientUse {
    public long Id { get; set; }
    public double Quantity { get; set; }
    public Ingredient Ingredient { get; set; }
    public Recipe Recipe { get; set; }
}

class RecipeMap : ClassMap&lt;Recipe&gt; {
    Id (r =&gt; r.Id);
    Map (r =&gt; r.Name);
    HasMany (i =&gt; i.IngredientsUsed).Inverse ();
}

class RecipeMap : ClassMap&lt;IngredientUse&gt; {
    Id (iu =&gt; iu.Id);
    Map (iu =&gt; iu.Quantity);
    References (iu =&gt; iu.Ingredient);
    References (iu =&gt; iu.Recipe);
}</pre></div></div>

<p>It&#8217;s important to note that the updated mapping expects the exact same underlying DB structure.  So the model is starting to look a bit more like the database.  What this gets you is the ability to save an IngredientUse without first needing to retrieve the recipe you want to add it to.  So instead of saving it like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw4">void</span> Save <span class="br0">&#40;</span>IngredientUse ingredientUse, <span class="kw4">long</span> recipeId<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">var</span> recipe <span class="sy0">=</span> session<span class="sy0">.</span><span class="kw1">Get</span><span class="sy0">&lt;</span>Recipe<span class="sy0">&gt;</span> <span class="br0">&#40;</span>recipeId<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; recipe<span class="sy0">.</span><span class="me1">AddIngredientUse</span> <span class="br0">&#40;</span>ingredientUse<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; session<span class="sy0">.</span><span class="me1">SaveOrUpdate</span> <span class="br0">&#40;</span>recipe<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">void Save (IngredientUse ingredientUse, long recipeId) {
    var recipe = session.Get&lt;Recipe&gt; (recipeId);
    recipe.AddIngredientUse (ingredientUse);
    session.SaveOrUpdate (recipe);
}</pre></div></div>

<p>You now save it like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw4">void</span> Save <span class="br0">&#40;</span>IngredientUse ingredientUse, <span class="kw4">long</span> recipeId<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; ingredientUse<span class="sy0">.</span><span class="me1">Recipe</span> <span class="sy0">=</span> session<span class="sy0">.</span><span class="me1">Load</span><span class="sy0">&lt;</span>Recipe<span class="sy0">&gt;</span> <span class="br0">&#40;</span>recipeId<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; session<span class="sy0">.</span><span class="me1">SaveOrUpdate</span> <span class="br0">&#40;</span>ingredientUse<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">void Save (IngredientUse ingredientUse, long recipeId) {
    ingredientUse.Recipe = session.Load&lt;Recipe&gt; (recipeId);
    session.SaveOrUpdate (ingredientUse);
}</pre></div></div>

<p>The difference between Load and Get in this case is worth noting.  Load will NEVER return null, it will get your entity or throw an exception.  Get on the other hand can return null.  So when you use Load, you are essentially telling NHibernate &#8220;this entity IS in the database, trust me&#8221;.  That enables NHibernate to use a proxy instead of going out to make sure your entity actually exists.  And since we only need the Id, that proxy will never need to go out and load any of the actual object data.  I found this especially useful when saving an IngredientUse at the end of an HTTP request.</p>
<p>A perfectly logical side effect (that I didn&#8217;t consider) to this change is the presence of stale results in NHibernate&#8217;s second level cache.  Because the Recipe&#8217;s associated collections are cached in relation to the Recipe, and the Recipe is never saved, the collection does not get updated in the cache.  I thought I was stuck for a bit, until I found the Session Factory&#8217;s <a href="http://ajava.org/online/hibernate3api/org/hibernate/SessionFactory.html#evictCollection%28java.lang.String,%20java.io.Serializable%29">&#8220;EvictCollection&#8221;</a> method.  This is one of those &#8220;use at your own risk&#8221; methods, so consider yourself warned.  If abused, this could get pretty ugly (leading to a situation where you&#8217;d be better off not caching your collections at all).  However, I&#8217;ve got an app where I expect far more reads than writes, and I don&#8217;t think I&#8217;ll be using it all over the place, so I think this method can be leveraged to solve my problem.</p>
<p>The EvictCollection method&#8217;s overload that we are interested in takes a string representing the fully qualified collection name, and an object representing the Id of the <strong>parent object</strong> (in this case the Recipe).  So the call we need to make looks something like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sessionFactory<span class="sy0">.</span><span class="me1">EvictCollection</span><span class="br0">&#40;</span><span class="st0">&quot;MyApp.Domain.Recipe.IngredientsUsed&quot;</span>, <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sessionFactory.EvictCollection("MyApp.Domain.Recipe.IngredientsUsed", 1);</pre></div></div>

<p>Easy enough, but the approach leaves a bit to be desired.  Because of the magical string, this approach will not be refactoring-friendly, and prone to runtime errors.  By using a few LINQ expressions we can do a bit better though.  We&#8217;ll create a class called CollectionEvictor to take care of this stuff for us.  But first we&#8217;ll write a test.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="de1"><pre class="de1"><span class="br0">&#91;</span>Test<span class="br0">&#93;</span>
<span class="kw1">public</span> <span class="kw4">void</span> Evict <span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">var</span> mockery <span class="sy0">=</span> <span class="kw3">new</span> MockRepository <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="kw1">var</span> sessionFactory <span class="sy0">=</span> mockery<span class="sy0">.</span><span class="me1">StrictMock</span><span class="sy0">&lt;</span>ISessionFactory<span class="sy0">&gt;</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">var</span> ingredientUse <span class="sy0">=</span> <span class="kw3">new</span> IngredientUse <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; Recipe <span class="sy0">=</span> <span class="kw3">new</span> Recipe <span class="br0">&#123;</span> Id <span class="sy0">=</span> <span class="nu0">1</span> <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">using</span> <span class="br0">&#40;</span>mockery<span class="sy0">.</span><span class="me1">Record</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; sessionFactory<span class="sy0">.</span><span class="me1">EvictCollection</span> <span class="br0">&#40;</span><span class="st0">&quot;MyApp.Domain.Recipe.IngredientsUsed&quot;</span>, additionUse<span class="sy0">.</span><span class="me1">Recipe</span><span class="sy0">.</span><span class="me1">Id</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; <span class="kw1">using</span> <span class="br0">&#40;</span>mockery<span class="sy0">.</span><span class="me1">Playback</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">var</span> evictor <span class="sy0">=</span> <span class="kw3">new</span> CollectionEvictor<span class="sy0">&lt;</span>IngredientUse<span class="sy0">&gt;</span> <span class="br0">&#40;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x <span class="sy0">=&gt;</span> x<span class="sy0">.</span><span class="me1">Recipe</span><span class="sy0">.</span><span class="me1">IngredientsUsed</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x <span class="sy0">=&gt;</span> x<span class="sy0">.</span><span class="me1">Recipe</span><span class="sy0">.</span><span class="me1">Id</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sessionFactory<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; evictor<span class="sy0">.</span><span class="me1">Evict</span><span class="br0">&#40;</span>additionUse<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">[Test]
public void Evict ()
{
    var mockery = new MockRepository ();
    var sessionFactory = mockery.StrictMock&lt;ISessionFactory&gt; ();

    var ingredientUse = new IngredientUse {
        Recipe = new Recipe { Id = 1 }
    };

    using (mockery.Record ()) {
        sessionFactory.EvictCollection ("MyApp.Domain.Recipe.IngredientsUsed", additionUse.Recipe.Id);
    }
            
    using (mockery.Playback ()) {
        var evictor = new CollectionEvictor&lt;IngredientUse&gt; (
            x =&gt; x.Recipe.IngredientsUsed,
            x =&gt; x.Recipe.Id,
            sessionFactory);

        evictor.Evict(additionUse);
    }
}</pre></div></div>

<p>And the class is pretty straight forward as well:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw4">class</span> CollectionEvictor<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="kw1">where</span> T <span class="sy0">:</span> <span class="kw4">class</span>
<span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">readonly</span> MemberExpression collectionProperty<span class="sy0">;</span>
&nbsp; &nbsp; <span class="kw1">readonly</span> Func<span class="sy0">&lt;</span>T, <span class="kw4">object</span><span class="sy0">&gt;</span> idFunction<span class="sy0">;</span>
&nbsp; &nbsp; <span class="kw1">readonly</span> ISessionFactory sessionFactory<span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> CollectionEvictor <span class="br0">&#40;</span>Expression<span class="sy0">&lt;</span>Func<span class="sy0">&lt;</span>T, <span class="kw4">object</span><span class="sy0">&gt;&gt;</span> collectionProperty, Func<span class="sy0">&lt;</span>T, <span class="kw4">object</span><span class="sy0">&gt;</span> idFunction<span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">:</span> <span class="kw1">this</span> <span class="br0">&#40;</span>collectionProperty, idFunction, ObjectFactory<span class="sy0">.</span><span class="me1">GetInstance</span><span class="sy0">&lt;</span>ISessionFactory<span class="sy0">&gt;</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#123;</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> CollectionEvictor <span class="br0">&#40;</span>Expression<span class="sy0">&lt;</span>Func<span class="sy0">&lt;</span>T, <span class="kw4">object</span><span class="sy0">&gt;&gt;</span> collectionProperty, Func<span class="sy0">&lt;</span>T, <span class="kw4">object</span><span class="sy0">&gt;</span> idFunction, ISessionFactory sessionFactory<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">this</span><span class="sy0">.</span><span class="me1">collectionProperty</span> <span class="sy0">=</span> collectionProperty<span class="sy0">.</span><span class="me1">Body</span> <span class="kw1">as</span> MemberExpression<span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">this</span><span class="sy0">.</span><span class="me1">idFunction</span> <span class="sy0">=</span> idFunction<span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">this</span><span class="sy0">.</span><span class="me1">sessionFactory</span> <span class="sy0">=</span> sessionFactory<span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">void</span> Evict <span class="br0">&#40;</span>T updated<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">var</span> key <span class="sy0">=</span> collectionProperty<span class="sy0">.</span><span class="me1">Expression</span><span class="sy0">.</span><span class="me1">Type</span><span class="sy0">.</span><span class="me1">FullName</span> <span class="sy0">+</span> <span class="st0">&quot;.&quot;</span> <span class="sy0">+</span> collectionProperty<span class="sy0">.</span><span class="me1">Member</span><span class="sy0">.</span><span class="me1">Name</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; sessionFactory<span class="sy0">.</span><span class="me1">EvictCollection</span> <span class="br0">&#40;</span>key, idFunction<span class="sy0">.</span><span class="me1">Invoke</span> <span class="br0">&#40;</span>updated<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public class CollectionEvictor&lt;T&gt; where T : class
{
    readonly MemberExpression collectionProperty;
    readonly Func&lt;T, object&gt; idFunction;
    readonly ISessionFactory sessionFactory;

    public CollectionEvictor (Expression&lt;Func&lt;T, object&gt;&gt; collectionProperty, Func&lt;T, object&gt; idFunction)
        : this (collectionProperty, idFunction, ObjectFactory.GetInstance&lt;ISessionFactory&gt; ()){ }

    public CollectionEvictor (Expression&lt;Func&lt;T, object&gt;&gt; collectionProperty, Func&lt;T, object&gt; idFunction, ISessionFactory sessionFactory)
    {
        this.collectionProperty = collectionProperty.Body as MemberExpression;
        this.idFunction = idFunction;
        this.sessionFactory = sessionFactory;
    }

    public void Evict (T updated)
    {
        var key = collectionProperty.Expression.Type.FullName + "." + collectionProperty.Member.Name;
        sessionFactory.EvictCollection (key, idFunction.Invoke (updated));
    }
}</pre></div></div>

<p>And now we&#8217;ve got something that&#8217;s a bit awkward, but at least checked at compile time.  It seems strange that we need to go through the IngredientUse&#8217;s link back to the recipe to specify the collection, but that is one of the things that allows us to do it in a generic fashion.  The key to making this happen is the LINQ expression type, that allows us to store the lambda expression as <strong>data</strong> instead of as executable code, allowing us to get much more information about it&#8217;s signature.  By taking its body and casting it to a MemberExpression (thanks <a href="/index.php/All/?disp=authdir&amp;author=225">Matt!</a>) it becomes easy to get the full name of the Recipe type, and the name of the property referenced in the function.  We can then put these together and get our magical string.  Because we don&#8217;t need to execute anything but the call to get the attached Recipe&#8217;s Id, we don&#8217;t need to load anything from the database and can use the information our proxy already has.</p>
<p>Assuming there&#8217;s already a base repository defined, it can be extended like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw1">abstract</span> <span class="kw4">class</span> CollectionEvictingRepository<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="sy0">:</span> BaseRepository<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="kw1">where</span> T <span class="sy0">:</span> <span class="kw4">class</span>, <span class="kw3">new</span> <span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">protected</span> <span class="kw1">readonly</span> IList<span class="sy0">&lt;</span>CollectionEvictor<span class="sy0">&lt;</span>T<span class="sy0">&gt;&gt;</span> evictors <span class="sy0">=</span> <span class="kw3">new</span> List<span class="sy0">&lt;</span>CollectionEvictor<span class="sy0">&lt;</span>T<span class="sy0">&gt;&gt;</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw1">override</span> <span class="kw4">void</span> Save <span class="br0">&#40;</span>T toSave<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">base</span><span class="sy0">.</span><span class="me1">Save</span> <span class="br0">&#40;</span>toSave<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; EvictCollections <span class="br0">&#40;</span>toSave<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw1">override</span> <span class="kw4">void</span> <span class="kw1">Remove</span> <span class="br0">&#40;</span>T toRemove<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">base</span><span class="sy0">.</span><span class="kw1">Remove</span> <span class="br0">&#40;</span>toRemove<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; EvictCollections <span class="br0">&#40;</span>toRemove<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw4">void</span> EvictCollections <span class="br0">&#40;</span>T toSave<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">foreach</span> <span class="br0">&#40;</span><span class="kw1">var</span> evictor <span class="kw1">in</span> evictors<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; evictor<span class="sy0">.</span><span class="me1">Evict</span> <span class="br0">&#40;</span>toSave<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public abstract class CollectionEvictingRepository&lt;T&gt; : BaseRepository&lt;T&gt; where T : class, new ()
{
    protected readonly IList&lt;CollectionEvictor&lt;T&gt;&gt; evictors = new List&lt;CollectionEvictor&lt;T&gt;&gt; ();

    public override void Save (T toSave)
    {
        base.Save (toSave);
        EvictCollections (toSave);
    }

    public override void Remove (T toRemove)
    {
        base.Remove (toRemove);
        EvictCollections (toRemove);
    }

    void EvictCollections (T toSave)
    {
        foreach (var evictor in evictors) {
            evictor.Evict (toSave);
        }
    }
}</pre></div></div>

<p>As you can see, this calls the standard Save/Delete behavior, then evicts any collections that have been invalidated as a result of the operation.  Implementations can then look like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw1">sealed</span> <span class="kw4">class</span> AdditionUseRepository <span class="sy0">:</span> CollectionEvictingRepository<span class="sy0">&lt;</span>AdditionUse<span class="sy0">&gt;</span>
<span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">public</span> AdditionUseRepository<span class="br0">&#40;</span><span class="br0">&#41;</span> 
&nbsp; &nbsp; <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; evictors<span class="sy0">.</span><span class="kw1">Add</span><span class="br0">&#40;</span><span class="kw3">new</span> CollectionEvictor<span class="sy0">&lt;</span>IngredientUse<span class="sy0">&gt;</span><span class="br0">&#40;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance <span class="sy0">=&gt;</span> instance<span class="sy0">.</span><span class="me1">Recipe</span><span class="sy0">.</span><span class="me1">IngredientsUsed</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; instance <span class="sy0">=&gt;</span> instance<span class="sy0">.</span><span class="me1">Recipe</span><span class="sy0">.</span><span class="me1">Id</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public sealed class AdditionUseRepository : CollectionEvictingRepository&lt;AdditionUse&gt;
{
	public AdditionUseRepository() 
	{
	    evictors.Add(new CollectionEvictor&lt;IngredientUse&gt;(
                instance =&gt; instance.Recipe.IngredientsUsed,
	        instance =&gt; instance.Recipe.Id));
	}
}</pre></div></div>

<p>All told this is a pretty naive implementation (You&#8217;ll need to check for null after casting to MemberExpression, etc&#8230;) but I think it shows the idea pretty well.  You may not ever need to use an Inverse relationship, but if you do, and need to pair it with a second level cache, something like this might come in handy.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/smo-script-index-and-fk-s-on-a-database/'>SMO Script Index and FK's on a database</a><p>This is a quick one and I see one issue already in the script generating&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/how-to-refresh-the-local-intellisense-ca/'>How to refresh the local IntelliSense cache in SQL Server Management Studio</a><p>This question came up again yesterday in our SQL Server forum so I decided to&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://forum.lessthandot.com/download/file.php?avatar=56_1270084566.jpg" alt="User bio image"/>Alex is a software engineer from southeastern PA, where he lives with a lovely wife and a veritable smorgasbord of pets.  He loves mountain biking, open source software, barbecue and Syracuse basketball.<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/AlexCuse" title="AlexCuse at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/in/alexullrich" title="AlexCuse at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="/index.php/author/alexcuse/feed/" title="Blog RSS feed for AlexCuse" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 13,216 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/alexcuse/">Read More Posts by Alex Ullrich</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&text=RT @LessThanDot Blog - Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache by @AlexCuse" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&title=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache&source=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&title=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&quote=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/&title=Inverse Mapped Collections and NHibernate&amp;#8217;s Second-Level Cache" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		3 Comments	</h4>
			<ol class="comments-list">
					<li class="comment even thread-even depth-1" id="comment-3615">
				<div id="div-comment-3615" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9243c3d64f4e9ce2ad01761731c0db3a?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9243c3d64f4e9ce2ad01761731c0db3a?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Bishop</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/#comment-3615">
			February 16, 2011 at 1:26 am</a>		</div>

		<p>I spotted a typo while reading : </p>
<p># class  RecipeMap : ClassMap &lt; IngredientUse &gt; {</p>
<p>My guess would be that it should be </p>
<p># class  IngredientUseMap : ClassMap &lt; IngredientUse &gt; {</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/?replytocom=3615#respond' onclick='return addComment.moveForm( "div-comment-3615", "3615", "respond", "1040" )' aria-label='Reply to Bishop'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcuse bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-3616">
				<div id="div-comment-3616" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Alex Ullrich</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/#comment-3616">
			February 16, 2011 at 3:44 am</a>		</div>

		<p>Right you are Bishop, thanks for pointing it out.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/?replytocom=3616#respond' onclick='return addComment.moveForm( "div-comment-3616", "3616", "respond", "1040" )' aria-label='Reply to Alex Ullrich'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-3617">
				<div id="div-comment-3617" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/e3cf0d2e3ac6a86c1623d4eaedc3f9b3?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/e3cf0d2e3ac6a86c1623d4eaedc3f9b3?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">waqas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/#comment-3617">
			April 20, 2011 at 7:20 am</a>		</div>

		<p>here is another v good read about NHibernate L2 caching, </p>
<p><a href="http://www.alachisoft.com/ncache/nhibernate_l2cache_index.html" rel="nofollow">http://www.alachisoft.com/ncache/nhibernate_l2cache_index.html</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/?replytocom=3617#respond' onclick='return addComment.moveForm( "div-comment-3617", "3617", "respond", "1040" )' aria-label='Reply to waqas'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/webdev/serverprogramming/inverse-mapped-collections-and-nhibernate-s-second-level-cache/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1040' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="3295c76acbf4caaed33c36b1b5fc2cb1"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765966"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
