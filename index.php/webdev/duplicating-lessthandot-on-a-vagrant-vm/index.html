<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Duplicating LessThanDot on a Vagrant VM</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Duplicating LessThanDot on a Vagrant VM" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/" />
	<meta prefix="og: http://ogp.me/ns#" property="og:image" content="/wp-content/uploads/2016/01/Vagrant-200x200.png" /> <!-- thumbnail -->
				<meta prefix="og: http://ogp.me/ns#" property="og:image" content="/wp-content/uploads/2016/01/Vagrant-300x300.png" /> <!-- medium -->
				<meta prefix="og: http://ogp.me/ns#" property="og:image" content="/wp-content/uploads/2016/01/Vagrant.png" /> <!-- large -->
					<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Setting up a development environment for LessThanDot is kind of tricky, where &#8220;tricky&#8221; is defined somewhere between &#8220;I have PHP on my Windows box&#8221; and &#8220;at least I&#8217;m running it in a version of Apache&#8221;. Recently I realized I had misplaced my local development environment somewhere and needed a way to make some changes. Have [&hellip;]" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Duplicating LessThanDot on a Vagrant VM Comments Feed" href="/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='How I Hire Developers' href='/index.php/management/how-i-hire-developers/' />
<link rel='next' title='Learn about SQL Server in Azure in Madison, WI' href='/index.php/uncategorized/learn-about-sql-server-in-azure-in-madison-wi/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/" />
<link rel='shortlink' href='/?p=4297' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fwebdev%2Fduplicating-lessthandot-on-a-vagrant-vm%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fwebdev%2Fduplicating-lessthandot-on-a-vagrant-vm%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/uncategorized/learn-about-sql-server-in-azure-in-madison-wi/" rel="next">Learn about SQL Server in Azure in Madison, WI</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/management/how-i-hire-developers/" rel="prev">How I Hire Developers</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/" class="post-title">Duplicating LessThanDot on a Vagrant VM</a></h1>
					<div class="post-byline">by <a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)" rel="author">Eli Weinstock-Herman (tarwn)</a> on January 8, 2016 in category <a href="/index.php/category/webdev/" rel="category tag">Web Developer</a>. Article views: 2,287 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&text=RT @LessThanDot Blog - Duplicating LessThanDot on a Vagrant VM by @tarwn" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&title=Duplicating LessThanDot on a Vagrant VM&source=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&title=Duplicating LessThanDot on a Vagrant VM" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&quote=Duplicating LessThanDot on a Vagrant VM" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&title=Duplicating LessThanDot on a Vagrant VM" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>Setting up a development environment for LessThanDot is kind of tricky, where &#8220;tricky&#8221; is defined somewhere between &#8220;I have PHP on my Windows box&#8221; and &#8220;at least I&#8217;m running it in a version of Apache&#8221;. Recently I realized I had misplaced my local development environment somewhere and needed a way to make some changes.</p>
<p>Have a problem once? Solve it. Have a problem a second time? Automate it.</p>
<p>So, using <a href="https://www.vagrantup.com/">Vagrant</a>, I created a series of configurations and scripts that can create a duplicate of our production environment, running a local VM that answers to http://lessthandot.local instead of the real URL.</p>
<h2>What it takes to launch a server</h2>
<p>LessThanDot is probably not that dissimilar from other LAMP blogs. We have wired together several external packages that we run on a very specific version of PHP and MySQL that doesn&#8217;t make them angry (ish). The site lives on a set of sub-domains and includes some tricky bits, like using soft-linked media folders to prevent the content from being wiped out when we deploy new versions (or having to be included in source control). </p>
<p><strong>Folder structure:</strong></p>
<ul>
<li>/ &#8211; top-level git repository folder
<ul>
<li>configs/ &#8211; configurations used on our live serve for Apache, PHP, etc</li>
<li>trunk/ &#8211; the source code for the site</li>
<li>deploy/ &#8211; the deployment scripts (not relevant to this story)</li>
<li>vagrant_data/ &#8211; (.gitignore&#8217;d) created by vagrant script for copies of backups and such</li>
<li>vagrant_setup/ &#8211; scripts for vagrant like bootstrap.sh and mysql-secure.sh</li>
<li>Vagrantfile &#8211; the main Vagrant provisioning script</li>
<li>vagrant.config &#8211; (.gitignore&#8217;d) the configuration file consumed by vagrant</li>
<li>vagrant.config.sample &#8211; a sample file to create a vagrant.config from</li>
</ul>
</li>
</ul>
<p>The real configuration file and vagrant_data folder are listed in the gitignore to ensure real configurations and media content don&#8217;t make it into git (more soon on where that media content even came from).</p>
<p><strong>Type &#8220;vagrant up&#8221; on the host:</strong></p>
<ul>
<li>VM is created with matching version of Centos and booted</li>
<li>The local configuration file is loaded with values for:
<ul>
<li>Root MySQL password</li>
<li>Site MySQL User and password</li>
<li>Prefix to use for the MySQL databases</li>
<li>VM IP Address and fake domain name (lessthandot.local)</li>
<li>Address, credentials, and filenames for our backups (not on our public server)</li>
</ul>
</li>
<li>A private network is setup using the configured IP Address</li>
<li>The VM&#8217;s hostname is set using the domain name above</li>
<li>The /etc/hosts file is updated with aliases for the configured domain and necessary subdomains (ex: blogs.lessthandot.local)</li>
<li>The host folder is linked to a new /vagrant folder on the VM (content in these folders is synced)</li>
<li>The bootstrap.sh is called to continue setup on the VM (passing in the configs args)</li>
</ul>
<p><strong>Bootstrap.sh on the VM (runs from the Vagrantfile above):</strong></p>
<ul>
<li>Creates a local /vagrant/vagrant_data folder if it doesn&#8217;t exist (this is synced with the host)</li>
<li>If there isn&#8217;t a database backup available in /vagrant/vagrant_data:
<ul>
<li>Connect to the backup server and download the most recent database backup</li>
<li>Since this is synced with the host, I can choose to leave this file for subsequent &#8220;vagrant up&#8221; runs or delete it to get a fresh one</li>
</ul>
</li>
<li>If there isn&#8217;t a media backup available in /vagrant/vagrant_data:
<ul>
<li>Connect to the backup server and download the most recent media backup</li>
</ul>
</li>
<li>Install PHP
<ul>
<li>I had to add a new package source to get the specific version I wanted: rpm -Uvh https:/a.completely.different.source/</li>
<li>Then <code>yum -y install php-blah</code> the list of PHP packages we use </li>
</ul>
</li>
<li>Install MySQL
<ul>
<li><code>yum -y install mysql-server</code></li>
<li><code>service mysqld start</code></li>
</ul>
</li>
<li>Secure MySQL &#8211; run the &#8220;secure-mysql.sh&#8221; script (below), passing the configured root password from the conf file</li>
<li>Create the website database user from passed configs</li>
<li>Restore MySQL Backups
<ul>
<li>unzip the database backup from /vagrant/vagrant_data to the local user directory</li>
<li>for each database (passing in the root password $SETTINGS_MYSQL_ROOTPASS and prefix $SETTINGS_MYSQL_DBPREFIX)
<ul>
<li><code>mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" -e "CREATE DATABASE "$SETTINGS_MYSQL_DBPREFIX"_sampledb COLLATE=utf8_general_ci"</code></li>
<li><code>mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" "$SETTINGS_MYSQL_DBPREFIX"_sampledb &lt; mysql/prod_sampledb.sql</code></li>
</ul>
</li>
<li>GRANT a narrow set of read/write rights to the web user for these new databases</li>
</ul>
</li>
<li>Install Apache
<ul>
<li>yum -y install httpd</li>
</ul>
</li>
<li>Configure All The Things (site-setup.sh)
<ul>
<li>Create /etc/httpd/conf.d/z_lessthandot.httpd.conf with IP Address and definitions for all of the subdomains to match production site</li>
<li>Overwrite /etc/httpd/conf/httpd.conf with production version</li>
<li>Overwrite php.ini with production version</li>
<li>Create main site config.php using the configured domain name, MySQL credentials, etc</li>
<li>Update hostname in the WordPress database (wiki) in a couple places</li>
<li>Extract media files from the backups and put them in the appropriate places (already gitignored, these are replaced with soft links in production)</li>
<li>restart apache, cross fingers</li>
</ul>
</li>
</ul>
<p>At this point I can open up my local browser of choice, type in http://lessthandot.local, and the site loads with up to date data. All of the links throughout the site link to appropriate sub-domains as you move from sub-site to sub-site, and everything runs smoothly. If I screw something up, I&#8217;m working in a local git folder and can back it out and, if it&#8217;s bad enough, destroy and recreate my environment in minutes.</p>
<h2>Details (aka, Places Things Got Hinky)</h2>
<p>Here are some of the details and sticky spots, without revealing anything I shouldn&#8217;t behind the scenes on our server.</p>
<h3>64-bit OS on Windows</h3>
<p>initially I couldn&#8217;t get the VirtualBox VMs to start. vagrant would get stuck after setting the private key for SSH. I pulled up the VritualBox GUI and tried to view the screen and it warned me that I couldn&#8217;t run a 64-bit VM. I rebooted and turned on the Intel virtualization option in my BIOS, which didn&#8217;t fix it. Then I removed the Hyper-V feature from Windows, which did the trick.</p>
<p>At this point, I could successfully launch a Centos VM from the command-line. I could SSH into the system with &#8220;vagrant ssh&#8221; and it automatically linked my host directory with &#8220;/vagrant&#8221; on the VM, so files copied in either would sync back to the first&#8221;.</p>
<h3>Local Configuration File, not in git, passed through to VM</h3>
<p>The local configuration file works like this.</p>
<p>1) Added a vagrant.config file using YAML that looked like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="de1"><pre class="de1">mysql.rootpass: &nbsp; &nbsp;qwertyissupersafe
mysql.webuser: &nbsp; &nbsp; yourusername
mysql.webpass: &nbsp; &nbsp; yourpassword
mysql.dbprefix: &nbsp; &nbsp;ltd
vagrant.ipaddress: 192.168.1.1
vagrant.hostname: &nbsp;ltd.local
backups.address: &nbsp; 192.168.1.2
backups.username: &nbsp;FTPUserNameHere
backups.password: &nbsp;PasswordHere
backups.conf: &nbsp; &nbsp; &nbsp;lotsostuff.tar.gz
backups.data: &nbsp; &nbsp; &nbsp;thedatas.tar.gz</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">mysql.rootpass:    qwertyissupersafe
mysql.webuser:     yourusername
mysql.webpass:     yourpassword
mysql.dbprefix:    ltd
vagrant.ipaddress: 192.168.1.1
vagrant.hostname:  ltd.local
backups.address:   192.168.1.2
backups.username:  FTPUserNameHere
backups.password:  PasswordHere
backups.conf:      lotsostuff.tar.gz
backups.data:      thedatas.tar.gz</pre></div></div>

<p>2) Added logic in the Vagrantfile to parse the config file and later pass values to the bootstrap as args:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="ruby"><thead><tr><td colspan="2"  class="head">Ruby</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="de1"><pre class="de1"><span class="co1"># -*- mode: ruby -*-</span>
<span class="co1"># vi: set ft=ruby :</span>
<span class="kw3">require</span> <span class="st0">'yaml'</span>
&nbsp;
Vagrant.<span class="me1">configure</span><span class="br0">&#40;</span><span class="nu0">2</span><span class="br0">&#41;</span> <span class="kw1">do</span> <span class="sy0">|</span>config<span class="sy0">|</span>
&nbsp;
&nbsp; <span class="co1"># load settings from file</span>
&nbsp; custom_vagrantfile = <span class="st0">'vagrant.local'</span>
&nbsp; <span class="kw1">if</span> <span class="kw4">File</span>.<span class="me1">exist</span>?<span class="br0">&#40;</span>custom_vagrantfile<span class="br0">&#41;</span>
&nbsp; &nbsp; settings = <span class="kw4">YAML</span>.<span class="me1">load_file</span> custom_vagrantfile
&nbsp; <span class="kw1">else</span>
&nbsp; &nbsp; <span class="kw3">raise</span><span class="br0">&#40;</span><span class="kw4">Exception</span>, <span class="st0">&quot;Settings file '#{custom_vagrantfile}' has not been created. Please copy the sample file and fill in the necessary passwords (don't worry, it's excluded from git)&quot;</span><span class="br0">&#41;</span>
&nbsp; <span class="kw1">end</span>
&nbsp;
&nbsp; <span class="co1"># ... more stuff ###</span>
&nbsp;
&nbsp; settings_array = <span class="br0">&#91;</span>
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;mysql.rootpass&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;mysql.webuser&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;mysql.webpass&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;mysql.dbprefix&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;vagrant.ipaddress&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;vagrant.hostname&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;backups.address&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;backups.username&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;backups.password&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;backups.conf&quot;</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; settings<span class="br0">&#91;</span><span class="st0">&quot;backups.data&quot;</span><span class="br0">&#93;</span>
&nbsp; <span class="br0">&#93;</span>
&nbsp; config.<span class="me1">vm</span>.<span class="me1">provision</span> <span class="re3">:shell</span>, <span class="re3">:path</span> <span class="sy0">=&gt;</span> <span class="st0">&quot;vagrant_setup/bootstrap.sh&quot;</span>, <span class="re3">:args</span> <span class="sy0">=&gt;</span> settings_array
<span class="kw1">end</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse"># -*- mode: ruby -*-
# vi: set ft=ruby :
require 'yaml'

Vagrant.configure(2) do |config|

  # load settings from file
  custom_vagrantfile = 'vagrant.local'
  if File.exist?(custom_vagrantfile)
    settings = YAML.load_file custom_vagrantfile
  else
    raise(Exception, "Settings file '#{custom_vagrantfile}' has not been created. Please copy the sample file and fill in the necessary passwords (don't worry, it's excluded from git)")
  end

  # ... more stuff ###

  settings_array = [
    settings["mysql.rootpass"], 
    settings["mysql.webuser"], 
    settings["mysql.webpass"], 
    settings["mysql.dbprefix"], 
    settings["vagrant.ipaddress"], 
    settings["vagrant.hostname"], 
    settings["backups.address"], 
    settings["backups.username"], 
    settings["backups.password"], 
    settings["backups.conf"], 
    settings["backups.data"]
  ]
  config.vm.provision :shell, :path =&gt; "vagrant_setup/bootstrap.sh", :args =&gt; settings_array
end</pre></div></div>

<p>I was explicit with the settings array so it would be more obvious to me if I mismatched an arg between the array and the bootstrap script.</p>
<p>3) The bootstrap file then starts like so:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="bash"><thead><tr><td colspan="2"  class="head">Bash</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="de1"><pre class="de1"><span class="co0">#!/usr/bin/env bash</span>
&nbsp;
<span class="co0"># Settings from Vagrantfile</span>
<span class="re2">SETTINGS_MYSQL_ROOTPASS</span>=<span class="re4">$1</span>
<span class="re2">SETTINGS_MYSQL_WEBUSER</span>=<span class="re4">$2</span>
<span class="re2">SETTINGS_MYSQL_WEBPASS</span>=<span class="re4">$3</span>
<span class="re2">SETTINGS_MYSQL_DBPREFIX</span>=<span class="re4">$4</span>
<span class="re2">SETTINGS_VAGRANT_IPADDRESS</span>=<span class="re4">$5</span>
<span class="re2">SETTINGS_VAGRANT_HOSTNAME</span>=<span class="re4">$6</span>
<span class="re2">SETTINGS_BACKUPS_ADDRESS</span>=<span class="re4">$7</span>
<span class="re2">SETTINGS_BACKUPS_USERNAME</span>=<span class="re4">$8</span>
<span class="re2">SETTINGS_BACKUPS_PASSWORD</span>=<span class="re4">$9</span>
<span class="re2">SETTINGS_BACKUPS_CONF</span>=<span class="co1">${10}</span>
<span class="re2">SETTINGS_BACKUPS_DATA</span>=<span class="co1">${11}</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">#!/usr/bin/env bash

# Settings from Vagrantfile
SETTINGS_MYSQL_ROOTPASS=$1
SETTINGS_MYSQL_WEBUSER=$2
SETTINGS_MYSQL_WEBPASS=$3
SETTINGS_MYSQL_DBPREFIX=$4
SETTINGS_VAGRANT_IPADDRESS=$5
SETTINGS_VAGRANT_HOSTNAME=$6
SETTINGS_BACKUPS_ADDRESS=$7
SETTINGS_BACKUPS_USERNAME=$8
SETTINGS_BACKUPS_PASSWORD=$9
SETTINGS_BACKUPS_CONF=${10}
SETTINGS_BACKUPS_DATA=${11}</pre></div></div>

<p>4) To prevent the config file from committing, I added it to the gitignore and created a sample file with dummy files that would be added to the git repository.</p>
<h3>Custom Domains / Hosts file</h3>
<p>To have the host names resolve, I used a plugin named &#8220;hostsupdater&#8221;. It doesn&#8217;t support windows UAC yet, so for the short term I had to make my hosts file editable by my user account (ick). I chose this plugin because it allowed me to specify additional aliases rather than assuming I only wanted the hostname of the VM added.</p>
<p>To install it:<br />
<code>vagrant plugin install vagrant-hostsupdater</code></p>
<p>In my Vagrantfile:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="ruby"><thead><tr><td colspan="2"  class="head">Ruby</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1">config.<span class="me1">vm</span>.<span class="me1">hostname</span> = settings<span class="br0">&#91;</span><span class="st0">&quot;vagrant.hostname&quot;</span><span class="br0">&#93;</span>
config.<span class="me1">hostsupdater</span>.<span class="me1">aliases</span> = <span class="br0">&#91;</span><span class="st0">&quot;sqlcop.#{config.vm.hostname}&quot;</span>,<span class="st0">&quot;blogs.#{config.vm.hostname}&quot;</span>,<span class="st0">&quot;wiki.#{config.vm.hostname}&quot;</span>,<span class="st0">&quot;forum.#{config.vm.hostname}&quot;</span>,<span class="st0">&quot;cooking.#{config.vm.hostname}&quot;</span>,<span class="st0">&quot;admin.#{config.vm.hostname}&quot;</span><span class="br0">&#93;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">config.vm.hostname = settings["vagrant.hostname"]
config.hostsupdater.aliases = ["sqlcop.#{config.vm.hostname}","blogs.#{config.vm.hostname}","wiki.#{config.vm.hostname}","forum.#{config.vm.hostname}","cooking.#{config.vm.hostname}","admin.#{config.vm.hostname}"]</pre></div></div>

<p>The plugin, hostsupdater, takes care of adding and removing entries from the hosts files when I &#8220;vagrant up&#8221;.</p>
<h3>Copying files that already exist</h3>
<p>This will get stuck at an &#8220;are you sure&#8221; prompt: </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="bash"><thead><tr><td colspan="2"  class="head">Bash</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw2">cp</span> <span class="sy0">/</span>vagrant<span class="sy0">/</span>configs<span class="sy0">/</span>httpd.conf <span class="sy0">/</span>etc<span class="sy0">/</span>httpd<span class="sy0">/</span>conf<span class="sy0">/</span>httpd.conf</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">cp /vagrant/configs/httpd.conf /etc/httpd/conf/httpd.conf</pre></div></div>

<p>This will charge ahead without any prompting at all: </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="bash"><thead><tr><td colspan="2"  class="head">Bash</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">\<span class="kw2">cp</span> <span class="sy0">/</span>vagrant<span class="sy0">/</span>configs<span class="sy0">/</span>httpd.conf <span class="sy0">/</span>etc<span class="sy0">/</span>httpd<span class="sy0">/</span>conf<span class="sy0">/</span>httpd.conf</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">\cp /vagrant/configs/httpd.conf /etc/httpd/conf/httpd.conf</pre></div></div>

<p>Do the second. 🙂</p>
<h3>Securing MySQL &#8211; mysql-secure.sh</h3>
<p>When you install MySQL, it will suggest you run a command to secure your installation. This script performs the same steps:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="bash"><thead><tr><td colspan="2"  class="head">Bash</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="co0">#!/usr/bin/env bash</span>
&nbsp;
<span class="re2">SETTINGS_MYSQL_ROOTPASS</span>=<span class="re4">$1</span>
mysqladmin <span class="re5">-uroot</span> password <span class="st0">&quot;<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>&quot;</span>
mysql <span class="re5">-u</span> root <span class="re5">-p</span><span class="st0">&quot;<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>&quot;</span> <span class="re5">-e</span> <span class="st0">&quot;UPDATE mysql.user SET Password=PASSWORD('<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>') WHERE User='root'&quot;</span>
mysql <span class="re5">-u</span> root <span class="re5">-p</span><span class="st0">&quot;<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>&quot;</span> <span class="re5">-e</span> <span class="st0">&quot;DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1')&quot;</span>
mysql <span class="re5">-u</span> root <span class="re5">-p</span><span class="st0">&quot;<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>&quot;</span> <span class="re5">-e</span> <span class="st0">&quot;DELETE FROM mysql.user WHERE User=''&quot;</span>
mysql <span class="re5">-u</span> root <span class="re5">-p</span><span class="st0">&quot;<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>&quot;</span> <span class="re5">-e</span> <span class="st0">&quot;DELETE FROM mysql.db WHERE Db='test' OR Db='test\_%'&quot;</span>
mysql <span class="re5">-u</span> root <span class="re5">-p</span><span class="st0">&quot;<span class="es2">$SETTINGS_MYSQL_ROOTPASS</span>&quot;</span> <span class="re5">-e</span> <span class="st0">&quot;FLUSH PRIVILEGES&quot;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">#!/usr/bin/env bash

SETTINGS_MYSQL_ROOTPASS=$1
mysqladmin -uroot password "$SETTINGS_MYSQL_ROOTPASS"
mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" -e "UPDATE mysql.user SET Password=PASSWORD('$SETTINGS_MYSQL_ROOTPASS') WHERE User='root'"
mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" -e "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1')"
mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" -e "DELETE FROM mysql.user WHERE User=''"
mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" -e "DELETE FROM mysql.db WHERE Db='test' OR Db='test\_%'"
mysql -u root -p"$SETTINGS_MYSQL_ROOTPASS" -e "FLUSH PRIVILEGES"</pre></div></div>

<p>The single parameter for this script is the value from the configuration that I intended the root password to be set to. This is also passed to my later scripts for applying backups and creating a new user.</p>
<h3>Template for httpd.conf</h3>
<p>The z_lessthandot.httpd.conf template is just a copy of the production conf with tokens in all the spots that the IP Address or domain name show up, like so:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="de1"><pre class="de1">NameVirtualHost %%SETTINGS_VAGRANT_IPADDRESS%%:80 
&nbsp;
#### Production Sites ####
##########################
&nbsp;
&lt;VirtualHost %%SETTINGS_VAGRANT_IPADDRESS%%:80&gt;
&nbsp; &nbsp; DocumentRoot /vagrant/trunk/www/
&nbsp; &nbsp; ServerName %%SETTINGS_VAGRANT_HOSTNAME%%
&nbsp; &nbsp; # ... etc ...
&lt;/VirtualHost&gt;
&nbsp;
&lt;VirtualHost %%SETTINGS_VAGRANT_IPADDRESS%%:80&gt;
&nbsp; &nbsp; DocumentRoot /vagrant/trunk/forum/
&nbsp; &nbsp; ServerName forum.%%SETTINGS_VAGRANT_HOSTNAME%%
&nbsp; &nbsp; # ...etc...
&lt;/VirtualHost&gt;</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">NameVirtualHost %%SETTINGS_VAGRANT_IPADDRESS%%:80 

#### Production Sites ####
##########################

&lt;VirtualHost %%SETTINGS_VAGRANT_IPADDRESS%%:80&gt;
	DocumentRoot /vagrant/trunk/www/
	ServerName %%SETTINGS_VAGRANT_HOSTNAME%%
	# ... etc ...
&lt;/VirtualHost&gt;

&lt;VirtualHost %%SETTINGS_VAGRANT_IPADDRESS%%:80&gt;
	DocumentRoot /vagrant/trunk/forum/
	ServerName forum.%%SETTINGS_VAGRANT_HOSTNAME%%
	# ...etc...
&lt;/VirtualHost&gt;</pre></div></div>

<p>To replace the tokens, I use sed and the args passed into the script (originally form the config file):</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="bash"><thead><tr><td colspan="2"  class="head">Bash</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw2">sed</span> <span class="st0">&quot;s/%%SETTINGS_VAGRANT_IPADDRESS%%/<span class="es2">$SETTINGS_VAGRANT_IPADDRESS</span>/g;s/%%SETTINGS_VAGRANT_HOSTNAME%%/<span class="es2">$SETTINGS_VAGRANT_HOSTNAME</span>/g&quot;</span> <span class="sy0">/</span>vagrant<span class="sy0">/</span>vagrant_setup<span class="sy0">/</span>z_lessthandot.httpd.conf <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>httpd<span class="sy0">/</span>conf.d<span class="sy0">/</span>z_lessthandot.httpd.conf</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sed "s/%%SETTINGS_VAGRANT_IPADDRESS%%/$SETTINGS_VAGRANT_IPADDRESS/g;s/%%SETTINGS_VAGRANT_HOSTNAME%%/$SETTINGS_VAGRANT_HOSTNAME/g" /vagrant/vagrant_setup/z_lessthandot.httpd.conf &gt; /etc/httpd/conf.d/z_lessthandot.httpd.conf</pre></div></div>

<p>And there we go, one customized site httpd.conf.</p>
<h2>Instant Server, Just Add Water</h2>
<p>Having done this once, I know the next one I have to build will be even easier. This provides me the freedom of working with the tools of my choice while also running the code exactly like it will on the production environment, without any quirks from my OS, personal PHP setup, and so on getting in my way. If the worst happens, I can destroy the machine and recreate it in minutes.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbadmin/automated-database-depoyments-presentation-demos/'>Automated Database Deployments - Presentation Demos</a><p>This is an outline of the tools and scripts I used while demonstrating conversion of&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbadmin/sql-university-sql-server-reporting-1/'>SQL University - SQL Server Reporting Services Configuration Files Overview</a><p>SQL Server 2008 R2 Welcome to SQL Server Reporting Services week at SQL University. This&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://www.tiernok.com/images/RedShirt_80.jpg" alt="User bio image"/>My roles have included accidental DBA, lone developer, systems architect, team lead, VP of Engineering, and general troublemaker. On the technical front I work in web development, distributed systems, test automation, and devop-sy areas like delivery pipelines and integration of all the auditable things. <br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/tarwn" title="tarwn at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/in/eliweinstockherman" title="tarwn at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://tiernok.com/" title="tarwn at HomePage" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_homepage.png" alt="HomePage" /></a><a href="https://plus.google.com/114520820167873768473" title="tarwn at Google Plus" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_gplus.png" alt="Google Plus" /></a><a href="/index.php/author/tarwn/feed/" title="Blog RSS feed for tarwn" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 2,287 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/tarwn/">Read More Posts by Eli Weinstock-Herman (tarwn)</a>
						</div>
					</div>
					<div>
						<label>Tags:</label> <a href="/index.php/tag/vagrant/" rel="tag">Vagrant</a> 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&text=RT @LessThanDot Blog - Duplicating LessThanDot on a Vagrant VM by @tarwn" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&title=Duplicating LessThanDot on a Vagrant VM&source=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&title=Duplicating LessThanDot on a Vagrant VM" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&quote=Duplicating LessThanDot on a Vagrant VM" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/&title=Duplicating LessThanDot on a Vagrant VM" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		1 Comment so far	</h4>
			<ol class="comments-list">
					<li class="comment byuser comment-author-kermit even thread-even depth-1" id="comment-4893618">
				<div id="div-comment-4893618" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/fe367f8ca2e1d303ac247c423bd25f5e?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/fe367f8ca2e1d303ac247c423bd25f5e?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.vurso.co.uk/' rel='external nofollow' class='url'>Tahir Khalid</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/#comment-4893618">
			January 26, 2016 at 1:05 pm</a>		</div>

		<p>Great article Eli something I will definitely be looking into!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/?replytocom=4893618#respond' onclick='return addComment.moveForm( "div-comment-4893618", "4893618", "respond", "4297" )' aria-label='Reply to Tahir Khalid'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/webdev/duplicating-lessthandot-on-a-vagrant-vm/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='4297' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="6da9003b743b65f4c0ccd295cc484e57"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765900"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
