<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Monitoring and Logging as a Service &#8211; The Common Bits</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Monitoring and Logging as a Service &#8211; The Common Bits" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="In my previous post I outlined some of my own history with monitoring and my intent to review several available logging services. To help compare apples to apples, the logging mechanisms and log messages will operate consistently for each of the selected services." />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Monitoring and Logging as a Service &#8211; The Common Bits Comments Feed" href="/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Setting up a Central Management Server' href='/index.php/datamgmt/dbadmin/mssqlserveradmin/setting-up-a-central-management/' />
<link rel='next' title='Consulting â€“ The best part?' href='/index.php/itprofessionals/itservicemanagement/consulting-the-best-part/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/" />
<link rel='shortlink' href='/?p=1643' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fenterprisedev%2Finstrumentation%2Fmonitoring-and-logging-as-a-service-common-bits%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fenterprisedev%2Finstrumentation%2Fmonitoring-and-logging-as-a-service-common-bits%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/itprofessionals/itservicemanagement/consulting-the-best-part/" rel="next">Consulting â€“ The best part?</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/datamgmt/dbadmin/mssqlserveradmin/setting-up-a-central-management/" rel="prev">Setting up a Central Management Server</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/" class="post-title">Monitoring and Logging as a Service &#8211; The Common Bits</a></h1>
					<div class="post-byline">by <a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)" rel="author">Eli Weinstock-Herman (tarwn)</a> on July 3, 2012 in category <a href="/index.php/category/enterprisedev/instrumentation/" rel="category tag">Instrumentation</a>. Article views: 4,663 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&text=RT @LessThanDot Blog - Monitoring and Logging as a Service &amp;#8211; The Common Bits by @tarwn" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&title=Monitoring and Logging as a Service &amp;#8211; The Common Bits&source=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&title=Monitoring and Logging as a Service &amp;#8211; The Common Bits" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&quote=Monitoring and Logging as a Service &amp;#8211; The Common Bits" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&title=Monitoring and Logging as a Service &amp;#8211; The Common Bits" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>In my <a href="/index.php/EnterpriseDev/instrumentation/monitoring-and-logging-as-a-service" title="Monitoring and Logging as a Service - Introduction" target="_blank">previous post</a> I outlined some of my own history with monitoring and my intent to review several available logging services. To help compare apples to apples, the logging mechanisms and log messages will operate consistently for each of the selected services. </p>
<p>The sample code is available on github and will continue to be updated as I add services I am trying: <a href="https://github.com/tarwn/InstrumentationSampleCode" title="InstrumentationSampleCode on GitHub" target="_blank">tarwn/InstrumentationSampleCode</a></p>
<p>The purpose of this post is to outline that common portion of the application before we get into the reviews, so we have a common starting place and something to refer back to once we start customizing to support the services.</p>
<h2>The Sample Code</h2>
<p>The sample code for this series is relatively simple. The solution includes 4 projects: Logging, LoggingTests, SampleSiteWithLogging, and SensitiveSettings.</p>
<h3>Logging</h3>
<p>This is the core project for the post series. The goal of the Logging library is to make it extremely easy to log from inside the application (think statsd + graphite ala <a href="http://codeascraft.etsy.com/2011/02/15/measure-anything-measure-everything/" title="Measure Anything, Measure Everything post at Etsy" target="_blank">Etsy</a> simple) while making it easy to swap out which logging service we are using. </p>
<p>There are two major components in the library, the Logger class which provides singleton access to the selected logging service and the required one line log calls and the HttpJsonPost, which handles HTTP requests (currently focused on key/value data for unstructured JSON or raw text posts).</p>
<p>The singleton can be setup with any implementation of an ILogProvider. It provides methods to log a single message or produce a message that automatically logs itself on disposal (capturing elapsed time and including it in the message). </p>
<p><b>Logging.Logger</b> (<a href="https://github.com/tarwn/InstrumentationSampleCode/blob/master/Logging/Logger.cs" title="Logger.cs on Github" target="_blank">source</a>)</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw4">class</span> Logger <span class="br0">&#123;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> ILogProvider _logProvider<span class="sy0">;</span>
&nbsp; &nbsp; <span class="kw1">private</span> <span class="kw1">static</span> Logger _current<span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> Logger<span class="br0">&#40;</span>ILogProvider logProvider<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; _logProvider <span class="sy0">=</span> logProvider<span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">void</span> LogMessage<span class="br0">&#40;</span>Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span> message, Action<span class="sy0">&lt;</span>Result<span class="sy0">&gt;</span> callback<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; _logProvider<span class="sy0">.</span><span class="me1">Log</span><span class="br0">&#40;</span>message, callback<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> SetDefaultLogger<span class="br0">&#40;</span>ILogProvider logProvider<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; _current <span class="sy0">=</span> <span class="kw3">new</span> Logger<span class="br0">&#40;</span>logProvider<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> <span class="kw1">static</span> Logger GetDefaultLogger<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>_current <span class="sy0">!=</span> <span class="kw1">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> _current<span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">throw</span> <span class="kw3">new</span> Exception<span class="br0">&#40;</span><span class="st0">&quot;Default logger not setup&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> Log<span class="br0">&#40;</span>Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span> message, Action<span class="sy0">&lt;</span>Result<span class="sy0">&gt;</span> callback<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; GetDefaultLogger<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">LogMessage</span><span class="br0">&#40;</span>message, callback<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw1">static</span> LoggerWithElapsedTime CaptureElapsedTime<span class="br0">&#40;</span>Dictionary<span class="sy0">&lt;</span><span class="kw5">System</span><span class="sy0">.</span><span class="kw4">String</span>, <span class="kw5">System</span><span class="sy0">.</span><span class="kw4">String</span><span class="sy0">&gt;</span> message, Action<span class="sy0">&lt;</span>Result<span class="sy0">&gt;</span> callback<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="kw3">new</span> LoggerWithElapsedTime<span class="br0">&#40;</span>GetDefaultLogger<span class="br0">&#40;</span><span class="br0">&#41;</span>, message, callback<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public class Logger {

	private ILogProvider _logProvider;
	private static Logger _current;

	public Logger(ILogProvider logProvider) {
		_logProvider = logProvider;
	}

	public void LogMessage(Dictionary&lt;string, string&gt; message, Action&lt;Result&gt; callback) {
		_logProvider.Log(message, callback);
	}

	public static void SetDefaultLogger(ILogProvider logProvider) {
		_current = new Logger(logProvider);
	}

	private static Logger GetDefaultLogger() {
		if (_current != null) {
			return _current;
		}
		else {
			throw new Exception("Default logger not setup");
		}
	}

	public static void Log(Dictionary&lt;string, string&gt; message, Action&lt;Result&gt; callback) {
		GetDefaultLogger().LogMessage(message, callback);
	}

	public static LoggerWithElapsedTime CaptureElapsedTime(Dictionary&lt;System.String, System.String&gt; message, Action&lt;Result&gt; callback) {
		return new LoggerWithElapsedTime(GetDefaultLogger(), message, callback);
	}
}</pre></div></div>

<p>Each log call passes in a message and a callback that will be called with the result of the HTTP post, though so far the sample website code is using fire-and-forget, not bothering to provide a callback method.</p>
<p>To support the ILogProvider implementation, I created an <a href="https://github.com/tarwn/InstrumentationSampleCode/blob/master/Logging/Communications/HttpJsonPost.cs" title="HttpJsonPost on Github">HttpJsonPost class</a> class and associated helpers to handle the HTTP communications. This class can do synchronous and asynchronous HTTP requests to the relevant services:</p>
<p><b>Logging.Communications.HttpJsonPost</b> (<a href="https://github.com/tarwn/InstrumentationSampleCode/blob/master/Logging/Communications/HttpJsonPost.cs" title="HttpJsonPost on Github" target="_blank">source</a>)</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw4">class</span> HttpJsonPost <span class="br0">&#123;</span>
&nbsp;
&nbsp; &nbsp; Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>,<span class="kw4">string</span><span class="sy0">&gt;</span> _message<span class="sy0">;</span>
&nbsp; &nbsp; NetworkCredential _credentials<span class="sy0">;</span>
&nbsp; &nbsp; <span class="kw4">bool</span> _useJson<span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> HttpJsonPost<span class="br0">&#40;</span>Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span> message, NetworkCredential credentials <span class="sy0">=</span> <span class="kw1">null</span>, <span class="kw4">bool</span> useJson <span class="sy0">=</span> <span class="kw1">true</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> HttpWebRequest InitializeRequest<span class="br0">&#40;</span><span class="kw4">string</span> url, <span class="kw4">string</span> method<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">void</span> Send<span class="br0">&#40;</span><span class="kw4">string</span> url, <span class="kw4">string</span> method, Action<span class="sy0">&lt;</span>Result<span class="sy0">&gt;</span> callback, <span class="kw4">bool</span> processResponse <span class="sy0">=</span> <span class="kw1">true</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> <span class="kw4">void</span> SendAsync<span class="br0">&#40;</span><span class="kw4">string</span> url, <span class="kw4">string</span> method, Action<span class="sy0">&lt;</span>Result<span class="sy0">&gt;</span> callback, <span class="kw4">bool</span> processResponse <span class="sy0">=</span> <span class="kw1">true</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> <span class="kw4">void</span> GetRequestStream<span class="br0">&#40;</span>IAsyncResult result<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> <span class="kw4">void</span> GetResponseStream<span class="br0">&#40;</span>IAsyncResult result<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> <span class="kw4">void</span> ProcessResponse<span class="br0">&#40;</span>Func<span class="sy0">&lt;</span>WebResponse<span class="sy0">&gt;</span> getResponse, Action<span class="sy0">&lt;</span>Result<span class="sy0">&gt;</span> callback<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">private</span> <span class="kw4">void</span> WriteMessage<span class="br0">&#40;</span>Stream stream<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="coMULTI">/* ... */</span> <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public class HttpJsonPost {

	Dictionary&lt;string,string&gt; _message;
	NetworkCredential _credentials;
	bool _useJson;

	public HttpJsonPost(Dictionary&lt;string, string&gt; message, NetworkCredential credentials = null, bool useJson = true) { /* ... */ }

	private HttpWebRequest InitializeRequest(string url, string method) { /* ... */ }

	public void Send(string url, string method, Action&lt;Result&gt; callback, bool processResponse = true) { /* ... */ }

	public void SendAsync(string url, string method, Action&lt;Result&gt; callback, bool processResponse = true) { /* ... */ }

	private void GetRequestStream(IAsyncResult result) { /* ... */ }

	private void GetResponseStream(IAsyncResult result) { /* ... */ }

	private void ProcessResponse(Func&lt;WebResponse&gt; getResponse, Action&lt;Result&gt; callback) { /* ... */ }

	private void WriteMessage(Stream stream) { /* ... */ }
}</pre></div></div>

<p>This little bit of code and their supporting classes are all it takes to talk to the external logging services, and to do so with limited impact by using asynchronous requests and callbacks.</p>
<h2>The Sample Website</h2>
<p>The sample website contains very little code that I added. The majority of the code is the &#8220;Empty MVC 3 Web Site&#8221; template from visual studio, I&#8217;ve added an extremely basic HomeController and some setup code in the global.asax to setup the log provider and log a few events.</p>
<p><b>SampleSiteWithLogging.Global</b> (<a href="https://github.com/tarwn/InstrumentationSampleCode/blob/master/SampleSiteWithLogging/Global.asax.cs" title="Global.asax.cs on GitHub" target="_blank">source</a>)</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw4">class</span> MvcApplication <span class="sy0">:</span> <span class="kw5">System.<span class="me1">Web</span></span><span class="sy0">.</span><span class="me1">HttpApplication</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; 
&nbsp; &nbsp; <span class="coMULTI">/* ... */</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">protected</span> <span class="kw4">void</span> Application_Start<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="coMULTI">/* ... */</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; ILogProvider provider <span class="sy0">=</span> GetProviderFromSettings<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; Logger<span class="sy0">.</span><span class="me1">SetDefaultLogger</span><span class="br0">&#40;</span>provider<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; Logger<span class="sy0">.</span><span class="me1">Log</span><span class="br0">&#40;</span><span class="kw3">new</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="br0">&#123;</span> <span class="st0">&quot;Type&quot;</span>, <span class="st0">&quot;ApplicationStartup&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Time&quot;</span>, DateTime<span class="sy0">.</span><span class="me1">UtcNow</span><span class="sy0">.</span><span class="me1">ToString</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>, <span class="kw1">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">protected</span> <span class="kw4">void</span> Application_BeginRequest<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; Logger<span class="sy0">.</span><span class="me1">Log</span><span class="br0">&#40;</span><span class="kw3">new</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="br0">&#123;</span> <span class="st0">&quot;Type&quot;</span>, <span class="st0">&quot;ApplicationRequest&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;UserAgent&quot;</span>, Request<span class="sy0">.</span><span class="me1">UserAgent</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Time&quot;</span>, DateTime<span class="sy0">.</span><span class="me1">UtcNow</span><span class="sy0">.</span><span class="me1">ToString</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>, <span class="kw1">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">protected</span> <span class="kw4">void</span> Application_Error<span class="br0">&#40;</span><span class="kw4">Object</span> sender, <span class="kw5">System</span><span class="sy0">.</span><span class="me1">EventArgs</span> e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw5">System.<span class="me1">Web</span></span><span class="sy0">.</span><span class="me1">HttpContext</span> context <span class="sy0">=</span> HttpContext<span class="sy0">.</span><span class="me1">Current</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw5">System</span><span class="sy0">.</span><span class="me1">Exception</span> exc <span class="sy0">=</span> Context<span class="sy0">.</span><span class="me1">Server</span><span class="sy0">.</span><span class="me1">GetLastError</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; Logger<span class="sy0">.</span><span class="me1">Log</span><span class="br0">&#40;</span><span class="kw3">new</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="br0">&#123;</span> <span class="st0">&quot;Type&quot;</span>, <span class="st0">&quot;ApplicationError&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Exception&quot;</span>, exc<span class="sy0">.</span><span class="me1">ToString</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Time&quot;</span>, DateTime<span class="sy0">.</span><span class="me1">UtcNow</span><span class="sy0">.</span><span class="me1">ToString</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>, <span class="kw1">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">protected</span> ILogProvider GetProviderFromSettings<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">LoadFrom</span><span class="br0">&#40;</span><span class="kw5">System.<span class="me1">IO</span></span><span class="sy0">.</span><span class="me1">Path</span><span class="sy0">.</span><span class="me1">Combine</span><span class="br0">&#40;</span><span class="kw5">System</span><span class="sy0">.</span><span class="me1">AppDomain</span><span class="sy0">.</span><span class="me1">CurrentDomain</span><span class="sy0">.</span><span class="me1">BaseDirectory</span>, <span class="st_h">@&quot;bin&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">string</span> provider <span class="sy0">=</span> <span class="st0">&quot;null&quot;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="sy0">.</span><span class="me1">ContainsKey</span><span class="br0">&#40;</span><span class="st0">&quot;LogProvider&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; provider <span class="sy0">=</span> SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;LogProvider&quot;</span><span class="br0">&#93;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">switch</span> <span class="br0">&#40;</span>provider<span class="sy0">.</span><span class="me1">ToUpper</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">&quot;LOGGLY&quot;</span><span class="sy0">:</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="kw3">new</span> LogglyProvider<span class="br0">&#40;</span>SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;Loggly.BaseURL&quot;</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">&quot;STORM&quot;</span><span class="sy0">:</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="kw3">new</span> StormProvider<span class="br0">&#40;</span>SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;Storm.BaseURL&quot;</span><span class="br0">&#93;</span>, SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;Storm.AccessToken&quot;</span><span class="br0">&#93;</span>, SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;Storm.ProjectId&quot;</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">case</span> <span class="st0">&quot;LOGENTRIES&quot;</span><span class="sy0">:</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="kw3">new</span> LogentriesProvider<span class="br0">&#40;</span>SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;logentries.BaseURL&quot;</span><span class="br0">&#93;</span>, SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;logentries.AccountKey&quot;</span><span class="br0">&#93;</span>, SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;logentries.Host&quot;</span><span class="br0">&#93;</span>, SensitiveSettings<span class="sy0">.</span><span class="me1">SettingsManager</span><span class="sy0">.</span><span class="me1">Settings</span><span class="br0">&#91;</span><span class="st0">&quot;logentries.Log&quot;</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">default</span><span class="sy0">:</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="kw3">new</span> NullLogProvider<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public class MvcApplication : System.Web.HttpApplication {
	
	/* ... */

	protected void Application_Start() {
		/* ... */

		ILogProvider provider = GetProviderFromSettings();
		Logger.SetDefaultLogger(provider);
		Logger.Log(new Dictionary&lt;string, string&gt;() { { "Type", "ApplicationStartup" }, { "Time", DateTime.UtcNow.ToString() } }, null);
	}

	protected void Application_BeginRequest() {
		Logger.Log(new Dictionary&lt;string, string&gt;() { { "Type", "ApplicationRequest" }, { "UserAgent", Request.UserAgent }, { "Time", DateTime.UtcNow.ToString() } }, null);
	}

	protected void Application_Error(Object sender, System.EventArgs e) {
		System.Web.HttpContext context = HttpContext.Current;
		System.Exception exc = Context.Server.GetLastError();

		Logger.Log(new Dictionary&lt;string, string&gt;() { { "Type", "ApplicationError" }, { "Exception", exc.ToString() }, { "Time", DateTime.UtcNow.ToString() } }, null);
	}

	protected ILogProvider GetProviderFromSettings() {
		SensitiveSettings.SettingsManager.LoadFrom(System.IO.Path.Combine(System.AppDomain.CurrentDomain.BaseDirectory, @"bin"));
		string provider = "null";
		if (SensitiveSettings.SettingsManager.Settings.ContainsKey("LogProvider")) {
			provider = SensitiveSettings.SettingsManager.Settings["LogProvider"];
		}

		switch (provider.ToUpper()) { 
			case "LOGGLY":
				return new LogglyProvider(SensitiveSettings.SettingsManager.Settings["Loggly.BaseURL"]);
			case "STORM":
				return new StormProvider(SensitiveSettings.SettingsManager.Settings["Storm.BaseURL"], SensitiveSettings.SettingsManager.Settings["Storm.AccessToken"], SensitiveSettings.SettingsManager.Settings["Storm.ProjectId"]);
			case "LOGENTRIES":
				return new LogentriesProvider(SensitiveSettings.SettingsManager.Settings["logentries.BaseURL"], SensitiveSettings.SettingsManager.Settings["logentries.AccountKey"], SensitiveSettings.SettingsManager.Settings["logentries.Host"], SensitiveSettings.SettingsManager.Settings["logentries.Log"]);
			default:
				return new NullLogProvider();
		}
		
	}
}</pre></div></div>

<p>The global.asax file allows us to wire logic into the global application workflow. On startup we get a provider, based on our &#8220;Sensitive Settings&#8221; configuration file, set that as our default logger, then go ahead and log our first message with entries to indicate this is application startup and the current UTC timestamp. Each time we receive a request from a web browser, we use our on line logging call to log the browsers UserAgent string and a timestamp. When an error goes unhandled, we can log that too.</p>
<p>Elsewhere in our application we can use those same one line calls to pass information to the logging service. The HomeController logs information, but instead uses the CaptureElapsedTime method to log information and the time that elapses between it&#8217;s instantiation and disposal.</p>
<p><b>SampleSiteWithLogging.Controllers.HomeController</b> (<a href="https://github.com/tarwn/InstrumentationSampleCode/blob/master/SampleSiteWithLogging/Controllers/HomeController.cs" title="HomeController.cs on Github" target="_blank">source</a>)</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="csharp"><thead><tr><td colspan="2"  class="head">C#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="de1"><pre class="de1"><span class="kw1">public</span> <span class="kw4">class</span> HomeController <span class="sy0">:</span> Controller <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">public</span> ActionResult Index<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> View<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> ActionResult ShortOperation<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">using</span> <span class="br0">&#40;</span><span class="kw1">var</span> log <span class="sy0">=</span> Logging<span class="sy0">.</span><span class="me1">Logger</span><span class="sy0">.</span><span class="me1">CaptureElapsedTime</span><span class="br0">&#40;</span><span class="kw3">new</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span> <span class="br0">&#123;</span> <span class="br0">&#123;</span> <span class="st0">&quot;Type&quot;</span>, <span class="st0">&quot;SiteHit&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Area&quot;</span>, <span class="st0">&quot;HomeController&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Method&quot;</span>, <span class="st0">&quot;ShortOperation&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>, <span class="kw1">null</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> View<span class="br0">&#40;</span><span class="st0">&quot;Index&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">public</span> ActionResult LongOperation<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">using</span> <span class="br0">&#40;</span><span class="kw1">var</span> log <span class="sy0">=</span> Logging<span class="sy0">.</span><span class="me1">Logger</span><span class="sy0">.</span><span class="me1">CaptureElapsedTime</span><span class="br0">&#40;</span><span class="kw3">new</span> Dictionary<span class="sy0">&lt;</span><span class="kw4">string</span>, <span class="kw4">string</span><span class="sy0">&gt;</span> <span class="br0">&#123;</span> <span class="br0">&#123;</span> <span class="st0">&quot;Type&quot;</span>, <span class="st0">&quot;SiteHit&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Area&quot;</span>, <span class="st0">&quot;HomeController&quot;</span> <span class="br0">&#125;</span>, <span class="br0">&#123;</span> <span class="st0">&quot;Method&quot;</span>, <span class="st0">&quot;LongOperation&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>, <span class="kw1">null</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Thread<span class="sy0">.</span><span class="me1">Sleep</span><span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw4">int</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="nu0">3000</span> <span class="sy0">*</span> <span class="kw3">new</span> Random<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="me1">NextDouble</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> View<span class="br0">&#40;</span><span class="st0">&quot;Index&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp;
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">public class HomeController : Controller {
	public ActionResult Index() {
		return View();
	}

	public ActionResult ShortOperation() {
		using (var log = Logging.Logger.CaptureElapsedTime(new Dictionary&lt;string, string&gt; { { "Type", "SiteHit" }, { "Area", "HomeController" }, { "Method", "ShortOperation" } }, null)) {
			return View("Index");
		}
	}

	public ActionResult LongOperation() {
		using (var log = Logging.Logger.CaptureElapsedTime(new Dictionary&lt;string, string&gt; { { "Type", "SiteHit" }, { "Area", "HomeController" }, { "Method", "LongOperation" } }, null)) {
			Thread.Sleep((int)(3000 * new Random().NextDouble()));
			return View("Index");
		}
	}

}</pre></div></div>

<p>These examples are actually more wordy than I would like. If I were building this as part of a production application, I would refactor them down to take explicit arguments or infer some of the values, reducing the size of each call even further. </p>
<h2>&#8220;Sensitive Settings&#8221;</h2>
<p>The Sensitive Settings library is just a quick settings library I threw together so I could prevent my API keys for these services from getting committed to github.  The library is referenced by the website and unit test projects, each of which have a prebuild step to copy the &#8220;sensitive.config&#8221; file from the solution folder to their build target folders.</p>
<h2>LoggingTests</h2>
<p>The LoggingTests folder is really just a way for me to easily test small chunks of the libraries without firing up the interface. These aren&#8217;t real unit tests and that should serve as a second reason not to download and attempt to use the Logging library in a production application. ðŸ™‚</p>
<h2>Onward to the Reviews</h2>
<p>Now that we have some code we can easily connect to all of the services, the next post will cover the services I tried and how they measured up against my expectations for this type of usage.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service/'>Monitoring and Logging as a Service - Introduction</a><p>Monitoring [in IT] sucks and I am probably more critical of its state than most&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/enterprisedev/instrumentation/monitoring-and-logging-reviews/'>Monitoring and Logging as a Service - Reviews</a><p>There is a lot of value in knowing what the internals of your application are&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://www.tiernok.com/images/RedShirt_80.jpg" alt="User bio image"/>My roles have included accidental DBA, lone developer, systems architect, team lead, VP of Engineering, and general troublemaker. On the technical front I work in web development, distributed systems, test automation, and devop-sy areas like delivery pipelines and integration of all the auditable things. <br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/tarwn" title="tarwn at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/in/eliweinstockherman" title="tarwn at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://tiernok.com/" title="tarwn at HomePage" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_homepage.png" alt="HomePage" /></a><a href="https://plus.google.com/114520820167873768473" title="tarwn at Google Plus" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_gplus.png" alt="Google Plus" /></a><a href="/index.php/author/tarwn/feed/" title="Blog RSS feed for tarwn" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 4,663 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/tarwn/">Read More Posts by Eli Weinstock-Herman (tarwn)</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&text=RT @LessThanDot Blog - Monitoring and Logging as a Service &amp;#8211; The Common Bits by @tarwn" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&title=Monitoring and Logging as a Service &amp;#8211; The Common Bits&source=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&title=Monitoring and Logging as a Service &amp;#8211; The Common Bits" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&quote=Monitoring and Logging as a Service &amp;#8211; The Common Bits" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/&title=Monitoring and Logging as a Service &amp;#8211; The Common Bits" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		No comments posted so far	</h4>
					<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/enterprisedev/instrumentation/monitoring-and-logging-as-a-service-common-bits/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1643' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="7b13b2203029ed80337f27127a9f1d28"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765915"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
