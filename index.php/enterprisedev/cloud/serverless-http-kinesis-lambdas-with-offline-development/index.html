<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Serverless HTTP + Kinesis Lambdas with Offline Development</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Serverless HTTP + Kinesis Lambdas with Offline Development" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Lately I&#8217;ve been exploring an idea around applying custom, user-defined rules to streams of events. I&#8217;m using a combination of technologies, but the core is a FaaS setup that I can run locally that utilizes the serverless package to deploy AWS Lambda functions that consume events from a Kinesis stream. I prefer the speed of [&hellip;]" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Serverless HTTP + Kinesis Lambdas with Offline Development Comments Feed" href="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The State of Software Engineering Report 2017' href='/index.php/uncategorized/the-state-of-software-engineering-report-2017/' />
<link rel='next' title='Streaming Alerts using AWS Lambda, Kinesis, and DynamoDB' href='/index.php/enterprisedev/cloud/streaming-alerts-using-aws-lambda-kinesis-and-dynamodb/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/" />
<link rel='shortlink' href='/?p=8865' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fenterprisedev%2Fcloud%2Fserverless-http-kinesis-lambdas-with-offline-development%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fenterprisedev%2Fcloud%2Fserverless-http-kinesis-lambdas-with-offline-development%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/enterprisedev/cloud/streaming-alerts-using-aws-lambda-kinesis-and-dynamodb/" rel="next">Streaming Alerts using AWS Lambda, Kinesis, and DynamoDB</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/uncategorized/the-state-of-software-engineering-report-2017/" rel="prev">The State of Software Engineering Report 2017</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/" class="post-title">Serverless HTTP + Kinesis Lambdas with Offline Development</a></h1>
					<div class="post-byline">by <a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)" rel="author">Eli Weinstock-Herman (tarwn)</a> on January 16, 2018 in category <a href="/index.php/category/enterprisedev/cloud/" rel="category tag">Cloud</a>. Article views: 4,189 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&text=RT @LessThanDot Blog - Serverless HTTP + Kinesis Lambdas with Offline Development by @tarwn" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&title=Serverless HTTP + Kinesis Lambdas with Offline Development&source=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&title=Serverless HTTP + Kinesis Lambdas with Offline Development" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&quote=Serverless HTTP + Kinesis Lambdas with Offline Development" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&title=Serverless HTTP + Kinesis Lambdas with Offline Development" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>Lately I&#8217;ve been exploring an idea around applying custom, user-defined rules to streams of events. I&#8217;m using a combination of technologies, but the core is a <abbr title="Function-as-a-Service">FaaS</abbr> setup that I can run locally that utilizes the <a href="https://serverless.com/">serverless</a> package to deploy <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> functions that consume events from a <a href="https://aws.amazon.com/kinesis/">Kinesis stream</a>. </p>
<p>I prefer the speed of local development feedback cycles. Getting HTTP Functions running locally was easy with serverless-offline, Kinesis was a lot trickier with more false starts. If you&#8217;re trying to get local node.js Lambdas running for HTTP and Kinesis, hopefully this will help.</p>
<h2>Spoilers&#8230;</h2>
<p>By the end of this post, we&#8217;ll have an HTTP endpoint that can accept POSTed events and publish to a Kinesis stream. We&#8217;ll have another function pulling events off that stream and processing them. No infrastructure, no polling code, no webserver configurations, less than 40 lines of code, and a simple cli command to deploy: <code>serverless deploy</code></p>
<div id="attachment_8867" style="width: 666px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2018/01/OfflineHttpAndKinesisOutput.png" alt="cUrl =&gt; HTTP Function =&gt; Kinesis Stream =&gt; Kinesis Function" width="656" height="161" class="size-full wp-image-8867" srcset="/wp-content/uploads/2018/01/OfflineHttpAndKinesisOutput.png 656w, /wp-content/uploads/2018/01/OfflineHttpAndKinesisOutput-300x74.png 300w" sizes="(max-width: 656px) 100vw, 656px" /><p class="wp-caption-text">cUrl => HTTP Function => Kinesis Stream => Kinesis Function</p></div>
<p>That&#8217;s pretty standard FaaS stuff, but I can&#8217;t stand the latency of deploying to test changes, so I&#8217;ll add in some plugins and a little hackery to have all of that running in realtime, locally, with automatic syncing of changes as they&#8217;re made (because I don&#8217;t even like restarting services to try changes).</p>
<div id="attachment_8890" style="width: 699px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2018/01/OfflineHttpAndKinesisOutputUpdated.png" alt="Updated Functions, Running Locally, No Restarts (SUPER!!!)" width="689" height="157" class="size-full wp-image-8890" srcset="/wp-content/uploads/2018/01/OfflineHttpAndKinesisOutputUpdated.png 689w, /wp-content/uploads/2018/01/OfflineHttpAndKinesisOutputUpdated-300x68.png 300w" sizes="(max-width: 689px) 100vw, 689px" /><p class="wp-caption-text">Updated Functions, Running Locally, No Restarts (SUPER!!!)</p></div>
<p>Here comes the details&#8230;</p>
<h2>Laying the Groundwork: An HTTP Function</h2>
<p>First I need some events flowing into a log. I&#8217;m choosing to use an HTTP endpoint to start getting setup for more complex functions and so I don&#8217;t get distracted building something to produce real events.<br />
I&#8217;m using <a href="">serverless</a> to wire up and deploy my functions. Two of the benefits of this is not wiring my deployment to git commits and being able to simulate Lambda and run my function logic locally.</p>
<h3>1. Set Up Serverless + AWS</h3>
<p>First up, I followed the Getting Started directions to get serverless setup with AWS credentials: </p>
<ul>
<li><a href="https://serverless.com/framework/docs/providers/aws/guide/installation/" title="Serverless.com: AWS - Installation">AWS &#8211; Installation</a></li>
<li><a href="https://serverless.com/framework/docs/providers/aws/guide/credentials/" title="Serverless.com: AWS - Credentials">AWS &#8211; Credentials</a></li>
</ul>
<p>Next, I define a very simple Http handler for my function:</p>
<p><b>OfflineHttp/functions/eventsHttp.js</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttp/functions/eventsHttp.js">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="javascript"><thead><tr><td colspan="2"  class="head">Javascript</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1">module.<span class="me1">exports</span>.<span class="me1">handler</span> <span class="sy0">=</span> <span class="br0">&#40;</span>event<span class="sy0">,</span> context<span class="sy0">,</span> callback<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span><span class="st0">&quot;You POSTed an event!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span>event.<span class="me1">body</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; callback<span class="br0">&#40;</span><span class="kw2">null</span><span class="sy0">,</span> <span class="br0">&#123;</span> statusCode<span class="sy0">:</span> <span class="nu0">200</span><span class="sy0">,</span> body<span class="sy0">:</span> <span class="st0">&quot;Success&quot;</span> <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">module.exports.handler = (event, context, callback) =&gt; { 
	console.log("You POSTed an event!");
	console.log(event.body);
	callback(null, { statusCode: 200, body: "Success" });
};</pre></div></div>

<p>Add the serverless-offline package: <code>npm install serverless-offline --save-dev</code></p>
<p>And then configure serverless:</p>
<p><b>OfflineHttp/serverless.yaml</b> <a href="https://github.com/tarwn/serverless-examples/tree/master/OfflineHttp/serverless.yaml">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="de1"><pre class="de1"># the name of my service - used during deployment
service: example-offline-http
&nbsp;
# serverless plugins to use with serverless
plugins:
&nbsp; - serverless-offline
&nbsp;
# set a default stage in case I don’t provide one
custom:
&nbsp; defaults:
&nbsp; &nbsp; stage: dev
&nbsp;
# some details about the environment and language I'm going to use
provider:
&nbsp; name: aws
&nbsp; runtime: nodejs6.10
&nbsp; region: us-east-1
&nbsp;
# the function entry point and defining the events to trigger it
functions:
&nbsp; events:
&nbsp; &nbsp; handler: functions/eventsHttp.handler
&nbsp; &nbsp; events:
&nbsp; &nbsp; &nbsp; - http:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: POST
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; path: events
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cors: true</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse"># the name of my service - used during deployment
service: example-offline-http

# serverless plugins to use with serverless
plugins:
  - serverless-offline

# set a default stage in case I don’t provide one
custom:
  defaults:
    stage: dev

# some details about the environment and language I'm going to use
provider:
  name: aws
  runtime: nodejs6.10
  region: us-east-1

# the function entry point and defining the events to trigger it
functions:
  events:
    handler: functions/eventsHttp.handler
    events:
      - http:
          method: POST
          path: events
          cors: true</pre></div></div>

<p>Now to test it, we will start serverless and then post some events with curl:</p>
<p>Run <code>serverless offline</code></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1">Serverless: Starting Offline: dev/us-east-1.
Serverless: Routes for events:
Serverless: POST /events
Serverless: Offline listening on http://localhost:3000</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Serverless: Starting Offline: dev/us-east-1.
Serverless: Routes for events:
Serverless: POST /events
Serverless: Offline listening on http://localhost:3000</pre></div></div>

<p>And now we run <code>curl -d "{'key1':'value1', 'key2':'value2'}" -H "Content-Type: application/json" -X POST http://localhost:3000/events </code><br />
And serverless processes the response, and sends back a 200 Success:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1">Serverless: POST /events (λ: events)
You POSTed an event!
{'key1':'value1', 'key2':'value2'}
Serverless: [200] {&quot;statusCode&quot;:200,&quot;body&quot;:&quot;Success&quot;}</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Serverless: POST /events (λ: events)
You POSTed an event!
{'key1':'value1', 'key2':'value2'}
Serverless: [200] {"statusCode":200,"body":"Success"}</pre></div></div>

<p>To deploy this to real AWS, we run: <code>serverless deploy</code></p>
<p>Serverless creates the stack for us, creates a CloudFormation file to deploy the Lambda, performs the update, then returns information about the environment and the new endpoint it created. Replace the <code>localhost </code> entry above with that new endpoint and try it out!</p>
<p>We can continue to make changes and redeploy them, later deploys update that same stack. When we&#8217;re done, we can leave it running or remove it with <code>serverless remove</code>.</p>
<h3>2. Adding in Kinesis</h3>
<p>Adding a function to consume events from Kinesis is just as easy as the Http example above, but making this work locally is where it gets tricky. I looked at a few different approaches and eventually had to bundle something up on my own (I may go back to the drawing board and write a serverless-kinesalite plugin soon).</p>
<p><i>Note: From here out I&#8217;ll focus on running offline, you can then layer in the configurations for deploying to real Kinesis (lots of good posts on that).</i></p>
<p>To simulate kinesis locally, we can use the <a href="https://github.com/mhart/kinesalite">kinesalite</a> package. So let&#8217;s start by adding a script to bootstrap a Kinesis stream locally that we can publish to from our Http function above. </p>
<p>First, we can use a YAML file to define some environment-specific environment variables:</p>
<p><b>OfflineHttpAndKinesis/config/env.yml</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/config/env.yml">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
</pre></td><td class="de1"><pre class="de1">---
offline: 
&nbsp; KINESIS_HOST: 'localhost'
&nbsp; KINESIS_PORT: 4567
&nbsp; KINESIS_REGION: 'us-east-1'
&nbsp; KINESIS_STREAM_NAME_EVENTS: 'offline-events'</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">---
offline: 
  KINESIS_HOST: 'localhost'
  KINESIS_PORT: 4567
  KINESIS_REGION: 'us-east-1'
  KINESIS_STREAM_NAME_EVENTS: 'offline-events'</pre></div></div>

<p>Because I don&#8217;t have a Kinesis plugin for serverless, we&#8217;re going to be running the bootstrap.js script prior to starting <code>serverless offline</code>, so we can use these environment variables across that bootstrap file, the Kinesis Lambda watcher, and in server less for the HTTP functions to publish to.</p>
<p>This is easy to make available in the serverless config, using a coalesce to look at the set for a stage passed in from the command line or falling back to a default value:</p>
<p><b>OfflineHttpAndKinesis/serverless.yml</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/serverless.yml">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="de1"><pre class="de1">…
&nbsp;
custom:
&nbsp; defaults:
&nbsp; &nbsp; stage: dev
&nbsp;
provider:
&nbsp; name: aws
&nbsp; runtime: nodejs6.10
&nbsp; region: us-east-1
&nbsp; environment: ${file(./config/env.yml):${opt:stage, self:custom.defaults.stage}}
&nbsp;
…</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">…

custom:
  defaults:
    stage: dev

provider:
  name: aws
  runtime: nodejs6.10
  region: us-east-1
  environment: ${file(./config/env.yml):${opt:stage, self:custom.defaults.stage}}

…</pre></div></div>

<p>As we add the bootstrap and kinesis runner, we&#8217;ll pull these environment variables in as well.</p>
<p>Now we&#8217;ll need to add some additional npm packages:</p>
<ul>
<li><code>npm install aws-sdk --save</code> &#8211; For creating the Kinesis stream and publishing in the HTTP Function</li>
<li><code>npm install js-yaml --save-dev</code> &#8211; For parsing the env.yml file for the bootstrap + runner</li>
<li><code>npm install concurrently --save-dev</code> &#8211; To make a clean npm task to start everything</li>
<li><code>npm install -g kinesalite</code> &#8211; Kinesis emulation</li>
</ul>
<p>We&#8217;re ready to add in local kinesis now.</p>
<h3>3. Bootstrap the Stream</h3>
<p>Before we run functions to consume events from the stream, we need to make sure we have started kinesalite and run the bootstrap to ensure the stream is created. We can use the AWS SDK with the env.yml values to get everything ready.</p>
<p><b>OfflineHttpAndKinesis/utility/bootstrap.js</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/utility/bootstrap.js">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="javascript"><thead><tr><td colspan="2"  class="head">Javascript</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="de1"><pre class="de1"><span class="kw1">const</span> AWS <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'aws-sdk'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">const</span> envFromYaml <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'./envFromYaml'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
envFromYaml.<span class="me1">config</span><span class="br0">&#40;</span><span class="st0">'./config/env.yml'</span><span class="sy0">,</span><span class="st0">'offline'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">const</span> kinesis <span class="sy0">=</span> <span class="kw1">new</span> AWS.<span class="me1">Kinesis</span><span class="br0">&#40;</span><span class="br0">&#123;</span>
&nbsp; &nbsp; endpoint<span class="sy0">:</span> `$<span class="br0">&#123;</span>process.<span class="me1">env</span>.<span class="me1">KINESIS_HOST</span><span class="br0">&#125;</span><span class="sy0">:</span>$<span class="br0">&#123;</span>process.<span class="me1">env</span>.<span class="me1">KINESIS_PORT</span><span class="br0">&#125;</span>`<span class="sy0">,</span>
&nbsp; &nbsp; region<span class="sy0">:</span> process.<span class="me1">env</span>.<span class="me1">KINESIS_REGION</span><span class="sy0">,</span>
&nbsp; &nbsp; apiVersion<span class="sy0">:</span> <span class="st0">'2013-12-02'</span><span class="sy0">,</span>
&nbsp; &nbsp; sslEnabled<span class="sy0">:</span> <span class="kw2">false</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
ensureStreamExists<span class="br0">&#40;</span>kinesis<span class="sy0">,</span> process.<span class="me1">env</span>.<span class="me1">KINESIS_STREAM_NAME_EVENTS</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">function</span> ensureStreamExists<span class="br0">&#40;</span>kinesis<span class="sy0">,</span> streamName<span class="br0">&#41;</span><span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="kw1">var</span> req <span class="sy0">=</span> kinesis.<span class="me1">createStream</span><span class="br0">&#40;</span><span class="br0">&#123;</span> ShardCount<span class="sy0">:</span> <span class="nu0">1</span><span class="sy0">,</span> StreamName<span class="sy0">:</span> streamName <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; req.<span class="me1">send</span><span class="br0">&#40;</span><span class="kw1">function</span> <span class="br0">&#40;</span>err<span class="sy0">,</span> data<span class="br0">&#41;</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>err<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>err.<span class="me1">code</span> <span class="sy0">===</span> <span class="st0">'ResourceInUseException'</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">// Stream already exists, so no problem</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span>`Bootstrap<span class="sy0">:</span> Success <span class="sy0">-</span> Kinesis stream <span class="st0">'${streamName}'</span> already exists`<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process.<span class="me1">exit</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span>`Bootstrap<span class="sy0">:</span> Failed <span class="sy0">-</span> Create Kinesis stream <span class="st0">'${streamName}'</span> failed with error $<span class="br0">&#123;</span>err.<span class="me1">stack</span><span class="br0">&#125;</span>`<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process.<span class="me1">exit</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span>`Bootstrap<span class="sy0">:</span> Success <span class="sy0">-</span> Kinesis stream <span class="st0">'${streamName}'</span> created`<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; process.<span class="me1">exit</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">const AWS = require('aws-sdk');
const envFromYaml = require('./envFromYaml');

envFromYaml.config('./config/env.yml','offline');

const kinesis = new AWS.Kinesis({
    endpoint: `${process.env.KINESIS_HOST}:${process.env.KINESIS_PORT}`,
    region: process.env.KINESIS_REGION,
    apiVersion: '2013-12-02',
    sslEnabled: false
});

ensureStreamExists(kinesis, process.env.KINESIS_STREAM_NAME_EVENTS);

function ensureStreamExists(kinesis, streamName){
    var req = kinesis.createStream({ ShardCount: 1, StreamName: streamName });
    req.send(function (err, data) { 
        if (err) {
            if (err.code === 'ResourceInUseException') {
                // Stream already exists, so no problem
                console.log(`Bootstrap: Success - Kinesis stream '${streamName}' already exists`);
                process.exit(0);
            }
            else {
                console.log(`Bootstrap: Failed - Create Kinesis stream '${streamName}' failed with error ${err.stack}`);
                process.exit(1);
            }
        }
        else { 
            console.log(`Bootstrap: Success - Kinesis stream '${streamName}' created`);
            process.exit(0);
        }
    });
}</pre></div></div>

<p>At the top, we&#8217;re pulling the environment variables from the YAML file and pushing it into process.env. We then use the variables to define our Kinesis connection and call the homegrown <code>ensureStreamExists</code> function for each Stream we need to create it if it doesn&#8217;t already exist. My other application has multiple streams, so I have additional KINESIS_STREAM_NAME_* environment variables and call <code>ensureStreamExists</code> for each one. </p>
<p>Now to try it out, we can use two console sessions to run kinesalite: <code>kinesalite</code> and then the bootstrap: <code>node utility/bootstrap.js</code>, and we&#8217;ll know it&#8217;s working when we see this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="text"><thead><tr><td colspan="2"  class="head">Text</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">Bootstrap: Success - Kinesis stream 'offline-events' created</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Bootstrap: Success - Kinesis stream 'offline-events' created</pre></div></div>

<p>We&#8217;ll come back and use concurrently to bundle this into a single, easy npm task.</p>
<h3>4. Add a Kinesis Function</h3>
<p>Adding a new function to consume Kinesis events is as easy as the HTTP function.</p>
<p>Here is the function we&#8217;re adding:</p>
<p><b>OfflineHttpAndKinesis/functions/eventsStream.js</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/functions/eventsStream.js">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="javascript"><thead><tr><td colspan="2"  class="head">Javascript</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="st0">'use strict'</span><span class="sy0">;</span>
&nbsp;
module.<span class="me1">exports</span>.<span class="me1">handler</span> <span class="sy0">=</span> <span class="br0">&#40;</span>event<span class="sy0">,</span> context<span class="sy0">,</span> callback<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; event.<span class="me1">Records</span>.<span class="me1">forEach</span><span class="br0">&#40;</span><span class="br0">&#40;</span>record<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">const</span> payload <span class="sy0">=</span> <span class="kw1">new</span> Buffer<span class="br0">&#40;</span>record.<span class="me1">kinesis</span>.<span class="me1">data</span><span class="sy0">,</span> <span class="st0">'base64'</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="st0">'ascii'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span><span class="st0">&quot;Received an event: &quot;</span> <span class="sy0">+</span> payload<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; callback<span class="br0">&#40;</span><span class="kw2">null</span><span class="sy0">,</span> `Successfully processed $<span class="br0">&#123;</span>event.<span class="me1">Records</span>.<span class="me1">length</span><span class="br0">&#125;</span> event.`<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">'use strict';

module.exports.handler = (event, context, callback) =&gt; {
    event.Records.forEach((record) =&gt; {
        const payload = new Buffer(record.kinesis.data, 'base64').toString('ascii');
        console.log("Received an event: " + payload);
    });
    callback(null, `Successfully processed ${event.Records.length} event.`);
};</pre></div></div>

<p>This function accepts a batch of Kinesis events, loops through each to read the contents, and then console.log&#8217;s that event content. In later posts, I&#8217;ll go into more complex cases or you can look at the <a href="https://github.com/serverless/examples" title="github: serverless/examples">serverless/examples</a> for ideas.</p>
<p>Now for the hard part.</p>
<p>I&#8217;ve adapted a runner I found online for this part, which is available on <a href="https://github.com/tarwn/local-kinesis-lambda-runner" title="github: tarwn/local-kinesis-lambda-runner">github</a>. I&#8217;ve fixed some bugs and made changes for wider function support, but I&#8217;m still leaning toward writing a serverless plugin directly instead.</p>
<p><code>npm install git+https://github.com/tarwn/local-kinesis-lambda-runner.git#package --save-dev</code> will install the version I&#8217;m using.</p>
<p>With the package above and the following script, we can bind functions locally to the Kinesis streams with minimal double-typing (there is still a little).</p>
<p><b>OfflineHttpAndKinesis/utility/runOfflineStreamHandlers.js</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/utility/runOfflineStreamHandlers.js">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="javascript"><thead><tr><td colspan="2"  class="head">Javascript</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="de1"><pre class="de1"><span class="kw1">const</span> AWS <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'aws-sdk'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">const</span> run <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'@rabblerouser/local-kinesis-lambda-runner'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">const</span> envFromYaml <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'./envFromYaml'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
envFromYaml.<span class="me1">config</span><span class="br0">&#40;</span><span class="st0">'./config/env.yml'</span><span class="sy0">,</span><span class="st0">'offline'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">const</span> kinesis <span class="sy0">=</span> <span class="kw1">new</span> AWS.<span class="me1">Kinesis</span><span class="br0">&#40;</span><span class="br0">&#123;</span>
&nbsp; &nbsp; endpoint<span class="sy0">:</span> `$<span class="br0">&#123;</span>process.<span class="me1">env</span>.<span class="me1">KINESIS_HOST</span><span class="br0">&#125;</span><span class="sy0">:</span>$<span class="br0">&#123;</span>process.<span class="me1">env</span>.<span class="me1">KINESIS_PORT</span><span class="br0">&#125;</span>`<span class="sy0">,</span>
&nbsp; &nbsp; region<span class="sy0">:</span> process.<span class="me1">env</span>.<span class="me1">KINESIS_REGION</span><span class="sy0">,</span>
&nbsp; &nbsp; apiVersion<span class="sy0">:</span> <span class="st0">'2013-12-02'</span><span class="sy0">,</span>
&nbsp; &nbsp; sslEnabled<span class="sy0">:</span> <span class="kw2">false</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">const</span> functions <span class="sy0">=</span> <span class="br0">&#91;</span>
&nbsp; &nbsp; <span class="br0">&#123;</span> funName<span class="sy0">:</span> <span class="st0">'EventProcessor'</span><span class="sy0">,</span> handlerPath<span class="sy0">:</span> <span class="st0">'../functions/eventsStream'</span><span class="sy0">,</span> handlerName<span class="sy0">:</span> <span class="st0">'handler'</span><span class="sy0">,</span> kinesisStreamName<span class="sy0">:</span> process.<span class="me1">env</span>.<span class="me1">KINESIS_STREAM_NAME_EVENTS</span> <span class="br0">&#125;</span>
<span class="br0">&#93;</span><span class="sy0">;</span>
initialize<span class="br0">&#40;</span>functions<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// … more code …</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">const AWS = require('aws-sdk');
const run = require('@rabblerouser/local-kinesis-lambda-runner');
const envFromYaml = require('./envFromYaml');

envFromYaml.config('./config/env.yml','offline');

const kinesis = new AWS.Kinesis({
    endpoint: `${process.env.KINESIS_HOST}:${process.env.KINESIS_PORT}`,
    region: process.env.KINESIS_REGION,
    apiVersion: '2013-12-02',
    sslEnabled: false
});
const functions = [
    { funName: 'EventProcessor', handlerPath: '../functions/eventsStream', handlerName: 'handler', kinesisStreamName: process.env.KINESIS_STREAM_NAME_EVENTS }
];
initialize(functions);

// … more code …</pre></div></div>

<p>The key part of this file to edit is the names in the array of functions. <code>funName</code> is a human-readable name you will see in the console output, <code>handlerPath</code> is the relative path to the file the handler is in, <code>handlerName</code> is the module. Everything else is read from the environment variables that are pulled in from the env.yml file and you can add as few or as many entries to the functions array as you like. This file also invalidates the require() cache while it&#8217;s running, so you can make changes to functions and fire new events and the new code will be picked up immediately without restarting anything.</p>
<p>We have one more step before we can bring it all together: publishing events.</p>
<h2>Publishing Events to Kinesis</h2>
<p>We have all the pieces we need to publish events, an HTTP function, the AWS SDK, shared environment variables to identify the streams, so let&#8217;s connect all the dots.</p>
<p>Updating the function to publish the events looks like this:</p>
<p><b>OfflineHttpAndKinesis/functions/eventsHttp.js</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/functions/eventsHttp.js">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="javascript"><thead><tr><td colspan="2"  class="head">Javascript</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="de1"><pre class="de1"><span class="st0">'use strict'</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">var</span> AWS <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'aws-sdk'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; 
<span class="kw1">const</span> kinesis <span class="sy0">=</span> <span class="kw1">new</span> AWS.<span class="me1">Kinesis</span><span class="br0">&#40;</span><span class="br0">&#123;</span>
&nbsp; &nbsp; endpoint<span class="sy0">:</span> `$<span class="br0">&#123;</span>process.<span class="me1">env</span>.<span class="me1">KINESIS_HOST</span><span class="br0">&#125;</span><span class="sy0">:</span>$<span class="br0">&#123;</span>process.<span class="me1">env</span>.<span class="me1">KINESIS_PORT</span><span class="br0">&#125;</span>`<span class="sy0">,</span>
&nbsp; &nbsp; region<span class="sy0">:</span> process.<span class="me1">env</span>.<span class="me1">KINESIS_REGION</span><span class="sy0">,</span>
&nbsp; &nbsp; apiVersion<span class="sy0">:</span> <span class="st0">'2013-12-02'</span><span class="sy0">,</span>
&nbsp; &nbsp; sslEnabled<span class="sy0">:</span> <span class="kw2">false</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
module.<span class="me1">exports</span>.<span class="me1">handler</span> <span class="sy0">=</span> <span class="br0">&#40;</span>event<span class="sy0">,</span> context<span class="sy0">,</span> callback<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; console.<span class="me1">log</span><span class="br0">&#40;</span><span class="st0">&quot;You POSTed an event!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">var</span> putReq <span class="sy0">=</span> kinesis.<span class="me1">putRecord</span><span class="br0">&#40;</span><span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; Data<span class="sy0">:</span> JSON.<span class="me1">stringify</span><span class="br0">&#40;</span>event.<span class="me1">body</span><span class="br0">&#41;</span><span class="sy0">,</span>
&nbsp; &nbsp; &nbsp; &nbsp; PartitionKey<span class="sy0">:</span> <span class="st0">'0'</span><span class="sy0">,</span>
&nbsp; &nbsp; &nbsp; &nbsp; StreamName<span class="sy0">:</span> process.<span class="me1">env</span>.<span class="me1">KINESIS_STREAM_NAME_EVENTS</span>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="sy0">,</span> <span class="kw1">function</span> <span class="br0">&#40;</span>err<span class="sy0">,</span> data<span class="br0">&#41;</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>err<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback<span class="br0">&#40;</span>err<span class="sy0">,</span> <span class="br0">&#123;</span> statusCode<span class="sy0">:</span> <span class="nu0">500</span><span class="sy0">,</span> body<span class="sy0">:</span> <span class="st0">&quot;Error writing to kinesis&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">&#123;</span> 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback<span class="br0">&#40;</span><span class="kw2">null</span><span class="sy0">,</span> <span class="br0">&#123;</span> statusCode<span class="sy0">:</span> <span class="nu0">200</span><span class="sy0">,</span> body<span class="sy0">:</span> <span class="st0">&quot;Ok&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#125;</span>
&nbsp; &nbsp; <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">'use strict';

var AWS = require('aws-sdk');
    
const kinesis = new AWS.Kinesis({
	endpoint: `${process.env.KINESIS_HOST}:${process.env.KINESIS_PORT}`,
	region: process.env.KINESIS_REGION,
	apiVersion: '2013-12-02',
	sslEnabled: false
});

module.exports.handler = (event, context, callback) =&gt; { 
	console.log("You POSTed an event!");

	var putReq = kinesis.putRecord({
		Data: JSON.stringify(event.body),
		PartitionKey: '0',
		StreamName: process.env.KINESIS_STREAM_NAME_EVENTS
	}, function (err, data) { 
		if (err) {
			callback(err, { statusCode: 500, body: "Error writing to kinesis" } );
		}
		else { 
			callback(null, { statusCode: 200, body: "Ok" } );
		}
	});
};</pre></div></div>

<p>Here we&#8217;re initializing the Kinesis connection, then inside the HTTP handler we use <code>putRecord</code> to publish the POSTed event to our Kinesis stream.</p>
<p>The first thing to note is that we initialize the kinesis object outside the function call in both functions. AWS will re-use functions if a lot of events are coming in, so this ensures we don&#8217;t lose time on every single call recreating that necessary resource.</p>
<p>The second to note is that I&#8217;ve hard-coded the PartitionKey. Kinesalite only handles a single partition, but for a real system you would want to replace this with some logic to calculate a PartitionKey, depending on whether you wanted events to consistently be placed in the same partition (maybe all events for a client are always on the same partition) or opt for something more random to level-load the partitions. Lambda will run a single function at a time against each partition, preserving the order of whatever processing you&#8217;re doing (only to the partition, though, not the whole stream).</p>
<p>So, we have a Kinesis emulator, a script to bootstrap the stream, an Http endpoint that pushes an event to kinesis, a function that consumes those events, and a script to run the kinesis function as if it were running under serverless. Time to put it all together!</p>
<h2>Let&#8217;s Go!</h2>
<p>Instead of firing up 4 consoles and running things in the perfect order, we&#8217;ll use <code>concurrently</code> to create a single npm task that will make our lives much easier (and more colorful). Here is the npm task:</p>
<p><b>OfflineHttpAndKinesis/package.json</b> <a href="https://github.com/tarwn/serverless-examples/blob/master/OfflineHttpAndKinesis/package.json">(github)</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="javascript"><thead><tr><td colspan="2"  class="head">Javascript</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="st0">&quot;scripts&quot;</span><span class="sy0">:</span> <span class="br0">&#123;</span>
&nbsp; &nbsp; <span class="st0">&quot;offline&quot;</span><span class="sy0">:</span> <span class="st0">&quot;concurrently --names <span class="es0">\&quot;</span>KNSL,BOOT,HTTP,STRM<span class="es0">\&quot;</span> -c <span class="es0">\&quot;</span>bgGreen.bold,bgGreen.bold,bgBlue.bold,bgMagenta.bold<span class="es0">\&quot;</span> --kill-others-on-fail <span class="es0">\&quot;</span>kinesalite<span class="es0">\&quot;</span> <span class="es0">\&quot;</span>node utility/bootstrap.js<span class="es0">\&quot;</span> <span class="es0">\&quot;</span>serverless offline start --stage offline<span class="es0">\&quot;</span> <span class="es0">\&quot;</span>node utility/runOfflineStreamHandlers.js<span class="es0">\&quot;</span>&quot;</span>
&nbsp; <span class="br0">&#125;</span><span class="sy0">,</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">  "scripts": {
    "offline": "concurrently --names \"KNSL,BOOT,HTTP,STRM\" -c \"bgGreen.bold,bgGreen.bold,bgBlue.bold,bgMagenta.bold\" --kill-others-on-fail \"kinesalite\" \"node utility/bootstrap.js\" \"serverless offline start --stage offline\" \"node utility/runOfflineStreamHandlers.js\""
  },</pre></div></div>

<p>This sets up 4 names to show on console output, each with a different color, and each with a different command. We&#8217;re going to run kinesalite, the bootstrap, serverless offline, and the offline handler script. If we Ctrl+C, it will force a failure and exit them all.</p>
<p>To start, we just need to type <code>npm run offline</code>.</p>
<p>Initial output:<br />
<div id="attachment_8868" style="width: 796px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2018/01/OfflineHttpAndKinesisStartupOutput.png" alt="Offline Lambda and Kinesis Output" width="786" height="391" class="size-full wp-image-8868" srcset="/wp-content/uploads/2018/01/OfflineHttpAndKinesisStartupOutput.png 786w, /wp-content/uploads/2018/01/OfflineHttpAndKinesisStartupOutput-300x149.png 300w, /wp-content/uploads/2018/01/OfflineHttpAndKinesisStartupOutput-768x382.png 768w" sizes="(max-width: 786px) 100vw, 786px" /><p class="wp-caption-text">Offline Lambda and Kinesis Output</p></div></p>
<p>I&#8217;ve been ignoring the initial error that gets kicked out by the stream handler script, it doesn&#8217;t cause any issues at this time. (It&#8217;s adding to the &#8216;maybe I&#8217;ll write a plugin&#8217; balance, though).</p>
<p>And after running the curl command to add an event:<br />
<div id="attachment_8867" style="width: 666px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2018/01/OfflineHttpAndKinesisOutput.png" alt="cUrl =&gt; HTTP Function =&gt; Kinesis Stream =&gt; Kinesis Function" width="656" height="161" class="size-full wp-image-8867" srcset="/wp-content/uploads/2018/01/OfflineHttpAndKinesisOutput.png 656w, /wp-content/uploads/2018/01/OfflineHttpAndKinesisOutput-300x74.png 300w" sizes="(max-width: 656px) 100vw, 656px" /><p class="wp-caption-text">cUrl => HTTP Function => Kinesis Stream => Kinesis Function</p></div></p>
<p>So we have two pretty simple bits of code and we&#8217;re consuming events (with the first 1,000,000 runs/month being free). There were some complicated bits, but that was all for offline emulation. </p>
<p>Hopefully this was helpful, next up I&#8217;ll dive into the project that sparked this work and also adds in some DynamoDB and running an entire Express instance in a single HTTP Function (not recommend, by the way).</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/webdev/uidevelopment/javascript/getting-started-with-javascript-unit/'>Getting Started with JavaScript Unit Testing</a><p>Recently I decided to start doing JavaScript code katas. I've been using JavaScript for around&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://www.tiernok.com/images/RedShirt_80.jpg" alt="User bio image"/>My roles have included accidental DBA, lone developer, systems architect, team lead, VP of Engineering, and general troublemaker. On the technical front I work in web development, distributed systems, test automation, and devop-sy areas like delivery pipelines and integration of all the auditable things. <br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/tarwn" title="tarwn at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/in/eliweinstockherman" title="tarwn at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://tiernok.com/" title="tarwn at HomePage" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_homepage.png" alt="HomePage" /></a><a href="https://plus.google.com/114520820167873768473" title="tarwn at Google Plus" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_gplus.png" alt="Google Plus" /></a><a href="/index.php/author/tarwn/feed/" title="Blog RSS feed for tarwn" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 4,189 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/tarwn/">Read More Posts by Eli Weinstock-Herman (tarwn)</a>
						</div>
					</div>
					<div>
						<label>Tags:</label> <a href="/index.php/tag/faas/" rel="tag">FaaS</a>, <a href="/index.php/tag/kinesis/" rel="tag">Kinesis</a>, <a href="/index.php/tag/lambda/" rel="tag">lambda</a>, <a href="/index.php/tag/node-js/" rel="tag">node.js</a>, <a href="/index.php/tag/serverless/" rel="tag">Serverless</a> 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&text=RT @LessThanDot Blog - Serverless HTTP + Kinesis Lambdas with Offline Development by @tarwn" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&title=Serverless HTTP + Kinesis Lambdas with Offline Development&source=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&title=Serverless HTTP + Kinesis Lambdas with Offline Development" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&quote=Serverless HTTP + Kinesis Lambdas with Offline Development" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/&title=Serverless HTTP + Kinesis Lambdas with Offline Development" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		2 Comments	</h4>
			<ol class="comments-list">
					<li class="comment even thread-even depth-1 parent" id="comment-5977280">
				<div id="div-comment-5977280" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/6135326eb62264710152071c156f8c51?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/6135326eb62264710152071c156f8c51?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.sapec.nl/' rel='external nofollow' class='url'>Peter</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/#comment-5977280">
			January 17, 2018 at 10:06 am</a>		</div>

		<p>Why wouldnt you use kestrel to create code that can be called by web/api plain http or something RESTfull ?.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/?replytocom=5977280#respond' onclick='return addComment.moveForm( "div-comment-5977280", "5977280", "respond", "8865" )' aria-label='Reply to Peter'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment byuser comment-author-tarwn bypostauthor odd alt depth-2" id="comment-5977400">
				<div id="div-comment-5977400" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/67511f6308748c8524ff82fa4ec1eb58?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/67511f6308748c8524ff82fa4ec1eb58?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Eli Weinstock-Herman (tarwn)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/#comment-5977400">
			January 17, 2018 at 12:26 pm</a>		</div>

		<p>I assume you mean &#8220;Why not use kestrel instead of an HTTP Lambda?&#8221;?</p>
<p>If I wanted to put something up quickly that could receive web hook callbacks, the 3 files (package.json, serverless.yml, eventsHttp.js) would be sufficient, and maybe overkill, to easily deploy it and have the service definition and code in git. I could also build a microservices using logs and a variety of storage and ML services this way and it still be about as simple as deploying a single web app to Heroku or Azure. And it would automatically scale based on demand, rather than requiring me to pay a fixed price for fixed resources that would be too little one moment and too much the rest. Also, HTTP events are one type of things Lambdas/Functions can handle, they also provide simplified consumer logic for things like Kinesis and EventHubs and other services. Operating on a file dropped into Dropbox in Azure is pretty much just as easy as the HTTP Handler above, but something that takes some work to implement as part of a website (and I&#8217;d go so far as to say that a website is the wrong kind of tool to build this).</p>
<p>The example above (package.json, serverless.yml, eventsHttp.js) is only lacking AWS account credentials to be 100% complete. I personally love Azure, so if I was deploying something that would be more of a site with consistent usage then I&#8217;d probably shift from functions to Azure Web Sites (probably with MVC) . From there if I needed specific assemblies or to deploy lots of inter-related sites I&#8217;d consider Kubernetes, if I wanted something more ActorModel and to give up some of the niceties of modern web servers I could switch to ServiceFabric, and then finally there is probably still reason I would consider physical servers but I can&#8217;t think of any offhand.</p>
<p>So I don&#8217;t look at FaaS as a replacement for some flavor of website on the Paas/IaaS/Hardware options, just another circle in the Venn diagram that gives us a different set of capabilities and tradeoffs in our toolbelt. I probably could have talked more to that in the post above, but I felt like a bunch of those posts had been written already better than I could and really was focused on helping folks with the specific case of &#8220;how do you have a good local development experience w/ Kinesis functions&#8221; since that was pretty painful for me.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/?replytocom=5977400#respond' onclick='return addComment.moveForm( "div-comment-5977400", "5977400", "respond", "8865" )' aria-label='Reply to Eli Weinstock-Herman (tarwn)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/enterprisedev/cloud/serverless-http-kinesis-lambdas-with-offline-development/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='8865' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="efe937780e95574250dabe07151bdc23"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765892"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
