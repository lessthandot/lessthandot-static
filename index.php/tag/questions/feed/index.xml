<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>questions &#8211; LessthanDot</title>
	<atom:link href="/index.php/tag/questions/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>A Technical Community for IT Professionals</description>
	<lastBuildDate>Sat, 09 Mar 2019 12:50:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.6.1</generator>
	<item>
		<title>The Ten Most Asked SQL Server Questions And Their Answers</title>
		<link>/index.php/datamgmt/datadesign/the-ten-most-asked-sql-server-questions-1/</link>
		<comments>/index.php/datamgmt/datadesign/the-ten-most-asked-sql-server-questions-1/#comments</comments>
		<pubDate>Wed, 10 Dec 2008 15:09:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[answers]]></category>
		<category><![CDATA[questions]]></category>
		<category><![CDATA[sql server 2000]]></category>
		<category><![CDATA[sql server 2005]]></category>
		<category><![CDATA[sql server 2008]]></category>

		<guid isPermaLink="false">/index.php/2008/12/the-ten-most-asked-sql-server-questions-1/</guid>
		<description><![CDATA[If you are active in the SQL Server newsgroups and forums as I am, you will notice that the same questions keep popping up all the time. I picked ten of them which I see daily. Since this became a pretty long blogpost I have linked all the questions bel&#8230;]]></description>
				<content:encoded><![CDATA[<p>If you are active in the SQL Server newsgroups and forums as I am, you will notice that the same questions keep popping up all the time. I picked ten of them which I see daily. Since this became a pretty long blogpost I have linked all the questions below to jump to the question itself.</p>
<p>1) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#1">Selecting all the values from a table for a particular date</a><br />
2) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#2">Search all columns in all the tables in a database for a specific value</a><br />
3) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#3">Splitting string values</a><br />
4) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#4">Select all rows from one table that don&#8217;t exist in another table</a><br />
5) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#5">Getting all rows from one table and only the latest from the child table</a><br />
6) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#6">Getting all characters until a specific character</a><br />
7) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#7">Return all rows with NULL values in a column</a><br />
8) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#8">Row values to column (PIVOT)</a><br />
9) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#9">Pad or remove leading zeroes from numbers</a><br />
10) <a href="/index.php/DataMgmt/DataDesign/the-ten-most-asked-sql-server-questions--1#10">Concatenate Values From Multiple Rows Into One Column</a></p>
<h2 id="1">1 Selecting all the values from a table for a particular date</h2>
<p>This is a very popular question and people sometimes answer that you need to use between. There is a problem with between if you happen to have a value at exactly midnight. Let us take a look, first create this table.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> SomeDates <span class="br0">&#40;</span>DateColumn <span class="kw1">DATETIME</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE SomeDates (DateColumn DATETIME)</pre></div></div>

<p>Insert 2 values</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-02 00:00:00.000'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-01 00:00:00.000'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT INTO SomeDates VALUES('2008-10-02 00:00:00.000')
INSERT INTO SomeDates VALUES('2008-10-01 00:00:00.000')</pre></div></div>

<p>Return everything between &#8216;2008-10-01&#8217; and &#8216;2008-10-02&#8217;</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>
<span class="kw1">FROM</span> SomeDates
<span class="kw1">WHERE</span> DateColumn <span class="sy0">BETWEEN</span> <span class="st0">'20081001'</span> <span class="sy0">AND</span> <span class="st0">'20081002'</span>
<span class="kw1">ORDER</span> <span class="kw1">BY</span> DateColumn</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *
FROM SomeDates
WHERE DateColumn BETWEEN '20081001' AND '20081002'
ORDER BY DateColumn</pre></div></div>

<p>This works without a problem, we get this returned</p>
<p>(results)<br />
2008-10-01 00:00:00.000<br />
2008-10-02 00:00:00.000</p>
<p>Let&#8217;s add some more dates including the time portion</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-02 00:01:00.000'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-02 00:00:59.000'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-02 00:00:01.000'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-01 00:01:00.000'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-01 00:12:00.000'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-01 23:00:00.000'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT INTO SomeDates VALUES('2008-10-02 00:01:00.000')
INSERT INTO SomeDates VALUES('2008-10-02 00:00:59.000')
INSERT INTO SomeDates VALUES('2008-10-02 00:00:01.000')
INSERT INTO SomeDates VALUES('2008-10-01 00:01:00.000')
INSERT INTO SomeDates VALUES('2008-10-01 00:12:00.000')
INSERT INTO SomeDates VALUES('2008-10-01 23:00:00.000')</pre></div></div>

<p>Return everything between &#8216;2008-10-01&#8217; and &#8216;2008-10-02&#8217;</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>
<span class="kw1">FROM</span> SomeDates
<span class="kw1">WHERE</span> DateColumn <span class="sy0">BETWEEN</span> <span class="st0">'20081001'</span> <span class="sy0">AND</span> <span class="st0">'20081002'</span>
<span class="kw1">ORDER</span> <span class="kw1">BY</span> DateColumn</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *
FROM SomeDates
WHERE DateColumn BETWEEN '20081001' AND '20081002'
ORDER BY DateColumn</pre></div></div>

<p>(results)<br />
2008-10-01 00:00:00.000<br />
2008-10-01 00:01:00.000<br />
2008-10-01 00:12:00.000<br />
2008-10-01 23:00:00.000<br />
2008-10-02 00:00:00.000</p>
<p>Here is where it goes wrong; for 2008-10-02 only the midnight value is returned the other ones are ignored</p>
<p>Now if we change 2008-10-02 to 2008-10-03 we get what we want</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>
<span class="kw1">FROM</span> SomeDates
<span class="kw1">WHERE</span> DateColumn <span class="sy0">BETWEEN</span> <span class="st0">'20081001'</span> <span class="sy0">AND</span> <span class="st0">'20081003'</span>
<span class="kw1">ORDER</span> <span class="kw1">BY</span> DateColumn</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *
FROM SomeDates
WHERE DateColumn BETWEEN '20081001' AND '20081003'
ORDER BY DateColumn</pre></div></div>

<p>(results)<br />
2008-10-01 00:00:00.000<br />
2008-10-01 00:01:00.000<br />
2008-10-01 00:12:00.000<br />
2008-10-01 23:00:00.000<br />
2008-10-02 00:00:00.000<br />
2008-10-02 00:00:01.000<br />
2008-10-02 00:00:59.000<br />
2008-10-02 00:01:00.000</p>
<p>Now insert a value for 2008-10-03 (midnight)</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> SomeDates <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'2008-10-03 00:00:00.000'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT INTO SomeDates VALUES('2008-10-03 00:00:00.000')</pre></div></div>

<p>Run the query again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>
<span class="kw1">FROM</span> SomeDates
<span class="kw1">WHERE</span> DateColumn <span class="sy0">BETWEEN</span> <span class="st0">'20081001'</span> <span class="sy0">AND</span> <span class="st0">'20081003'</span>
<span class="kw1">ORDER</span> <span class="kw1">BY</span> DateColumn</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *
FROM SomeDates
WHERE DateColumn BETWEEN '20081001' AND '20081003'
ORDER BY DateColumn</pre></div></div>

<p>(results)<br />
2008-10-01 00:00:00.000<br />
2008-10-01 00:01:00.000<br />
2008-10-01 00:12:00.000<br />
2008-10-01 23:00:00.000<br />
2008-10-02 00:00:00.000<br />
2008-10-02 00:00:01.000<br />
2008-10-02 00:00:59.000<br />
2008-10-02 00:01:00.000<br />
2008-10-03 00:00:00.000</p>
<p>We get back 2008-10-03 00:00:00.000, between will return the date if it is exactly midnight</p>
<p>If you use &gt;= and &lt; then you get exactly what you need </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>
<span class="kw1">FROM</span> SomeDates
<span class="kw1">WHERE</span> DateColumn <span class="sy0">&gt;=</span> <span class="st0">'20081001'</span> <span class="sy0">AND</span> DateColumn <span class="sy0">&lt;</span> <span class="st0">'20081003'</span>
<span class="kw1">ORDER</span> <span class="kw1">BY</span> DateColumn</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *
FROM SomeDates
WHERE DateColumn &gt;= '20081001' AND DateColumn &lt; '20081003'
ORDER BY DateColumn</pre></div></div>

<p>(results)<br />
2008-10-01 00:00:00.000<br />
2008-10-01 00:01:00.000<br />
2008-10-01 00:12:00.000<br />
2008-10-01 23:00:00.000<br />
2008-10-02 00:00:00.000<br />
2008-10-02 00:00:01.000<br />
2008-10-02 00:00:59.000<br />
2008-10-02 00:01:00.000</p>
<p>So be careful when using between because you might get back rows that you did not expect to get back and it might mess up your reporting if you do counts or sums</p>
<p><strong>Bonus: how to strip the time off a date?</strong></p>
<p>To strip the time portion of a datetime, you can do this and still return a datetime</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">Select</span> <span class="sy0">*</span> ,<span class="kw2">DATEADD</span><span class="br0">&#40;</span>dd, <span class="kw2">DATEDIFF</span><span class="br0">&#40;</span>dd, <span class="nu0">0</span>, DateColumn<span class="br0">&#41;</span>, <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">as</span> stripped
<span class="kw1">from</span> SomeDates </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Select * ,DATEADD(dd, DATEDIFF(dd, 0, DateColumn), 0) as stripped
from SomeDates </pre></div></div>

<p>you can also do a convert to varchar with a style value of 112 and then converting back to datetime</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">Select</span> <span class="sy0">*</span> ,<span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">datetime</span>,<span class="kw1">Convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">8</span><span class="br0">&#41;</span>,DateColumn,<span class="nu0">112</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">as</span> stripped
<span class="kw1">from</span> SomeDates </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Select * ,convert(datetime,Convert(varchar(8),DateColumn,112)) as stripped
from SomeDates </pre></div></div>

<p>Both methods return this<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<pre>DateColumn              stripped
2008-10-02 00:00:00.000	2008-10-02 00:00:00.000
2008-10-01 00:00:00.000	2008-10-01 00:00:00.000
2008-10-02 00:01:00.000	2008-10-02 00:00:00.000
2008-10-02 00:00:59.000	2008-10-02 00:00:00.000
2008-10-02 00:00:01.000	2008-10-02 00:00:00.000
2008-10-01 00:01:00.000	2008-10-01 00:00:00.000
2008-10-01 00:12:00.000	2008-10-01 00:00:00.000
2008-10-01 23:00:00.000	2008-10-01 00:00:00.000
2008-10-03 00:00:00.000	2008-10-03 00:00:00.000</pre>
<h2 id="2">2 Search all columns in all the tables in a database for a specific value</h2>
<p>How can I search all the columns in every table in my database for a specific value?<br />
This question keeps popping up all the time. Here is a variation of this question discussed <a href="http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/190a0d12-840f-4ecb-8d32-b436743fdf4e">MSDN Forum T-SQL</a>. Unfortunately there is no easy way to do this, you have to loop over all the tables in the database and search for the value.<br />
As you can imagine if you have a huge database with a lot of tables this can take a really long time.<br />
There are a couple of checks going on in this proc, if the data is not numeric then we skip all the numeric columns and do not search those columns. This code was created by our own gmmastros and what he did was create 3 different stored procedures, one for dates, numbers and strings. Then he created a 4th stored proc named FindMyData, this proc will only call the appropriate child procs if the datatype is right.<br />
We only list the table name and the column name where the value is stored, we do not return that data!<br />
First create the following 3 stored procedures</p>
<p>Just the date searching proc</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">PROCEDURE</span> FindMyData_Date
&nbsp; &nbsp; @DataToFind <span class="kw1">DATETIME</span>
<span class="kw1">AS</span>
<span class="kw1">SET</span> <span class="kw1">NOCOUNT</span> <span class="kw1">ON</span>
&nbsp;
<span class="kw1">DECLARE</span> @Temp <span class="kw1">TABLE</span><span class="br0">&#40;</span>RowId <span class="kw1">INT</span> <span class="kw1">IDENTITY</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">1</span><span class="br0">&#41;</span>, SchemaName sysname, TableName sysname, ColumnName SysName, DataType <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>, DataFound <span class="kw1">BIT</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">DECLARE</span> @<span class="kw2">ISDATE</span> <span class="kw1">BIT</span>
&nbsp;
&nbsp;
&nbsp;
&nbsp; &nbsp; <span class="kw1">INSERT</span> &nbsp;<span class="kw1">INTO</span> @Temp<span class="br0">&#40;</span>TableName,SchemaName, ColumnName, DataType<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;C.<span class="me1">Table_Name</span>,C.<span class="me1">TABLE_SCHEMA</span>, C.<span class="me1">Column_Name</span>, C.<span class="me1">Data_Type</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp;Information_Schema.<span class="me1">Columns</span> <span class="kw1">AS</span> C
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">INNER</span> Join Information_Schema.<span class="me1">Tables</span> <span class="kw1">AS</span> T
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">ON</span> C.<span class="me1">Table_Name</span> <span class="sy0">=</span> T.<span class="me1">Table_Name</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">AND</span> C.<span class="me1">TABLE_SCHEMA</span> <span class="sy0">=</span> T.<span class="me1">TABLE_SCHEMA</span>
&nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp; Table_Type <span class="sy0">=</span> <span class="st0">'Base Table'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; And <span class="br0">&#40;</span>Data_Type <span class="sy0">=</span> <span class="st0">'DateTime'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Or <span class="br0">&#40;</span>Data_Type <span class="sy0">=</span> <span class="st0">'SmallDateTime'</span> And @DataToFind <span class="sy0">&gt;=</span> <span class="st0">'19000101'</span> And @DataToFind <span class="sy0">&lt;</span> <span class="st0">'20790607'</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">DECLARE</span> @i <span class="kw1">INT</span>
<span class="kw1">DECLARE</span> @<span class="kw2">MAX</span> <span class="kw1">INT</span>
<span class="kw1">DECLARE</span> @TableName sysname
<span class="kw1">DECLARE</span> @ColumnName sysname
<span class="kw1">DECLARE</span> @SchemaName sysname
<span class="kw1">DECLARE</span> @<span class="kw1">SQL</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
<span class="kw1">DECLARE</span> @<span class="kw1">PARAMETERS</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
<span class="kw1">DECLARE</span> @DataExists <span class="kw1">BIT</span>
<span class="kw1">DECLARE</span> @SQLTemplate <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SELECT</span> &nbsp;@SQLTemplate <span class="sy0">=</span> <span class="st0">'If Exists(Select *</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From &nbsp; ReplaceTableName</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where &nbsp;[ReplaceColumnName]</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= '</span><span class="st0">''</span> <span class="sy0">+</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">30</span><span class="br0">&#41;</span>, @DataToFind, <span class="nu0">126</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">''</span><span class="st0">'</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set @DataExists = 1</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Else</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set @DataExists = 0'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; @<span class="kw1">PARAMETERS</span> <span class="sy0">=</span> <span class="st0">'@DataExists Bit OUTPUT'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; @i <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp;
<span class="kw1">SELECT</span> @i <span class="sy0">=</span> <span class="nu0">1</span>, @<span class="kw2">MAX</span> <span class="sy0">=</span> <span class="kw2">MAX</span><span class="br0">&#40;</span>RowId<span class="br0">&#41;</span>
<span class="kw1">FROM</span> &nbsp; @Temp
&nbsp;
<span class="kw1">WHILE</span> @i <span class="sy0">&lt;=</span> @<span class="kw2">MAX</span>
&nbsp; &nbsp; <span class="kw1">BEGIN</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;@<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="kw2">REPLACE</span><span class="br0">&#40;</span><span class="kw2">REPLACE</span><span class="br0">&#40;</span>@SQLTemplate, <span class="st0">'ReplaceTableName'</span>, <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>SchemaName<span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">'.'</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>TableName<span class="br0">&#41;</span><span class="br0">&#41;</span>, <span class="st0">'ReplaceColumnName'</span>, ColumnName<span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp;@Temp
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp; RowId <span class="sy0">=</span> @i
&nbsp;
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">PRINT</span> @<span class="kw1">SQL</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">EXEC</span> <span class="kw3">SP_EXECUTESQL</span> @<span class="kw1">SQL</span>, @<span class="kw1">PARAMETERS</span>, @DataExists <span class="sy0">=</span> @DataExists <span class="kw1">OUTPUT</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">IF</span> @DataExists <span class="sy0">=</span><span class="nu0">1</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">UPDATE</span> @Temp <span class="kw1">SET</span> DataFound <span class="sy0">=</span> <span class="nu0">1</span> <span class="kw1">WHERE</span> RowId <span class="sy0">=</span> @i
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SET</span> @i <span class="sy0">=</span> @i <span class="sy0">+</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">END</span>
&nbsp;
<span class="kw1">SELECT</span> &nbsp;SchemaName,TableName, ColumnName
<span class="kw1">FROM</span> &nbsp; &nbsp;@Temp
<span class="kw1">WHERE</span> &nbsp; DataFound <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp;
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE PROCEDURE FindMyData_Date
    @DataToFind DATETIME
AS
SET NOCOUNT ON
 
DECLARE @Temp TABLE(RowId INT IDENTITY(1,1), SchemaName sysname, TableName sysname, ColumnName SysName, DataType VARCHAR(100), DataFound BIT)

DECLARE @ISDATE BIT
 

 
    INSERT  INTO @Temp(TableName,SchemaName, ColumnName, DataType)
    SELECT  C.Table_Name,C.TABLE_SCHEMA, C.Column_Name, C.Data_Type
    FROM    Information_Schema.Columns AS C
            INNER Join Information_Schema.Tables AS T
                ON C.Table_Name = T.Table_Name
		AND C.TABLE_SCHEMA = T.TABLE_SCHEMA
    WHERE   Table_Type = 'Base Table'
            And (Data_Type = 'DateTime'
            Or (Data_Type = 'SmallDateTime' And @DataToFind &gt;= '19000101' And @DataToFind &lt; '20790607'))
 
DECLARE @i INT
DECLARE @MAX INT
DECLARE @TableName sysname
DECLARE @ColumnName sysname
DECLARE @SchemaName sysname
DECLARE @SQL NVARCHAR(4000)
DECLARE @PARAMETERS NVARCHAR(4000)
DECLARE @DataExists BIT
DECLARE @SQLTemplate NVARCHAR(4000)
 
SELECT  @SQLTemplate = 'If Exists(Select *
                                 From   ReplaceTableName
                                 Where  [ReplaceColumnName]
                                              = ''' + CONVERT(VARCHAR(30), @DataToFind, 126) + '''
                                 )
                           Set @DataExists = 1
                       Else
                           Set @DataExists = 0',
        @PARAMETERS = '@DataExists Bit OUTPUT',
        @i = 1
 
SELECT @i = 1, @MAX = MAX(RowId)
FROM   @Temp
 
WHILE @i &lt;= @MAX
    BEGIN
        SELECT  @SQL = REPLACE(REPLACE(@SQLTemplate, 'ReplaceTableName', QUOTENAME(SchemaName) + '.' + QUOTENAME(TableName)), 'ReplaceColumnName', ColumnName)
        FROM    @Temp
        WHERE   RowId = @i
 
 
        PRINT @SQL
        EXEC SP_EXECUTESQL @SQL, @PARAMETERS, @DataExists = @DataExists OUTPUT
 
        IF @DataExists =1
            UPDATE @Temp SET DataFound = 1 WHERE RowId = @i
 
        SET @i = @i + 1
    END
 
SELECT  SchemaName,TableName, ColumnName
FROM    @Temp
WHERE   DataFound = 1

go</pre></div></div>

<p>If you want to test just this proc, try this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> FindMyData_Date <span class="st0">'20070615'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec FindMyData_Date '20070615'</pre></div></div>

<p>This is the string proc</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">PROCEDURE</span> FindMyData_String
&nbsp; &nbsp; @DataToFind <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>,
&nbsp; &nbsp; @ExactMatch <span class="kw1">BIT</span> <span class="sy0">=</span> <span class="nu0">0</span>
<span class="kw1">AS</span>
<span class="kw1">SET</span> <span class="kw1">NOCOUNT</span> <span class="kw1">ON</span>
&nbsp;
<span class="kw1">DECLARE</span> @Temp <span class="kw1">TABLE</span><span class="br0">&#40;</span>RowId <span class="kw1">INT</span> <span class="kw1">IDENTITY</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">1</span><span class="br0">&#41;</span>, SchemaName sysname, TableName sysname, ColumnName SysName, DataType <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>, DataFound <span class="kw1">BIT</span><span class="br0">&#41;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">INSERT</span> &nbsp;<span class="kw1">INTO</span> @Temp<span class="br0">&#40;</span>TableName,SchemaName, ColumnName, DataType<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;C.<span class="me1">Table_Name</span>,C.<span class="me1">TABLE_SCHEMA</span>, C.<span class="me1">Column_Name</span>, C.<span class="me1">Data_Type</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp;Information_Schema.<span class="me1">Columns</span> <span class="kw1">AS</span> C
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">INNER</span> Join Information_Schema.<span class="me1">Tables</span> <span class="kw1">AS</span> T
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">ON</span> C.<span class="me1">Table_Name</span> <span class="sy0">=</span> T.<span class="me1">Table_Name</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">AND</span> C.<span class="me1">TABLE_SCHEMA</span> <span class="sy0">=</span> T.<span class="me1">TABLE_SCHEMA</span>
&nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp; Table_Type <span class="sy0">=</span> <span class="st0">'Base Table'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; And Data_Type In <span class="br0">&#40;</span><span class="st0">'ntext'</span>,<span class="st0">'text'</span>,<span class="st0">'nvarchar'</span>,<span class="st0">'nchar'</span>,<span class="st0">'varchar'</span>,<span class="st0">'char'</span><span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">DECLARE</span> @i <span class="kw1">INT</span>
<span class="kw1">DECLARE</span> @<span class="kw2">MAX</span> <span class="kw1">INT</span>
<span class="kw1">DECLARE</span> @TableName sysname
<span class="kw1">DECLARE</span> @ColumnName sysname
<span class="kw1">DECLARE</span> @SchemaName sysname
<span class="kw1">DECLARE</span> @<span class="kw1">SQL</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
<span class="kw1">DECLARE</span> @<span class="kw1">PARAMETERS</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
<span class="kw1">DECLARE</span> @DataExists <span class="kw1">BIT</span>
<span class="kw1">DECLARE</span> @SQLTemplate <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SELECT</span> &nbsp;@SQLTemplate <span class="sy0">=</span> <span class="kw1">CASE</span> <span class="kw1">WHEN</span> @ExactMatch <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">THEN</span> <span class="st0">'If Exists(Select *</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From &nbsp; ReplaceTableName</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where &nbsp;Convert(nVarChar(4000), [ReplaceColumnName])</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= '</span><span class="st0">''</span> <span class="sy0">+</span> @DataToFind <span class="sy0">+</span> <span class="st0">''</span><span class="st0">'</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 1</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Else</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 0'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">ELSE</span> <span class="st0">'If Exists(Select *</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From &nbsp; ReplaceTableName</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where &nbsp;Convert(nVarChar(4000), [ReplaceColumnName])</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Like '</span><span class="st0">'%'</span> <span class="sy0">+</span> @DataToFind <span class="sy0">+</span> <span class="st0">'%'</span><span class="st0">'</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 1</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Else</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 0'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">END</span>,
&nbsp; &nbsp; &nbsp; &nbsp; @<span class="kw1">PARAMETERS</span> <span class="sy0">=</span> <span class="st0">'@DataExists Bit OUTPUT'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; @i <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp;
<span class="kw1">SELECT</span> @i <span class="sy0">=</span> <span class="nu0">1</span>, @<span class="kw2">MAX</span> <span class="sy0">=</span> <span class="kw2">MAX</span><span class="br0">&#40;</span>RowId<span class="br0">&#41;</span>
<span class="kw1">FROM</span> &nbsp; @Temp
&nbsp;
<span class="kw1">WHILE</span> @i <span class="sy0">&lt;=</span> @<span class="kw2">MAX</span>
&nbsp; &nbsp; <span class="kw1">BEGIN</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;@<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="kw2">REPLACE</span><span class="br0">&#40;</span><span class="kw2">REPLACE</span><span class="br0">&#40;</span>@SQLTemplate, <span class="st0">'ReplaceTableName'</span>, <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>SchemaName<span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">'.'</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>TableName<span class="br0">&#41;</span><span class="br0">&#41;</span>, <span class="st0">'ReplaceColumnName'</span>, ColumnName<span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp;@Temp
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp; RowId <span class="sy0">=</span> @i
&nbsp;
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">PRINT</span> @<span class="kw1">SQL</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">EXEC</span> <span class="kw3">SP_EXECUTESQL</span> @<span class="kw1">SQL</span>, @<span class="kw1">PARAMETERS</span>, @DataExists <span class="sy0">=</span> @DataExists <span class="kw1">OUTPUT</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">IF</span> @DataExists <span class="sy0">=</span><span class="nu0">1</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">UPDATE</span> @Temp <span class="kw1">SET</span> DataFound <span class="sy0">=</span> <span class="nu0">1</span> <span class="kw1">WHERE</span> RowId <span class="sy0">=</span> @i
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SET</span> @i <span class="sy0">=</span> @i <span class="sy0">+</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">END</span>
&nbsp;
<span class="kw1">SELECT</span> &nbsp;SchemaName,TableName, ColumnName
<span class="kw1">FROM</span> &nbsp; &nbsp;@Temp
<span class="kw1">WHERE</span> &nbsp; DataFound <span class="sy0">=</span> <span class="nu0">1</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE PROCEDURE FindMyData_String
    @DataToFind NVARCHAR(4000),
    @ExactMatch BIT = 0
AS
SET NOCOUNT ON
 
DECLARE @Temp TABLE(RowId INT IDENTITY(1,1), SchemaName sysname, TableName sysname, ColumnName SysName, DataType VARCHAR(100), DataFound BIT)
 
    INSERT  INTO @Temp(TableName,SchemaName, ColumnName, DataType)
    SELECT  C.Table_Name,C.TABLE_SCHEMA, C.Column_Name, C.Data_Type
    FROM    Information_Schema.Columns AS C
            INNER Join Information_Schema.Tables AS T
                ON C.Table_Name = T.Table_Name
		AND C.TABLE_SCHEMA = T.TABLE_SCHEMA
    WHERE   Table_Type = 'Base Table'
            And Data_Type In ('ntext','text','nvarchar','nchar','varchar','char')
 
 
DECLARE @i INT
DECLARE @MAX INT
DECLARE @TableName sysname
DECLARE @ColumnName sysname
DECLARE @SchemaName sysname
DECLARE @SQL NVARCHAR(4000)
DECLARE @PARAMETERS NVARCHAR(4000)
DECLARE @DataExists BIT
DECLARE @SQLTemplate NVARCHAR(4000)
 
SELECT  @SQLTemplate = CASE WHEN @ExactMatch = 1
                            THEN 'If Exists(Select *
                                           From   ReplaceTableName
                                           Where  Convert(nVarChar(4000), [ReplaceColumnName])
                                                        = ''' + @DataToFind + '''
                                           )
                                      Set @DataExists = 1
                                  Else
                                      Set @DataExists = 0'
                            ELSE 'If Exists(Select *
                                           From   ReplaceTableName
                                           Where  Convert(nVarChar(4000), [ReplaceColumnName])
                                                        Like ''%' + @DataToFind + '%''
                                           )
                                      Set @DataExists = 1
                                  Else
                                      Set @DataExists = 0'
                            END,
        @PARAMETERS = '@DataExists Bit OUTPUT',
        @i = 1
 
SELECT @i = 1, @MAX = MAX(RowId)
FROM   @Temp
 
WHILE @i &lt;= @MAX
    BEGIN
        SELECT  @SQL = REPLACE(REPLACE(@SQLTemplate, 'ReplaceTableName', QUOTENAME(SchemaName) + '.' + QUOTENAME(TableName)), 'ReplaceColumnName', ColumnName)
        FROM    @Temp
        WHERE   RowId = @i
 
 
        PRINT @SQL
        EXEC SP_EXECUTESQL @SQL, @PARAMETERS, @DataExists = @DataExists OUTPUT
 
        IF @DataExists =1
            UPDATE @Temp SET DataFound = 1 WHERE RowId = @i
 
        SET @i = @i + 1
    END
 
SELECT  SchemaName,TableName, ColumnName
FROM    @Temp
WHERE   DataFound = 1
GO</pre></div></div>

<p>If you want to test just this proc, try this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> FindMyData_string <span class="st0">'google'</span>, <span class="nu0">0</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec FindMyData_string 'google', 0</pre></div></div>

<p>Just the number proc</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">PROCEDURE</span> FindMyData_Number
&nbsp; &nbsp; @DataToFind <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>,
&nbsp; &nbsp; @ExactMatch <span class="kw1">BIT</span> <span class="sy0">=</span> <span class="nu0">0</span>
<span class="kw1">AS</span>
<span class="kw1">SET</span> <span class="kw1">NOCOUNT</span> <span class="kw1">ON</span>
<span class="kw1">DECLARE</span> @Temp <span class="kw1">TABLE</span><span class="br0">&#40;</span>RowId <span class="kw1">INT</span> <span class="kw1">IDENTITY</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">1</span><span class="br0">&#41;</span>, SchemaName sysname, TableName sysname, ColumnName SysName, DataType <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>, DataFound <span class="kw1">BIT</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">DECLARE</span> @IsNumber <span class="kw1">BIT</span>
<span class="kw1">DECLARE</span> @<span class="kw2">ISDATE</span> <span class="kw1">BIT</span>
&nbsp;
<span class="kw1">IF</span> <span class="kw2">ISNUMERIC</span><span class="br0">&#40;</span><span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span>, @DataToFind<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">SET</span> @IsNumber <span class="sy0">=</span> <span class="nu0">1</span>
<span class="kw1">ELSE</span>
&nbsp; &nbsp; <span class="kw1">SET</span> @IsNumber <span class="sy0">=</span> <span class="nu0">0</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">INSERT</span> &nbsp;<span class="kw1">INTO</span> @Temp<span class="br0">&#40;</span>TableName,SchemaName, ColumnName, DataType<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;C.<span class="me1">Table_Name</span>,C.<span class="me1">TABLE_SCHEMA</span>, C.<span class="me1">Column_Name</span>, C.<span class="me1">Data_Type</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp;Information_Schema.<span class="me1">Columns</span> <span class="kw1">AS</span> C
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">INNER</span> Join Information_Schema.<span class="me1">Tables</span> <span class="kw1">AS</span> T
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">ON</span> C.<span class="me1">Table_Name</span> <span class="sy0">=</span> T.<span class="me1">Table_Name</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">AND</span> C.<span class="me1">TABLE_SCHEMA</span> <span class="sy0">=</span> T.<span class="me1">TABLE_SCHEMA</span>
&nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp; Table_Type <span class="sy0">=</span> <span class="st0">'Base Table'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; And Data_Type In <span class="br0">&#40;</span><span class="st0">'float'</span>,<span class="st0">'real'</span>,<span class="st0">'decimal'</span>,<span class="st0">'money'</span>,<span class="st0">'smallmoney'</span>,<span class="st0">'bigint'</span>,<span class="st0">'int'</span>,<span class="st0">'smallint'</span>,<span class="st0">'tinyint'</span>,<span class="st0">'bit'</span><span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">DECLARE</span> @i <span class="kw1">INT</span>
<span class="kw1">DECLARE</span> @<span class="kw2">MAX</span> <span class="kw1">INT</span>
<span class="kw1">DECLARE</span> @TableName sysname
<span class="kw1">DECLARE</span> @ColumnName sysname
<span class="kw1">DECLARE</span> @<span class="kw1">SQL</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
<span class="kw1">DECLARE</span> @<span class="kw1">PARAMETERS</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
<span class="kw1">DECLARE</span> @DataExists <span class="kw1">BIT</span>
<span class="kw1">DECLARE</span> @SQLTemplate <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SELECT</span> &nbsp;@SQLTemplate <span class="sy0">=</span> <span class="kw1">CASE</span> <span class="kw1">WHEN</span> @ExactMatch <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">THEN</span> <span class="st0">'If Exists(Select *</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From &nbsp; ReplaceTableName</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where &nbsp;Convert(VarChar(40), [ReplaceColumnName])</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= '</span><span class="st0">''</span> <span class="sy0">+</span> @DataToFind <span class="sy0">+</span> <span class="st0">''</span><span class="st0">'</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 1</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Else</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 0'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">ELSE</span> <span class="st0">'If Exists(Select *</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From &nbsp; ReplaceTableName</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Where &nbsp;Convert(VarChar(40), [ReplaceColumnName])</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Like '</span><span class="st0">'%'</span> <span class="sy0">+</span> @DataToFind <span class="sy0">+</span> <span class="st0">'%'</span><span class="st0">'</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 1</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Else</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @DataExists = 0'</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">END</span>,
&nbsp; &nbsp; &nbsp; &nbsp; @<span class="kw1">PARAMETERS</span> <span class="sy0">=</span> <span class="st0">'@DataExists Bit OUTPUT'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; @i <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp;
<span class="kw1">SELECT</span> @i <span class="sy0">=</span> <span class="nu0">1</span>, @<span class="kw2">MAX</span> <span class="sy0">=</span> <span class="kw2">MAX</span><span class="br0">&#40;</span>RowId<span class="br0">&#41;</span>
<span class="kw1">FROM</span> &nbsp; @Temp
&nbsp;
<span class="kw1">WHILE</span> @i <span class="sy0">&lt;=</span> @<span class="kw2">MAX</span>
&nbsp; &nbsp; <span class="kw1">BEGIN</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;@<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="kw2">REPLACE</span><span class="br0">&#40;</span><span class="kw2">REPLACE</span><span class="br0">&#40;</span>@SQLTemplate, <span class="st0">'ReplaceTableName'</span>, <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>SchemaName<span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">'.'</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>TableName<span class="br0">&#41;</span><span class="br0">&#41;</span>, <span class="st0">'ReplaceColumnName'</span>, ColumnName<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp;@Temp
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp; RowId <span class="sy0">=</span> @i
&nbsp;
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">PRINT</span> @<span class="kw1">SQL</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">EXEC</span> <span class="kw3">SP_EXECUTESQL</span> @<span class="kw1">SQL</span>, @<span class="kw1">PARAMETERS</span>, @DataExists <span class="sy0">=</span> @DataExists <span class="kw1">OUTPUT</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">IF</span> @DataExists <span class="sy0">=</span><span class="nu0">1</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">UPDATE</span> @Temp <span class="kw1">SET</span> DataFound <span class="sy0">=</span> <span class="nu0">1</span> <span class="kw1">WHERE</span> RowId <span class="sy0">=</span> @i
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SET</span> @i <span class="sy0">=</span> @i <span class="sy0">+</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">END</span>
&nbsp;
<span class="kw1">SELECT</span> &nbsp;SchemaName,TableName, ColumnName
<span class="kw1">FROM</span> &nbsp; &nbsp;@Temp
<span class="kw1">WHERE</span> &nbsp; DataFound <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp;
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE PROCEDURE FindMyData_Number
    @DataToFind NVARCHAR(4000),
    @ExactMatch BIT = 0
AS
SET NOCOUNT ON
DECLARE @Temp TABLE(RowId INT IDENTITY(1,1), SchemaName sysname, TableName sysname, ColumnName SysName, DataType VARCHAR(100), DataFound BIT)

DECLARE @IsNumber BIT
DECLARE @ISDATE BIT
 
IF ISNUMERIC(CONVERT(VARCHAR(20), @DataToFind)) = 1
    SET @IsNumber = 1
ELSE
    SET @IsNumber = 0
 
    INSERT  INTO @Temp(TableName,SchemaName, ColumnName, DataType)
    SELECT  C.Table_Name,C.TABLE_SCHEMA, C.Column_Name, C.Data_Type
    FROM    Information_Schema.Columns AS C
            INNER Join Information_Schema.Tables AS T
                ON C.Table_Name = T.Table_Name
        AND C.TABLE_SCHEMA = T.TABLE_SCHEMA
    WHERE   Table_Type = 'Base Table'
            And Data_Type In ('float','real','decimal','money','smallmoney','bigint','int','smallint','tinyint','bit')
 
 
DECLARE @i INT
DECLARE @MAX INT
DECLARE @TableName sysname
DECLARE @ColumnName sysname
DECLARE @SQL NVARCHAR(4000)
DECLARE @PARAMETERS NVARCHAR(4000)
DECLARE @DataExists BIT
DECLARE @SQLTemplate NVARCHAR(4000)
 
SELECT  @SQLTemplate = CASE WHEN @ExactMatch = 1
                            THEN 'If Exists(Select *
                                           From   ReplaceTableName
                                           Where  Convert(VarChar(40), [ReplaceColumnName])
                                                        = ''' + @DataToFind + '''
                                           )
                                      Set @DataExists = 1
                                  Else
                                      Set @DataExists = 0'
                            ELSE 'If Exists(Select *
                                           From   ReplaceTableName
                                           Where  Convert(VarChar(40), [ReplaceColumnName])
                                                        Like ''%' + @DataToFind + '%''
                                           )
                                      Set @DataExists = 1
                                  Else
                                      Set @DataExists = 0'
                            END,
        @PARAMETERS = '@DataExists Bit OUTPUT',
        @i = 1
 
SELECT @i = 1, @MAX = MAX(RowId)
FROM   @Temp
 
WHILE @i &lt;= @MAX
    BEGIN
        SELECT  @SQL = REPLACE(REPLACE(@SQLTemplate, 'ReplaceTableName', QUOTENAME(SchemaName) + '.' + QUOTENAME(TableName)), 'ReplaceColumnName', ColumnName)
	FROM    @Temp
        WHERE   RowId = @i
 
 
        PRINT @SQL
        EXEC SP_EXECUTESQL @SQL, @PARAMETERS, @DataExists = @DataExists OUTPUT
 
        IF @DataExists =1
            UPDATE @Temp SET DataFound = 1 WHERE RowId = @i
 
        SET @i = @i + 1
    END
 
SELECT  SchemaName,TableName, ColumnName
FROM    @Temp
WHERE   DataFound = 1
 
go</pre></div></div>

<p>If you want to test just this proc, try this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> FindMyData_Number <span class="st0">'562'</span>, <span class="nu0">1</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec FindMyData_Number '562', 1</pre></div></div>

<p>The mother of all procs!</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">PROCEDURE</span> FindMyData
&nbsp; &nbsp; @DataToFind <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">4000</span><span class="br0">&#41;</span>,
&nbsp; &nbsp; @ExactMatch <span class="kw1">BIT</span> <span class="sy0">=</span> <span class="nu0">0</span>
<span class="kw1">AS</span>
<span class="kw1">SET</span> <span class="kw1">NOCOUNT</span> <span class="kw1">ON</span>
&nbsp;
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #Output<span class="br0">&#40;</span>SchemaName sysname, TableName sysname, ColumnName sysname<span class="br0">&#41;</span>
&nbsp;
<span class="kw1">IF</span> <span class="kw2">ISDATE</span><span class="br0">&#40;</span>@DataToFind<span class="br0">&#41;</span> <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> #Output <span class="kw1">EXEC</span> FindMyData_Date @DataToFind
&nbsp;
<span class="kw1">IF</span> <span class="kw2">ISNUMERIC</span><span class="br0">&#40;</span>@DataToFind<span class="br0">&#41;</span> <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> #Output <span class="kw1">EXEC</span> FindMyData_Number @DataToFind, @Exactmatch
&nbsp;
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #Output <span class="kw1">EXEC</span> FindMyData_String @DataToFind, @ExactMatch
&nbsp;
<span class="kw1">SELECT</span> SchemaName,TableName, ColumnName
<span class="kw1">FROM</span> &nbsp; #Output
<span class="kw1">ORDER</span> <span class="kw1">BY</span> SchemaName,TableName, ColumnName
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE PROCEDURE FindMyData
    @DataToFind NVARCHAR(4000),
    @ExactMatch BIT = 0
AS
SET NOCOUNT ON
 
CREATE TABLE #Output(SchemaName sysname, TableName sysname, ColumnName sysname)
 
IF ISDATE(@DataToFind) = 1
    INSERT INTO #Output EXEC FindMyData_Date @DataToFind
 
IF ISNUMERIC(@DataToFind) = 1
    INSERT INTO #Output EXEC FindMyData_Number @DataToFind, @Exactmatch
 
INSERT INTO #Output EXEC FindMyData_String @DataToFind, @ExactMatch
 
SELECT SchemaName,TableName, ColumnName
FROM   #Output
ORDER BY SchemaName,TableName, ColumnName
go</pre></div></div>

<p>Here are some proc calls to test it out</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> FindMyData <span class="st0">'google'</span>, <span class="nu0">0</span>
<span class="kw1">exec</span> FindMyData <span class="nu0">1</span>, <span class="nu0">0</span>
<span class="kw1">exec</span> FindMyData <span class="st0">'20081201'</span>, <span class="nu0">0</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec FindMyData 'google', 0
exec FindMyData 1, 0
exec FindMyData '20081201', 0</pre></div></div>


<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> FindMyData <span class="st0">'sysobjects'</span>, <span class="nu0">0</span> </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec FindMyData 'sysobjects', 0 </pre></div></div>

<h2 id="3">3 Splitting string values</h2>
<p>The fastest way to split a comma delimited string is by using a number table. If you do not have a number table in your database then use this code to create one</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="co1">-- Create our Pivot table ** do this only once</span>
&nbsp; &nbsp; <span class="kw1">CREATE</span> <span class="kw1">TABLE</span> NumberPivot <span class="br0">&#40;</span>NumberID <span class="kw1">INT</span> <span class="kw1">PRIMARY</span> <span class="kw1">KEY</span><span class="br0">&#41;</span>
&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">INSERT</span> <span class="kw1">INTO</span> NumberPivot
&nbsp; &nbsp; &nbsp; &nbsp;<span class="kw1">SELECT</span> number <span class="kw1">FROM</span> master..<span class="me1">spt_values</span>
&nbsp; &nbsp; <span class="kw1">where</span> type <span class="sy0">=</span> <span class="st0">'P'</span>
&nbsp; &nbsp;
&nbsp; &nbsp; GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">-- Create our Pivot table ** do this only once
    CREATE TABLE NumberPivot (NumberID INT PRIMARY KEY)
    
       INSERT INTO NumberPivot
       SELECT number FROM master..spt_values
	where type = 'P'
   
    GO</pre></div></div>

<p>Now you can run the following code to return each of the values in the comma delimited string in its own row</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @SplitString <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> @SplitString <span class="sy0">=</span><span class="st0">'1,4,77,88,4546,234,2,3,54,87,9,6,4,36,6,9,9,6,4,4,68,9,0,5,3,2,'</span>
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; <span class="kw1">SELECT</span> <span class="kw2">SUBSTRING</span><span class="br0">&#40;</span><span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span>, NumberID <span class="sy0">+</span> <span class="nu0">1</span>,
&nbsp; &nbsp; <span class="kw2">CHARINDEX</span><span class="br0">&#40;</span><span class="st0">','</span>, <span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span>, NumberID <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy0">-</span> NumberID <span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="kw1">AS</span> <span class="kw1">VALUE</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> NumberPivot
&nbsp; &nbsp; <span class="kw1">WHERE</span> NumberID <span class="sy0">&lt;=</span> <span class="kw2">LEN</span><span class="br0">&#40;</span><span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span><span class="br0">&#41;</span> <span class="sy0">-</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="sy0">AND</span> <span class="kw2">SUBSTRING</span><span class="br0">&#40;</span><span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span>, NumberID, <span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="st0">','</span>
&nbsp; &nbsp; GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @SplitString VARCHAR(1000)
    SELECT @SplitString ='1,4,77,88,4546,234,2,3,54,87,9,6,4,36,6,9,9,6,4,4,68,9,0,5,3,2,'
     
    SELECT SUBSTRING(',' + @SplitString + ',', NumberID + 1,
    CHARINDEX(',', ',' + @SplitString + ',', NumberID + 1) - NumberID -1)AS VALUE
    FROM NumberPivot
    WHERE NumberID &lt;= LEN(',' + @SplitString + ',') - 1
    AND SUBSTRING(',' + @SplitString + ',', NumberID, 1) = ','
    GO</pre></div></div>

<p>You can also return distinct values by using DISTINCT </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @SplitString <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> @SplitString <span class="sy0">=</span><span class="st0">'1,4,77,88,4546,234,2,3,54,87,9,6,4,36,6,9,9,6,4,4,68,9,0,5,3,2'</span>
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; <span class="kw1">SELECT</span> <span class="kw1">DISTINCT</span> <span class="kw2">SUBSTRING</span><span class="br0">&#40;</span><span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span>, NumberID <span class="sy0">+</span> <span class="nu0">1</span>,
&nbsp; &nbsp; <span class="kw2">CHARINDEX</span><span class="br0">&#40;</span><span class="st0">','</span>, <span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span>, NumberID <span class="sy0">+</span> <span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy0">-</span> NumberID <span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="kw1">AS</span> <span class="kw1">VALUE</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> NumberPivot
&nbsp; &nbsp; <span class="kw1">WHERE</span> NumberID <span class="sy0">&lt;=</span> <span class="kw2">LEN</span><span class="br0">&#40;</span><span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span><span class="br0">&#41;</span> <span class="sy0">-</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="sy0">AND</span> <span class="kw2">SUBSTRING</span><span class="br0">&#40;</span><span class="st0">','</span> <span class="sy0">+</span> @SplitString <span class="sy0">+</span> <span class="st0">','</span>, NumberID, <span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="st0">','</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @SplitString VARCHAR(1000)
    SELECT @SplitString ='1,4,77,88,4546,234,2,3,54,87,9,6,4,36,6,9,9,6,4,4,68,9,0,5,3,2'
     
    SELECT DISTINCT SUBSTRING(',' + @SplitString + ',', NumberID + 1,
    CHARINDEX(',', ',' + @SplitString + ',', NumberID + 1) - NumberID -1)AS VALUE
    FROM NumberPivot
    WHERE NumberID &lt;= LEN(',' + @SplitString + ',') - 1
    AND SUBSTRING(',' + @SplitString + ',', NumberID, 1) = ','</pre></div></div>

<p>You now can dump the result into a table and then you can join one of your real tables with that table which will execute much faster</p>
<h2 id="4">4 Select all rows from one table that don&#8217;t exist in another table</h2>
<p>There are at least 5 ways to return data from one table which is not in another table. Two of these are SQL Server 2005 and greater only</p>
<p>NOT IN<br />
NOT EXISTS<br />
LEFT and RIGHT JOIN<br />
OUTER APPLY (2005+)<br />
EXCEPT (2005+)</p>
<p>First Create these two tables</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> testnulls <span class="br0">&#40;</span>ID <span class="kw1">INT</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> testnulls <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> testnulls <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="nu0">2</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> testnulls <span class="kw1">VALUES</span> <span class="br0">&#40;</span>null<span class="br0">&#41;</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">CREATE</span> <span class="kw1">TABLE</span> testjoin <span class="br0">&#40;</span>ID <span class="kw1">INT</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> testjoin <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> <span class="kw1">INTO</span> testjoin <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="nu0">3</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE testnulls (ID INT)
    INSERT INTO testnulls VALUES (1)
    INSERT INTO testnulls VALUES (2)
    INSERT INTO testnulls VALUES (null)
 
    CREATE TABLE testjoin (ID INT)
    INSERT INTO testjoin VALUES (1)
    INSERT INTO testjoin VALUES (3)</pre></div></div>

<p><strong>NOT IN</strong></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testjoin <span class="kw1">WHERE</span> ID <span class="sy0">NOT</span> <span class="sy0">IN</span><span class="br0">&#40;</span><span class="kw1">SELECT</span> ID <span class="kw1">FROM</span> testnulls<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM testjoin WHERE ID NOT IN(SELECT ID FROM testnulls)</pre></div></div>

<p>What happened? Nothing gets returned! The reason is because the subquery returns a NULL and you can&#8217;t compare a NULL to anything</p>
<p>Now run this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testjoin <span class="kw1">WHERE</span> ID <span class="sy0">NOT</span> <span class="sy0">IN</span><span class="br0">&#40;</span><span class="kw1">SELECT</span> ID <span class="kw1">FROM</span> testnulls <span class="kw1">WHERE</span> ID <span class="kw1">IS</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM testjoin WHERE ID NOT IN(SELECT ID FROM testnulls WHERE ID IS NOT NULL)</pre></div></div>

<p>That worked because we eliminated the NULL values in the subquery</p>
<p><strong>NOT EXISTS</strong></p>
<p>NOT EXISTS doesn&#8217;t have the problem that NOT IN has. Run the following code</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testjoin j
&nbsp; &nbsp; <span class="kw1">WHERE</span> <span class="sy0">NOT</span> <span class="sy0">EXISTS</span> <span class="br0">&#40;</span><span class="kw1">SELECT</span> n.<span class="me1">ID</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> testnulls n
&nbsp; &nbsp; <span class="kw1">WHERE</span> n.<span class="me1">ID</span> <span class="sy0">=</span> j.<span class="me1">ID</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM testjoin j
    WHERE NOT EXISTS (SELECT n.ID
    FROM testnulls n
    WHERE n.ID = j.ID)</pre></div></div>

<p>Everything worked as expected</p>
<p><strong>LEFT and RIGHT JOIN</strong></p>
<p>Plain vanilla LEFT and RIGHT JOINS</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> j.<span class="sy0">*</span> <span class="kw1">FROM</span> testjoin j
&nbsp; &nbsp; <span class="kw1">LEFT</span> <span class="sy0">OUTER</span> <span class="sy0">JOIN</span> testnulls n <span class="kw1">ON</span> n.<span class="me1">ID</span> <span class="sy0">=</span> j.<span class="me1">ID</span>
&nbsp; &nbsp; <span class="kw1">WHERE</span> n.<span class="me1">ID</span> <span class="kw1">IS</span> <span class="sy0">NULL</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">SELECT</span> j.<span class="sy0">*</span> <span class="kw1">FROM</span> &nbsp;testnulls n
&nbsp; &nbsp; <span class="kw1">RIGHT</span> <span class="sy0">OUTER</span> <span class="sy0">JOIN</span> testjoin j &nbsp;<span class="kw1">ON</span> n.<span class="me1">ID</span> <span class="sy0">=</span> j.<span class="me1">ID</span>
&nbsp; &nbsp; <span class="kw1">WHERE</span> n.<span class="me1">ID</span> <span class="kw1">IS</span> <span class="sy0">NULL</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT j.* FROM testjoin j
    LEFT OUTER JOIN testnulls n ON n.ID = j.ID
    WHERE n.ID IS NULL
 
    SELECT j.* FROM  testnulls n
    RIGHT OUTER JOIN testjoin j  ON n.ID = j.ID
    WHERE n.ID IS NULL</pre></div></div>

<p><strong>OUTER APPLY (SQL 2005 +)</strong></p>
<p>OUTER APPLY is something that got added to SQL 2005</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> j.<span class="sy0">*</span> <span class="kw1">FROM</span> testjoin j
&nbsp; &nbsp; <span class="sy0">OUTER</span> APPLY
&nbsp; &nbsp; <span class="br0">&#40;</span><span class="kw1">SELECT</span> id &nbsp;<span class="kw1">FROM</span> testnulls n
&nbsp; &nbsp; <span class="kw1">WHERE</span> n.<span class="me1">ID</span> <span class="sy0">=</span> j.<span class="me1">ID</span><span class="br0">&#41;</span> a
&nbsp; &nbsp; <span class="kw1">WHERE</span> a.<span class="me1">ID</span> <span class="kw1">IS</span> <span class="sy0">NULL</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT j.* FROM testjoin j
    OUTER APPLY
    (SELECT id  FROM testnulls n
    WHERE n.ID = j.ID) a
    WHERE a.ID IS NULL</pre></div></div>

<p><strong>EXCEPT(SQL 2005 +)</strong><br />
EXCEPT is something that got added to SQL 2005. It basically returns everything from the top table which is not in the bottom table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testjoin
&nbsp; &nbsp; <span class="kw1">EXCEPT</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testnulls</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM testjoin
    EXCEPT
    SELECT * FROM testnulls</pre></div></div>

<p><strong>INTERSECT </strong><br />
INTERSECT returns what ever is in both tables(like a regular join)</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testjoin
&nbsp; &nbsp; <span class="kw1">INTERSECT</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> testnulls</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM testjoin
    INTERSECT
    SELECT * FROM testnulls</pre></div></div>

<h2 id="5">5 Getting all rows from one table and only the latest from the child table </h2>
<p>First create this table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #MaxVal<span class="br0">&#40;</span>id <span class="kw1">INT</span>,<span class="kw1">VALUE</span> <span class="kw1">INT</span>,SomeDate <span class="kw1">datetime</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">1</span>,<span class="st0">'20010101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">2</span>,<span class="st0">'20020101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">3</span>,<span class="st0">'20080101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">2</span>,<span class="nu0">1</span>,<span class="st0">'20010101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">2</span>,<span class="nu0">2</span>,<span class="st0">'20060101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">2</span>,<span class="nu0">3</span>,<span class="st0">'20080101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">3</span>,<span class="nu0">1</span>,<span class="st0">'20010101'</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> #MaxVal <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">3</span>,<span class="nu0">2</span>,<span class="st0">'20080101'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE #MaxVal(id INT,VALUE INT,SomeDate datetime)
    INSERT #MaxVal VALUES(1,1,'20010101')
    INSERT #MaxVal VALUES(1,2,'20020101')
    INSERT #MaxVal VALUES(1,3,'20080101')
    INSERT #MaxVal VALUES(2,1,'20010101')
    INSERT #MaxVal VALUES(2,2,'20060101')
    INSERT #MaxVal VALUES(2,3,'20080101')
    INSERT #MaxVal VALUES(3,1,'20010101')
    INSERT #MaxVal VALUES(3,2,'20080101')</pre></div></div>

<p>If you just need the max value from a column you can just do a group by</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> id,<span class="kw2">MAX</span><span class="br0">&#40;</span>SomeDate<span class="br0">&#41;</span> <span class="kw1">AS</span> <span class="kw1">VALUE</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> #MaxVal
&nbsp; &nbsp; <span class="kw1">GROUP</span> <span class="kw1">BY</span> id</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT id,MAX(SomeDate) AS VALUE
    FROM #MaxVal
    GROUP BY id</pre></div></div>

<p>If you need the whole row back then the query below is one way of doing this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> t.<span class="sy0">*</span> <span class="kw1">FROM</span><span class="br0">&#40;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> id,<span class="kw2">MAX</span><span class="br0">&#40;</span>SomeDate<span class="br0">&#41;</span> <span class="kw1">AS</span> MaxValue
&nbsp; &nbsp; <span class="kw1">FROM</span> #MaxVal
&nbsp; &nbsp; <span class="kw1">GROUP</span> <span class="kw1">BY</span> id<span class="br0">&#41;</span> x
&nbsp; &nbsp; <span class="sy0">JOIN</span> #MaxVal t <span class="kw1">ON</span> x.<span class="me1">id</span> <span class="sy0">=</span>t.<span class="me1">id</span>
&nbsp; &nbsp; <span class="sy0">AND</span> x.<span class="me1">MaxValue</span> <span class="sy0">=</span>t.<span class="me1">SomeDate</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT t.* FROM(
    SELECT id,MAX(SomeDate) AS MaxValue
    FROM #MaxVal
    GROUP BY id) x
    JOIN #MaxVal t ON x.id =t.id
    AND x.MaxValue =t.SomeDate</pre></div></div>

<p>We have another blog post on our site which has a lot more detail about doing this, as a matter of fact that blog post describes 5 ways to do it. These 5 ways are:</p>
<p><strong>Key Search</strong><br />
1. Correlated Subquery<br />
2. Derived Table</p>
<p><strong>Number and Filter</strong><br />
3. Windowing Function &#8211; Two Stage<br />
4. Windowing Function &#8211; One Stage</p>
<p><strong>Simulate MS Access</strong><br />
5. Compound Key, aka Packed Values</p>
<p>That post can be found here: <a href="/index.php/DataMgmt/DBProgramming/MSSQLServer/including-an-aggregated-column-s-related">Including an Aggregated Column&#8217;s Related Values</a></p>
<h2 id="6">6 Getting all characters until a specific character (charindex + left)</h2>
<p>There are two built in functions that you can use in SQL Server to return the first position in a column of the character you are looking for. These functions are PATINDEX and CHARINDEX. Let&#8217;s take a look at how PATINDEX  works. First create this table.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #SomeTable2
<span class="br0">&#40;</span>SomeValue <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">49</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable2 <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'one two three'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable2 <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'1 2 3'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable2 <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'abc def ghi'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable2 <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'one two'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable2 <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'one two three four'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable2 <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'one two three four five'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE #SomeTable2
(SomeValue VARCHAR(49))
INSERT INTO #SomeTable2 VALUES ('one two three')
INSERT INTO #SomeTable2 VALUES ('1 2 3')
INSERT INTO #SomeTable2 VALUES ('abc def ghi')
INSERT INTO #SomeTable2 VALUES ('one two')
INSERT INTO #SomeTable2 VALUES ('one two three four')
INSERT INTO #SomeTable2 VALUES ('one two three four five')</pre></div></div>

<p>Now we want to return everything up to the first space and also everything after the last space. Here is how we do that</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span>,<span class="kw1">left</span><span class="br0">&#40;</span>SomeValue,<span class="kw2">patindex</span><span class="br0">&#40;</span><span class="st0">'% %'</span>,SomeValue<span class="br0">&#41;</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span>,
<span class="kw1">right</span><span class="br0">&#40;</span>SomeValue,<span class="kw2">patindex</span><span class="br0">&#40;</span><span class="st0">'% %'</span>,<span class="br0">&#40;</span><span class="kw2">reverse</span><span class="br0">&#40;</span>SomeValue<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span>
<span class="kw1">from</span> #SomeTable2</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select *,left(SomeValue,patindex('% %',SomeValue)-1),
right(SomeValue,patindex('% %',(reverse(SomeValue)))-1)
from #SomeTable2</pre></div></div>

<p>(results)</p>
<table border = "1">
<tr>
<td>	one two three	</td>
<td>	one	</td>
<td>	three	</td>
</tr>
<tr>
<td>	1 2 3	</td>
<td>	1	</td>
<td>	3	</td>
</tr>
<tr>
<td>	abc def ghi	</td>
<td>	abc	</td>
<td>	ghi	</td>
</tr>
<tr>
<td>	one two	</td>
<td>	one	</td>
<td>	two	</td>
</tr>
<tr>
<td>	one two three four	</td>
<td>	one	</td>
<td>	four	</td>
</tr>
<tr>
<td>	one two three four five	</td>
<td>	one	</td>
<td>	five	</td>
</tr>
</table>
<p>As you can see to get the last value you can just use the REVERSE function with the RIGHT function. </p>
<h2 id="7">7 Return all rows with NULL values in a column</h2>
<p>People have a hard time with nulls, the first problem with NULLs is that your WHERE clause is not the same as if you would select a blank or a value </p>
<p>First create this simple table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #SomeTableNull<span class="br0">&#40;</span>SomeValue <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">49</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTableNull <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'1'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTableNull <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">''</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTableNull <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'a'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTableNull <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="sy0">NULL</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE #SomeTableNull(SomeValue VARCHAR(49))
INSERT INTO #SomeTableNull VALUES ('1')
INSERT INTO #SomeTableNull VALUES ('')
INSERT INTO #SomeTableNull VALUES ('a')
INSERT INTO #SomeTableNull VALUES (NULL)</pre></div></div>

<p>To search a column your WHERE clause uses the  = sign</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> #SomeTableNull <span class="kw1">WHERE</span> SomeValue <span class="sy0">=</span> <span class="st0">''</span>
<span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> #SomeTableNull <span class="kw1">WHERE</span> SomeValue <span class="sy0">=</span> <span class="st0">'1'</span>
<span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> #SomeTableNull <span class="kw1">WHERE</span> SomeValue <span class="sy0">=</span> <span class="st0">'a'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM #SomeTableNull WHERE SomeValue = ''
SELECT * FROM #SomeTableNull WHERE SomeValue = '1'
SELECT * FROM #SomeTableNull WHERE SomeValue = 'a'</pre></div></div>

<p>Now let us try that to find a NULL value</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> #SomeTableNull <span class="kw1">WHERE</span> SomeValue <span class="sy0">=</span> <span class="sy0">NULL</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM #SomeTableNull WHERE SomeValue = NULL</pre></div></div>

<p>What just happened? We got nothing back? The reason is that you cannot compare a NULL value according to ANSI standards.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1">Take a look <span class="kw1">at</span> this
<span class="kw1">IF</span> <span class="sy0">NULL</span> <span class="sy0">=</span> <span class="sy0">NULL</span>
<span class="kw1">print</span> <span class="st0">'equal'</span>
<span class="kw1">else</span> 
<span class="kw1">print</span> <span class="st0">'not so equal'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Take a look at this
IF NULL = NULL
print 'equal'
else 
print 'not so equal'</pre></div></div>

<p>The bottom print statement got printed, NULL is unknown and you do not know if two unknows are the same</p>
<p>The correct way to return the NULL value is the following</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> #SomeTableNull <span class="kw1">WHERE</span> SomeValue <span class="kw1">IS</span> <span class="sy0">NULL</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT * FROM #SomeTableNull WHERE SomeValue IS NULL</pre></div></div>

<p>Just so that you know this, if you turn off ansi nulls then you can use =</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SET</span> ansi_nulls <span class="kw1">off</span>
&nbsp;
&nbsp;
<span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> #SomeTableNull <span class="kw1">WHERE</span> SomeValue <span class="sy0">=</span> <span class="sy0">NULL</span>
&nbsp;
<span class="kw1">SET</span> ansi_nulls <span class="kw1">on</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SET ansi_nulls off


SELECT * FROM #SomeTableNull WHERE SomeValue = NULL

SET ansi_nulls on</pre></div></div>

<p>However I do not recommend doing that ever, the default is ON and I would leave it like that</p>
<h2 id="8">8 Row values to column (PIVOT)</h2>
<p>A very frequent request is how to pivot/transpose/crosstab a query. SQL server 2005 introduced PIVOT, this makes life a lot easier compared to the SQL 2000 days. so let&#8217;s see how this works. First create this table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #SomeTable
<span class="br0">&#40;</span>SomeName <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">49</span><span class="br0">&#41;</span>, Quantity <span class="kw1">INT</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE #SomeTable
(SomeName VARCHAR(49), Quantity INT)</pre></div></div>


<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'Scarface'</span>, <span class="nu0">2</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'Scarface'</span>, <span class="nu0">4</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'LOTR'</span>, <span class="nu0">5</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'LOTR'</span>, <span class="nu0">6</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span> <span class="st0">'Jaws'</span>, <span class="nu0">2</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'Blade'</span>, <span class="nu0">5</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'Saw'</span>, <span class="nu0">6</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span> <span class="st0">'Saw'</span>, <span class="nu0">2</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span> <span class="st0">'Jaws'</span>, <span class="nu0">12</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'Blade'</span>, <span class="nu0">5</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'Saw'</span>, <span class="nu0">6</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #SomeTable <span class="kw1">VALUES</span> <span class="br0">&#40;</span> <span class="st0">'Saw'</span>, <span class="nu0">2</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT INTO #SomeTable VALUES ('Scarface', 2)
INSERT INTO #SomeTable VALUES ('Scarface', 4)
INSERT INTO #SomeTable VALUES ('LOTR', 5)
INSERT INTO #SomeTable VALUES ('LOTR', 6)
INSERT INTO #SomeTable VALUES ( 'Jaws', 2)
INSERT INTO #SomeTable VALUES ('Blade', 5)
INSERT INTO #SomeTable VALUES ('Saw', 6)
INSERT INTO #SomeTable VALUES ( 'Saw', 2)
INSERT INTO #SomeTable VALUES ( 'Jaws', 12)
INSERT INTO #SomeTable VALUES ('Blade', 5)
INSERT INTO #SomeTable VALUES ('Saw', 6)
INSERT INTO #SomeTable VALUES ( 'Saw', 2)</pre></div></div>

<p>What we want is too list all the movies in a column and the sum of all quantities for that movie as a value. So in this case we want this output</p>
<table border="1">
<tr>
<td> Scarface </td>
<td> LOTR </td>
<td> Jaws </td>
<td> Saw </td>
<td> Blade
</td>
</tr>
<tr>
<td> 6 </td>
<td> 11 </td>
<td> 14 </td>
<td> 16 </td>
<td> 10
</td>
</tr>
</table>
<p>First let&#8217;s look how we can do this in SQL Server 2000, this BTW will also work in SQL Server 2005/2008</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="kw2">SUM</span><span class="br0">&#40;</span><span class="kw1">CASE</span> SomeName <span class="kw1">WHEN</span> <span class="st0">'Scarface'</span> <span class="kw1">THEN</span> Quantity <span class="kw1">ELSE</span> <span class="nu0">0</span> <span class="kw1">END</span><span class="br0">&#41;</span> <span class="kw1">AS</span> Scarface,
<span class="kw2">SUM</span><span class="br0">&#40;</span><span class="kw1">CASE</span> SomeName <span class="kw1">WHEN</span> <span class="st0">'LOTR'</span> <span class="kw1">THEN</span> Quantity <span class="kw1">ELSE</span> <span class="nu0">0</span> <span class="kw1">END</span><span class="br0">&#41;</span> <span class="kw1">AS</span> LOTR,
<span class="kw2">SUM</span><span class="br0">&#40;</span><span class="kw1">CASE</span> SomeName <span class="kw1">WHEN</span> <span class="st0">'Jaws'</span> <span class="kw1">THEN</span> Quantity <span class="kw1">ELSE</span> <span class="nu0">0</span> <span class="kw1">END</span><span class="br0">&#41;</span> <span class="kw1">AS</span> Jaws,
<span class="kw2">SUM</span><span class="br0">&#40;</span><span class="kw1">CASE</span> SomeName <span class="kw1">WHEN</span> <span class="st0">'Saw'</span> <span class="kw1">THEN</span> Quantity <span class="kw1">ELSE</span> <span class="nu0">0</span> <span class="kw1">END</span><span class="br0">&#41;</span> <span class="kw1">AS</span> Saw,
<span class="kw2">SUM</span><span class="br0">&#40;</span><span class="kw1">CASE</span> SomeName <span class="kw1">WHEN</span> <span class="st0">'Blade'</span> <span class="kw1">THEN</span> Quantity <span class="kw1">ELSE</span> <span class="nu0">0</span> <span class="kw1">END</span><span class="br0">&#41;</span> <span class="kw1">AS</span> Blade
<span class="kw1">FROM</span> #SomeTable</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT SUM(CASE SomeName WHEN 'Scarface' THEN Quantity ELSE 0 END) AS Scarface,
SUM(CASE SomeName WHEN 'LOTR' THEN Quantity ELSE 0 END) AS LOTR,
SUM(CASE SomeName WHEN 'Jaws' THEN Quantity ELSE 0 END) AS Jaws,
SUM(CASE SomeName WHEN 'Saw' THEN Quantity ELSE 0 END) AS Saw,
SUM(CASE SomeName WHEN 'Blade' THEN Quantity ELSE 0 END) AS Blade
FROM #SomeTable</pre></div></div>

<p>In SQL Server 2005/2008 we can use PIVOT, here is how we can use it</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> Scarface, LOTR, Jaws, Saw,Blade
<span class="kw1">FROM</span>
<span class="br0">&#40;</span><span class="kw1">SELECT</span> SomeName,Quantity
<span class="kw1">FROM</span> #SomeTable<span class="br0">&#41;</span> <span class="kw1">AS</span> pivTemp
PIVOT
<span class="br0">&#40;</span> &nbsp; <span class="kw2">SUM</span><span class="br0">&#40;</span>Quantity<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">FOR</span> SomeName <span class="sy0">IN</span> <span class="br0">&#40;</span>Scarface, LOTR, Jaws, Saw,Blade<span class="br0">&#41;</span>
<span class="br0">&#41;</span> <span class="kw1">AS</span> pivTable</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT Scarface, LOTR, Jaws, Saw,Blade
FROM
(SELECT SomeName,Quantity
FROM #SomeTable) AS pivTemp
PIVOT
(   SUM(Quantity)
    FOR SomeName IN (Scarface, LOTR, Jaws, Saw,Blade)
) AS pivTable</pre></div></div>

<p>That looks a little bit neater than the SQL 2000 version.<br />
If you are interested in Column To Row take a look at <a href="http://wiki.lessthandot.com/index.php/Column_To_Row_%28UNPIVOT%29">Column To Row (UNPIVOT)</a> on our wiki</p>
<h2 id="9">9 Pad or remove leading zeroes from numbers</h2>
<p>To pad a number with leading zeroes you use as many zeroes as you want the output to be, then use concatenation plus the right function to display it<br />
For example if you want to pad a 6 digit column with zeroes you would do something like this<br />
 RIGHT(&#8216;000000&#8217; + CONVERT(VARCHAR(6),ColumnName),6)</p>
<p>Here is some code that will show this, first create this table<br />
USE tempdb<br />
go</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> testpadding<span class="br0">&#40;</span>id <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">50</span><span class="br0">&#41;</span>,id2 <span class="kw1">INT</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> testpadding <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'000001'</span>,<span class="nu0">1</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> testpadding <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'000134'</span>,<span class="nu0">134</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> testpadding <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'002232'</span>,<span class="nu0">2232</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> testpadding <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'000002'</span>,<span class="nu0">2</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE testpadding(id VARCHAR(50),id2 INT)
INSERT testpadding VALUES('000001',1)
INSERT testpadding VALUES('000134',134)
INSERT testpadding VALUES('002232',2232)
INSERT testpadding VALUES('000002',2)</pre></div></div>

<p>Now run </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="kw1">RIGHT</span><span class="br0">&#40;</span><span class="st0">'000000'</span> <span class="sy0">+</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">6</span><span class="br0">&#41;</span>,id2<span class="br0">&#41;</span>,<span class="nu0">6</span><span class="br0">&#41;</span>
<span class="kw1">FROM</span> testpadding</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT RIGHT('000000' + CONVERT(VARCHAR(6),id2),6)
FROM testpadding</pre></div></div>

<p>(results)<br />
000001<br />
000134<br />
002232<br />
000002</p>
<p>what about the id columns and stripping the zeroes from that?<br />
No problem do this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">INT</span>,id<span class="br0">&#41;</span>
<span class="kw1">FROM</span> testpadding</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT CONVERT(INT,id)
FROM testpadding</pre></div></div>

<p>(results)<br />
1<br />
134<br />
2232<br />
2</p>
<p>Beautiful right? Not so fast, insert this row</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> testpadding <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="st0">'02222222222222222222200002'</span>,<span class="nu0">2</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT testpadding VALUES('02222222222222222222200002',2)</pre></div></div>


<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">INT</span>,id<span class="br0">&#41;</span>
<span class="kw1">FROM</span> testpadding</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT CONVERT(INT,id)
FROM testpadding</pre></div></div>

<p>Server: Msg 248, Level 16, State 1, Line 1<br />
The conversion of the varchar value &#8216;02222222222222222222200002&#8217; overflowed an int column.</p>
<p>Okay we can do a bigint instead</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">bigINT</span>,id<span class="br0">&#41;</span>
<span class="kw1">FROM</span> testpadding</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT CONVERT(bigINT,id)
FROM testpadding</pre></div></div>

<p>Server: Msg 8115, Level 16, State 2, Line 1<br />
Arithmetic overflow error converting expression to data type bigint.</p>
<p>Nope, even that doesn&#8217;t fit, now what?</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="kw2">replace</span><span class="br0">&#40;</span><span class="kw2">ltrim</span><span class="br0">&#40;</span><span class="kw2">replace</span><span class="br0">&#40;</span>id,<span class="st0">'0'</span>,<span class="st0">' '</span><span class="br0">&#41;</span><span class="br0">&#41;</span>,<span class="st0">' '</span>,<span class="st0">'0'</span><span class="br0">&#41;</span>
<span class="kw1">FROM</span> testpadding</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select replace(ltrim(replace(id,'0',' ')),' ','0')
FROM testpadding</pre></div></div>

<p>(results)<br />
1<br />
134<br />
2232<br />
2<br />
2222222222222222222200002</p>
<p>So how does that work? First you replace all the zeroes with spaces, then you trim it to get rid of the leading spaces, after you replace the space back to zeroes again, the leading zeroes don&#8217;t exists anymore because they were trimmed</p>
<h2 id="10">10 Concatenate Values From Multiple Rows Into One Column</h2>
<p>If you want to concatenate values from multiple rows into one and you want to order it then you have to use FOR XML PATH. The ORDER BY is -not- guaranteed to be processed before the concatenation occurs, if you use that technique. However, it -is- guaranteed if you use FOR XML PATH(&#8221;).</p>
<p>Let&#8217;s take a look. First create these tables</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="de1"><pre class="de1"><span class="kw1">USE</span> TEMPDB
GO
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> Authors <span class="br0">&#40;</span>Id <span class="kw1">INT</span>, LastName <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>, FirstName <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
GO
<span class="kw1">INSERT</span> Authors <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="st0">'Nielsen'</span>,<span class="st0">'Paul'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Authors <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">2</span>,<span class="st0">'King'</span>,<span class="st0">'Stephen'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Authors <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">3</span>,<span class="st0">'Stephenson'</span>,<span class="st0">'Neal'</span><span class="br0">&#41;</span>
GO
&nbsp;
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> Books <span class="br0">&#40;</span>ID <span class="kw1">INT</span>,AuthorID <span class="kw1">INT</span>, BookName <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">200</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
GO
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">1</span>,<span class="st0">'SQL Server 2005 Bible'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">2</span>,<span class="nu0">1</span>,<span class="st0">'SQL Server 2008 Bible'</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">3</span>,<span class="nu0">2</span>,<span class="st0">'It'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">4</span>,<span class="nu0">2</span>,<span class="st0">'The Stand'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">5</span>,<span class="nu0">2</span>,<span class="st0">'Thinner'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">6</span>,<span class="nu0">2</span>,<span class="st0">'Salems Lot'</span><span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">7</span>,<span class="nu0">3</span>,<span class="st0">'Snow Crash'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">8</span>,<span class="nu0">3</span>,<span class="st0">'The Diamond Age'</span><span class="br0">&#41;</span>
<span class="kw1">INSERT</span> Books <span class="kw1">VALUES</span><span class="br0">&#40;</span><span class="nu0">9</span>,<span class="nu0">3</span>,<span class="st0">'Cryptonomicon'</span><span class="br0">&#41;</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">USE TEMPDB
GO
CREATE TABLE Authors (Id INT, LastName VARCHAR(100), FirstName VARCHAR(100))
GO
INSERT Authors VALUES(1,'Nielsen','Paul')
INSERT Authors VALUES(2,'King','Stephen')
INSERT Authors VALUES(3,'Stephenson','Neal')
GO
 
CREATE TABLE Books (ID INT,AuthorID INT, BookName VARCHAR(200))
GO
INSERT Books VALUES(1,1,'SQL Server 2005 Bible')
INSERT Books VALUES(2,1,'SQL Server 2008 Bible')
 
INSERT Books VALUES(3,2,'It')
INSERT Books VALUES(4,2,'The Stand')
INSERT Books VALUES(5,2,'Thinner')
INSERT Books VALUES(6,2,'Salems Lot')
 
 
INSERT Books VALUES(7,3,'Snow Crash')
INSERT Books VALUES(8,3,'The Diamond Age')
INSERT Books VALUES(9,3,'Cryptonomicon')
GO</pre></div></div>

<p>This is the old style function, it will run on SQL Server 2000 and up</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">FUNCTION</span> fnGetBooks2 <span class="br0">&#40;</span>@AuthorID <span class="kw1">INT</span><span class="br0">&#41;</span>
<span class="kw1">RETURNS</span> <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">8000</span><span class="br0">&#41;</span>
<span class="kw1">AS</span>
<span class="kw1">BEGIN</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">DECLARE</span> @BookList <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">8000</span><span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SELECT</span> @BookList <span class="sy0">=</span> <span class="st0">''</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SELECT</span> @BookList <span class="sy0">=</span> @BookList <span class="sy0">+</span> BookName <span class="sy0">+</span><span class="st0">','</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">FROM</span> Books
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">WHERE</span> AuthorID <span class="sy0">=</span> @AuthorID
&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">AND</span> BookName <span class="kw1">IS</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">ORDER</span> <span class="kw1">BY</span> BookName <span class="co1">--yes we can sort</span>
&nbsp;
<span class="kw1">RETURN</span> <span class="kw1">LEFT</span><span class="br0">&#40;</span>@BookList,<span class="br0">&#40;</span><span class="kw2">LEN</span><span class="br0">&#40;</span>@BookList<span class="br0">&#41;</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="kw1">END</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE FUNCTION fnGetBooks2 (@AuthorID INT)
RETURNS VARCHAR(8000)
AS
BEGIN
        DECLARE @BookList VARCHAR(8000)
        SELECT @BookList = ''
        SELECT @BookList = @BookList + BookName +','
        FROM Books
        WHERE AuthorID = @AuthorID
        AND BookName IS NOT NULL
        ORDER BY BookName --yes we can sort
 
RETURN LEFT(@BookList,(LEN(@BookList) -1))
END
GO</pre></div></div>

<p>This is the same function using XML Path, so SQL Server 2005 and up</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">FUNCTION</span> fnGetBooks <span class="br0">&#40;</span>@AuthorID <span class="kw1">INT</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">RETURNS</span> <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">8000</span><span class="br0">&#41;</span>
<span class="kw1">AS</span>
<span class="kw1">BEGIN</span>
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;<span class="kw1">DECLARE</span> @BookList <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">8000</span><span class="br0">&#41;</span>
&nbsp;<span class="kw1">SELECT</span> @BookList <span class="sy0">=</span><span class="br0">&#40;</span>
&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">SELECT</span> &nbsp;BookName <span class="sy0">+</span> <span class="st0">', '</span> <span class="kw1">AS</span> <span class="br0">&#91;</span><span class="kw1">text</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
&nbsp;
&nbsp; &nbsp; &nbsp;<span class="kw1">FROM</span> &nbsp; &nbsp;Books
&nbsp;<span class="kw1">WHERE</span> AuthorID <span class="sy0">=</span> @AuthorID
&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">AND</span> BookName <span class="kw1">IS</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>
&nbsp; &nbsp; &nbsp;<span class="kw1">ORDER</span> <span class="kw1">BY</span> BookName
&nbsp;
&nbsp; &nbsp; &nbsp;<span class="kw1">FOR</span> XML <span class="kw1">PATH</span><span class="br0">&#40;</span><span class="st0">''</span><span class="br0">&#41;</span> <span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
<span class="kw1">RETURN</span> <span class="kw1">LEFT</span><span class="br0">&#40;</span>@BookList,<span class="br0">&#40;</span><span class="kw2">LEN</span><span class="br0">&#40;</span>@BookList<span class="br0">&#41;</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="kw1">END</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE FUNCTION fnGetBooks (@AuthorID INT)
 
RETURNS VARCHAR(8000)
AS
BEGIN
       
 DECLARE @BookList VARCHAR(8000)
 SELECT @BookList =(
 
        SELECT  BookName + ', ' AS [text()]
 
     FROM    Books
 WHERE AuthorID = @AuthorID
        AND BookName IS NOT NULL
     ORDER BY BookName
 
     FOR XML PATH('') )
       
 
RETURN LEFT(@BookList,(LEN(@BookList) -1))
END
GO</pre></div></div>

<p>Here are the calls to the functions</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>,dbo.<span class="me1">fnGetBooks</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span> <span class="kw1">AS</span> Books
<span class="kw1">FROM</span> Authors</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *,dbo.fnGetBooks(id) AS Books
FROM Authors</pre></div></div>


<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span>,dbo.<span class="me1">fnGetBooks2</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span> <span class="kw1">AS</span> Books
<span class="kw1">FROM</span> Authors</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT *,dbo.fnGetBooks2(id) AS Books
FROM Authors</pre></div></div>

<p></p>
<p>(results)</p>
<table border="1">
<tr>
<td> Id </td>
<td> LastName</td>
<td> FirstName </td>
<td> Books
</td>
</tr>
<tr>
<td> 1 </td>
<td> Nielsen </td>
<td> Paul</td>
<td> SQL Server 2005 Bible,SQL Server 2008 Bible
</td>
</tr>
<tr>
<td> 2 </td>
<td> King </td>
<td> Stephen</td>
<td> It,Salems Lot,The Stand,Thinner
</td>
</tr>
<tr>
<td> 3 </td>
<td> Stephenson</td>
<td> Neal</td>
<td> Cryptonomicon,Snow Crash,The Diamond Age
</td>
</tr>
</table>
<p>The results are the same but I have been assured by people in the private SQL Server MVP group that FOR XML PATH will preserve the order while the other function might not</p>
<p>In case you want some more of this stuff we have over 80 hacks, tips and trick on our <a href="http://wiki.lessthandot.com/index.php/SQL_Server_Programming_Hacks_-_100%2B_List">SQL Server Programming Hacks</a> wiki page</p>
<p>*** <strong>Remember, if you have a SQL related question try our <a href="http://forum.lessthandot.com/viewforum.php?f=17">Microsoft SQL Server Programming</a> forum or our <a href="http://forum.lessthandot.com/viewforum.php?f=22">Microsoft SQL Server Admin</a> forum</strong><ins></ins></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/the-ten-most-asked-sql-server-questions-1/feed/</wfw:commentRss>
		<slash:comments>56</slash:comments>
		</item>
	</channel>
</rss>
