<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>import &#8211; LessthanDot</title>
	<atom:link href="/index.php/tag/import/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>A Technical Community for IT Professionals</description>
	<lastBuildDate>Sat, 09 Mar 2019 12:50:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.6.1</generator>
	<item>
		<title>BULK INSERT data where the row terminator is a linefeed in SQL Server</title>
		<link>/index.php/datamgmt/dbadmin/mssqlserveradmin/bulk-insert-data-where-the/</link>
		<comments>/index.php/datamgmt/dbadmin/mssqlserveradmin/bulk-insert-data-where-the/#comments</comments>
		<pubDate>Thu, 14 Feb 2013 13:38:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Business Intelligence]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[bcp]]></category>
		<category><![CDATA[bulk insert]]></category>
		<category><![CDATA[files]]></category>
		<category><![CDATA[import]]></category>
		<category><![CDATA[sql server 2005]]></category>
		<category><![CDATA[sql server 2008]]></category>
		<category><![CDATA[sql server 2012]]></category>

		<guid isPermaLink="false">/index.php/2013/02/bulk-insert-data-where-the/</guid>
		<description><![CDATA[I like to use BULK INSERT or bcp as much as possible, this is especially true if all I need to do is dump the file into a table. For more complex things I will go the SSIS route. Files are generated by all kinds of systems these days, these can be Windo&#8230;]]></description>
				<content:encoded><![CDATA[<p>I like to use BULK INSERT or bcp as much as possible, this is especially true if all I need to do is dump the file into a table. For more complex things I will go the SSIS route. Files are generated by all kinds of systems these days, these can be Windows, *nix, Mac, Amiga and other systems. </p>
<p>Make sure to use something other than notepad when dealing with these files and you want to look at them. Notepad++ or Editplus have more functionality and are many times faster than notepad. The nice thing about either of these is that you can see control characters.</p>
<p>See how you can see the linefeeds here? Can&#8217;t do that in notepad</p>
<div class="image_block"><a href="/wp-content/uploads/blogs/DataMgmt/Denis/LineFeedFile.PNG?mtime=1360855487"><img alt="" src="/wp-content/uploads/blogs/DataMgmt/Denis/LineFeedFile.PNG?mtime=1360855487" width="421" height="223" /></a></div>
<p>So let&#8217;s say you get a file where the row terminator is a linefeed, how would you specify that as a row terminator in BULK INSERT?</p>
<p>You can try newline</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">BULK</span> <span class="kw1">INSERT</span> SomeTable
&nbsp; &nbsp;<span class="kw1">FROM</span> <span class="st0">'D:JunkdrawImportMe.txt'</span>
&nbsp; &nbsp;<span class="kw1">WITH</span> <span class="br0">&#40;</span>FIELDTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'t'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FIRSTROW <span class="sy0">=</span><span class="nu0">2</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ROWTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'n'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">BULK INSERT SomeTable
   FROM 'D:JunkdrawImportMe.txt'
   WITH (FIELDTERMINATOR = 't',
         FIRSTROW =2,
         ROWTERMINATOR = 'n')</pre></div></div>

<p>Nope, that doesn&#8217;t work, you get 0 rows inserted</p>
<p>You can try carriage return</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">BULK</span> <span class="kw1">INSERT</span> SomeTable
&nbsp; &nbsp;<span class="kw1">FROM</span> <span class="st0">'D:JunkdrawImportMe.txt'</span>
&nbsp; &nbsp;<span class="kw1">WITH</span> <span class="br0">&#40;</span>FIELDTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'t'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FIRSTROW <span class="sy0">=</span><span class="nu0">2</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ROWTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'r'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">BULK INSERT SomeTable
   FROM 'D:JunkdrawImportMe.txt'
   WITH (FIELDTERMINATOR = 't',
         FIRSTROW =2,
         ROWTERMINATOR = 'r')</pre></div></div>

<p>Nope, that doesn&#8217;t work either, you get 0 rows inserted</p>
<p>What about l for linefeed?</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">BULK</span> <span class="kw1">INSERT</span> SomeTable
&nbsp; &nbsp;<span class="kw1">FROM</span> <span class="st0">'D:JunkdrawImportMe.txt'</span>
&nbsp; &nbsp;<span class="kw1">WITH</span> <span class="br0">&#40;</span>FIELDTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'t'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FIRSTROW <span class="sy0">=</span><span class="nu0">2</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ROWTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'l'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">BULK INSERT SomeTable
   FROM 'D:JunkdrawImportMe.txt'
   WITH (FIELDTERMINATOR = 't',
         FIRSTROW =2,
         ROWTERMINATOR = 'l')</pre></div></div>

<p>You get an error</p>
<p>Msg 4864, Level 16, State 1, Line 1<br />
Bulk load data conversion error (type mismatch or invalid character for the specified codepage) for row 2, column 1 (SomeDate).</p>
<p>What about if you try a CHAR(10) which is a linefeed</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">BULK</span> <span class="kw1">INSERT</span> SomeTable
&nbsp; &nbsp;<span class="kw1">FROM</span> <span class="st0">'D:JunkdrawImportMe.txt'</span>
&nbsp; &nbsp;<span class="kw1">WITH</span> <span class="br0">&#40;</span>FIELDTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="st0">'t'</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FIRSTROW <span class="sy0">=</span><span class="nu0">2</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ROWTERM<span class="sy0">IN</span>AT<span class="sy0">OR</span> <span class="sy0">=</span> <span class="kw1">CHAR</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span> <span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">BULK INSERT SomeTable
   FROM 'D:JunkdrawImportMe.txt'
   WITH (FIELDTERMINATOR = 't',
         FIRSTROW =2,
         ROWTERMINATOR = CHAR(10) )</pre></div></div>

<p>You get this error<br />
Msg 102, Level 15, State 1, Line 5<br />
Incorrect syntax near &#8216;CHAR&#8217;.</p>
<p>Mmm, what if you embed it from within Dynamic SQL</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @cmd <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">SET</span> @cmd <span class="sy0">=</span> <span class="st0">'BULK INSERT SomeTable</span>
<span class="st0">FROM '</span><span class="st0">'D:JunkdrawImportMe.txt'</span><span class="st0">'</span>
<span class="st0">WITH ( &nbsp; &nbsp; &nbsp;FIELDTERMINATOR = '</span><span class="st0">'t'</span><span class="st0">',</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FIRSTROW =2,</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ROWTERMINATOR = '</span><span class="st0">''</span><span class="sy0">+</span><span class="kw1">CHAR</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span><span class="sy0">+</span><span class="st0">''</span><span class="st0">')'</span>
<span class="kw1">EXEC</span><span class="br0">&#40;</span>@cmd<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @cmd varchar(1000)
SET @cmd = 'BULK INSERT SomeTable
FROM ''D:JunkdrawImportMe.txt''
WITH (      FIELDTERMINATOR = ''t'',
            FIRSTROW =2,
            ROWTERMINATOR = '''+CHAR(10)+''')'
EXEC(@cmd)</pre></div></div>

<p>Bingo, that works.  Keep this in mind next time you get a file with a linefeed and you are struggling importing that file</p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/dbadmin/mssqlserveradmin/bulk-insert-data-where-the/feed/</wfw:commentRss>
		<slash:comments>9</slash:comments>
		</item>
		<item>
		<title>How to import a bunch of XML files from a directory in T-SQL</title>
		<link>/index.php/datamgmt/datadesign/how-to-import-a-bunch-of-xml-files-from/</link>
		<comments>/index.php/datamgmt/datadesign/how-to-import-a-bunch-of-xml-files-from/#comments</comments>
		<pubDate>Tue, 28 Apr 2009 18:01:36 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[import]]></category>
		<category><![CDATA[sql server 2005]]></category>
		<category><![CDATA[sql server 2008]]></category>
		<category><![CDATA[xml]]></category>

		<guid isPermaLink="false">/index.php/2009/04/how-to-import-a-bunch-of-xml-files-from/</guid>
		<description><![CDATA[A couple of days ago onpnt posted the following blogpost: Import directory of XML files into SQL Server 2005 In that post he was using SQLCLR to import a bunch of files. Some of you might not be so familiar with .NET so I am providing a T-SQL way to do something similar You will [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>A couple of days ago onpnt posted the following blogpost: <a href="/index.php/DataMgmt/DataDesign/import-directory-of-xml-files-into-sql-s-2005">Import directory of XML files into SQL Server 2005</a><br />
In that post he was using SQLCLR to import a bunch of files. Some of you might not be so familiar with .NET so I am providing a T-SQL way to do something similar</p>
<p>You will need to create a directory testxml on the c drive and put a bunch of XML files in there. If you don&#8217;t have any XML files then save the following two as file1.xml and file2.xml</p>
<p>file1.xml</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="xml"><thead><tr><td colspan="2"  class="head">XML</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="de1"><pre class="de1"><span class="sc3"><span class="re1">&lt;MusicCollection<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Artist<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;ArtistName<span class="re2">&gt;</span></span></span>Pink Floyd<span class="sc3"><span class="re1">&lt;/ArtistName<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Wish You Were Here<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1975<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>The Wall<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1979<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Artist<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Artist<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;ArtistName<span class="re2">&gt;</span></span></span>Prince<span class="sc3"><span class="re1">&lt;/ArtistName<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Purple Rain<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1984<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Lotusflow3r<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>2009<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>1999<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1982<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Artist<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Artist<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;ArtistName<span class="re2">&gt;</span></span></span>Incubus<span class="sc3"><span class="re1">&lt;/ArtistName<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Morning View<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>2001<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Light Grenades<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>2006<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Artist<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/MusicCollection<span class="re2">&gt;</span></span></span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">&lt;MusicCollection&gt;
 &lt;Artist&gt;
  &lt;ArtistName&gt;Pink Floyd&lt;/ArtistName&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Wish You Were Here&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1975&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;The Wall&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1979&lt;/YearReleased&gt;
  &lt;/Album&gt;
  &lt;/Artist&gt;
 &lt;Artist&gt;
  &lt;ArtistName&gt;Prince&lt;/ArtistName&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Purple Rain&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1984&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Lotusflow3r&lt;/AlbumName&gt;
  &lt;YearReleased&gt;2009&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;1999&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1982&lt;/YearReleased&gt;
  &lt;/Album&gt;
  &lt;/Artist&gt;
 &lt;Artist&gt;
  &lt;ArtistName&gt;Incubus&lt;/ArtistName&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Morning View&lt;/AlbumName&gt;
  &lt;YearReleased&gt;2001&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Light Grenades&lt;/AlbumName&gt;
  &lt;YearReleased&gt;2006&lt;/YearReleased&gt;
  &lt;/Album&gt;
  &lt;/Artist&gt;
  &lt;/MusicCollection&gt;</pre></div></div>

<p>file2.xml</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="xml"><thead><tr><td colspan="2"  class="head">XML</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="de1"><pre class="de1"><span class="sc3"><span class="re1">&lt;MusicCollection<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Artist<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;ArtistName<span class="re2">&gt;</span></span></span>Pink Floyd<span class="sc3"><span class="re1">&lt;/ArtistName<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Wish You Were Here<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1975<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>The Wall<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1979<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Artist<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Artist<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;ArtistName<span class="re2">&gt;</span></span></span>Prince<span class="sc3"><span class="re1">&lt;/ArtistName<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Purple Rain<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1984<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>Lotusflow3r<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>2009<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp;<span class="sc3"><span class="re1">&lt;Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;AlbumName<span class="re2">&gt;</span></span></span>1999<span class="sc3"><span class="re1">&lt;/AlbumName<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;YearReleased<span class="re2">&gt;</span></span></span>1982<span class="sc3"><span class="re1">&lt;/YearReleased<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Album<span class="re2">&gt;</span></span></span>
&nbsp; <span class="sc3"><span class="re1">&lt;/Artist<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/MusicCollection<span class="re2">&gt;</span></span></span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">&lt;MusicCollection&gt;
 &lt;Artist&gt;
  &lt;ArtistName&gt;Pink Floyd&lt;/ArtistName&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Wish You Were Here&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1975&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;The Wall&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1979&lt;/YearReleased&gt;
  &lt;/Album&gt;
  &lt;/Artist&gt;
 &lt;Artist&gt;
  &lt;ArtistName&gt;Prince&lt;/ArtistName&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Purple Rain&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1984&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;Lotusflow3r&lt;/AlbumName&gt;
  &lt;YearReleased&gt;2009&lt;/YearReleased&gt;
  &lt;/Album&gt;
 &lt;Album&gt;
  &lt;AlbumName&gt;1999&lt;/AlbumName&gt;
  &lt;YearReleased&gt;1982&lt;/YearReleased&gt;
  &lt;/Album&gt;
  &lt;/Artist&gt;
&lt;/MusicCollection&gt;</pre></div></div>

<p>Now that we have our files we are ready to grab all the files in the directory. We will use a plain vanilla DOS dir command for this with the B switch so that we don&#8217;t get a lot of garbage returned. Here is what this block of code looks like</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="de1"><pre class="de1"><span class="kw1">IF</span> <span class="kw2">OBJECT_ID</span><span class="br0">&#40;</span><span class="st0">'tempdb..#tempList'</span><span class="br0">&#41;</span> <span class="kw1">IS</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>
<span class="kw1">DROP</span> <span class="kw1">TABLE</span> #tempList
&nbsp;
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #tempList <span class="br0">&#40;</span><span class="br0">&#91;</span>FileName<span class="br0">&#93;</span> <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">--plain vanilla dos dir command with /B switch (bare format)</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #tempList
<span class="kw1">EXEC</span> MASTER..<span class="me1">XP_CMDSHELL</span> <span class="st0">'dir c:testxml /B'</span>
&nbsp;
&nbsp;
<span class="co1">--delete the null values</span>
<span class="kw1">DELETE</span> #tempList <span class="kw1">WHERE</span> <span class="br0">&#91;</span>FileName<span class="br0">&#93;</span> <span class="kw1">IS</span> <span class="sy0">NULL</span>
&nbsp;
<span class="co1">-- Delete all the files that don't have xml extension</span>
<span class="kw1">DELETE</span> #tempList <span class="kw1">WHERE</span> <span class="br0">&#91;</span>FileName<span class="br0">&#93;</span> <span class="sy0">NOT</span> <span class="sy0">LIKE</span> <span class="st0">'%.xml'</span>
&nbsp;
<span class="co1">--this will be used to loop over the table</span>
<span class="kw1">alter</span> <span class="kw1">table</span> #tempList <span class="kw1">add</span> id <span class="kw1">int</span> <span class="kw1">identity</span>
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">IF OBJECT_ID('tempdb..#tempList') IS NOT NULL
DROP TABLE #tempList

CREATE TABLE #tempList ([FileName] VARCHAR(500))

--plain vanilla dos dir command with /B switch (bare format)
INSERT INTO #tempList
EXEC MASTER..XP_CMDSHELL 'dir c:testxml /B'


--delete the null values
DELETE #tempList WHERE [FileName] IS NULL

-- Delete all the files that don't have xml extension
DELETE #tempList WHERE [FileName] NOT LIKE '%.xml'

--this will be used to loop over the table
alter table #tempList add id int identity
go</pre></div></div>

<p>Now let&#8217;s see what has actually been inserted into the table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> #tempList</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from #tempList</pre></div></div>

<p>Output<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<pre>FileName	id
file1.xml	1
file2.xml	2</pre>
<p>The following table will be used to store the XML.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> <span class="br0">&#91;</span>dbo<span class="br0">&#93;</span>.<span class="br0">&#91;</span>XMLImport<span class="br0">&#93;</span><span class="br0">&#40;</span>
&nbsp; &nbsp; <span class="br0">&#91;</span>filename<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw1">VARCHAR</span><span class="br0">&#93;</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span> <span class="sy0">NULL</span>,
&nbsp; &nbsp; <span class="br0">&#91;</span>timecreated<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw1">DATETIME</span><span class="br0">&#93;</span> <span class="sy0">NULL</span>,
&nbsp; &nbsp; <span class="br0">&#91;</span>xmldata<span class="br0">&#93;</span> <span class="br0">&#91;</span>xml<span class="br0">&#93;</span> <span class="sy0">NULL</span>
<span class="br0">&#41;</span> <span class="kw1">ON</span> <span class="br0">&#91;</span><span class="kw1">PRIMARY</span><span class="br0">&#93;</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE [dbo].[XMLImport](
    [filename] [VARCHAR](500) NULL,
    [timecreated] [DATETIME] NULL,
    [xmldata] [xml] NULL
) ON [PRIMARY]
GO</pre></div></div>

<p>Here is where the import happens, since we have to use dynamic SQL to do the XML import it is better to use SP_EXECUTESQL instead of EXEC since SP_EXECUTESQL has output parameters.<br />
I have put comments in this codeblock but if you need more information how exactly this works then leave me a comment.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="de1"><pre class="de1"><span class="kw1">truncate</span> <span class="kw1">table</span> XMLImport <span class="co1">--in case you want to rerun just this codeblock</span>
<span class="kw1">declare</span> @Directory <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">50</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @Directory <span class="sy0">=</span> <span class="st0">'c:testxml'</span>
&nbsp;
<span class="kw1">declare</span> @FileExist <span class="kw1">int</span>
<span class="kw1">DECLARE</span> @FileName <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span>,@DeleteCommand <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>,@FullFileName <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">DECLARE</span> @<span class="kw1">SQL</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>,@xml xml
&nbsp;
<span class="co1">--This is so that we know how long the loop lasts</span>
<span class="kw1">declare</span> @LoopID <span class="kw1">int</span>, @MaxID <span class="kw1">int</span>
<span class="kw1">SELECT</span> @LoopID <span class="sy0">=</span> <span class="kw2">min</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span>,@MaxID <span class="sy0">=</span> <span class="kw2">max</span><span class="br0">&#40;</span>ID<span class="br0">&#41;</span>
<span class="kw1">FROM</span> #tempList
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">WHILE</span> @LoopID <span class="sy0">&lt;=</span> @MaxID
<span class="kw1">BEGIN</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">SELECT</span> @FileNAme <span class="sy0">=</span> filename
&nbsp; &nbsp; <span class="kw1">from</span> #tempList
&nbsp; &nbsp; <span class="kw1">where</span> id <span class="sy0">=</span> @LoopID
&nbsp;
&nbsp; &nbsp; <span class="kw1">SELECT</span> @FullFileName <span class="sy0">=</span> @Directory <span class="sy0">+</span> @FileName 
&nbsp; &nbsp; 
&nbsp; &nbsp; <span class="kw1">exec</span> xp_fileexist @FullFileName , @FileExist <span class="kw1">output</span>
&nbsp; &nbsp; <span class="kw1">if</span> @FileExist <span class="sy0">=</span><span class="nu0">1</span> <span class="co1">--sanity check in case some evil person removed the file</span>
&nbsp; &nbsp; <span class="kw1">begin</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> N<span class="st0">'select @xml = xml </span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; FROM OPENROWSET(BULK '</span><span class="st0">''</span> <span class="sy0">+</span> @FullFileName <span class="sy0">+</span><span class="st0">''</span><span class="st0">' ,Single_BLOB) as TEMP(xml)'</span>
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; <span class="co1">-- Just like in the bedroom, this is where the magic happens</span>
&nbsp; &nbsp; <span class="co1">-- We use the output functionality to fill the xml variable for later use</span>
&nbsp; &nbsp; <span class="kw1">EXEC</span> <span class="kw3">SP_EXECUTESQL</span> @<span class="kw1">SQL</span>, N<span class="st0">'@xml xml OUTPUT'</span>, @xml <span class="kw1">OUTPUT</span>
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; 
&nbsp; &nbsp; <span class="co1">--The actual insert happens here, as you can see we use the output value (@xml)</span>
&nbsp; &nbsp; <span class="kw1">INSERT</span> XMLImport <span class="br0">&#40;</span><span class="br0">&#91;</span>filename<span class="br0">&#93;</span>,timecreated,xmldata<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> @FileName,<span class="kw2">getdate</span><span class="br0">&#40;</span><span class="br0">&#41;</span>,@xml
&nbsp; &nbsp; 
&nbsp; &nbsp; <span class="kw1">SET</span> @DeleteCommand <span class="sy0">=</span> <span class="st0">'del '</span> <span class="sy0">+</span> &nbsp;@Directory <span class="sy0">+</span> @FileName 
&nbsp; &nbsp; <span class="co1">--maybe you want to delete or move the file to another directory</span>
&nbsp; &nbsp; <span class="co1">-- ** here is how to delete the files you just imported</span>
&nbsp; &nbsp; <span class="co1">-- uncomment line below to delete the file just inserted</span>
&nbsp; &nbsp; <span class="co1">--EXEC MASTER..XP_CMDSHELL @DeleteCommand</span>
&nbsp; &nbsp; <span class="co1">-- ** end of here is how to delete the files</span>
&nbsp; &nbsp; <span class="kw1">end</span>
&nbsp;
&nbsp; &nbsp; <span class="co1">--Get the next id, instead of +1 we grab the next value in case of skipped id values</span>
&nbsp; &nbsp; <span class="kw1">SELECT</span> @LoopID <span class="sy0">=</span> <span class="kw2">min</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> #tempList
&nbsp; &nbsp; <span class="kw1">where</span> id <span class="sy0">&gt;</span> @LoopID
<span class="kw1">END</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">truncate table XMLImport --in case you want to rerun just this codeblock
declare @Directory varchar(50)
select @Directory = 'c:testxml'

declare @FileExist int
DECLARE @FileName varchar(500),@DeleteCommand varchar(1000),@FullFileName varchar(500)

DECLARE @SQL NVARCHAR(1000),@xml xml

--This is so that we know how long the loop lasts
declare @LoopID int, @MaxID int
SELECT @LoopID = min(id),@MaxID = max(ID)
FROM #tempList



WHILE @LoopID &lt;= @MaxID
BEGIN

	SELECT @FileNAme = filename
	from #tempList
	where id = @LoopID

	SELECT @FullFileName = @Directory + @FileName 
	
	exec xp_fileexist @FullFileName , @FileExist output
	if @FileExist =1 --sanity check in case some evil person removed the file
	begin
	SELECT @SQL = N'select @xml = xml 
		FROM OPENROWSET(BULK ''' + @FullFileName +''' ,Single_BLOB) as TEMP(xml)'
	 
	-- Just like in the bedroom, this is where the magic happens
	-- We use the output functionality to fill the xml variable for later use
	EXEC SP_EXECUTESQL @SQL, N'@xml xml OUTPUT', @xml OUTPUT
	 
	
	--The actual insert happens here, as you can see we use the output value (@xml)
	INSERT XMLImport ([filename],timecreated,xmldata)
	SELECT @FileName,getdate(),@xml
	
	SET @DeleteCommand = 'del ' +  @Directory + @FileName 
	--maybe you want to delete or move the file to another directory
	-- ** here is how to delete the files you just imported
	-- uncomment line below to delete the file just inserted
	--EXEC MASTER..XP_CMDSHELL @DeleteCommand
	-- ** end of here is how to delete the files
	end

	--Get the next id, instead of +1 we grab the next value in case of skipped id values
	SELECT @LoopID = min(id)
	FROM #tempList
	where id &gt; @LoopID
END</pre></div></div>

<p>So that is all the code that you need to make this happen, let&#8217;s see what is actually inserted into the table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> XMLImport</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from XMLImport</pre></div></div>

<p>output<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<pre>filename	timecreated		xmldata
file1.xml	2009-04-29 09:18:42.313	&lt;MusicCollection&gt;&lt;Artist&gt;&lt;ArtistName&gt;Pink Floyd....
file2.xml	2009-04-29 09:18:42.330	&lt;MusicCollection&gt;&lt;Artist&gt;&lt;ArtistName&gt;Pink Floyd....</pre>
<p></p>
<h3>Attention/warning!!</h3>
<p>Here are a couple of warnings for you. </p>
<p><strong>xp_cmdshell</strong><br />
It is not a best practice to have xp_cmdshell enabled. As a matter of fact beginning with SQL Server 2005, the product ships with xp_cmdshell disabled. If you try to run xp_cmdshell you will get the following message if it is not enabled<br />
Server: Msg 15281, Level 16, State 1, Procedure xp_cmdshell, Line 1</p>
<p>SQL Server blocked access to procedure &#8216;sys.xp_cmdshell&#8217; of component &#8216;xp_cmdshell&#8217; because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of &#8216;xp_cmdshell&#8217; by using sp_configure. For more information about enabling &#8216;xp_cmdshell&#8217;, see &#8220;Surface Area Configuration&#8221; in SQL Server Books Online.</p>
<p>To enable xp_cmdshell execute the following code</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="de1"><pre class="de1"><span class="kw1">EXECUTE</span> <span class="kw3">SP_CONFIGURE</span> <span class="st0">'show advanced options'</span>, <span class="nu0">1</span>
<span class="kw1">RECONFIGURE</span> <span class="kw1">WITH</span> OVERRIDE
GO
&nbsp;
<span class="kw1">EXECUTE</span> <span class="kw3">SP_CONFIGURE</span> <span class="st0">'xp_cmdshell'</span>, <span class="st0">'1'</span>
<span class="kw1">RECONFIGURE</span> <span class="kw1">WITH</span> OVERRIDE
GO
&nbsp;
<span class="kw1">EXECUTE</span> <span class="kw3">SP_CONFIGURE</span> <span class="st0">'show advanced options'</span>, <span class="nu0">0</span>
<span class="kw1">RECONFIGURE</span> <span class="kw1">WITH</span> OVERRIDE
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">EXECUTE SP_CONFIGURE 'show advanced options', 1
RECONFIGURE WITH OVERRIDE
GO
 
EXECUTE SP_CONFIGURE 'xp_cmdshell', '1'
RECONFIGURE WITH OVERRIDE
GO
 
EXECUTE SP_CONFIGURE 'show advanced options', 0
RECONFIGURE WITH OVERRIDE
GO</pre></div></div>

<p><strong>OPENROWSET </strong><br />
In SQL Server 2005 and 2008 OPENROWSET is also disabled by default, if you try to run an OPENROWSET query then you will see the following message:</p>
<p>Server: Msg 15281, Level 16, State 1, Line 1<br />
SQL Server blocked access to STATEMENT &#8216;OpenRowset/OpenDatasource&#8217; of component &#8216;Ad Hoc Distributed Queries&#8217; because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of &#8216;Ad Hoc Distributed Queries&#8217; by using sp_configure. For more information about enabling &#8216;Ad Hoc Distributed Queries&#8217;, see &#8220;Surface Area Configuration&#8221; in SQL Server Books Online.</p>
<p>To enable OPENROWSET and OPENQUERY you can use the previous script but instead of &#8216;xp_cmdshell&#8217; you will use &#8216;Ad Hoc Distributed Queries&#8217;. The script to enable Ad Hoc Distributed Queries is below</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="de1"><pre class="de1"><span class="kw1">EXECUTE</span> <span class="kw3">SP_CONFIGURE</span> <span class="st0">'show advanced options'</span>, <span class="nu0">1</span>
<span class="kw1">RECONFIGURE</span> <span class="kw1">WITH</span> OVERRIDE
GO
&nbsp;
<span class="kw1">EXECUTE</span> <span class="kw3">SP_CONFIGURE</span> <span class="st0">'Ad Hoc Distributed Queries'</span>, <span class="st0">'1'</span>
<span class="kw1">RECONFIGURE</span> <span class="kw1">WITH</span> OVERRIDE
GO
&nbsp;
<span class="kw1">EXECUTE</span> <span class="kw3">SP_CONFIGURE</span> <span class="st0">'show advanced options'</span>, <span class="nu0">0</span>
<span class="kw1">RECONFIGURE</span> <span class="kw1">WITH</span> OVERRIDE
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">EXECUTE SP_CONFIGURE 'show advanced options', 1
RECONFIGURE WITH OVERRIDE
GO
 
EXECUTE SP_CONFIGURE 'Ad Hoc Distributed Queries', '1'
RECONFIGURE WITH OVERRIDE
GO
 
EXECUTE SP_CONFIGURE 'show advanced options', 0
RECONFIGURE WITH OVERRIDE
GO</pre></div></div>

<p><strong>xp_fileexist</strong><br />
The stored proc xp_fileexist is undocumented so be aware that it could change with a service pack or be removed all together</p>
<p></p>
<p>*** <strong>If you have a SQL related question try our <a href="http://forum.lessthandot.com/viewforum.php?f=17">Microsoft SQL Server Programming</a> forum or our <a href="http://forum.lessthandot.com/viewforum.php?f=22">Microsoft SQL Server Admin</a> forum</strong><ins></ins></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/how-to-import-a-bunch-of-xml-files-from/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		</item>
	</channel>
</rss>
