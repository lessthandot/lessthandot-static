<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>sybase &#8211; LessthanDot</title>
	<atom:link href="/index.php/tag/sybase/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>A Technical Community for IT Professionals</description>
	<lastBuildDate>Sat, 09 Mar 2019 12:50:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.6.1</generator>
	<item>
		<title>A week in Sybase Training, what did I learn, day 5</title>
		<link>/index.php/datamgmt/datadesign/a-week-in-sybase-training-4/</link>
		<comments>/index.php/datamgmt/datadesign/a-week-in-sybase-training-4/#respond</comments>
		<pubDate>Fri, 10 Jun 2011 14:39:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[ase]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sybase]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">/index.php/2011/06/a-week-in-sybase-training-4/</guid>
		<description><![CDATA[This is day 4 of my training and today it is going to focus on Backups, Advanced Backup Techniques, Sybase Central and Monitoring the System

Backups
Instead of backup and restore Sybase uses the commands dump and load, SQL Server people will be fami&#8230;]]></description>
				<content:encoded><![CDATA[<p>This is day 5 of my training and today it is going to focus on Backups, Advanced Backup Techniques, Sybase Central and Monitoring the System</p>
<h2>Backups</h2>
<p>Instead of backup and restore Sybase uses the commands dump and load, SQL Server people will be familiar with dump devices and the sp_addumpdevice stored procedure. In order to be able to perform backup, you first need to make sure that the Backup Server is running. You also need to add a dump, device, below is some sample syntax</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw3">sp_addumpdevice</span> <span class="st0">&quot;disk&quot;</span>, <span class="st0">&quot;db_dump_device&quot;</span>,
<span class="st0">&quot;/home/usr/u/someserver/sa/db_dump_device.dat&quot;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_addumpdevice "disk", "db_dump_device",
"/home/usr/u/someserver/sa/db_dump_device.dat"</pre></div></div>

<p><strong>Database backups</strong><br />
This is pretty much the same as SQL Server, it is a full database backup. Sybase does not have differential backups, Sybase has incremental backups and this is just a log backup. Sybase also has compression, you can go from level 0 to level 9, the higher the level, the smaller the file will be but the longer it will take and it will also use more CPU in that case.</p>
<p>Here is a sample dump statement</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">dump</span> <span class="kw1">database</span> pubs2
&nbsp; &nbsp; <span class="kw1">to</span> <span class="st0">&quot;/dev/db_dump_device&quot;</span>
&nbsp; &nbsp; <span class="kw1">with</span> init</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">dump database pubs2
    to "/dev/db_dump_device"
    with init</pre></div></div>

<p><strong>Log backups</strong><br />
Log backups are called incremental backups in Sybase, the command is dump tran, below are the 4 different variations</p>
<p><strong>dump tran</strong><br />
will backup and removes the inactive portion</p>
<p><strong>dump tran with truncate_only</strong><br />
removes the inactive part of the log without making a backup copy</p>
<p><strong>dump tran with no log</strong><br />
removes the inactive part of the log without making a backup copy and without recording the procedure in the transaction log. Use no_log only when you are completely out of log space and cannot run the usual dump transaction command. Use no_log as a last resort and use it only once after dump transaction with truncate_only fails</p>
<p><strong>dump tran with no_truncate</strong><br />
dumps a transaction log, even if the disk containing the data segments for a database is inaccessible, using a pointer to the transaction log in the master database. The with no_truncate option provides up-to-the-minute log recovery when the transaction log resides on an undamaged device, and the master database and user databases reside on different physical devices.</p>
<p>If you use dump tran with no_truncate you must follow it with dump database, not with another dump tran. If you load a dump generated using the no_truncate option, Adaptive Server prevents you from loading any subsequent dump.</p>
<p>Here is the complete syntax</p>
<pre>dump tran[saction] database_name  
	to [compress::[compression_level::]]stripe_device
		[at backup_server_name]
		[density = density_value, 
		blocksize = number_bytes,
		capacity = number_kilobytes, 
		dumpvolume = volume_name,
		file = file_name]
	[stripe on [compress::[compression_level::]]stripe_device
		[at backup_server_name]
		[density = density_value, 
		blocksize = number_bytes,
		capacity = number_kilobytes, 
		dumpvolume = volume_name,
		file = file_name]]
	[[stripe on [compress::[compression_level::]]stripe_device 
		[at backup_server_name]
		[density = density_value, 
		blocksize = number_bytes,
		capacity = number_kilobytes, 
		dumpvolume = volume_name,
		file = file_name] ]...]
	[with { 
		density = density_value, 
		blocksize = number_bytes,
		capacity = number_kilobytes, 
		compression = compress_level,
		dumpvolume = volume_name,
		file = file_name,
		[dismount | nodismount],
		[nounload | unload],
		retaindays = number_days,
		[noinit | init],
		notify = {client | operator_console}, 
		standby_access }]</pre>
<p><strong>Restores</strong><br />
Restores are named load in Sybase. Once you loaded a database it is in the offline state, you have to make it online<br />
The load syntax is the same as the dump syntax. Instead of <em>dump  </em>you use <em>load </em>and instead of <em>to </em>you use <em>from</em></p>
<p>Example</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">load</span> <span class="kw1">database</span> pubs2 
&nbsp; &nbsp; <span class="kw1">from</span> <span class="st0">&quot;/dev/db_dump_device&quot;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">load database pubs2 
    from "/dev/db_dump_device"</pre></div></div>

<h2>Advanced Backup Techniques</h2>
<p>This module went into some things you have to do if you want to do a point in time restore or if you lost the latest backup what you can do to backup to the most recent log backup.</p>
<h2>Sybase Central </h2>
<p>The other day I had some complaints about Sybase Central, I still think it sucks compared to SQL Server Management Studio but some of the things I complained about have been addresses<br />
When I said that I didn&#8217;t see results when running two commands, this is because by default Sybase Central only shows one result set. The icons are hideous, some of them have to be from NT4 or even windows 3.11<br />
You will like this one&#8230;there is no shortcut or toolbar options to uncomment or comment a block of text&#8230;.you have to go line by line or place /* before and */ after the text you want to comment. You can&#8217;t use multiple windows open in the same session, CTRL + N and it closes what you had open and you have a blank window, you have to open another instance of Interactive SQL to have multiple connections and sessions<br />
For the rest, you will think that you are back using Query Analyzer</p>
<h2>Monitoring the System</h2>
<p>This started with the error log, where errors are stored and severity levels of errors, also discussed was how to prune the error log.<br />
Next up was sp_who (what no sp_who2? Nope, doesn&#8217;t exist) and how to use KILL<br />
Discussed next was how to monitor lock contention by using the sp_oject_stats stored procedure.</p>
<p><strong>MDA Tables</strong><br />
These tables are similar to the sys.dm&#8230;&#8230; views in SQL Server. There are over 30 of these tables</p>
<p><strong>sp_sysmon</strong><br />
This is a monitoring stored procedure, sp_sysmon displays information about Adaptive Server performance. It sets internal counters to 0, then waits for the specified interval while activity on the server causes the counters to be incremented. When the interval ends, sp_sysmon prints information from the values in the counters. See the Performance and Tuning Guide for more information.</p>
<pre>Report section			Parameter
----------------------------	-------------
Application Management		appmgmt
Data Cache Management		dcache
Disk I/O Management		diskio
ESP Management			esp
Index Management		indexmgmt
Kernel Utilization		kernel
Lock Management			locks
Memory Management		memory
Metadata Cache Management	mdcache
Monitor Access to Executing SQL	monaccess
Network I/O Management		netio
Parallel Query Management	parallel
Procedure Cache Management	pcache
Recovery Management		recovery
Task Management			taskmgmt
Transaction Management		xactmgmt
Transaction Profile		xactsum
Worker Process Management	wpm</pre>
<p>Here is a memory sample</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1">sp_sysmon begin_sample
go
<span class="co1">-- do something or wait</span>
sp_sysmon end_sample, memory
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_sysmon begin_sample
go
-- do something or wait
sp_sysmon end_sample, memory
go</pre></div></div>

]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/a-week-in-sybase-training-4/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>A week in Sybase Training, what did I learn, day 4</title>
		<link>/index.php/datamgmt/datadesign/a-week-in-sybase-training-3/</link>
		<comments>/index.php/datamgmt/datadesign/a-week-in-sybase-training-3/#respond</comments>
		<pubDate>Thu, 09 Jun 2011 17:54:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[ase]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sybase]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">/index.php/2011/06/a-week-in-sybase-training-3/</guid>
		<description><![CDATA[This is day 4 of my training and today it is going to focus on Bulk Copy, Automatic Recovery, Checking and Fixing Database Consistency and Planning for Backups


Bulk Copy

Automatic Recovery


Checking and Fixing Database Consistency 


Plan&#8230;]]></description>
				<content:encoded><![CDATA[<p>This is day 4 of my training and today it is going to focus on Bulk Copy, Automatic Recovery, Checking and Fixing Database Consistency</p>
<p></p>
<h2>Bulk Copy</h2>
<p><strong>Getting the DDL</strong><br />
The lesson started with showing how you can get the DDL for an object, you can use Sybase Central to do this or you can use the ddlgen Utility. Sybase Central is similar to SSMS, you right click on the object and select the Generate DDL option. The ddlgen utility is a Java based command line tool</p>
<p>Syntax looks like this</p>
<pre>ddlgen 
	-Ulogin
	-Ppassword
	-S[server | host_name : port_number]
	[-I interfaces_file]
	[-Tobject_type]
	[-Nobject_name]
	[-Ddbname]
	[-Xextended_object_type]
	[-Ooutput_file]
	[-Eerror_file]
	[-Lprogress_log_file]
	[-Jclient_charset]
	-F[ % | SGM | GRP | USR | R | D | UDD | U | V | 
		P | XP | I | RI | KC | TR | PC ]</pre>
<p>Here is what object_type (switch T) can be</p>
<pre>Object type	Description
------------	------------------
C		cache
D		default
DB		database
DBD		database device
DPD		dump device
EC		execution class
EG		engine group
EK		encrypted keys
GRP		group
I		index
KC		key constraints
L		login
LK		logical key
P		stored procedure
R		rule
RI		referential integrity
RO		role
RS		remote server
SGM		segment
TR		trigger
U		table
UDD		user-defined datatype
USR		user
V		view
WS		user-defined Web service
WSC		Web service consumer
XP		extended stored procedure</pre>
<p>Here are two examples. Both of these generate DDL for the primary and unique keys of all the tables in a database that begin with “PK”:</p>
<p><em>ddlgen -Ulogin -Ppassword -TKC -Ndbname.%.%.PK%</em></p>
<p>Or:</p>
<p><em>ddlgen -Ulogin -Ppassword -TKC -N%.%.PK% -Ddbname</em></p>
<p><strong>BCP</strong><br />
This should look familiar if you have used bcp on SQL Server. Bcp has two speeds in Sybase.<br />
Fast bcp, better performance but no recovery, used when a table doesn&#8217;t have indexes or triggers (or triggers have been disabled), you also have to have the minimally-logged operations enabled on the database<br />
Slow bcp, slower performance but has better recovery, used when a table has at least one indexes or trigger<br />
You can use bcp to copy data into partitioned tables by executing in parallel with different files in different sessions</p>
<p>You need these options turned on</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> <span class="kw3">sp_dboption</span> MyDb, <span class="st0">&quot;select into/bulkcopy/pllsort&quot;</span>, <span class="kw1">true</span>
<span class="kw1">exec</span> <span class="kw3">sp_dboption</span> MyDb, <span class="st0">&quot;trunc log on chkpt&quot;</span>, <span class="kw1">true</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec sp_dboption MyDb, "select into/bulkcopy/pllsort", true
exec sp_dboption MyDb, "trunc log on chkpt", true</pre></div></div>

<p>
The bcp syntax is more or less the same as in SQL Server so I won&#8217;t go into any detail here.<br />
One thing that bcp does not have in Sybase is the <em>queryout</em>, you can however create a view and do it that way</p>
<p>
<h2>Automatic Recovery</h2>
<p>This was mostly about the log, dirty pages, when checkpoints occur, talking about the &#8220;trunc log on chkpt&#8221; option. Discussed was what happens when recovery kicks in, what happens to committed and uncommitted transaction, how to make recovery less long. Sybase doesn&#8217;t have the concept of fast recovery, the database is not available until all the transactions have been rolled forward or rolled back.  There is a way to specify which databases you want recovered first after the system databases have been recovered, you do this with the sp_dbrecovery_order proc</p>
<p><strong>sp_dbrecovery_order</strong></p>
<p>Specifies the order in which user databases are recovered and lists the user-defined recovery order of a database or all databases.</p>
<pre>sp_dbrecovery_order [database_name [, rec_order 
	[, force [ relax | strict ]]]] </pre>
<p>Also discussed were full and incremental backups.</p>
<p>
<h2>Checking and Fixing Database Consistency </h2>
<p>Sybase just like SQL Server has the dbcc (database consistency checker) command<br />
Here are some of them and what they call under the hood</p>
<p>dbcc checkdb, this calls the following dbcc command for every table<br />
&#8230;dbcc checktable</p>
<p>dbcc checkalloc, this one will call these 3<br />
&#8230;.dbcc tablealloc<br />
&#8230;.dbcc indexalloc<br />
&#8230;.dbcc textalloc</p>
<p>dbcc checkcatalog, this one checks the catalogs</p>
<p>dbcc checkstorage<br />
dbcc checkstorage stores the output in a database named dbccdb, you have to create the dbccdb database yourself and then run the installdbccdb script that will create the objects you need. After dbccdb  is created you need to configure parallelism, configure data cache + large I/O(sp_cacheconfig and sp_poolconfig), you need to create workspaces, you need to run the stored procedure sp_dbbc_updateconfig to set some attributes and finally you need to run sp_dbcc_evaluatedb to make sure it is all configured correctly.</p>
<p>Here is a list of most of them</p>
<p>tablealloc<br />
checks allocation information for the specified table.</p>
<p>textalloc<br />
checks allocation information in text pages for the specified table.</p>
<p>indexalloc<br />
checks allocation information for the specified index.</p>
<p>checkalloc<br />
runs the same checks as tablealloc, for all pages in a database.</p>
<p>checkcatalog<br />
checks for consistency in and between system tables. For example, checkcatalog makes sure that every type in syscolumns has a matching entry in systypes, that every table and view in sysobjects has at least one column in syscolumns, and that the last checkpoint in syslogs is valid. checkcatalog also reports on any segments that have been defined. If no database name is given, checkcatalog checks the current database.</p>
<p>checktable<br />
checks the integrity of data and index pages in the specified table.</p>
<p>checkdb<br />
runs the same checks as checktable, for all tables in a database.</p>
<p>checkstorage<br />
combines some of the checks of the above commands, and provides additional checks.</p>
<p>reindex<br />
checks the integrity of indexes on user tables. prints a message when it finds the first index error and then drops/recreates the index.</p>
<p>Just so you know Sybase also has undocumented dbcc command, just like SQL Server<br />
Here is a list of some of those<br />
dbcc page<br />
dbcc pglinkage<br />
dbcc log<br />
dbcc traceflags<br />
dbcc traceon<br />
dbcc traceoff<br />
dbcc memusage</p>
<p>You can give dbcc permissions to a user (but why would you..as an admin, you should be running this)</p>
<p><em>grant dbcc to user</em><br />
and<br />
<em>revoke dbcc from user</em></p>
<p>Finally if a database is completely FUBARed then you can use <em>dbcc dbrepair</em> to drop it, you can drop a suspect database with a regular <em>DROP database</em> command</p>
<p></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/a-week-in-sybase-training-3/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>A week in Sybase Training, what did I learn, day 3</title>
		<link>/index.php/datamgmt/datadesign/a-week-in-sybase-training-2/</link>
		<comments>/index.php/datamgmt/datadesign/a-week-in-sybase-training-2/#comments</comments>
		<pubDate>Wed, 08 Jun 2011 18:00:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[ase]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sybase]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">/index.php/2011/06/a-week-in-sybase-training-2/</guid>
		<description><![CDATA[This is day 3 of my training. It will be a scorching 100 degrees in NYC today so I will not walk around at all today.

Auto Expand

tempdb]]></description>
				<content:encoded><![CDATA[<p>This is day 3 of my training. It will be a scorching 100 degrees in NYC today so I will not each lunch in Bryant Park today.</p>
<h4>Auto Expand</h4>
<p>This is what is knows as autogrow in SQL Server. by default Sybase does not have this turned on, as a matter of fact, you have to run a script that is shipped with the product in order to create the stored procedures that will make it possible for you to use this feature. It seems that within the Sybase crowd, if it is a old school DBA then they don&#8217;t like feature, if it is a new DBA they love it because they have to do less.</p>
<p>There is a proc that is named sp_dbextend that you can use to manage all this stuff</p>
<p>Here is an example that  defines the rate of growth as 5% of current value, in each expansion attempt for the database pubs2</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_dbextend <span class="st0">'modify'</span>, <span class="st0">'database'</span>, pubs2, logsegment, <span class="st0">'growby'</span>, <span class="st0">'5%'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_dbextend 'modify', 'database', pubs2, logsegment, 'growby', '5%'</pre></div></div>

<p>You can use the sp_dbextend  stored procedure to manage devices, databases and thresholds.</p>
<p>I won&#8217;t go into more detail here, you can look that up in Sybase documentation if you are interested.</p>
<h4>tempdb</h4>
<p>I learned some interesting things in regards to tempdb. In Sybase you can have user created temporary databases. You can then either bind a login to a specific tempdb or you can create a group and then each connection will connect to a tempdb within that group in a round robin fashion. You can create 511 temporary databases per server.</p>
<p>Here is how you create a temporary database</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">create</span> <span class="kw1">temporary</span> <span class="kw1">database</span> tempdb_01 <span class="kw1">on</span> some_tempdb_device <span class="sy0">=</span> <span class="nu0">10</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">create temporary database tempdb_01 on some_tempdb_device = 10</pre></div></div>

<p>Then to add that database to the default group, you would do this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_tempdb <span class="st0">'add'</span>, tempdb_01, <span class="st0">'default'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_tempdb 'add', tempdb_01, 'default'</pre></div></div>

<p>Now when you connect and there are 15 temporary databases and for some reason you would like to know which one your session will use, you can use @@tempdbid, below is an example</p>
<pre>select db_name(@@tempdbid)</pre>
<p>You can also make sure that login Menace will always use the tempdb_01 temporary database by binding that login to that database</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_tempdb bind, <span class="st0">'LG'</span>, <span class="st0">'Menace'</span>, <span class="st0">'DB'</span>, <span class="st0">'tempdb_01'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_tempdb bind, 'LG', 'Menace', 'DB', 'tempdb_01'</pre></div></div>

<p>If you want to check what tempdb a certain process id has assigned, you can use the tempdb_id() function, you would pass in the SPID</p>
<p>All in all interesting stuff&#8230;..however if the original tempdb is down, you are still out of luck<br />
In the SQL Server world people have been asking for 1 tempdb per database for a while to get around the tempdb contention issues</p>
<h4>Security</h4>
<p>There are several roles in Sybase just like in SQL Server. Here are some of them</p>
<p>sa_role (System Administrator)<br />
sso_role (System Security Officer)<br />
oper_role (Server Operator (OPER))<br />
sybase_ts_role<br />
navigator_role</p>
<p>By default the sa account has sa_role, sso_role, oper_role and sybase_ts_role</p>
<p>There are in total 14 roles, you can find all of them in the syssrvroles table</p>
<p>You can enable or disable roles by using the set role RoleName [on | off]</p>
<p>To check if you have a role or not, you can use the proc_role function, here is an example</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> proc_role<span class="br0">&#40;</span><span class="st0">'sa_role'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select proc_role('sa_role')</pre></div></div>

<p>That will return 1 if you have that role or 0 if you do not</p>
<p>To see all the roles for a login you can use the sp_displaylogin stored procedure.</p>
<p>Here is an example</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_displaylogin <span class="st0">'sa'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_displaylogin 'sa'</pre></div></div>

<p>You can grant a role or roles to someone by using the grant role command. Here is an example</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">grant</span> <span class="kw1">role</span> sso_role, sa_role, oper_role <span class="kw1">to</span> SQLMenace</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">grant role sso_role, sa_role, oper_role to SQLMenace</pre></div></div>

<p>To take away the sso_role, you would use revoke</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">revoke</span> <span class="kw1">role</span> sso_role <span class="kw1">from</span> SQLMenace</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">revoke role sso_role from SQLMenace</pre></div></div>

<p>Here are some procs to manage logins, if you are a SQL Server person, some of these will look familiar to you.</p>
<p>sp_addlogin<br />
sp_droplogin<br />
sp_displaylogin<br />
sp_locklogin<br />
sp_modifylogin<br />
sp_password</p>
<p>You can require setup experation, set a minimum password length, set maximum failed logins before a login gets locked out and requiring digits in password.</p>
<h4>Database access, users and object permissions</h4>
<p>This is very similar to SQL Server, it even has that proc we all know sp_helprotect<br />
One interesting thins is that if I create Table A with a PK and you create table B with a FK to my table, then I have to give you references permissions on my table or specific columns</p>
<p>Everything else is similar to SQL Server, there is object chaining, there are roles. What does not exists in Sybase(and this has nothing to do with security but we discussed bit) is deferred name resolution&#8230;.the way they do it is creating a dummy table and then dropping it after the proc has been created.</p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/a-week-in-sybase-training-2/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>A week in Sybase Training, what did I learn, day 2</title>
		<link>/index.php/datamgmt/datadesign/a-week-in-sybase-training-1/</link>
		<comments>/index.php/datamgmt/datadesign/a-week-in-sybase-training-1/#respond</comments>
		<pubDate>Tue, 07 Jun 2011 18:13:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[ase]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sybase]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">/index.php/2011/06/a-week-in-sybase-training-1/</guid>
		<description><![CDATA[This is day 2 of my Sybase training.

I forgot to mention yesterday, half of the people are in this class because the Sybase DBA quit and never say the O word (O like in Oracle)]]></description>
				<content:encoded><![CDATA[<p>This is day 2 of my Sybase training.</p>
<p>I forgot to mention <a href="/index.php/DataMgmt/DBAdmin/a-week-in-sybase-training">yesterday</a>, half of the people are in this class because the Sybase DBA quit, another thing that was said yesterday was to never say the O word (O like in Oracle).</p>
<p>Today we continued with configurations. Sybase has something called a data cache, you can have more than 1 cache. to increase the default data cache to 100MB you would issue the following command</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_cacheconfig <span class="st0">'default data cache'</span>, <span class="st0">'100M'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_cacheconfig 'default data cache', '100M'</pre></div></div>

<p>to create a new cache name SQLMenace with 10MB, your command would look like this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_cacheconfig SQLMenace, <span class="st0">'10M'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_cacheconfig SQLMenace, '10M'</pre></div></div>

<p>To drop the cache that is named SQLMenace your command would look like this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_cacheconfig SQLMenace, <span class="st0">'0'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_cacheconfig SQLMenace, '0'</pre></div></div>

<p>All in all it seems you have to configure a lot more in Sybase compared to SQL Server. It looks like if you have configured to have 200 connection or 10000 open indexes that you have to monitor this, then you have to adjust this if you see that you have configured too much or if user complain that they can&#8217;t connect you need to configure for more connections</p>
<h4>Tools</h4>
<p>I will never ever complain about SSMS again. Interactive SQL in Sybase Central brings all the pains (without the joys) of Query Analyzer back to the present day. I can&#8217;t even find a shortcut to quickly comment or uncomment a selection. If you want to run a selection you have to press F9, F5 will run the first statement on a page only. But F9 is not any better it will only run the first line in a selection, if you put a GO in between it only runs the second command&#8230;..I can see the making of big mistakes if you are not aware of this behavior.</p>
<h4>Devices</h4>
<p>Devices in Sybase are similar to what files are in SQL Server. There is one interesting thing that happens upon install, remember I told you yesterday that Sybase places the master database on the master device, guess what, the master device is the default device. After installation you should make this device not default. You can make a device default or not by executing the following command</p>
<p>sp_diskdefault DeviceName, defaultoff|defaulton</p>
<p>so to make master not default, you would do</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_diskdefault master, defaultoff</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_diskdefault master, defaultoff</pre></div></div>

<p>You can have many devices just like you can have many files in SQL Server. <del>I have so far not seen a way that you can group these like we have filegroups in SQL Server</del> I was wrong I think, I guess these are segments</p>
<p>Here is how you create a new device</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">disk</span> init 
name <span class="sy0">=</span> <span class="st0">&quot;my_device&quot;</span>, 
physname <span class="sy0">=</span> <span class="st0">&quot;/usr/u/sybase/data/my_device.dat&quot;</span>, 
vdevno <span class="sy0">=</span> <span class="nu0">2</span>, <span class="kw1">size</span> <span class="sy0">=</span> <span class="nu0">5120</span>, dsync <span class="sy0">=</span> <span class="kw1">true</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">disk init 
name = "my_device", 
physname = "/usr/u/sybase/data/my_device.dat", 
vdevno = 2, size = 5120, dsync = true</pre></div></div>

<p>A couple of things&#8230;<br />
<strong>name </strong>is the name<br />
<strong>vdevno </strong>is the unique filenumber, you can create one  between 1 and 2,147,483,647 or you can have the system assign one<br />
<strong>physname</strong>(yes that was a typo) is the physical location of the file<br />
<strong>size </strong> is the size<br />
<strong>dsync </strong>specifies whether writes to the database device take place directly to the storage media, or are buffered when using operating system files. This option is meaningful only when you are initializing an operating system file; it has no effect when initializing devices on a raw partition. By default, all operating system files are initialized with dsync set to true.</p>
<p>On Unix/Linux you can have files on raw partitions or on the filesystem</p>
<p>When you drop a device by using sp_dropdevice, you also have to remove it from the filesystem, it does not do this for you.</p>
<p><strong>Databases</strong><br />
Sybase needs a lot more hand holding compared to SQL Server when creating databases. It is very important to save the scripts that you used to create the databases. If on one server you have 2 data files and 1 log 1 and on the other server you create the same but the order is not the same&#8230;you have a lot of problems (also know as job security I guess, you need to document everything, you can also grab this info from the sysusages table and them do some math to get to the same sizes)</p>
<p>Sybase has something called segments&#8230;.I guess it is similar to a filegroup.<br />
Here is what the documentation says</p>
<blockquote><p>A segment is a label that points to one or more database devices. Segment names are used in create table and create index commands to place tables or indexes on specific database devices. Using segments can improve Adaptive Server performance and give the System Administrator or Database Owner increased control over the placement, size, and space usage of database objects.</p></blockquote>
<p>By default in Sybase tables will be created with not null as default, you can override this with the <em>allow nulls by default</em> option, you can use sp_dboption for this.<br />
There is also an option to create an identity column on every table by default. You can create automatic IDENTITY columns by using the auto identity database option and the size of auto identity configuration parameter</p>
<p>Here is what it looks like</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw3">sp_dboption</span> database_name, <span class="st0">&quot;auto identity&quot;</span>, <span class="st0">&quot;true&quot;</span> </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_dboption database_name, "auto identity", "true" </pre></div></div>

<p>You need to then run a checkpoint so that the in-memory structure <em>dbtable </em>gets refreshed</p>
<p><strong>Thresholds</strong><br />
This is pretty cool, in Sybase you can use the proc sp_addthreshold to fire another proc when free space falls below a certain threshold</p>
<p><strong>sp_addthreshold</strong><br />
Creates a threshold to monitor space on a database segment. When free space on the segment falls below the specified level, Adaptive Server executes the associated stored procedure.</p>
<p>Example</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1">sp_addthreshold mydb, segment1, <span class="nu0">200</span>, pr_threshold_warning</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_addthreshold mydb, segment1, 200, pr_threshold_warning</pre></div></div>

<p>Creates a threshold for segment1. When the free space on segment1 drops below 200 pages, Adaptive Server executes the procedure pr_threshold_warning</p>
<p>You can also use sp_helpthreshold for information about existing thresholds.</p>
<p>Another use of thresholds is in a database to expand the database when you hit the threshold (similar to autogrow in SQL Server)</p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/a-week-in-sybase-training-1/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>A week in Sybase Training, what did I learn, day 1</title>
		<link>/index.php/datamgmt/datadesign/a-week-in-sybase-training/</link>
		<comments>/index.php/datamgmt/datadesign/a-week-in-sybase-training/#respond</comments>
		<pubDate>Mon, 06 Jun 2011 18:12:00 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[ase]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sybase]]></category>
		<category><![CDATA[training]]></category>

		<guid isPermaLink="false">/index.php/2011/06/a-week-in-sybase-training/</guid>
		<description><![CDATA[This whole week I am in Sybase training in NYC. I will write down short posts of mostly differences between Sybase and SQL Server each day and also what I have learned.

First here is the awesome view from the Sybase office in the Grace building in Ne&#8230;]]></description>
				<content:encoded><![CDATA[<p>This whole week I am in Sybase training in NYC. I will write down short posts of mostly differences between Sybase and SQL Server each day and also what I have learned.</p>
<p>First here is the awesome view from the Sybase office in the Grace building in New York City on the 32 floor</p>
<p><a href="http://www.flickr.com/photos/denisgobo/5804523937/" title="Empire State Building View from the 32nd floor by Denis Gobo, on Flickr"><img src="http://farm4.static.flickr.com/3521/5804523937_c7f7c53eab.jpg" width="375" height="500" alt="Empire State Building View from the 32nd floor" /></a></p>
<p>Here are the materials for this week of training.</p>
<p><a href="http://www.flickr.com/photos/denisgobo/5804584563/" title="Sybase Training Materials by Denis Gobo, on Flickr"><img src="http://farm4.static.flickr.com/3590/5804584563_9acb76a291.jpg" width="500" height="375" alt="Sybase Training Materials" /></a><br />
<br />That is a lot of stuff, by the end of the day I am sure my brain will be mush <img src="https://s.w.org/images/core/emoji/2/72x72/1f641.png" alt="🙁" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p>One of the biggest differences between SQL Server and Sybase is of course that Sybase runs on Linus, Unix, Mac and Windows, SQL Server only runs on Windows.</p>
<h4>System databases</h4>
<p>SQL Server has the following system databases<br />
master<br />
model<br />
tempdb<br />
msdb<br />
resource(a hidden db,files are mssqlsystemresource.mdf and mssqlsystemresource.ldf))</p>
<p>Sybase has the following system databases<br />
master<br />
model<br />
tempdb<br />
sybsystemdb(stores information about distributed transactions)<br />
sybsystemprocs(Sybase system procedures are stored in the database sybsystemproc)</p>
<p>Certain system databases go on certain database devices, depending on the version these devices change, these devices are sysprocsdev, systemdbdev , master and tempdev</p>
<h4>Installation</h4>
<p>Interestingly enough, Sybase still installs with the sa account with a blank password. After the installation is done you need to change the password(Yeah you better or something like SQL Slammer for Sybase might bite you later on)<br />
I learned about the various files and directories that are needed for a Sybase installation.<br />
When installing Sybase, you install the following things with a typical install<br />
Adaptive Server (this is the data engine)<br />
Backup Server<br />
Monitor Server<br />
XP Server</p>
<p>A custom install would also give you the option of installing the Job Scheduler, the Job Scheduler is probably something like SQL Agent. The instructor said it is heavy weight, it uses a lot of process power.</p>
<p><strong>Interface file</strong><br />
Sybase uses something called an interface file, this file lists the server and port of every known server<br />
The file looks like this</p>
<pre>ServerName
        master  tcp ether ServerName 5001
        query  tcp ether ServerName 5001</pre>
<p>The interface file lives in the $SYBASE directory</p>
<p><strong>Page Size</strong><br />
SQL Server only has 8K files, Sybase has 2K, 4K, 8K, 16k files.<br />
This sounds great, however the page size is per server and if on one server the page size is 2K and the other server has 4K then you can&#8217;t backup and restore the database on the other server, you need to script out the DB and then bcp all the data over, there was also another way mentioned by manipulating files.</p>
<p>Sybase also has no mixed extents, an 8K master database will be 4 times bigger than a 2K master database.</p>
<h4>Memory</h4>
<p><strong>ASE.exe<br />
Server + Kernel</strong><br />
This is something like number of open databases,open objects, open indexes, open partitions, number of locks<br />
<strong>proc cache<br />
data cache</strong></p>
<p>This is done with the sp_config stored procedure, all these configurations are written in the ServerName.cfg file (in theory you can change it right there but if you add a bad value you might mess up your server and it won&#8217;t start). </p>
<p>The sp_monitorconfig will show you the usage statistics. The procedure sp_monitorconfig displays cache usage statistics regarding metadata descriptors for indexes, objects, and databases. sp_monitorconfig also reports statistics on auxiliary scan descriptors used for referential integrity queries, and usage statistics for transaction descriptors and DTX participants.</p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/a-week-in-sybase-training/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Having Fun With OPENQUERY And Update,Delete And Insert Statements</title>
		<link>/index.php/datamgmt/datadesign/having-fun-with-openquery-and-update-del/</link>
		<comments>/index.php/datamgmt/datadesign/having-fun-with-openquery-and-update-del/#comments</comments>
		<pubDate>Wed, 17 Jun 2009 16:33:48 +0000</pubDate>
		<dc:creator><![CDATA[SQLDenis]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[how to]]></category>
		<category><![CDATA[linked server]]></category>
		<category><![CDATA[openquery]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sybase]]></category>

		<guid isPermaLink="false">/index.php/2009/06/having-fun-with-openquery-and-update-del/</guid>
		<description><![CDATA[Recently I had to do some data manipulation against a Sybase linked server running on a Unix box. When you have a linked server you can use OPENQUERY do perform DML statements like delete, update and inserts but the syntax is a little different So let&#8217;s look at some code, first create a linked server [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>Recently I had to do some data manipulation against a Sybase linked server running on a Unix box. When you have a linked server you can use OPENQUERY do perform DML statements like delete, update and inserts but the syntax is a little different</p>
<p>So let&#8217;s look at some code, first create a linked server on your machine that is linked to your machine. You can add a linked server through the wizard or through the sp_addlinkedserver stored proc</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">EXEC</span> master.<span class="me1">dbo</span>.<span class="kw3">sp_addlinkedserver</span> @server <span class="sy0">=</span> N<span class="st0">'localhost'</span>, @srvproduct<span class="sy0">=</span>N<span class="st0">'SQL Server'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">EXEC master.dbo.sp_addlinkedserver @server = N'localhost', @srvproduct=N'SQL Server'</pre></div></div>

<p>Test that the linked server was created and that you can execute queries against it</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> <span class="kw1">openquery</span><span class="br0">&#40;</span>localhost,<span class="st0">'select * from sysobjects'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from openquery(localhost,'select * from sysobjects')</pre></div></div>

<p>Now that this is done we need to create a table and insert one row of data</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="kw1">use</span> tempdb
go
&nbsp;
&nbsp;
<span class="kw1">create</span> <span class="kw1">table</span> test<span class="br0">&#40;</span>id <span class="kw1">int</span> <span class="kw1">primary</span> <span class="kw1">key</span>, col1 <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
go
&nbsp;
<span class="kw1">insert</span> test <span class="kw1">values</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="st0">'test1'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">use tempdb
go


create table test(id int primary key, col1 varchar(20))
go

insert test values(1,'test1')</pre></div></div>

<p>Select from the table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> test</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from test</pre></div></div>

<p>Output<br />
&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<pre>id	col1
1	test1</pre>
<p><strong>SELECT</strong><br />
A select statement with openquery looks like this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> <span class="kw1">openquery</span><span class="br0">&#40;</span>localhost,<span class="st0">'select * from tempdb.dbo.test'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from openquery(localhost,'select * from tempdb.dbo.test')</pre></div></div>

<p>As you can see that was pretty standard</p>
<p><strong>INSERT</strong><br />
an insert statement is a little odd looking because you still have the select in the openquery but the values that you want to insert look like a select statement that come after the openquery. It looks like this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> &nbsp;<span class="kw1">OPENQUERY</span><span class="br0">&#40;</span>localhost,<span class="st0">'SELECT id,col1 from tempdb.dbo.test '</span><span class="br0">&#41;</span>
<span class="kw1">SELECT</span> <span class="nu0">2</span>,<span class="st0">'Test2'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT  OPENQUERY(localhost,'SELECT id,col1 from tempdb.dbo.test ')
SELECT 2,'Test2'</pre></div></div>

<p>Verify that the data is correct</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> test</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from test</pre></div></div>

<p>Output<br />
&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<pre>id	col1
1	test1
2	Test2</pre>
<p><strong>UPDATE</strong><br />
The update has a select with a where clause inside the openquery statement and the set statement comes after that. Here is what this looks like</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">UPDATE</span> <span class="kw1">OPENQUERY</span><span class="br0">&#40;</span>localhost, <span class="st0">'select id,col1 from tempdb.dbo.test where id = 1 '</span><span class="br0">&#41;</span>
<span class="kw1">SET</span> id <span class="sy0">=</span> <span class="nu0">3</span>,col1 <span class="sy0">=</span> <span class="st0">'Test3'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">UPDATE OPENQUERY(localhost, 'select id,col1 from tempdb.dbo.test where id = 1 ')
SET id = 3,col1 = 'Test3'</pre></div></div>

<p>Verify that the data is correct</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> test</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from test</pre></div></div>

<p>Output<br />
&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<pre>id	col1
2	Test2
3	Test3</pre>
<p><strong>DELETE</strong><br />
Finally a delete will have the where clause inside openquery </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DELETE</span> <span class="kw1">OPENQUERY</span><span class="br0">&#40;</span>localhost, <span class="st0">'select id,col1 from tempdb.dbo.test where id = 2 '</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DELETE OPENQUERY(localhost, 'select id,col1 from tempdb.dbo.test where id = 2 ')</pre></div></div>

<p>Verify that the data is correct</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> test</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from test</pre></div></div>

<p>Output<br />
&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<pre>id	col1
3	Test3</pre>
<p><strong>When it doesn&#8217;t work</strong></p>
<p>I showed you what worked, now let&#8217;s look at some stuff that doesn&#8217;t<br />
Create another table that looks like the table we had before but without a primary key</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">create</span> <span class="kw1">table</span> test2<span class="br0">&#40;</span>id <span class="kw1">int</span>, col1 <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
go
&nbsp;
<span class="kw1">insert</span> test2 <span class="kw1">values</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="st0">'test1'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">create table test2(id int, col1 varchar(20))
go

insert test2 values(1,'test1')</pre></div></div>

<p>The select statement works without a problem</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> <span class="kw1">openquery</span><span class="br0">&#40;</span>localhost,<span class="st0">'select * from tempdb.dbo.test2'</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from openquery(localhost,'select * from tempdb.dbo.test2')</pre></div></div>

<p>Output<br />
&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<pre>id	col1
1	test1</pre>
<p>The insert statement also works</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> &nbsp;<span class="kw1">OPENQUERY</span><span class="br0">&#40;</span>localhost,<span class="st0">'SELECT id,col1 from tempdb.dbo.test2 '</span><span class="br0">&#41;</span>
<span class="kw1">SELECT</span> <span class="nu0">2</span>,<span class="st0">'test2'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT  OPENQUERY(localhost,'SELECT id,col1 from tempdb.dbo.test2 ')
SELECT 2,'test2'</pre></div></div>

<p>Verify that the data is correct</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> test2</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from test2</pre></div></div>

<pre>1	test1
2	test2</pre>
<p>If you run the following update query</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">UPDATE</span> <span class="kw1">OPENQUERY</span><span class="br0">&#40;</span>localhost, <span class="st0">'select id,col1 from tempdb.dbo.test2 where id = 1 '</span><span class="br0">&#41;</span>
<span class="kw1">SET</span> id <span class="sy0">=</span> <span class="nu0">3</span>,col1 <span class="sy0">=</span> <span class="st0">'test2'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">UPDATE OPENQUERY(localhost, 'select id,col1 from tempdb.dbo.test2 where id = 1 ')
SET id = 3,col1 = 'test2'</pre></div></div>

<p>you will be greeted with this message</p>
<p><em>Server: Msg 7320, Level 16, State 2, Line 1<br />
Could not execute query against OLE DB provider &#8216;SQLOLEDB&#8217;.  The provider could not support a required row lookup interface. The provider indicates that conflicts occurred with other properties or requirements.<br />
[OLE/DB provider returned message: Multiple-step OLE DB operation generated errors. Check each OLE DB status value, if available. No work was done.]<br />
OLE DB error trace [OLE/DB Provider &#8216;SQLOLEDB&#8217; ICommandText::Execute returned 0x80040e21:  select id,col1 from tempdb.dbo.test2 where id = 1 [PROPID=DBPROP_IRowsetLocate VALUE=True STATUS=DBPROPSTATUS_CONFLICTING], [PROPID=DBPROP_BOOKMARKS VALUE=True STATUS=DBPROPSTATUS_CONFLICTING]].</em></p>
<p>The delete has the same issue as the update statement, running the following</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DELETE</span> <span class="kw1">OPENQUERY</span><span class="br0">&#40;</span>localhost, <span class="st0">'select id,col1 from tempdb.dbo.test2 where id = 2 '</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DELETE OPENQUERY(localhost, 'select id,col1 from tempdb.dbo.test2 where id = 2 ')</pre></div></div>

<p>will produce this error message</p>
<p><em>Server: Msg 7320, Level 16, State 2, Line 1<br />
Could not execute query against OLE DB provider &#8216;SQLOLEDB&#8217;.  The provider could not support a required row lookup interface. The provider indicates that conflicts occurred with other properties or requirements.<br />
[OLE/DB provider returned message: Multiple-step OLE DB operation generated errors. Check each OLE DB status value, if available. No work was done.]<br />
OLE DB error trace [OLE/DB Provider &#8216;SQLOLEDB&#8217; ICommandText::Execute returned 0x80040e21:  select id,col1 from tempdb.dbo.test2 where id = 2 [PROPID=DBPROP_IRowsetLocate VALUE=True STATUS=DBPROPSTATUS_CONFLICTING], [PROPID=DBPROP_BOOKMARKS VALUE=True STATUS=DBPROPSTATUS_CONFLICTING]].</em></p>
<p>So what those errors are telling us is that a row lookup could not be performed, this is of course because we don&#8217;t have a key on this table. So just be aware of that!</p>
<p>Now that we are done we can drop the linked server, you can use sp_dropserver to do that</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw3">sp_dropserver</span> <span class="st0">'localhost'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_dropserver 'localhost'</pre></div></div>

<p></p>
<p>*** <strong>If you have a SQL related question try our <a href="http://forum.lessthandot.com/viewforum.php?f=17">Microsoft SQL Server Programming</a> forum or our <a href="http://forum.lessthandot.com/viewforum.php?f=22">Microsoft SQL Server Admin</a> forum</strong><ins></ins></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/having-fun-with-openquery-and-update-del/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		</item>
	</channel>
</rss>
