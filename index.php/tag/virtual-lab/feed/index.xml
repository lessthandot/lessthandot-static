<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>virtual lab &#8211; LessthanDot</title>
	<atom:link href="/index.php/tag/virtual-lab/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>A Technical Community for IT Professionals</description>
	<lastBuildDate>Sat, 09 Mar 2019 12:50:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.6.1</generator>
	<item>
		<title>Virtual Lab Tip: Notifications from Windows Event Log</title>
		<link>/index.php/sysadmins/os/windows/virtual-lab-tip-notifications-from-windo/</link>
		<comments>/index.php/sysadmins/os/windows/virtual-lab-tip-notifications-from-windo/#respond</comments>
		<pubDate>Fri, 22 Oct 2010 10:18:47 +0000</pubDate>
		<dc:creator><![CDATA[Eli Weinstock-Herman (tarwn)]]></dc:creator>
				<category><![CDATA[2008 Server]]></category>
		<category><![CDATA[Windows]]></category>
		<category><![CDATA[Windows 7]]></category>
		<category><![CDATA[virtual lab]]></category>
		<category><![CDATA[windows 2008]]></category>

		<guid isPermaLink="false">/index.php/2010/10/virtual-lab-tip-notifications-from-windo/</guid>
		<description><![CDATA[There are a number of environments or situations where large-scale systems monitoring is either not cost effective or simply not available. Windows 7 and 2008 include a feature for sending notifications when specific events occur in the event log.]]></description>
				<content:encoded><![CDATA[<div class="acc_header">
There are a number of environments or situations where large-scale systems monitoring is either not cost effective or simply not available. Windows 7 and 2008 include a feature for sending notifications when specific events occur in the event log.<br />
<br />
<label>Technical Area:</label> Accidental Systems Administrator,  Accidental Database Administrator<br />
<label class="diff">Level of Difficulty: </label><img src="http://tiernok.com/LTDBlog/dr_intermediate.png" alt="Intermediate Difficulty" /><br />
<label>Additional Articles:</label><a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a>
</div>
<p></p>
<h2>Using the Built-In Email</h2>
<p>Windows Vista, 7, and 2008 have a built-in option that allows us to attach actions to events from the event log. These actions take the form of Tasks, similar to scheduled tasks with the exception that they are trigger by events rather than time. The services infrastructure in windows logs startup and shutdown events for services and many applications use the event log rather than a custom logging format. We can take advantage of these messages to create a notification that emails us when certain events occur.</p>
<p>First we need an example of the event and, being lazy, I&#8217;m going to generate one the easy way. Shutting down a SQL Server service generates the first event I want to track (and makes SQL admins everywhere cringe a little, mission accomplished). Later in the post we&#8217;ll cover creating tasks without restarting our server, since people tend to get upset when we do things like that in production.</p>
<p>When we open the Event Log from Administrative Tools menu in Windows, there are several logs available. SQL Server and other service log entries are logged to the Application log. To create my new event-driven task, I locate the entry I just created, right click it, and select &#8220;Attach Task to This Event&#8230;&#8221;.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/EventMonitor/orig/01_screen.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/EventMonitor/01_screen.png" alt="Attach Task to Event Dialog" /></a><br />
	Attach Task to Event &#8211; Dialog
</div>
<p>The Task creation option presents us with a fairly simple dialog. To be consistent and build good habits, we fill in a descriptive name and description for the task. </p>
<div class="hint">
Filling in descriptive names and descriptions for items like tasks may seem like a waste of time, but it&#8217;s 20s of content now that will save a whole lot of digging around 4 years from now when you need to change it. Also, if I ever visit your shop I will make fun of you for not using a descriptive name <img src="https://s.w.org/images/core/emoji/2/72x72/1f642.png" alt="ðŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" />
</div>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/EventMonitor/orig/02_screen.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/EventMonitor/02_screen.png" alt="Names are Important" /></a><br />
	Names are Important
</div>
<p>The second step doesn&#8217;t require (or allow) an input and the third step presents us with the simple decision of sending an email, launching an executable, or displaying a message. We are here to send an email, so the choice should be obvious (but I still pressed the wrong one the second time through). </p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/EventMonitor/orig/03_screen.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/EventMonitor/03_screen.png" alt="Email Info" /></a><br />
	Information for Email
</div>
<p>After filling the email options out we continue to the last tab to review the task information before finishing. At this point we will want to check the &#8220;open properties&#8221; checkbox and press &#8220;Finish&#8221;.</p>
<p>After completing the wizard, we now have the full properties dialog for the task. Perhaps the most critical item here is to change the radio selection on the first tab to &#8220;Run whether user is logged in or not&#8221;. There is also an OS configuration box that I changed to Windows 2008 R2/Windows 7, but I am not sure whether this provides an addition features or simply satisfaction from making such an important decision.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/EventMonitor/orig/04_screen.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/EventMonitor/04_screen.png" alt="Change Summary - Finished" /></a><br />
Summary before Finishing
</div>
<p>I have enough of the task filled in now that we can now press the OK button and try it out. We open Server Manager from the pinned icon on the taskbar (or via the search mechanism in the Start menu). On expanding &#8220;Configuration/Task Scheduler/Task Scheduler Libary&#8221; and selecting &#8220;Event Viewer Tasks&#8221; we should see the task we created. Right clicking the task and pressing &#8220;Run&#8221; will force the task to run once (again, just like testing a scheduled task). We can select the History tab to see the details of the run or wait patiently for an email to show up in our inbox.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/EventMonitor/orig/05_screen.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/EventMonitor/05_screen.png" alt="Event Viewer Tasks view" /></a><br />
Event Viewer Tasks view
</div>
<p>And there we have it, an email each time our service stops.</p>
<h2>Alignment of the Stars</h2>
<p>If your mail server is like mine then it probably doesn&#8217;t allow anonymous relaying. If you are using Exchange and you are sending from the same account that you configured the task for (or the user is allowed to send for other users), then you may have received an email. Checking the alignment of the stars may also be of assistance. </p>
<p>Even if the email did work, it is going to be rather tedious to create individual tasks for each of the potential events (SQL Server start/stop, SQL Agent Start/Stop, etc) that you are interested in.</p>
<p>Rather than build a hard-coded email task for each possible event, there is an option to run an executable. Tie that to Cscript.exe and a VBScript (or maybe a powershell script?) and you have a lot more flexibility to send emails. </p>
<p>If you decide to go this route, you will probably want to edit your tasks to carry some additional information (like which event is firing). This will allow you to create a single script and task for multiple events:<br />
http://blogs.technet.com/b/otto/archive/2007/11/09/find-the-event-that-triggered-your-task.aspx</p>
<h2>Not Perfect</h2>
<p>This method of reporting from windows does not replace an external monitoring system. There is a wide range of errors that services and executables can generate. Covering them all would be extremely difficult even if we ignored errors that cause the box to lose communications or freeze entirely. However, if you have no budget at all, setting up some of these alerts will only cost you time and it will at least get you one step closer to knowing about problems before the phone rings.</p>
<p><label>Additional Articles:</label><a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a></p>
<style>
.mylab, .hint{
   margin: .5em 2em;
   padding: 1em 1em 1em 90px;
}
.mylab{
   border: 2px solid #CCEECC;
   background-color: #DDFFDD;
   background-image: url(http://tiernok.com/LTDBlog/mylab.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.hint{
   border: 2px solid #EEEECC;
   background-color: #FFFFDD;
   background-image: url(http://tiernok.com/LTDBlog/tip.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.screenshot{
   text-align: center;
   font-size: .8em;
   margin-bottom: 1em;
}
.acc_header{ position: relative; }
.acc_header label{ float: left; width: 150px; font-weight: bold;}
.acc_header br{  clear: left; }
.acc_header .diff{ margin-top: 3px; }
</style>
]]></content:encoded>
			<wfw:commentRss>/index.php/sysadmins/os/windows/virtual-lab-tip-notifications-from-windo/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Virtual Lab: Setting up Database Mail on SQL Server 2008 R2</title>
		<link>/index.php/datamgmt/datadesign/virtual-lab-setting-up-database-mail-on/</link>
		<comments>/index.php/datamgmt/datadesign/virtual-lab-setting-up-database-mail-on/#comments</comments>
		<pubDate>Tue, 06 Jul 2010 10:02:26 +0000</pubDate>
		<dc:creator><![CDATA[Eli Weinstock-Herman (tarwn)]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[databasemail]]></category>
		<category><![CDATA[sqlserver 2008 r2]]></category>
		<category><![CDATA[virtual lab]]></category>

		<guid isPermaLink="false">/index.php/2010/07/virtual-lab-setting-up-database-mail-on/</guid>
		<description><![CDATA[After our installation of SQL Server 2008 R2 a few weeks ago, we mentioned that we still had some additional setup tasks before we could consider the server to be done. This article covers setting up DatabaseMail, the internal mail client that will allow us to use built-in alerts (among other things).]]></description>
				<content:encoded><![CDATA[<div class="acc_header">
After our installation of SQL Server 2008 R2 <a href="/index.php/DataMgmt/DBAdmin/MSSQLServerAdmin/virtual-lab-creating-a-basic-sql-2008-r2" alt="Click here to catch up on that article if you missed it" target="_blank">a few weeks ago</a>, I mentioned that we still had some additional setup tasks before we could consider the server to be done. This article covers setting up DatabaseMail, the internal mail client/management system that will allow us to use built-in alerts (among other things).<br />
<br />
<label>Technical Area:</label> Accidental Database Administrator<br />
<label class="diff">Level of Difficulty: </label><img src="http://tiernok.com/LTDBlog/dr_basic.png" alt="Basic Difficulty" /><br />
<label>Additional Articles:</label><a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a>
</div>
<p>Database Mail is a subsystem that acts like a <a href="http://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" title="Simple Mail Transport Protocol">SMTP</a> client, allowing us to send emails from SQL Server processes and scripts. It replaces SQL Mail and doesn&#8217;t require a local installation of additional software (like Outlook, the quick fix) to function. </p>
<h2>Account, Profile, Service Broker, what?</h2>
<p>Database Mail expands on the concept of sending mail to include all of the features we wanted in SQLMail. This grown up version of mail uses SMTP to communicate with mail servers, no longer requiring a MAPI component to communicate messages (the reason we used to install products like Outlook to make SQLMail work). Behind the scenes, Database Mail uses Service Broker to manage email in queues, rather than trying an immediate send. Profiles allow us to define a chain of fail-over accounts to send from, so that messages are never left undelivered due to a primary email server being unavailable. And accounts are exactly what they sound like, individual, unique accounts that we can setup to use a variety of authentication and SMTP options.</p>
<h2>From the GUI</h2>
<p>Database Mail is something we want to setup immediately on creating a new server. When we are working with a relatively small number of servers, the GUI is not a bad option for setting up some accounts.</p>
<p>We&#8217;ll start by setting up an administrator profile with then intent to send critical notifications and alerts to this profile.</p>
<p>In SSMS we can right click the Database Mail entry under Management to begin the wizard.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/01_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/01_config.png" alt="SSMS DatabaseMail" /></a><br />
	DatabaseMail Menu Item in SSMS
</div>
<p>The Intro screen is fairly boring, so lets press &#8220;Next&#8221; and head to the main configuration page. This being the first time we are configuring DatabaseMail on our new server, we want to leave the first option selected and continue.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/02_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/02_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS
</div>
<p>A quick check by the wizard and it determines that components for Database Mail aren&#8217;t available on the server yet, so it asks us if we want to go ahead and install them (yes).</p>
<div class="hint">
How did the server know Database Mail wasn&#8217;t configured, and what did it do when we pressed &#8216;Yes&#8217;? <br />
There is an advanced option in the system configurations called &#8216;Database Mail XPs&#8217;. When the option is set to &#8216;0&#8217; (which is the default), then the Database Mail process doesn&#8217;t run. So the dialog simply checked the current value and, when we selected &#8216;Yes&#8217;, updated the configuration to a value of &#8216;1&#8217;.
</div>
<p>Profiles are used to represent a set of email addresses which allows us to represent a single person (or system) with multiple fail-over accounts. If an error occurs when the system is attempting to send mail from the first account in a profile, it fails to the next and retries, continuing until it either runs out of accounts or successfully sends it&#8217;s message.</p>
<p>Lets enter a Profile Name of &#8220;The Accidental Admin&#8221;.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/03_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/02_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS
</div>
<p>Now we&#8217;ll add the first two accounts to this profile, each on a different network. Many admins will choose a non-local account with an external provider as their primary to reduce the chances that emails will not get through when other issues are happening. As many of you know, when a server room overheats the exchange server is always the first to go, so we will start with an external provider and fail-over to an internal one. Keep in mind that these are the accounts the database will send emails <i>from</i> when using the specified profile, not to.</p>
<p>Creating an account is fairly straightforward, simply enter the details for where you would like the email to be sent and any authentication options that are necessary. In this case we want to create a minimum of two accounts so the failover can work properly.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/04_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/04_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS &#8211; Account Entry
</div>
<p>Now that we have two accounts, we can move on.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/05_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/05_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS &#8211; Account View
</div>
<p>The next step is to decide whether our profile is going to be public or private. A public profile will be accessible to other people working on the system, whereas a private one will not. In this case we will make the profile public but be aware that this means anyone will be able to us the database server to send mail from this particular profile.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/06_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/06_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS &#8211; Profile Security
</div>
<p>The last interactive step is to confirm or modify some additional system parameters. This step is not specific to configuring an email profile and accounts, it is displayed as the final step of setting up DatabaseMail (when setting up for the first time). I suggest reviewing the settings to ensure your comfortable with each of them.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/07_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/07_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS &#8211; System Parameters
</div>
<p>After a final review screen, press the &#8216;Finish&#8217; button to implement the changes.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/08_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/08_config.png" alt="SSMS DatabaseMail Wizard" /></a><br />
	DatabaseMail Wizard in SSMS &#8211; Finished
</div>
<p>The last step is to test our new setup. Right-click the Database Mail menu option in SSMS and select &#8220;Send Test Email&#8230;&#8221;.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/09_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/09_config.png" alt="SSMS DatabaseMail - Test Email" /></a><br />
	SSMS Menu &#8211; Sending a Test Email
</div>
<p>After entering an email address for our test message, we can hit the &#8220;Send&#8221; button and wait for confirmation of our ability to hit &#8220;Next, Next, Finish&#8221;.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/DatabaseMail/orig/10_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/DatabaseMail/10_config.png" alt="SSMS DatabaseMail - Test Email Dialog" /></a><br />
	SSMS DatabaseMail &#8211; Test Email Dialog
</div>
<h2>or From a Script</h2>
<p>Doing this on one server is pretty quick. Banging through the dialog on 20 (or with multiple profiles) is not only going to be a bit slower but probably guarantees at least one bad entry along the way. Luckily there is nothing magical about what SSMS is doing to configure these accounts and profiles, just a wizard driving system procedures behind the scenes. We can follow the same process programmatically and create a setup script. Once we have a setup script, of course, we can then use it against multiple systems and if we save it then we not only can set up future servers the same way, but we have detailed documentation on exactly how our servers were setup when we need it 3 years later.</p>
<p>Here are the commands we will be using:</p>
<dl>
<dt><a href="http://msdn.microsoft.com/en-us/library/ms189631.aspx" onclick="_blank" title="Read more at MSDN">sp_configure</a></dt>
<dd>This procedure is used to change SQL Server configurations</dd>
<dt><a href="http://msdn.microsoft.com/en-us/library/ms188058.aspx" onclick="_blank" title="Read more at MSDN">sysmail_add_profile_sp</a></dt>
<dd>Used to create a Database Mail Profile</dd>
<dt><a href="http://msdn.microsoft.com/en-us/library/ms182804.aspx" onclick="_blank" title="Read more at MSDN">sysmail_add_account_sp</a></dt>
<dd>Used to create a Database Mail Account</dd>
<dt><a href="http://msdn.microsoft.com/en-us/library/ms186258.aspx" onclick="_blank" title="Read more at MSDN">sysmail_add_profileaccount_sp</a></dt>
<dd>Used to tie a Database Mail Account to a Profile (Tab A in Slot B)</dd>
<dt><a href="http://msdn.microsoft.com/en-us/library/ms187911.aspx" onclick="_blank" title="Read more at MSDN">sysmail_add_principalprofile_sp</a></dt>
<dd>Assign access rights to a Database Mail profile</dd>
<dt><a href="http://msdn.microsoft.com/en-us/library/ms190307.aspx" onclick="_blank" title="Read more at MSDN">sp_send_dbmail</a></dt>
<dd>And sending an email, of course</dd>
</dl>
<p>And if we put it all together then we can duplicate the wizardy approach above like so:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td><td class="de1"><pre class="de1"><span class="co1">---- Enable the XPs for Database Mail</span>
<span class="kw1">EXECUTE</span> <span class="kw3">sp_configure</span> <span class="st0">'show advanced'</span>, <span class="nu0">1</span>;
<span class="kw1">RECONFIGURE</span>;
<span class="kw1">EXECUTE</span> <span class="kw3">sp_configure</span> <span class="st0">'Database Mail XPs'</span>,<span class="nu0">1</span>;
<span class="kw1">RECONFIGURE</span>;
<span class="kw1">EXECUTE</span> <span class="kw3">sp_configure</span> <span class="st0">'show advanced'</span>, <span class="nu0">0</span>;
<span class="kw1">RECONFIGURE</span>;
GO
&nbsp;
<span class="co1">---- Create our Default Profile</span>
<span class="kw1">DECLARE</span> @newProfileId <span class="kw1">int</span>;
<span class="kw1">EXECUTE</span> msdb.<span class="me1">dbo</span>.<span class="me1">sysmail_add_profile_sp</span>
&nbsp; &nbsp; @profile_name <span class="sy0">=</span> <span class="st0">'The Accidental Admin v2'</span>,
&nbsp; &nbsp; @description <span class="sy0">=</span> <span class="st0">'A second version of the DB Admin email profile'</span>,
&nbsp; &nbsp; @profile_id <span class="sy0">=</span> @newProfileId <span class="kw1">OUTPUT</span>;
<span class="kw1">print</span> <span class="st0">'Profile Created'</span>;
&nbsp;
<span class="co1">---- Create our accounts (You did plan on a minimum of two, right?)</span>
<span class="kw1">DECLARE</span> @newPriAccountId <span class="kw1">int</span>,
&nbsp; &nbsp; @newSecAccountId <span class="kw1">int</span>;
<span class="kw1">DECLARE</span> @sender <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">50</span><span class="br0">&#41;</span>;
<span class="kw1">SELECT</span> @sender <span class="sy0">=</span> <span class="st0">'DB SERVER - '</span> <span class="sy0">+</span> <span class="kw2">@@SERVERNAME</span>;
&nbsp;
<span class="co1">-- External account using username/password</span>
<span class="kw1">EXECUTE</span> msdb.<span class="me1">dbo</span>.<span class="me1">sysmail_add_account_sp</span> &nbsp;
&nbsp; &nbsp; @account_name <span class="sy0">=</span> <span class="st0">'External DBAdmin'</span>,
&nbsp; &nbsp; @email_address <span class="sy0">=</span> <span class="st0">'AnAccount@ExternalService.com'</span>,
&nbsp; &nbsp; @display_name <span class="sy0">=</span> @sender,
&nbsp; &nbsp; @description <span class="sy0">=</span> <span class="st0">'Primary account for DB Admin profile'</span>,
&nbsp; &nbsp; @mailserver_name <span class="sy0">=</span> <span class="st0">'mail.ExternalService.com'</span>,
&nbsp; &nbsp; @username <span class="sy0">=</span> <span class="st0">'username'</span>,
&nbsp; &nbsp; @password <span class="sy0">=</span> <span class="st0">'password'</span>,
&nbsp; &nbsp; @account_id <span class="sy0">=</span> @newPriAccountId <span class="kw1">OUTPUT</span>;
&nbsp;
<span class="co1">-- Internal account using credentials from the account DB server is running under</span>
<span class="kw1">EXECUTE</span> msdb.<span class="me1">dbo</span>.<span class="me1">sysmail_add_account_sp</span> &nbsp;
&nbsp; &nbsp; @account_name <span class="sy0">=</span> <span class="st0">'Internal DBAdmin'</span>,
&nbsp; &nbsp; @email_address <span class="sy0">=</span> <span class="st0">'YourAccount@YourDomain.com'</span>,
&nbsp; &nbsp; @display_name <span class="sy0">=</span> @sender,
&nbsp; &nbsp; @description <span class="sy0">=</span> <span class="st0">'Secondary account for DB Admin profile'</span>,
&nbsp; &nbsp; @mailserver_name <span class="sy0">=</span> <span class="st0">'mail.YourDomain.com'</span>,
&nbsp; &nbsp; @use_default_credentials <span class="sy0">=</span> <span class="nu0">1</span>,
&nbsp; &nbsp; @account_id <span class="sy0">=</span> @newSecAccountId <span class="kw1">OUTPUT</span>;
&nbsp;
<span class="kw1">print</span> <span class="st0">'Accounts Created: '</span> <span class="sy0">+</span> @sender;
&nbsp;
&nbsp; &nbsp; 
<span class="co1">---- Add Accounts to Profile</span>
<span class="kw1">EXECUTE</span> msdb.<span class="me1">dbo</span>.<span class="me1">sysmail_add_profileaccount_sp</span>
&nbsp; &nbsp; @profile_id <span class="sy0">=</span> @newProfileId,
&nbsp; &nbsp; @account_id <span class="sy0">=</span> @newPriAccountId,
&nbsp; &nbsp; @sequence_number <span class="sy0">=</span> <span class="nu0">1</span>;
&nbsp;
<span class="kw1">EXECUTE</span> msdb.<span class="me1">dbo</span>.<span class="me1">sysmail_add_profileaccount_sp</span>
&nbsp; &nbsp; @profile_id <span class="sy0">=</span> @newProfileId,
&nbsp; &nbsp; @account_id <span class="sy0">=</span> @newSecAccountId,
&nbsp; &nbsp; @sequence_number <span class="sy0">=</span> <span class="nu0">2</span>;
&nbsp;
<span class="kw1">print</span> <span class="st0">'Accounts assigned to Profile'</span>;
&nbsp;
Go
&nbsp;
<span class="co1">---- And Then We Test</span>
<span class="co1">-- Make sure you update the profile name with the value from above</span>
<span class="kw1">EXECUTE</span> msdb.<span class="me1">dbo</span>.<span class="me1">sp_send_dbmail</span>
&nbsp; &nbsp; @profile_name <span class="sy0">=</span> <span class="st0">'The Accidental Admin v2'</span>,
&nbsp; &nbsp; @subject <span class="sy0">=</span> <span class="st0">'Test Database Mail Message'</span>,
&nbsp; &nbsp; @recipients <span class="sy0">=</span> <span class="st0">'You@YourDomain.Com'</span>,
&nbsp; &nbsp; @body <span class="sy0">=</span> <span class="st0">'Test Message'</span>;
<span class="kw1">print</span> <span class="st0">'Test Email Away!'</span>;
&nbsp;
GO&nbsp; </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">---- Enable the XPs for Database Mail
EXECUTE sp_configure 'show advanced', 1;
RECONFIGURE;
EXECUTE sp_configure 'Database Mail XPs',1;
RECONFIGURE;
EXECUTE sp_configure 'show advanced', 0;
RECONFIGURE;
GO

---- Create our Default Profile
DECLARE @newProfileId int;
EXECUTE msdb.dbo.sysmail_add_profile_sp
	@profile_name = 'The Accidental Admin v2',
	@description = 'A second version of the DB Admin email profile',
	@profile_id = @newProfileId OUTPUT;
print 'Profile Created';

---- Create our accounts (You did plan on a minimum of two, right?)
DECLARE @newPriAccountId int,
	@newSecAccountId int;
DECLARE @sender varchar(50);
SELECT @sender = 'DB SERVER - ' + @@SERVERNAME;

-- External account using username/password
EXECUTE msdb.dbo.sysmail_add_account_sp  
	@account_name = 'External DBAdmin',
	@email_address = 'AnAccount@ExternalService.com',
	@display_name = @sender,
	@description = 'Primary account for DB Admin profile',
	@mailserver_name = 'mail.ExternalService.com',
	@username = 'username',
	@password = 'password',
	@account_id = @newPriAccountId OUTPUT;

-- Internal account using credentials from the account DB server is running under
EXECUTE msdb.dbo.sysmail_add_account_sp  
	@account_name = 'Internal DBAdmin',
	@email_address = 'YourAccount@YourDomain.com',
	@display_name = @sender,
	@description = 'Secondary account for DB Admin profile',
	@mailserver_name = 'mail.YourDomain.com',
	@use_default_credentials = 1,
	@account_id = @newSecAccountId OUTPUT;

print 'Accounts Created: ' + @sender;

    
---- Add Accounts to Profile
EXECUTE msdb.dbo.sysmail_add_profileaccount_sp
	@profile_id = @newProfileId,
	@account_id = @newPriAccountId,
	@sequence_number = 1;

EXECUTE msdb.dbo.sysmail_add_profileaccount_sp
	@profile_id = @newProfileId,
	@account_id = @newSecAccountId,
	@sequence_number = 2;

print 'Accounts assigned to Profile';

Go

---- And Then We Test
-- Make sure you update the profile name with the value from above
EXECUTE msdb.dbo.sp_send_dbmail
	@profile_name = 'The Accidental Admin v2',
	@subject = 'Test Database Mail Message',
	@recipients = 'You@YourDomain.Com',
	@body = 'Test Message';
print 'Test Email Away!';

GO	</pre></div></div>

<p>Running this script creates a setup similar to what we created in the first section, though some of the names have been changed (and I have removed my email address from the list so I don&#8217;t get server updates when someone comes along and forgets to swap out the addresses).</p>
<h2>And Now, Uses</h2>
<p>So now that we have Database Mail setup, what are we going to use it for? Well, besides creating our own monitoring and email scripts, the built in Alerts component in SQL Server uses Database mail to tell us when critical parts of our server have decided to misbehave. SQL Agent jobs have the option to notify us when they fail and they do so using, yep, Database Mail. Setting up Database Mail and using it in each of these situations won&#8217;t prevent problems from occurring, but it is the difference between finding out when the problem is occurring and finding out after the server has melted down. </p>
<p>Next week will be something interesting, but I haven&#8217;t determined what that will be yet, so we&#8217;ll figure it out as we go.</p>
<style>
.mylab, .hint{
   margin: .5em 2em;
   padding: 1em 1em 1em 90px;
}
.mylab{
   border: 2px solid #CCEECC;
   background-color: #DDFFDD;
   background-image: url(http://tiernok.com/LTDBlog/mylab.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.hint{
   border: 2px solid #EEEECC;
   background-color: #FFFFDD;
   background-image: url(http://tiernok.com/LTDBlog/tip.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.screenshot{
   text-align: center;
   font-size: .8em;
   margin-bottom: 1em;
}
.acc_header{ position: relative; }
.acc_header label{ float: left; width: 150px; font-weight: bold;}
.acc_header br{  clear: left; }
.acc_header .diff{ margin-top: 3px; }
.evo_post_text dt{ width: 220px; }
.evo_post_text dd{ margin-left: 230px; }
</style>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/virtual-lab-setting-up-database-mail-on/feed/</wfw:commentRss>
		<slash:comments>7</slash:comments>
		</item>
		<item>
		<title>Virtual Lab: Creating the Basic SQL 2008 R2 Virtual Machine</title>
		<link>/index.php/datamgmt/dbadmin/virtual-lab-creating-a-basic-sql-2008-r2/</link>
		<comments>/index.php/datamgmt/dbadmin/virtual-lab-creating-a-basic-sql-2008-r2/#comments</comments>
		<pubDate>Thu, 20 May 2010 17:36:19 +0000</pubDate>
		<dc:creator><![CDATA[Eli Weinstock-Herman (tarwn)]]></dc:creator>
				<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[sql server 2008 r2]]></category>
		<category><![CDATA[virtual lab]]></category>
		<category><![CDATA[vmware]]></category>

		<guid isPermaLink="false">/index.php/2010/05/virtual-lab-creating-a-basic-sql-2008-r2/</guid>
		<description><![CDATA[A virtual database server provides you the ability to not only work on database-relate tools and services, but also to try out hundreds of vendor products throughout the market that require a database backend. This article will walk through a basic database setup for SQL Server 2008 R2 on a virtual machine using mostly standard [&#8230;]]]></description>
				<content:encoded><![CDATA[<div class="acc_header">
A virtual database server provides you the ability to not only work on database-relate tools and services, but also to try out hundreds of vendor products throughout the market that require a database backend. This article will walk through a basic database setup for SQL Server 2008 R2 on a virtual machine using mostly standard installation options. This first installation will be limited to basic settings and a virtual harddrive, leaving us ready to customize the setup for later uses.<br />
<br />
<label>Technical Area:</label> Accidental Systems Administrator, Accidental Database Administrator<br />
<label class="diff">Level of Difficulty: </label><img src="http://tiernok.com/LTDBlog/dr_basic.png" alt="Basic Difficulty" /><br />
<label>Additional Articles:</label><a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a></p>
</div>
<h2>Setting up the Virtual Machine</h2>
<p>In the <a href="/index.php/All/?p=830" title="Read the first post">first post</a> we created a basic Windows 2008 R2 virtual machine to serve as a starting point for our later systems. Our first step will be to to make a copy of tis system for our new SQL Server installation. To begin with, we&#8217;ll make a copy of the folder, renaming that copy to match the name we will be assigning to our new server. If we look inside the folder we will see a variety of configuration files, including the file that serves as our virtual harddrive.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/0_files.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/0_files.png" alt="Files for VM" /></a><br />
	VM Folder and Files
</div>
<p>TO keep things consistent, we will rename the vmx and vmxf files to match the new server name as well. Once we have edited the names we need to open the vmx file in using our favorite editor (mine is EditPlus) and edit the values for &#8220;displayName&#8221; and &#8220;extendedConfigFile&#8221; to reflect the new file names. It&#8217;s possible to rename the other files but requires editing a larger number of configurations and I prefer to leave them with their original name to reflect the system I used as a template.</p>
<p>To add the new, copied system to VMWare we open the menu and select the option to &#8220;Add Virtual Machine to Inventory&#8221;. </p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/0_AddVirtualMachine.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/0_AddVirtualMachine.png" alt="Add Virtual Machine, Step 0" /></a><br />
	Adding a Virtual Machine, Step 0
</div>
<p>A dialog is presented with the list of stores that are set up on the local system. We select the store our copied VM resides in and then select the VM. The center column should now show us the vmx file we renamed, so we will select that and press Ok.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/1_AddVirtualMachine.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/1_AddVirtualMachine.png" alt="Add Virtual Machine, Step 1" /></a><br />
	Adding a Virtual Machine, Step 1
</div>
<div class="hint">
The &#8220;standard&#8221; store corresponds to the initial folder that VMWare generates when you first install it. By default this is &#8220;C:Virtual Machines&#8221; for Windows.
</div>
<p>The next step, once the VM is added, is to modify some of the settings. This basic VM was created with 4GB of memory, bridged networking, and an optical disk pointing to the Windows 2008 R2 ISO. These settings were to optimize the installation process, but now we should modify them to fit the needs of our new system. The optical disk will be pointed to the ISO for the SQL Server installation disk and the memory will be reduced to a more reasonable value. The network will remain in bridged mode until virtual network management is addressed in a later post.</p>
<div class="mylab">
Because I intend to have a number of servers running for some future articles, I have decided to start this system with 2GB of RAM. As the environment grows I may increase or decrease this number, depending on the number of systems I need to have running simultaneously.
</div>
<p>The last step is to add a virtual drive for database storage. In later articles we will walk through comparisons of different virtual and physical drive options, but for today we will be creating a simple secondary virtual drive to serve as storage. This secondary drive will start off small, as we don&#8217;t intend to work with a large amount of data on the system. </p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/4_AddVirtualMachine.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/4_AddVirtualMachine.png" alt="Add Virtual Machine, Step 2 &amp; 3" /></a><br />
	Adding a Virtual Machine, Step 2 &amp; 3
</div>
<h2>Configuring the OS</h2>
<p>Once the Virtual Machine is prepped, it&#8217;s time to boot into our system for the first time and prepare it for the SQL Server installation.</p>
<p>When we first attempt to start the new virtual machine, the below error message is displayed prominently on the VMWare interface and we have to select either the &#8220;Copied&#8221; or &#8220;Moved&#8221; option to continue.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/0_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/0_startup.png" alt="VM Error Message" /></a><br />
	VM Startup Error Message
</div>
<div class="hint">
VMWare has detected that the files have moved from their original location and is asking whether to treat this as a Move or a Copy. If you select the &#8220;copied&#8221; option, as I did, then some virtual hardware will be assigned new id&#8217;s to ensure they aren&#8217;t duplicates of the original system. This is particularly important for the MAC address of the network card. The downside is that enough id&#8217;s are changed that Windows will require one of it&#8217;s ten reactivations.
</div>
<p>Before going too far with the new server, lets start by providing it with it&#8217;s new name and executing the obligatory reboot.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/1_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/1_startup.png" alt="Changing the System Name" /></a><br />
	Changing the System Name
</div>
<div class="mylab">
While going through this process I found more &#8220;features&#8221; between VMWare and Windows 7. I initially had difficulties with the network connections because the VMWare adapters kept getting assigned to the Unidentified Network. Following the registry editing instructions in this <a href="http://aspoc.net/archives/2008/10/30/unidentified-network-issue-with-vmwares-virtual-nics-in-vista/" title="Unidentified network in Vista" target="_blank">Windows Vista article</a> appears to have corrected that.
</div>
<p>Next up is mounting the new virtual drive. We can access the &#8220;Server Management&#8221; snap-in by right-clicking on the Computer in Explorer and selecting &#8220;Manage&#8221; or by typing &#8220;Manage&#8221; into the Start menu search and selecting &#8220;Server Manager&#8221;. In the left column is a treeview with a number of options. Expand the Storage option and select &#8220;Disk Management&#8221; to see the available disks. </p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/2_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/2_startup.png" alt="Adding the new virtual disk" /></a><br />
	Server Management &#8211; Adding a Disk
</div>
<p>Initially the disk is listed as Offline (bottom of center column). Right-clicking the offline disk will provide the option to bring it Online. Once Online the disk will require initialization, so we right-click and select Initialize.</p>
<div class="mylab">
When initializing the drive the system will ask whether you want to use a master boot record or GPT. Not knowing what GPT means (yet), I decided to use a master boot record. This is not a recommendation, simply an expression of my own ignorance and the addition of a new item to my list of things to be learned (GPT).
</div>
<p>Once the drive reports a status of &#8220;Initialized&#8221; we can allocate it by right clicking on the volume and selecting &#8220;New Simple Volume&#8221;.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/3_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/3_startup.png" alt="Adding the new virtual disk" /></a><br />
	Server Management &#8211; Adding a Disk
</div>
<p>Windows provides a wizard to walk through the drive allocation process. For the sake of this article we will select all of the defaults it provides, which should net a brand new 10237MB &#8220;E:&#8221; drive formatted for NTFS. Once the wizard is complete, the Server Management console will update the drive status and a dialog will appear with Windows asking if it can now format the new drive.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/4_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/4_startup.png" alt="Adding the new virtual disk" /></a><br />
	Server Management &#8211; Adding a Disk
</div>
<div class="hint">
(This is more along the lines of experienced advice)<br />
If something is complex enough to have a wizard and configuration system, it&#8217;s generally complex enough for the defaults to give you an evenly rounded, mediocre set of settings. This is why system/storage/database admins cringe when they find systems installed with the defaults, the equivalent of carefully configuring the system to perform equally poorly for all possible situations.
</div>
<p>When the Format screen appears, Windows provides several values and offers some defaults. Since this drive is going to be used primarily for SQL Server, we will change the &#8220;Allocation Unit Size&#8221; from 4K to 64K. </p>
<div class="hint">
SQL Server works in request sizes of 8k and 64K. Selecting allocation unit sizes for a drive (or stripe sizes for an array) is going to be based on two factors:</p>
<ul>
<li>The options you get</li>
<li>Your I/O pattern</li>
</ul>
<p>You can find an excellent article here: <a href="http://www.sqlservercentral.com/blogs/sqlmanofmystery/archive/2010/01/04/fundamentals-of-storage-systems-stripe-size-block-size-and-io-patterns.aspx" target="_blank">Fundamentals of Storage Systems: Stripe Size, Block Size, and I/O Patterns at SQL Server Central</a><br />
The downside of a 64k unit size with NTFS is that NTFS compression requires 4k unit sizes, so selection of any other size means you cannot use this option.
</div>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/5_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/5_startup.png" alt="Adding the new virtual disk" /></a><br />
	Server Management &#8211; Adding a Disk
</div>
<p>And finally the last step in our OS setup is to create a new administrative account for the future SQL Server services. While the Server Management console is still open, expand the Configuration option in the right column, expand &#8220;Local Users and Groups&#8221;, and select the &#8220;Users&#8221; option.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/6_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/6_startup.png" alt="Adding an Administrative User" /></a><br />
	Server Management &#8211; Adding a New User
</div>
<p>To enter the new user information we&#8217;ll right click in the center column. To reduce future surprises we&#8217;ll make sure the checkboxes are set to not require password change.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/7_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/7_startup.png" alt="Adding an Administrative User" /></a><br />
	Server Management &#8211; Adding a New User
</div>
<p>Elevating the user&#8217;s permissions is fairly straightforward. After creating the user, we right click them and select &#8220;Properties&#8221;. We select the &#8220;Member Of&#8221; tab and add the user to the local Administrators group.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/8_startup.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/8_startup.png" alt="Adding an Administrative User" /></a><br />
	Server Management &#8211; Adding a New User
</div>
<h2>Setting up SQL Server</h2>
<p>If we had decided to use the host&#8217;s optical drive for the VM&#8217;s optical drive it would now be time to put the disc in the drive, whereas the ISO method should be good to go. </p>
<div class="hint">If you need help determining what version of SQL to install, there is useful information on the <a href="http://msdn.microsoft.com/en-us/library/ms144275.aspx" title="View edition information for SQL Server 2008" target="_blank">edition information page at MSDN</a>.</div>
<p>As we begin the installation process, the installer is going to check our prerequisites right away (unlike some prior versions that seemed to require everything from dog trainers to fiery hoops to get the job done). Press &#8220;Ok&#8221; and let the setup installer do it&#8217;s thing.</p>
<p>Once this check passes (or we potentially go through the process of installing the .Net Framework and a newer version of Windows Installer), the setup process will present us with a &#8220;SQL Server Installation Center&#8221; window. If you haven&#8217;t installed SQL Server recently, you are probably going to be surprised by the number of links that are available. Compared to the 5 menu options available on the SQL Server 2000 dialog, this one is almost a book.</p>
<h3>Installation</h3>
<p>First things first, lets make sure we have everything that SQL Server wants. The 5th option on the first screen is for the &#8220;System Configuration Checker&#8221;. Selecting this option will start a dialog/wizard process that is going to go through and verify we have any additional prerequisites (such as being logged in with administrative rights) that the installer will need.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/0_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/0_install.png" alt="System Configuration Checker" /></a><br />
	System Configuration Checker &#8211; All Green
</div>
<p>Once everything in the configuration checker is green, we can move on to the Installation. Selecting &#8220;Installation&#8221; from the right sidebar presents us with a new set of options to select from. As we are installing a new server from scratch, lets select the first option &#8220;New Installation or Add features&#8221;. After another Configuration Check, the setup presents a wizard for installing the Support Files.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/1_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/1_install.png" alt="SQL Server 2008 R2 Setup - Support Files (Next, Next, Install)" /></a><br />
	SQL Server 2008 R2 Setup &#8211; Support Files (Next, Next, Install)
</div>
<div class="mylab">
	I did receive a warning at the end of the Support Files installation. Basically the wizard is just warning me that the firewall may block the TCP ports for SQL Server unless I configure it otherwise. As the firewall is still running the default settings from installation, it&#8217;s probable you received this warning as well.</p>
<div class="screenshot">
		<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/2_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/2_install.png" alt="SQL Server 2008 R2 Setup - Firewall Warning" /></a><br />
		SQL Server 2008 R2 Setup &#8211; Firewall Warning
	</div>
</div>
<p>Once the Support Files have installed, we are presented with a dialog asking us to select whether we are trying to install SQL Server or PowerPivot for Sharepoint. Leaving SQL Server selected and pressing next will present us with a series of checkboxes to allow us to pick exactly which components we would like to install. Select the boxes the conform with what you intend to use the system for and press &#8220;Next&#8221;.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/3_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/3_install.png" alt="SQL Server 2008 R2 Setup - Component Selection" /></a><br />
	SQL Server 2008 R2 Setup &#8211; Component Selection
</div>
<div class="mylab">
Since my intent is to create a basic database server, I have selected the bare minimum number of components that I will need. These are the Database Engine, client tools connectivity, and the Management Tools. I probably could have selected the basic set of tools for this system, but it won&#8217;t make that big a difference.
</div>
<h3>Installation Configuration</h3>
<p>After making selections for what components to install, the setup program provides a number of screens to allow initial configuration of the system.</p>
<p>First we should decide whether this will be the default instance on the server or a named instance. If we were working with an existing server than we would need to look at the existing installation to determine which way to answer this question. As we are installing our first instance no a virtual server, however, we can go ahead and select the Default option.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/4_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/4_install.png" alt="SQL Server 2008 R2 Setup - Instance Configuration" /></a><br />
	SQL Server 2008 R2 Setup &#8211; Instance Configuration
</div>
<p>The disk space requirements step is always either purely informational or the beginning of a bad day. In this case we created our initial system with enough space to continue.</p>
<p>Next we are setting up the accounts used for the system services. Press the &#8220;Use the Same Account for all SQL Services&#8221; button, select &#8220;browse&#8221; and find the NT User we created earlier. Enter the password for the user and press &#8220;Ok&#8221; to assign it.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/5_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/5_install.png" alt="SQL Server 2008 R2 Setup - User Account Configuration" /></a><br />
	SQL Server 2008 R2 Setup &#8211; User Account Configuration
</div>
<div class="hint">
I don&#8217;t suggest changing the collation from the default for your first SQL instance and I can&#8217;t offer much assistance if you do. if you do choose to change the collation, however, I have a great deal of experience dealing with the results of servers being set to strange collations and not getting along, plus the site has a number of experts that know way more than I do about SQL Server administration. So if you do get adventurous and hurt yourself, put a post up in the <a href="http://forum.lessthandot.com/" target="_blank">forum</a> and someone should be able to help you out.
</div>
<p>Next we have the Account Provisioning tab, Data Directory configuration, and FILESTREAM configuration. For Account Provisioning we have to decide whether every connection will be made using Windows Authentication or whether there is the potential that one or more of our vendors use SQL Authentication.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/6_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/6_install.png" alt="SQL Server 2008 R2 Setup - Account Provisioning" /></a><br />
	SQL Server 2008 R2 Setup &#8211; Account Provisioning
</div>
<div class="mylab">
	Personally I always use mixed mode, though this may be the developer in me. In many environments we used SQL Authentication for in house web applications that had no special needs on the domain and thus did not get domain accounts (services and windows applications still used domain accounts). Some environments take the opposite approach and always crate separate domain accounts for every single web or local application. Many vendors go the SQL Authentication route because they can provide a script to create the user with necessary rights (or assume you will give them the sa password).
</div>
<p>On the Data Directories tab we have the option of defining the default folders that files will be created in. Setting these defaults will not ensure other IT personnel will create files in the correct directories, but it will start them in the right place and catch those one-off backups people tend to leave in the SQL installation folders. </p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/7_install.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/7_install.png" alt="SQL Server 2008 R2 Setup - Data Directories" /></a><br />
	SQL Server 2008 R2 Setup &#8211; Data Directories
</div>
<p>Continuing on through the next few screens, we should finally arrive at the &#8220;Ready to Install&#8221; screen. Pressing the &#8220;Install&#8221; button grants us one free coffee break, after which we will continue on with the initial configuration.</p>
<p>(insert intermission music here)</p>
<h2>SQL Server Configuration</h2>
<p>After installation of the software, there are still a few steps before we are done. Before continuing, let&#8217;s do a reboot and then ensure all of our services started correctly.</p>
<p>The SQL Server Configuration Manager is available from the Start Menu (Start -&gt; All Programs &gt; SQL Server 2008 R2 &gt; Configuration Tools &gt; SQL Server Configuration Manager).</p>
<p>Verify that the SQL Server service is set to start automatically and verify that the SQL Agent process is set the way we want it. If the Agent service is not correct, right click it and use the Properties dialog to set the startup to the appropriate value. </p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/0_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/0_config.png" alt="SQL Server 2008 R2 Setup - SQL Server Configuration" /></a><br />
	SQL Server 2008 R2 Setup &#8211; SQL Server Configuration
</div>
<div class="hint">
	The SQL Server Browser service is what responds to tools like SSMS when they are browsing for available services on the intranet. Depending on your environment you can choose to leave this disabled (more secure) or you can use the properties dialog to set the service to startup automatically on boot.
</div>
<p>Next we verify that the network configuration is set correctly. Since we intend to connect to the server from a remote client, we need to ensure that the TCP/IP option is enabled by right-clicking and entering the properties dialog.</p>
<div class="screenshot">
	<a href="http://tiernok.com/LTDBlog/FirstSQL/orig/1_config.png" title="View Fullsize" target="_blank"><img src="http://tiernok.com/LTDBlog/FirstSQL/1_config.png" alt="SQL Server 2008 R2 Setup - SQL Server Configuration" /></a><br />
	SQL Server 2008 R2 Setup &#8211; SQL Server Configuration
</div>
<div class="mylab">
Oddly enough my TCP/IP setting was already enabled. Is it me or do they keep flipping the defaults back and forth for this setting in each major version?
</div>
<p>If we have made any configuration changes in the past section we will want to do one last reboot. The SQL 2008 R2 installer did not ask for a reboot, but before we start working with the server we want to make sure  that the next reboot (when a real server would be in service) will not come with any surprises.</p>
<ol style="margin-left: 3em">
<li>Pin the &#8220;SQL Server Configuration Manager&#8221; to the Taskbar</li>
<li>Open SQL Server Management Studio (SSMS) and let it go through it&#8217;s first time initialization</li>
<li>Verify that you can connect to the local server with the sa account in SSMS</li>
<li>Pin SSMS to the taskbar</li>
<li>Open SSMS on your Host system and verify you can connect to the server (depending on your VM network settings of course)</li>
<li>Record the new NT user and sa passwords in your password safe (I like <a href="http://keepass.info/" title="Visit the Keepass site" target="_blank">Keepass</a>)</li>
</ol>
<p></p>
<h2>Additional Tasks</h2>
<p>We still have a few more tasks to complete before we can call this system ready, though I won&#8217;t be walking you through the rest of the way until a later post.</p>
<p>Once we have the server set up this far, it&#8217;s a good idea to go ahead and start setting up some of the internals, such as Database Mail and some of the Alerts. While these may be less useful on a test instance, it is good to build a habit of setting them up as part of a new instance. We also want to take this opportunity to reduce the amount of RAM assigned to SQL Server and set up our first backup schedule for our system databases.</p>
<p>While this seemed like a fairly straight-forward Next, Next, Next, Done installation, there was some thought put into where I was going to put files, memory sizing, etc. I highly encourage you to check out <a href="http://www.straightpathsql.com/archives/tag/installation/" target="_blank">this article series</a> for a more extensive set of pre-installation questions and thoughts.</p>
<p>In later weeks we will be working on the creation of a Domain Controller and Domain accounts, but afterward we will be coming back to this system and exploring other setup options, maintenance, and administrative activities.</p>
<p><label>Additional Articles:</label><a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a></p>
<style type="text/css">
.mylab, .hint{
   margin: .5em 2em;
   padding: 1em 1em 1em 90px;
}
.mylab{
   border: 2px solid #CCEECC;
   background-color: #DDFFDD;
   background-image: url(http://tiernok.com/LTDBlog/mylab.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.hint{
   border: 2px solid #EEEECC;
   background-color: #FFFFDD;
   background-image: url(http://tiernok.com/LTDBlog/tip.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.screenshot{
   text-align: center;
   font-size: .8em;
   margin-bottom: 1em;
}
.acc_header{ position: relative; }
.acc_header label{ float: left; width: 150px; font-weight: bold;}
.acc_header br{  clear: left; }
.acc_header .diff{ margin-top: 3px; }
</style>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/dbadmin/virtual-lab-creating-a-basic-sql-2008-r2/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		</item>
		<item>
		<title>Building the Virtual Lab: VMWare and MS Windows 2008 R2</title>
		<link>/index.php/sysadmins/os/building-the-virtual-lab-vmware-and-2008/</link>
		<comments>/index.php/sysadmins/os/building-the-virtual-lab-vmware-and-2008/#comments</comments>
		<pubDate>Tue, 11 May 2010 12:41:54 +0000</pubDate>
		<dc:creator><![CDATA[Eli Weinstock-Herman (tarwn)]]></dc:creator>
				<category><![CDATA[2008 Server]]></category>
		<category><![CDATA[Operating Systems]]></category>
		<category><![CDATA[Windows]]></category>
		<category><![CDATA[installation]]></category>
		<category><![CDATA[virtual lab]]></category>
		<category><![CDATA[vmware]]></category>
		<category><![CDATA[windows server 2008 r2]]></category>

		<guid isPermaLink="false">/index.php/2010/05/building-the-virtual-lab-vmware-and-2008/</guid>
		<description><![CDATA[Asking me what I do for living could net you different answers, depending on what day you ask. Over the years, and through the course of several jobs, I have had a wide range of responsibilities that often stretched well beyond my current organizational&#8230;]]></description>
				<content:encoded><![CDATA[<p>Asking me what I do for living could net you different answers, depending on what day you ask. Over the years, and through the course of several jobs, I have had a wide range of responsibilities that often stretched well beyond my current organizational role. I like to call these opportunities.</p>
<p>Recently I was considering the idea of building a virtual lab, as I&#8217;ve been worried that some of the varied experiences or skills I&#8217;ve picked up would rust away. While in Wisconsin visiting Ted Krueger (<a href="http://twitter.com/onpnt" title="Ted on Twitter">twitter</a> | <a href="/index.php/All/?disp=authdir&amp;author=68" title="Ted's blogs here">blog</a>) for <a href="/index.php/ITProfessionals/EthicsIT/my-singing-not-so-good" title="SQL Saturday Chicago article">SQL Saturday Chicago</a>, I realized that the lab could serve two purposes. I could use it to not only regain or sharpen aging skills, but I could also use it to start blogging on more technical matters. Don&#8217;t get me wrong, I love process and personal improvement topics, but I need my tech fix too.</p>
<p>So here we are. If you don&#8217;t already have a virtual lab at work or home then I invite you to follow along with me as I build one. Each blog entry will have a general level of difficulty, from basic installation <img src="http://tiernok.com/LTDBlog/dr_beanie.png" alt="propeller beanie" /> to advanced administration <img src="http://tiernok.com/LTDBlog/dr_wizard.png" alt="wizard's hat" />. As the lab grows we will be installing a wide number of systems then later configuring and tuning them to meet different circumstances and needs. </p>
<p>Lets get started.</p>
<style>
.mylab, .hint{
   margin: .5em 2em;
   padding: 1em 1em 1em 90px;
}
.mylab{
   border: 2px solid #CCEECC;
   background-color: #DDFFDD;
   background-image: url(http://tiernok.com/LTDBlog/mylab.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.hint{
   border: 2px solid #EEEECC;
   background-color: #FFFFDD;
   background-image: url(http://tiernok.com/LTDBlog/tip.png);
   background-repeat: no-repeat;
   background-position: 20px 20px;
}
.acc_header{ position: relative; }
.acc_header label{ float: left; width: 150px; font-weight: bold;}
.acc_header br{  clear: left; }
.acc_header .diff{ margin-top: 3px; }
</style>
<div class="acc_header">
<h2>Virtual Lab: Building the First Windows 2008 R2 Virtual Machine</h2>
<p>The purpose of today&#8217;s article is to create a basic windows virtual machine that can serve as a template for later virtual machines. Having a basic image or set of images on hand can dramatically speed up production and non-production roll-outs as well as ensure standardization of systems across your environment.<br />
<br />
<label>Technical Area:</label> Accidental Systems Administrator<br />
<label class="diff">Level of Difficulty: </label><img src="http://tiernok.com/LTDBlog/dr_basic.png" alt="Basic Difficulty" /><br />
<label>Additional Articles:</label><a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a></p>
</div>
<h2>Building the Lab Environment</h2>
<p>Building your own lab can be both fun and a learning experience. A virtual lab provides you a safe place to try new technologies and configurations. When you create a really horrendous set of configurations in your lab, your halls are going to be remarkably free of end users with torches and pitchforks. The risks you should never take in production environments, even production development systems, are fair game here. But first we have to build it.</p>
<h3>Environment</h3>
<p>First we should determine what type of environment we want to run and what types of technologies or systems we would like to play with. Some of you will be planning no working with just development software and/or database servers, some will be want to create a virtual business environment (DC, Exchange, AD, etc), and some will even want to play with a mixed operating system setup. Identifying some general requirements will also help when your lab (or the market) grows past the current list of technologies you want to try.</p>
<p>Here is a sample set of questions you should consider:</p>
<ol style="margin-left: 2em;">
<li>What OS&#8217;s are you intending to run? Desktop, Server, Windows, Unix, Linux ?</li>
<li>What major software packages or technical areas are you intended to explore in the lab?</li>
<li>Will any of the systems be used for active development (ie, results will be ported directly to production)?</li>
<li>Will any of the systems potentially move to production?</li>
<li>Will any of the systems need to travel with you (between sites, work and home, or to conferences)?</li>
<li>Will your systems need to run only some of the time, all the time, or a mix?</li>
<li>Will they require network access to the outside world?</li>
<li>Will the outside world be allowed to access your lab resources?</li>
<li>Will you need a private network in your lab or can they coexist on your existing network?</li>
<li>Will there be interdependencies? (for instance, Server A is running DNS and Active Directory and has to be on for Server B to work properly)</li>
</ol>
<div class="mylab">
And some of the answers for my lab:</p>
<ul>
<li>My lab will be running multiple Windows servers and 1-2 linux systems</li>
<li>Software packages: SQL Server (of course), TFS, Active Directory, Sharepoint, potentially a DC, possibly Exchange, &#8230;pretty much anything in Microsoft&#8217;s catalog or that comes in as a user request is fair game</li>
<li>None of these systems will go to a production environment or be accessed by active development environments</li>
<li>The only environments that may need to travel are the SQL Server ones</li>
<li>None of the systems will need to run all of the time</li>
<li>The lab systems will be on a private network with limited external access</li>
</ul>
</div>
<h3>Platform Selection</h3>
<p>Once we have an idea what we our lab will be used for, we need to determine what type of platform to use. If this is a home lab or you have limited space for equipment, you will probably want to go with a virtualization platform. Using a virtualization platform allows us to have a smaller physical (and electrical) footprint and multi-purpose our equipment, since many of our test servers will not need to be running when we aren&#8217;t directly using them. Virtualization also allows us to move systems to upgraded hosts if we later find ourselves having performance problems.</p>
<p>The hardware you use will depend on the types of answers you provided to the questions above. Using an old desktop might be a acceptable solution or you may need to incorporate higher end systems or even spare servers. My last setup (2007-2009) used an off-the-shelf Dell Precision work station as the host without any extra equipment or over-the-top upgrades. The system performed well as a low budget SQL Server and Windows server platform. On the other hand my new environment will need to support a far wider range and number of systems, so it will require higher performance hardware.</p>
<div class="mylab">
	Here is the current hardware setup for the lab:</p>
<ul>
<li>CPU: A Intel i7 920 quad-core</li>
<li>Memory: 10 GB of DDR3 RAM w/ room to upgrade up to 24GB</li>
<li>Storage #1: Raid 10 Array &#8211; (4) SATA2 7200RPM 500GB drives, mixed manufacturers</li>
<li>Storage #2: <a href="http://www.amazon.com/Vantec-NST-360SU-BK-3-5-Inch-External-Enclosure/dp/B000EDKO04/ref=sr_1_1?ie=UTF8&amp;s=electronics&amp;qid=1272804217&amp;sr=8-1" title="View at Amazon">Vantec external enclosure</a> w/ 500GB SATA2 drive (USB2/eSata) &#8211; raw storage for some backups, MSDN images, and other purchased software</li>
<li>Storage #3: <a href="http://www.amazon.com/TWO-BAY-SATA-DOCKING-STATION/dp/B001UHQFVA/ref=sr_1_5?ie=UTF8&amp;s=electronics&amp;qid=1272804276&amp;sr=1-5" title="View at amazon">Bytecc two-bay docking station</a>  (USB2/eSata) &#8211; more disk (will be critical in a later article)</li>
</ul>
<p>	I have selected VMWare for my virtualization platform. There are a number of reasons for this (for instance, Microsoft hard-blocking virtual server installations on Windows 7) and I actually would have preferred MS Virtual Server, but such is life.
</p></div>
<h2>Installing our First Virtual Server</h2>
<p>From this point forward we will be working from the comfort of my home lab, so examples will be based on VMWare Server 2.1 and I will point out versions for other software as it is introduced. The purpose of this first virtual machine is to serve as a template for later machines, allowing me to build out one image that with a standard base configuration, installs all common services, then apply all the outstanding Windows updates. Though I will be using the term &#8216;template&#8217; in the article, this shouldn&#8217;t be confused with the template capability in VMware&#8217;s vSphere. </p>
<div class="hint">
In a production environment it is extremely helpful to have a basic server image already pre-configured and up to date. Not only does it provide a faster alternative to building each server from scratch, but it ensures that each server goes out with all of the required services and configurations and does so without adding a checklist to your process. Not that I am a <a href="/index.php/ITProfessionals/ITServiceManagement/there-is-never-time-for-part-3" title="Or maybe I am">process improvement fan</a> or anything.
</div>
<p>Though the software is different, many of the concepts will be similar if your lab is going to be based on Microsoft Virtual Server 2005 and I have successfully followed almost the same exact steps through Virtual Server in the past.</p>
<h3>Build the Server</h3>
<p>First we need to build our virtual machine. Opening the VMWare Server Host and logging in with administrative credentials, we are presented with a dashboard view of our system.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vmware_beginning.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vmware_beginning.png" title="VMWare, Freshly Installed" /></a><br />
	VMWare, Freshly Installed
	</div>
<p>Clicking the &#8220;Virtual Machine&#8221; menu provides an option to &#8220;Create Virtual Machine&#8221; and a wizard to walk us through the creation of our virtual machine.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vmware_create_vm.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vmware_create_vm.png" title="VMWare Menu, Create VM" /></a><br />
	Create a new VM
	</div>
<p>While it isn&#8217;t critical to pick a good name at this point, it couldn&#8217;t hurt either. Later as we create servers for specific purposes the VM names will reflect the actual names of their servers.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vm_step1.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vm_step1.png" title="Creating a new VM, Step 1" /></a><br />
	New VM &#8211; Provide a Name
	</div>
<p>In my case I intend to use Windows 2008 R2 as my main server environment, so this basic image will reflect that in it&#8217;s name and I will choose the Windows 2008 option from the operating systems tab. Before choosing the 64-bit image I made sure to run the <a href="http://downloads.vmware.com/d/info/datacenter_downloads/vmware_server/2_0#drivers_tools" title="Available from VMWare Server Tools section">64-bit compatibility check</a> offered by VMWare to ensure I could run a 64-bit guest on my host. If you are using Virtual Server 2005 then you will be limited to 32-bit guests so be sue you buy/download the correct versions.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vm_step2.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vm_step2.png" title="Creating a new VM, Step 2" /></a><br />
	New VM &#8211; OS Selection
	</div>
<p>For this first server I am going to allocate 4GB of RAM for use during the installation process. When making later copies of the system we will tune these values accordingly. As I intend to use these systems in a lab environment and may need the images to be portable to another single core system, I&#8217;m going to select the 1 CPU option. For later articles we may create 2- or 4-CPU options, but for most of our non-production needs a 1-CPU system will be sufficient. While technically it would be possible to &#8220;tune&#8221; the CPU setting at a later time, since we really only care about the hard-drive file at this point, changing CPU architectures on a system after installation ranges from tricky to absurdly-painful-with-no-hope-of-working.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vm_step3.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vm_step3.png" title="Creating a new VM, Step 2" /></a><br />
	New VM &#8211; RAM and CPU Settings
	</div>
<p>The final lasting decision (though not the last step) is how large we want to make the virtual drive and whether we want to allocate the space ahead of time or use a growth model. In my last environment I pre-allocated space for my base windows installation and then attached or created secondary drives for the installed applications. In this case, Microsoft is suggesting <a href="http://www.microsoft.com/windowsserver2008/en/us/system-requirements.aspx" title="Windows 2008 R2 Requirements">a minimum of 32GB of space</a> and, while I don&#8217;t want to give up the space, I&#8217;ve decided to use pre-allocation again to simplify the process.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vm_step4.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vm_step4.png" title="Creating a new VM, Step 3" /></a><br />
	New VM &#8211; Drive Settings
	</div>
<p>The final options, optical drive access and network method, are only going to be used for this image during the Windows installation process. Later copies will again have values assigned based on the project or technology that&#8217;s being installed. For the purposes of the installation we will use an ISO file for the optical drive and bridged networking.</p>
<div class="hint">When you install VMWare initially it will ask for a folder for your standard store (default is &#8220;C:Virtual Machines&#8221; on Windows). ISOs placed in this folder will be available for mounting in VMWare or you can create a new store that points to a folder elsewhere. Having a dedicated drive for software storage, I created an &#8216;MSDN Library&#8217; store and pointed it to that location.</div>
<div class="hint">
VMWare Gotchas:<br />
Firefox 3.6 is documented as not working with the console viewer right now, so you are going to have to downgrade or switch to IE. 3-3.5 also had issue at one point but there are either fixes or workarounds for this.
</div>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vm_setup_done.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vm_setup_done.png" title="Setup is Complete" /></a><br />
	VM Setup Complete
	</div>
<h3>Install the OS</h3>
<p>We are now ready to turn our machine on for the first time and install Windows. This part is actually fairly boring, which is yet another reason that we want to limit how many times we have to do it.</p>
<div class="mylab">
This is the point I ran into an issue with VMWare&#8217;s console. VMWare continued to present me with a black screen when I opened the console. I believe the change that fixed this issue was setting the DNS address on the vmnet1 network connection, but it could just as easily have been the firewall being turned off when VMWare started or the couple changes I made to IE&#8217;s trusted sites. An excellent, practical example of why you should always make one change at a time and write down what you changed when you are troubleshooting a systems problem.
</div>
<p>The first decision the installer requires is selection between the various versions of Windows. Based on the options available, the trade-offs outlined in <a href="http://www.microsoft.com/windowsserver2008/en/us/r2-editions-overview.aspx" title="See the feature comparison">the feature comparison</a>, and the fact that I have already written down my MSDN Enterprise key, I will be installing Enterprise edition. I&#8217;m not actually sure how long the installation took, I wandered off and found something else to do for a while (Peanut butter jelly time, peanut b&#8230;oh). I&#8217;ve installed windows a few more times than your average developer, so my bet is on 39 minutes. <img src="https://s.w.org/images/core/emoji/2/72x72/1f609.png" alt="ðŸ˜‰" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<div class="hint">
The default Windows password policy is probably going to annoy you if you haven&#8217;t run into it before. It will not tell you what the policy is when your password fails and the policy itself is well-defined. In a production environment one of our first steps would likely be to change it to meet our business needs or current setup.</p>
<p>Official policy information can be found <a href="http://technet.microsoft.com/en-us/library/cc264456.aspx" title="Windows 2008 Password Policy Settings">here</a>
</div>
<p>After the initial login there are a couple key things we should do prior to starting the update cycle. First we are going to install the VMWare tools to make the interface easier to use and second, we are going to increase the screen resolution.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vmtools_host.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vmtools_host.png" title="Host Server - Installing VMWare Tools" /></a><br />
	Installing VMWare tools &#8211; Server OS View
	</div>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/vmtools_guest.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/vmtools_guest.png" title="Guest Server - Installing VMWare Tools" /></a><br />
	Installing VMWare tools &#8211; Guest OS View
	</div>
<p>After these two tasks we will begin by applying service packs (none for Windows 2008 R2 at this time) and then windows updates. Windows 2008 offers a handy dashboard to manage these tasks on the first install and, being lazy, I&#8217;m not going to turn it down.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/setup_dashboard.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/setup_dashboard.png" title="Server Dashboard" /></a><br />
	Windows Server &#8220;Configuration&#8221; Dashboard
	</div>
<div class="hint">
If you haven&#8217;t worked with server much in the past you may be surprised by a strange dialog when you attempt to restart your system. When you shutdown or reboot a server it asks you to provide a reason and note, I advise that you get in the habit of always typing up a short note on why you are shutting down or rebooting. It only takes a few seconds and one day it&#8217;s going to save you hours because these notes are entered into the event log before the system shuts down.
</div>
<p>Next I am going to glance through the features and see if there any others that I would want installed on all of my servers. In this case the only one I can see if SNMP, so a quick installation and configuration and we are ready to move on.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/snmp_setup.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/snmp_setup.png" title="Server Features - Configuring SNMP" /></a><br />
	Server Features &#8211; Configuring SNMP
	</div>
<div class="hint">
Installing SNMP services as part of your basic image gives you the opportunity to ensure you have consistent coverage and passwords across all your systems, which in turn makes deployment easier when it comes time to point your network or systems monitoring software at the new server.
</div>
<p>The step we might normally move on to in a production or corporate environment is installation of base antivirus, client license, or and inventory management software client. This is an excellent time to install software packages that are part of your standard or that can be pre-installed and updated later. Another consideration would be whether you need to set up VNC, RDP, or another remoting technology.</p>
<p>The last item on my personal setup list is to assign a background image and set up BGInfo. Having a common background and system information on every server is extremely handy and helps show critical information at a glance (like disk usage or IP addresses). An easy solution is a utility called BGInfofrom SysInternals. BGInfo is <a href="http://technet.microsoft.com/en-us/sysinternals/bb897557.aspx" title="BGInfo at Technet">a free download</a> and there are many examples and articles available on the internet for setting it up.</p>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/bginfo_background.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/bginfo_background.png" title="Server Dashboard" /></a><br />
	Windows Server &#8220;Configuration&#8221; Dashboard
	</div>
<div class="mylab">
Once upon a time I had scripts and standard layouts to add other interesting information to the background (such as uptime counters and such), but that can wait for another day. For this initial example I have grouped the information in a way that is meaningful for me, but haven&#8217;t done anything fancy.
</div>
<div class="hint">
If you run into difficulties on 2008 R2 with permissions then follow the instructions posted near the bottom by prrawls here: <a href="http://forum.sysinternals.com/printer_friendly_posts.asp?TID=17427" title="View the post about BGInfo on 2008 R2">SysInternals Forum Post</a>
</div>
<div style="text-align: center; font-size: .8em; margin-bottom: 1em;">
	<a href="http://www.tiernok.com/LTDBlog/labsetup/orig/done.png" target="_new"><img src="http://www.tiernok.com/LTDBlog/labsetup/done.png" title="Last Shutdown of the Basic Image" /></a><br />
	Last Shutdown of the Basic Image
	</div>
<h2>Basic Image Done</h2>
<p>The basic server is complete and ready to serve as the foundation for the rest of the lab. In coming weeks we will use this basic image to create more systems, such as a basic database server and a domain controller.</p>
<p>Additional Links:<br />
<a href="/index.php/DataMgmt/DBAdmin/MSSQLServerAdmin/virtual-lab-creating-a-basic-sql-2008-r2" title="Head to the Basic SQL 2008 R2 Install">Virtual Lab: Basic SQL 2008 R2 Virtual Machine</a><br />
<a href="http://wiki.lessthandot.com/index.php/Virtual_Lab" title="View the wiki entry">Virtual Lab entry on the LTD Wiki</a></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/sysadmins/os/building-the-virtual-lab-vmware-and-2008/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		</item>
	</channel>
</rss>
