<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>cdc &#8211; LessthanDot</title>
	<atom:link href="/index.php/tag/cdc/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description>A Technical Community for IT Professionals</description>
	<lastBuildDate>Sat, 09 Mar 2019 12:50:36 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.6.1</generator>
	<item>
		<title>My SQL Server Days slides and demos</title>
		<link>/index.php/datamgmt/dbprogramming/mssqlserver/my-sql-server-days-slides/</link>
		<comments>/index.php/datamgmt/dbprogramming/mssqlserver/my-sql-server-days-slides/#respond</comments>
		<pubDate>Mon, 03 Dec 2012 10:16:00 +0000</pubDate>
		<dc:creator><![CDATA[Koen Verbeeck]]></dc:creator>
				<category><![CDATA[Business Intelligence]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[SSIS]]></category>
		<category><![CDATA[cdc]]></category>
		<category><![CDATA[change data capture]]></category>
		<category><![CDATA[sql server days]]></category>
		<category><![CDATA[ssis]]></category>

		<guid isPermaLink="false">/index.php/2012/12/my-sql-server-days-slides/</guid>
		<description><![CDATA[Two weeks ago I had the pleasure of giving a session on the Belgian SQL Server Days. My session was about SSIS and the new features of Change Data Capture (CDC). With new features I mean the new SSIS 2012 components made by Attunity who simplify the man&#8230;]]></description>
				<content:encoded><![CDATA[<p class="MsoNormal" style="text-align: justify;"><span lang="EN-US">Two weeks ago I had the pleasure of giving a session on the Belgian <a href="http://www.sqlserverdays.be/2012/" target="_blank">SQL Server Days</a>. My session was about SSIS and the new features of Change Data Capture (CDC). With new features I mean the new SSIS 2012 components made by Attunity who simplify the manageability and usability of SSIS packages working with CDC, because technically CDC hasn’t changed since its introduction in SQL Server 2008.</span></p>
<p class="MsoNormal" style="text-align: justify;"><span lang="EN-US">The session went quite well (still waiting on attendee feedback), aside from some microphone problems who forced me to hold a replacement microphone in my left hand – quite difficult to do demos and use Zoomit – and a transaction that got stuck in SSMS and was stubborn enough not to roll back quickly. But these little setbacks didn’t get in the way of the message of the session and they only made myself stronger as a speaker.</span></p>
<p class="MsoNormal" style="text-align: justify;"><span lang="EN-US">The Belgian SQL Server User Group, <a href="http://sqlug.be/" target="_blank">SQLUG.be</a>, will make all slides available for the attendees, but for those who couldn’t attend the event I decided to put them online anyway. The slides can be downloaded from <a href="http://www.slideshare.net/KoenVerbeeck/sqlserverdays2012ssiscdc" target="_blank">SlideShare</a> and the demo material can be found <a href="/media/users/koenverbeeck/SQLServerDays2012_SlidesDemos/SSIS-CDC Demo.zip?mtime=1354310401">here</a>. Basically the demos consist of the following:</span></p>
<p class="MsoNormal" style="text-align: justify;"><span lang="EN-US"> </span></p>
<ol>
<li><span style="text-align: justify; text-indent: -18pt;" lang="EN-US">Set-up scripts creating some databases and transferring data from AdventureWorksDW2012.</span></li>
<li><span style="text-indent: -18pt;" lang="EN-US">A T-SQL script showing CDC functionality as it was introduced in SQL Server 2008.</span></li>
<li><span style="text-indent: -18pt;" lang="EN-US">A SSIS package for the initial load.</span></li>
<li><span style="text-indent: -18pt;" lang="EN-US">A SSIS package for the incremental load.</span></li>
<li><span style="text-indent: -18pt;" lang="EN-US">A SSIS package for the incremental load but with the addition of the __$reprocessing indicator.</span></li>
</ol>
<p><!--[if !supportLists]--></p>
<p class="MsoNormal" style="text-align: justify;"><span lang="EN-US">If you have questions about this material, feel free to ask them in the comments.</span></p>
<p class="MsoNormal" style="text-align: justify;"><span lang="EN-US">For more information on SSIS and CDC, check out the resources I listed at the end of the presentation.</span></p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/dbprogramming/mssqlserver/my-sql-server-days-slides/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Change Data Capture rundown 100 (setup)</title>
		<link>/index.php/datamgmt/datadesign/change-data-capture-sql-server-08/</link>
		<comments>/index.php/datamgmt/datadesign/change-data-capture-sql-server-08/#comments</comments>
		<pubDate>Mon, 12 Jul 2010 21:46:57 +0000</pubDate>
		<dc:creator><![CDATA[Ted Krueger (onpnt)]]></dc:creator>
				<category><![CDATA[Data Modelling and Design]]></category>
		<category><![CDATA[Database Administration]]></category>
		<category><![CDATA[Database Programming]]></category>
		<category><![CDATA[Microsoft SQL Server]]></category>
		<category><![CDATA[Microsoft SQL Server Admin]]></category>
		<category><![CDATA[cdc]]></category>
		<category><![CDATA[change data capture]]></category>
		<category><![CDATA[new features]]></category>
		<category><![CDATA[sql server 2008]]></category>
		<category><![CDATA[tracking data]]></category>

		<guid isPermaLink="false">/index.php/2010/07/change-data-capture-sql-server-08/</guid>
		<description><![CDATA[Many times as a database administrator, you're going to find yourself being asked, "When did this change?"  In fact, it is a common question that can come in so often, if you don't have the answer readily available, the business will quickly become frustrated with you.  This can have an adverse effect on your reputation of being able to manage the databases in question.]]></description>
				<content:encoded><![CDATA[<p>Many times as a database administrator, you&#8217;re going to find yourself being asked, &#8220;When did this change?&#8221;  In fact, it is a common question that can come in so often, if you don&#8217;t have the answer readily available, the business will quickly become frustrated with you.  This can have an adverse effect on your reputation of being able to manage the databases in question.  </p>
<p>Some databases (and software packages) simply do not track changes in the database.  The job of the system is to do what the business wants and that typically does not initially include data tracking.  Logging takes time and precious performance away from the systems.  That performance hit can make a software vendor look bad.  Is it worth the performance cost and cost to develop the tracking solution to them?  I think we know the answer to that question in most cases.  I&#8217;m on their side in the case of where you put your money for the product you provide to a point.  </p>
<p>Putting all of the bickering with why or why not vendors add data tracking to overall system features aside, let&#8217;s look at how we can manage data tracking with SQL Server and leave the vendor to do what the business asks of them; provide the solution to keep the business running.</p>
<div class="image_block"><img src="/wp-content/uploads/blogs/DataMgmt/cdc.gif" alt="" title="" width="384" height="304" /></div>
<p>In SQL Server 2008, Change Data Capture was introduced.  Oh, that sounds interesting and something you can use!  Well, there is a cost just like most features have cost that go with them.  Remember the performance issue with the vendor doing data tracking?  It comes with CDC as well.  As with everything, performance can take a back seat to providing the business with what they need, so we&#8217;re going to show you how to set CDC up as a base data tracking process in your databases.</p>
<p><strong>Setup CDC</strong></p>
<p>
<div class="image_block"><img src="/wp-content/uploads/blogs/DataMgmt/cdc_2.gif" alt="" title="" width="162" height="154" align="left" /></div>
<p>We are going to go through a step-by-step to get CDC going without falling into the deep end and then discuss the setup and overall process after accomplishing the setup.</p>
<p></p>
<p>To ensure CDC is not setup, we can check sys.databases and the is_cdc_enabled column.  You will see either a 1 for enabled or 0 for disabled.  </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> database_id ,
&nbsp; &nbsp; &nbsp; &nbsp; name ,
&nbsp; &nbsp; &nbsp; &nbsp; is_cdc_enabled
<span class="kw1">FROM</span> sys.<span class="me1">databases</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT database_id ,
        name ,
        is_cdc_enabled
FROM sys.databases</pre></div></div>

<p>Security for CDC is handled differently at each level from the database to the tables you enlist.  You must first enable CDC for the database itself.  In order to accomplish this you must be in the sysadmin server role.  Once enabled on the database level, any database user that is in the db_owner database role can then enable tables in the database for CDC.</p>
<p>If is_cdc_enabled is set to 0, use sys.sp_cdc_enable_db to enable CDC.  sys.sp_cdc_enable_db is run in the context of the database you wish to enable.  So, if you were working in AdventureWorks and wanted CDC enabled, you would want to use a USE AdventureWorks statement to move into the context first.</p>
<p>Below is something you could run as a check and enable task:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">If</span> <span class="br0">&#40;</span><span class="kw1">select</span> is_cdc_enabled <span class="kw1">from</span> sys.<span class="me1">databases</span> <span class="kw1">where</span> <span class="br0">&#91;</span>name<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">'AdventureWorks'</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="nu0">0</span>
&nbsp;<span class="kw1">begin</span>
&nbsp; &nbsp; <span class="kw1">Exec</span> sys.<span class="me1">sp_cdc_enable_db</span>
&nbsp; &nbsp; <span class="kw1">print</span> <span class="st0">'CDC Enabled'</span>
&nbsp;<span class="kw1">end</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">If (select is_cdc_enabled from sys.databases where [name] = 'AdventureWorks') = 0
 begin
	Exec sys.sp_cdc_enable_db
	print 'CDC Enabled'
 end</pre></div></div>

<p>If you run into a failure to authenticate:<br />
</p>
<blockquote><p>Msg 22830, Level 16, State 1, Procedure sp_cdc_enable_db_internal, Line 186<br />
Could not update the metadata that indicates database AdventureWorks is enabled for Change Data Capture. The failure occurred when executing the command &#8216;SetCDCTracked(Value = 1)&#8217;. The error returned was 15404: &#8216;Could not obtain information about Windows NT group/user &#8216;PMHCtkrueger&#8217;, error code 0x54b.&#8217;. Use the action and error to determine the cause of the failure and resubmit the request.<br />
Msg 266, Level 16, State 2, Procedure sp_cdc_enable_db_internal, Line 0<br />
Transaction count after EXECUTE indicates a mismatching number of BEGIN and COMMIT statements. Previous count = 0, current count = 1.<br />
Msg 266, Level 16, State 2, Procedure sp_cdc_enable_db, Line 0<br />
Transaction count after EXECUTE indicates a mismatching number of BEGIN and COMMIT statements. Previous count = 0, current count = 1.</p></blockquote>
<p>It is due to a bad owner state.  You can fix this by running: </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> <span class="kw3">sp_changedbowner</span> <span class="st0">'sa'</span>,<span class="st0">'dbo'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec sp_changedbowner 'sa','dbo'</pre></div></div>

<p>Now that the database is enabled for CDC, we can move to enabling a table to start tracking change in the data.  </p>
<p><strong>Enabling a table</strong></p>
<p>CDC can track an entire table or specific columns in a table.  You can use the @captured_column_list parameter when executing sys.sp_cdc_enable_table to specify the columns.  If the parameter is left out or NULL, the entire table will be then tracked.  For performance reasons, design CDC for the table with great thought in capturing only what is needed.  </p>
<p><strong>CDC and Filegroups </strong></p>
<p>BOL best practice suggests putting the CDC tables (instances) into a designated filegroup.  I can see this benefiting performance and not affecting the tables under the CDC monitoring.  This does add a structure change to the database so plan this out as well.  Move the filegroup to a designated disk when possible.  IO is always an important consideration.  If IO becomes a problem later on, it is one of the harder to fix performance issues.  This is because it requires moving files while working on the disk, which entails downtime on the database.  </p>
<p>We will show the filegroup practice so let&#8217;s create a filegroup for our CDC instance.</p>
<p><strong>Create a filegroup </strong></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="de1"><pre class="de1"><span class="kw1">USE</span> master
GO
<span class="kw1">ALTER</span> <span class="kw1">DATABASE</span> AdventureWorks
<span class="kw1">ADD</span> FILEGROUP CDCDataStore;
GO
<span class="kw1">ALTER</span> <span class="kw1">DATABASE</span> AdventureWorks
<span class="kw1">ADD</span> <span class="kw1">FILE</span> 
<span class="br0">&#40;</span>
&nbsp; &nbsp; NAME <span class="sy0">=</span> CDCDataStore,
&nbsp; &nbsp; FILENAME <span class="sy0">=</span> <span class="st0">'C:Program FilesMicrosoft SQL ServerMSSQL10.MSSQLSERVERMSSQLDATACDCDataStore.ndf'</span>,
&nbsp; &nbsp; <span class="kw1">SIZE</span> <span class="sy0">=</span> 500MB,
&nbsp; &nbsp; MAXSIZE <span class="sy0">=</span> 1000MB,
&nbsp; &nbsp; FILEGROWTH <span class="sy0">=</span> 500MB
<span class="br0">&#41;</span>
<span class="kw1">TO</span> FILEGROUP CDCDataStore;
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">USE master
GO
ALTER DATABASE AdventureWorks
ADD FILEGROUP CDCDataStore;
GO
ALTER DATABASE AdventureWorks
ADD FILE 
(
    NAME = CDCDataStore,
    FILENAME = 'C:Program FilesMicrosoft SQL ServerMSSQL10.MSSQLSERVERMSSQLDATACDCDataStore.ndf',
    SIZE = 500MB,
    MAXSIZE = 1000MB,
    FILEGROWTH = 500MB
)
TO FILEGROUP CDCDataStore;
GO</pre></div></div>

<p>To enable CDC, we use sys.sp_cdc_enable_table as mentioned earlier.  </p>
<p>Run the following to enable CDC on the table Employee in the AdventureWorks database (the entire table will be monitored):</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">USE</span> AdventureWorks
GO
<span class="kw1">EXEC</span> sys.<span class="me1">sp_cdc_enable_table</span>
@source_schema <span class="sy0">=</span> N<span class="st0">'HumanResources'</span>,
@source_name &nbsp; <span class="sy0">=</span> N<span class="st0">'Employee'</span>,
@role_name &nbsp; &nbsp; <span class="sy0">=</span> N<span class="st0">'CDCRoles'</span>,
@<span class="kw2">filegroup_name</span> <span class="sy0">=</span> N<span class="st0">'CDCDataStore'</span>,
@supports_net_changes <span class="sy0">=</span> <span class="nu0">1</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">USE AdventureWorks
GO
EXEC sys.sp_cdc_enable_table
@source_schema = N'HumanResources',
@source_name   = N'Employee',
@role_name     = N'CDCRoles',
@filegroup_name = N'CDCDataStore',
@supports_net_changes = 1
GO</pre></div></div>

<blockquote><p><span class="MT_red">Note: cdc agents need to be running, so the SQL Server agent needs to be running.</span></p></blockquote>
<p>If SQL Agent is not running, you will receive errors when the cdc table enable procedure executes.  Since there are four of these agents, you will receive the error for each job creation attempt</p>
<blockquote><p>SQLServerAgent is not currently running so it cannot be notified of this action.<br />
SQLServerAgent is not currently running so it cannot be notified of this action.<br />
SQLServerAgent is not currently running so it cannot be notified of this action.<br />
SQLServerAgent is not currently running so it cannot be notified of this action.</p></blockquote>
<p>Once you execute the enabling table procedure, some table valued functions will be created. All and net.  These will be used to look into the instances of CDC.  What we need to know to look into the changes captured are the LSN we want to start with and end with.  </p>
<p>To obtain the latest and first LSN we can use sys.fn_cdc_getmax_lsn and min:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> sys.<span class="me1">fn_cdc_get_min_lsn</span><span class="br0">&#40;</span><span class="st0">'HumanResources_Employee'</span><span class="br0">&#41;</span>;
<span class="kw1">select</span> sys.<span class="me1">fn_cdc_get_max_lsn</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select sys.fn_cdc_get_min_lsn('HumanResources_Employee');
select sys.fn_cdc_get_max_lsn</pre></div></div>

</p>
<p><strong>Putting this to work to review CDC</strong></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @<span class="kw1">begin</span> <span class="kw1">binary</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>, @<span class="kw1">end</span> <span class="kw1">binary</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>;
<span class="kw1">set</span> @<span class="kw1">begin</span> <span class="sy0">=</span> sys.<span class="me1">fn_cdc_get_min_lsn</span><span class="br0">&#40;</span><span class="st0">'HumanResources_Employee'</span><span class="br0">&#41;</span>;
<span class="kw1">set</span> @<span class="kw1">end</span> <span class="sy0">=</span> sys.<span class="me1">fn_cdc_get_max_lsn</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;
<span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> cdc.<span class="me1">fn_cdc_get_all_changes_HumanResources_Employee</span><span class="br0">&#40;</span>@<span class="kw1">begin</span>,@<span class="kw1">end</span>,<span class="st0">'all update old'</span><span class="br0">&#41;</span>;
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @begin binary(10), @end binary(10);
set @begin = sys.fn_cdc_get_min_lsn('HumanResources_Employee');
set @end = sys.fn_cdc_get_max_lsn();
select * from cdc.fn_cdc_get_all_changes_HumanResources_Employee(@begin,@end,'all update old');
go</pre></div></div>

<p>Time to play with what we&#8217;ve setup on the Employee table.  Let&#8217;s break login id for employeeid 1</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> HumanResources.<span class="me1">Employee</span>
<span class="co1">--adventure-worksguy1 „²we'll take the first one</span>
<span class="kw1">update</span> HumanResources.<span class="me1">Employee</span>
<span class="kw1">set</span> LoginID <span class="sy0">=</span> <span class="st0">'adventure-worksguy'</span> 
<span class="kw1">where</span> EmployeeID <span class="sy0">=</span> <span class="nu0">1</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from HumanResources.Employee
--adventure-worksguy1 „²we'll take the first one
update HumanResources.Employee
set LoginID = 'adventure-worksguy' 
where EmployeeID = 1</pre></div></div>

<p>CDC should have captured the change of the string adventure-worksguy1 to adventure-worksguy</p>
<p>The nice thing here is CDC will look at the data and if nothing changes, even for a DML event, nothing will be written.  Only when a change is caught on the columns monitored will it be logged.  Again, we can see how this can be a performance factor so plan this well when implementing and use CDC in the appropriate places.</p>
<p>When we check CDC we can see we get representation of the data before and after logged</p>
<div class="image_block"><img src="/wp-content/uploads/blogs/DataMgmt/cdc_3.gif" alt="" title="" width="722" height="323" /></div>
<p>Now the performance hit is imaginable already.  </p>
<ol>
<li>Logging the before </li>
<li>Logging the after</li>
</ol>
<p>But we should really test that.  We&#8217;ll do that with simply logging the times from client statistics to show a rough estimation of performance between a CDC enabled data change and a non-CDC table enabled data change.</p>
<p>We already have CDC enabled, so executing the Update statement again, the cost is 29ms on average of 15 executions. </p>
<p>To disable CDC on a table we use the, sys.sp_cdc_disable_table procedure as shown below:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">exec</span> sys.<span class="me1">sp_cdc_disable_table</span> 
&nbsp; @source_schema <span class="sy0">=</span> <span class="st0">'HumanResources'</span>, 
&nbsp; @source_name <span class="sy0">=</span> <span class="st0">'Employee'</span>,
&nbsp; @capture_instance <span class="sy0">=</span> <span class="st0">'HumanResources_Employee'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">exec sys.sp_cdc_disable_table 
  @source_schema = 'HumanResources', 
  @source_name = 'Employee',
  @capture_instance = 'HumanResources_Employee'</pre></div></div>

<p>After disabling CDC table instance for Employee, we hit 11ms averages.</p>
<p>Putting that into perspective: almost triple the cost!</p>
<div class="image_block"><img src="/wp-content/uploads/blogs/DataMgmt/cdc_4.gif" alt="" title="" width="486" height="348" /></div>
<p>So CDC has an enormous cost with it, but in a database where logging is absent and development is out of our hands along with the question of, &#8220;Why and who changed this?&#8221; being asked often, CDC will be an option that should be brought into play to manage the change control of the database.</p>
<p>Some things that should be considered are ETL loads.  I would absolutely disable CDC on tables where you load large amounts of data and then enable it after the load is completed.  The time for loading could be double to triple after enabling tables for CDC.  That may not be acceptable in the activity of the table. </p>
<p>Now that we have gone over the setup of CDC, we will move into using SSIS and CDC together and methods where CDC really shows its value.  Look for that article soon.</p>
]]></content:encoded>
			<wfw:commentRss>/index.php/datamgmt/datadesign/change-data-capture-sql-server-08/feed/</wfw:commentRss>
		<slash:comments>4</slash:comments>
		</item>
	</channel>
</rss>
