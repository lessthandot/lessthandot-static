<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Dynamic PIVOT on multiple columns</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Dynamic PIVOT on multiple columns" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="In this blog post I want to discuss a problem I encounter frequently in SQL related forums - how to perform dynamic PIVOT involving multiple columns using pure T-SQL solution.With the introduction of PIVOT operator in SQL 2005, it became very easy t&hellip;" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Dynamic PIVOT on multiple columns Comments Feed" href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='From Eli&#8217;s Shelves: Books for IT Management' href='/index.php/itprofessionals/itservicemanagement/from-elis-shelves-it-management/' />
<link rel='next' title='Data Quality and Master Data Management with Microsoft SQL Server 2008 R2 book available as a free download' href='/index.php/datamgmt/datadesign/data-quality-and-master-data/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/" />
<link rel='shortlink' href='/?p=1193' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fdynamic-pivot-on-multiple-columns%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fdynamic-pivot-on-multiple-columns%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/datamgmt/datadesign/data-quality-and-master-data/" rel="next">Data Quality and Master Data Management with Microsoft SQL Server 2008 R2 book available as a free download</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/itprofessionals/itservicemanagement/from-elis-shelves-it-management/" rel="prev">From Eli&#8217;s Shelves: Books for IT Management</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/" class="post-title">Dynamic PIVOT on multiple columns</a></h1>
					<div class="post-byline">by <a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky" rel="author">Naomi Nosonovsky</a> on May 29, 2011 in category <a href="/index.php/category/datamgmt/datadesign/" rel="category tag">Data Modelling and Design</a>. Article views: 45,556 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&text=RT @LessThanDot Blog - Dynamic PIVOT on multiple columns by naomi" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&title=Dynamic PIVOT on multiple columns&source=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&title=Dynamic PIVOT on multiple columns" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&quote=Dynamic PIVOT on multiple columns" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&title=Dynamic PIVOT on multiple columns" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>In this blog post I want to discuss a problem I encounter frequently in SQL related forums &#8211; how to perform dynamic PIVOT involving multiple columns using pure T-SQL solution. In SQL Server Reporting Services this functionality can be easily achieved using <a href="http://msdn.microsoft.com/en-us/library/ms157334(SQL.100).aspx">Matrix template</a>.</p>
<p>With the introduction of PIVOT operator in SQL 2005, it became very easy to write queries that transform rows into columns. There are numerous articles on the Web as how to perform PIVOT and even dynamic PIVOT. However, most of these articles explain how to perform such queries for just one column. I want to expand the transformation for multiple columns.</p>
<p>The idea of a solution is quite simple &#8211; you need to generate the SQL dynamically. Since we want to use pivot on multiple columns, we need to use <a href="/index.php/DataMgmt/DataDesign/understanding-sql-server-2000-pivot">CASE based pivot</a>.</p>
<p>You need to keep in mind, that resulting query should have less than 1024 columns. You may build the check for number of columns into the query.</p>
<p>Now, every time I need to create a dynamic query, I need to know what is the final query I am going to arrive to. Having the idea in mind and printing the SQL command until I got it right helps to create the working query.</p>
<p>Let&#8217;s consider the first example based on the AdventureWorks SalesOrderHeader table.<br />
This code creates the table we&#8217;re going to transform &#8211; it gives us summary of orders and total due per each quarter:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="de1"><pre class="de1"><span class="kw1">USE</span> AdventureWorks 
&nbsp;
<span class="kw1">SELECT</span> &nbsp; <span class="kw2">DATEPART</span><span class="br0">&#40;</span>quarter,OrderDate<span class="br0">&#41;</span> <span class="kw1">AS</span> <span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw2">DATEPART</span><span class="br0">&#40;</span><span class="kw1">YEAR</span>,OrderDate<span class="br0">&#41;</span> &nbsp; &nbsp;<span class="kw1">AS</span> <span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw2">COUNT</span><span class="br0">&#40;</span>SalesOrderID<span class="br0">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">AS</span> <span class="br0">&#91;</span>Orders <span class="kw2">Count</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw2">SUM</span><span class="br0">&#40;</span>TotalDue<span class="br0">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">AS</span> <span class="br0">&#91;</span>Total Due<span class="br0">&#93;</span> 
<span class="kw1">INTO</span> &nbsp; &nbsp; #SalesSummary 
<span class="kw1">FROM</span> &nbsp; &nbsp; Sales.<span class="me1">SalesOrderHeader</span> 
<span class="kw1">GROUP</span> <span class="kw1">BY</span> <span class="kw2">DATEPART</span><span class="br0">&#40;</span>quarter,OrderDate<span class="br0">&#41;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="kw2">DATEPART</span><span class="br0">&#40;</span><span class="kw1">YEAR</span>,OrderDate<span class="br0">&#41;</span> 
&nbsp;
<span class="kw1">SELECT</span> &nbsp; <span class="sy0">*</span> 
<span class="kw1">FROM</span> &nbsp; &nbsp; #SalesSummary 
<span class="kw1">ORDER</span> <span class="kw1">BY</span> <span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">USE AdventureWorks 

SELECT   DATEPART(quarter,OrderDate) AS [Quarter], 
         DATEPART(YEAR,OrderDate)    AS [Year], 
         COUNT(SalesOrderID)         AS [Orders Count], 
         SUM(TotalDue)               AS [Total Due] 
INTO     #SalesSummary 
FROM     Sales.SalesOrderHeader 
GROUP BY DATEPART(quarter,OrderDate), 
         DATEPART(YEAR,OrderDate) 

SELECT   * 
FROM     #SalesSummary 
ORDER BY [Year], 
         [Quarter]</pre></div></div>

<p>The #SalesSummary table lists count of orders and total due for each quarter and year.</p>
<p><center></p>
<div class="tables">
<table border="1" cellpadding ="5" cellspacing = "5">
<caption style="color:blue;font-weight:bold">Quarterly Orders Summary</caption>
<tr>
<th>Quarter</th>
<th>Year</th>
<th>Orders Count</th>
<th>Total Due</th>
</tr>
<tr>
<td align="right" style="width: 20%">3</td>
<td align="right" style="width: 20%">2001</td>
<td align="right" style="width: 20%">	621</td>
<td align="right" style="width: 20%">	$5,850,932.9483</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">	2001</td>
<td align="right">	758</td>
<td align="right">	$8,476,619.278</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">	2002</td>
<td align="right">	741</td>
<td align="right">	$7,379,686.3091</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">	2002</td>
<td align="right">	825</td>
<td align="right">	$8,210,285.1655</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">	2002</td>
<td align="right">	1054</td>
<td align="right">	$13,458,206.13</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">	2002</td>
<td align="right">	1072</td>
<td align="right">	$10,827,327.4904</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">	2003</td>
<td align="right">	1091</td>
<td align="right">	$8,550,831.8702</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">	2003</td>
<td align="right">	1260</td>
<td align="right">	$10,749,269.374</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">	2003</td>
<td align="right">	4152</td>
<td align="right">	$18,220,131.5285</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">	2003</td>
<td align="right">	5940</td>
<td align="right">	$16,787,382.3141</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">	2004</td>
<td align="right">	6087</td>
<td align="right">	$14,170,982.5455</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">	2004</td>
<td align="right">	6888</td>
<td align="right">	$17,969,750.9487</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">	2004</td>
<td align="right">	976</td>
<td align="right">	$56,178.9223</td>
</tr>
</table>
</div>
<p></center></p>
<p>Now, suppose we want to see these results horizontally. The following dynamic SQL produces the desired output:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> &nbsp;@<span class="kw1">SQL</span> &nbsp;<span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="kw2">MAX</span><span class="br0">&#41;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@Cols <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="kw2">MAX</span><span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<span class="kw1">SELECT</span> @Cols <span class="sy0">=</span> <span class="kw2">STUFF</span><span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw1">select</span> <span class="st0">', </span>
<span class="st0">SUM(CASE WHEN [Quarter]='</span> <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">' AND [Year] = '</span> <span class="sy0">+</span> 
<span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">' THEN [Orders Count] ELSE 0 END) AS ['</span> <span class="sy0">+</span> 
<span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">'-'</span> <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">' Orders], </span>
<span class="st0">SUM(CASE WHEN [Quarter]='</span> <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">' AND [Year] = '</span> <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">' THEN [Total Due] ELSE 0 END) AS ['</span> <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">'-'</span> <span class="sy0">+</span> 
<span class="kw1">CAST</span><span class="br0">&#40;</span><span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span> <span class="kw1">as</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">3</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">' Sales]'</span>
<span class="kw1">FROM</span> #SalesSummary 
<span class="kw1">ORDER</span> <span class="kw1">BY</span> <span class="br0">&#91;</span><span class="kw1">Year</span><span class="br0">&#93;</span>,<span class="br0">&#91;</span>Quarter<span class="br0">&#93;</span> <span class="kw1">FOR</span> XML <span class="kw1">PATH</span><span class="br0">&#40;</span><span class="st0">''</span><span class="br0">&#41;</span>,type<span class="br0">&#41;</span>.<span class="kw1">value</span><span class="br0">&#40;</span><span class="st0">'.'</span>,<span class="st0">'varchar(max)'</span><span class="br0">&#41;</span>,<span class="nu0">1</span>,<span class="nu0">2</span>,<span class="st0">''</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SET</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'SELECT '</span> <span class="sy0">+</span> @Cols <span class="sy0">+</span> <span class="st0">' &nbsp;FROM #SalesSummary'</span> 
&nbsp;
<span class="co1">--print @SQL </span>
<span class="kw1">EXECUTE</span><span class="br0">&#40;</span> @<span class="kw1">SQL</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE  @SQL  NVARCHAR(MAX), 
         @Cols NVARCHAR(MAX)
         
SELECT @Cols = STUFF((select ', 
SUM(CASE WHEN [Quarter]=' + CAST([Quarter] as varchar(3)) + ' AND [Year] = ' + 
CAST([Year] as char(4)) + 
' THEN [Orders Count] ELSE 0 END) AS [' + 
CAST([Year] as char(4)) + '-' + CAST([Quarter] as varchar(3)) + 
' Orders], 
SUM(CASE WHEN [Quarter]=' + CAST([Quarter] as varchar(3)) + 
' AND [Year] = ' + CAST([Year] as char(4)) + 
' THEN [Total Due] ELSE 0 END) AS [' + CAST([Year] as char(4)) + '-' + 
CAST([Quarter] as varchar(3)) + ' Sales]'
FROM #SalesSummary 
ORDER BY [Year],[Quarter] FOR XML PATH(''),type).value('.','varchar(max)'),1,2,'')

SET @SQL = 'SELECT ' + @Cols + '  FROM #SalesSummary' 

--print @SQL 
EXECUTE( @SQL)</pre></div></div>

<p>It produces the transformed result (I show only few first columns):</p>
<div class="tables">
<table border="1" cellpadding ="6" cellspacing = "4">
<caption style="color:blue;font-weight:bold">Transformed result</caption>
<tr>
<th>2001-3 Orders</th>
<th>2001-3 Sales</th>
<th>2001-4 Orders</th>
<th>2001-4 Sales</th>
<th>2002-1 Orders</th>
<th>2002-1 Sales</th>
<th>2002-2 Orders</th>
<th>2002-2 Sales</th>
</tr>
<tr>
<td align="right">
621</td>
<td align="right">$5,850,932.9483</td>
<td align="right">758</td>
<td align="right">$8,476,619.278</td>
<td align="right">741</td>
<td align="right">	$7,379,686.3091</td>
<td align="right">825</td>
<td align="right">$8,210,285.1655</td>
</tr>
</table>
</div>
<p>You may want to un-comment PRINT @SQL statement if you want to see the generated command. I used XML PATH to concatenate rows into a string based on this blog post by Brad Schulz <a href="http://bradsruminations.blogspot.com/2009/10/making-list-and-checking-it-twice.html">Making a list and checking it twice</a>.</p>
<p>Another interesting problem was presented in this <a href="http://social.msdn.microsoft.com/Forums/hu-HU/transactsql/thread/f64ca6b6-9d7b-4863-86fa-591af1ec2b9f">MSDN Transact-SQL forum thread</a>:</p>
<p>For the claims table that has many integer columns, transform rows into columns. I demonstrate just the solution with the table creation script:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="de1"><pre class="de1"><span class="kw1">USE</span> tempdb 
&nbsp;
<span class="kw1">IF</span> <span class="kw2">OBJECT_ID</span><span class="br0">&#40;</span><span class="st0">'Claims'</span>,<span class="st0">'U'</span><span class="br0">&#41;</span> <span class="kw1">IS</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span> 
&nbsp; <span class="kw1">DROP</span> <span class="kw1">TABLE</span> Claims 
&nbsp;
GO 
&nbsp;
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> Claims <span class="br0">&#40;</span> 
&nbsp; Claim &nbsp;<span class="kw1">INT</span>, 
&nbsp; HCPC &nbsp; <span class="kw1">INT</span>, 
&nbsp; <span class="br0">&#91;</span>mod<span class="br0">&#93;</span> &nbsp;<span class="kw1">INT</span>, 
&nbsp; charge <span class="kw1">INT</span>, 
&nbsp; paid &nbsp; <span class="kw1">INT</span>, 
&nbsp; Qty &nbsp; &nbsp;<span class="kw1">INT</span><span class="br0">&#41;</span> 
&nbsp;
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> Claims 
<span class="kw1">SELECT</span> <span class="nu0">12345</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">99245</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">90</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">20</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">10</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">1</span> 
<span class="kw1">UNION</span> <span class="sy0">ALL</span> 
<span class="kw1">SELECT</span> <span class="nu0">12345</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">99112</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="sy0">NULL</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">30</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">20</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">1</span> 
<span class="kw1">UNION</span> <span class="sy0">ALL</span> 
<span class="kw1">SELECT</span> <span class="nu0">12345</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">99111</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">80</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">50</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">25</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">2</span> 
<span class="kw1">UNION</span> <span class="sy0">ALL</span> 
<span class="kw1">SELECT</span> <span class="nu0">11112</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">99911</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">60</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">50</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">20</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">1</span> 
<span class="kw1">UNION</span> <span class="sy0">ALL</span> 
<span class="kw1">SELECT</span> <span class="nu0">12222</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">99454</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="sy0">NULL</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">50</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">20</span>, 
&nbsp; &nbsp; &nbsp; &nbsp;<span class="nu0">1</span> 
&nbsp;
<span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> Claims</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">USE tempdb 

IF OBJECT_ID('Claims','U') IS NOT NULL 
  DROP TABLE Claims 

GO 

CREATE TABLE Claims ( 
  Claim  INT, 
  HCPC   INT, 
  [mod]  INT, 
  charge INT, 
  paid   INT, 
  Qty    INT) 

INSERT INTO Claims 
SELECT 12345, 
       99245, 
       90, 
       20, 
       10, 
       1 
UNION ALL 
SELECT 12345, 
       99112, 
       NULL, 
       30, 
       20, 
       1 
UNION ALL 
SELECT 12345, 
       99111, 
       80, 
       50, 
       25, 
       2 
UNION ALL 
SELECT 11112, 
       99911, 
       60, 
       50, 
       20, 
       1 
UNION ALL 
SELECT 12222, 
       99454, 
       NULL, 
       50, 
       20, 
       1 

SELECT * FROM Claims</pre></div></div>

<p>The output is:<br />
<center></p>
<div class="tables">
<table border="1" cellpadding ="5" cellspacing = "5">
<caption style="color:blue;font-weight:bold">Claims table</caption>
<tr>
<th>Claim</th>
<th>HCPC</th>
<th>mod</th>
<th>Charge</th>
<th>Paid</th>
<th>Qty</th>
</tr>
<tr>
<td align="right" style="width: 20%">12345</td>
<td align="right" style="width: 20%">	99245</td>
<td align="right" style="width: 20%">	90</td>
<td align="right" style="width: 20%">	20</td>
<td align="right" style="width: 20%">	10</td>
<td align="right" style="width: 20%">	1</td>
</tr>
<tr>
<td align="right" style="width: 20%">12345</td>
<td align="right" style="width: 20%">	99112</td>
<td align="right" style="width: 20%">	NULL</td>
<td align="right" style="width: 20%">	30</td>
<td align="right" style="width: 20%">	20</td>
<td align="right" style="width: 20%">	1</td>
</tr>
<tr>
<td align="right" style="width: 20%">12345</td>
<td align="right" style="width: 20%">	99111</td>
<td align="right" style="width: 20%">	80</td>
<td align="right" style="width: 20%">	50</td>
<td align="right" style="width: 20%">	25</td>
<td align="right" style="width: 20%">	2</td>
</tr>
<tr>
<td align="right" style="width: 20%">11112</td>
<td align="right" style="width: 20%">	99911</td>
<td align="right" style="width: 20%">	60</td>
<td align="right" style="width: 20%">	50</td>
<td align="right" style="width: 20%">	20</td>
<td align="right" style="width: 20%">	1</td>
</tr>
<tr>
<td align="right" style="width: 20%">12222</td>
<td align="right" style="width: 20%">	99454</td>
<td align="right" style="width: 20%">	NULL</td>
<td align="right" style="width: 20%">	50</td>
<td align="right" style="width: 20%">	20</td>
<td align="right" style="width: 20%">	1</td>
</tr>
</table>
</div>
<p></center></p>
<p>And the following code transforms the result (as you see, I am using a loop and ROW_NUMBER() approach):</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> &nbsp;@<span class="kw1">SQL</span> &nbsp; &nbsp; <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="kw2">MAX</span><span class="br0">&#41;</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@Loop &nbsp; &nbsp;<span class="kw1">INT</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@MaxRows <span class="kw1">INT</span> 
&nbsp;
<span class="kw1">SET</span> @<span class="kw1">Sql</span> <span class="sy0">=</span> <span class="st0">''</span> 
&nbsp;
<span class="kw1">SELECT</span> @MaxRows <span class="sy0">=</span> <span class="kw2">MAX</span><span class="br0">&#40;</span>MaxRow<span class="br0">&#41;</span> 
<span class="kw1">FROM</span> &nbsp; <span class="br0">&#40;</span><span class="kw1">SELECT</span> &nbsp; <span class="kw2">COUNT</span><span class="br0">&#40;</span><span class="sy0">*</span> <span class="br0">&#41;</span> <span class="kw1">AS</span> MaxRow, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Claim 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; &nbsp; Claims 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">GROUP</span> <span class="kw1">BY</span> Claim<span class="br0">&#41;</span> X 
&nbsp;
<span class="kw1">SET</span> @Loop <span class="sy0">=</span> <span class="nu0">1</span> 
&nbsp;
<span class="kw1">WHILE</span> @Loop <span class="sy0">&lt;=</span> @MaxRows 
&nbsp; <span class="kw1">BEGIN</span> 
&nbsp; &nbsp; <span class="kw1">SELECT</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> @<span class="kw1">SQL</span> <span class="sy0">+</span> <span class="st0">', &nbsp; &nbsp; SUM(CASE WHEN Row = '</span> <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span>@Loop <span class="kw1">AS</span> <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">' THEN '</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>Column_Name<span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">' END) AS ['</span> <span class="sy0">+</span> COLUMN_NAME <span class="sy0">+</span> <span class="kw1">CAST</span><span class="br0">&#40;</span>@Loop <span class="kw1">AS</span> <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">']'</span>
&nbsp; &nbsp; <span class="kw1">FROM</span> &nbsp; <span class="sy0">IN</span>F<span class="sy0">OR</span>MATION_SCHEMA.<span class="me1">COLUMNS</span> 
&nbsp; &nbsp; <span class="kw1">WHERE</span> &nbsp;TABLE_Name <span class="sy0">=</span> <span class="st0">'Claims'</span> 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="sy0">AND</span> COLUMN_NAME <span class="sy0">NOT</span> <span class="sy0">IN</span> <span class="br0">&#40;</span><span class="st0">'Row'</span>,<span class="st0">'Claim'</span><span class="br0">&#41;</span> 
&nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; <span class="kw1">SET</span> @Loop <span class="sy0">=</span> @Loop <span class="sy0">+</span> <span class="nu0">1</span> 
&nbsp; <span class="kw1">END</span> 
&nbsp;
<span class="co1">--PRINT @SQL </span>
<span class="kw1">SET</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'SELECT Claim'</span> <span class="sy0">+</span> @<span class="kw1">SQL</span> <span class="sy0">+</span> <span class="st0">' FROM (select *, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;row_number() over (partition by Claim ORDER BY Claim) as Row &nbsp; &nbsp; &nbsp; &nbsp; FROM Claims) X GROUP BY Claim '</span> 
&nbsp;
<span class="kw1">PRINT</span> @<span class="kw1">SQL</span> 
&nbsp;
<span class="kw1">EXECUTE</span><span class="br0">&#40;</span> @<span class="kw1">SQL</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE  @SQL     NVARCHAR(MAX), 
         @Loop    INT, 
         @MaxRows INT 

SET @Sql = '' 

SELECT @MaxRows = MAX(MaxRow) 
FROM   (SELECT   COUNT(* ) AS MaxRow, 
                 Claim 
        FROM     Claims 
        GROUP BY Claim) X 

SET @Loop = 1 

WHILE @Loop &lt;= @MaxRows 
  BEGIN 
    SELECT @SQL = @SQL + ',     SUM(CASE WHEN Row = ' + CAST(@Loop AS VARCHAR(10)) + ' THEN ' + QUOTENAME(Column_Name) + ' END) AS [' + COLUMN_NAME + CAST(@Loop AS VARCHAR(10)) + ']'
    FROM   INFORMATION_SCHEMA.COLUMNS 
    WHERE  TABLE_Name = 'Claims' 
           AND COLUMN_NAME NOT IN ('Row','Claim') 
     
    SET @Loop = @Loop + 1 
  END 

--PRINT @SQL 
SET @SQL = 'SELECT Claim' + @SQL + ' FROM (select *,          row_number() over (partition by Claim ORDER BY Claim) as Row         FROM Claims) X GROUP BY Claim ' 

PRINT @SQL 

EXECUTE( @SQL)</pre></div></div>

<div class="tables">
<table border="1" cellpadding ="5" cellspacing = "5">
<caption style="color:blue;font-weight:bold">Transformed Output</caption>
<tr>
<th>Claim</th>
<th>HCPC1</th>
<th>mod1</th>
<th>Charge1</th>
<th>Paid1</th>
<th>Qty1</th>
<th>HCPC2</th>
<th>mod2</th>
<th>Charge2</th>
<th>Paid2</th>
<th>Qty2</th>
<th>HCPC3</th>
<th>mod3</th>
<th>Charge3</th>
<th>Paid3</th>
<th>Qty3</th>
</tr>
<tr>
<td align="right" style="width: 20%">11112</td>
<td align="right" style="width: 10%">	99911</td>
<td align="right" style="width: 10%">	60</td>
<td align="right" style="width: 10%">	50</td>
<td align="right" style="width: 10%">	20</td>
<td align="right">	1</td>
<td align="right" style="width: 20%">NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL	</td>
<td align="right" style="width: 20%">NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
</tr>
<tr>
<td align="right" style="width: 20%">12222</td>
<td align="right">	99454</td>
<td align="right">	NULL</td>
<td align="right">	50</td>
<td align="right">	20</td>
<td align="right">	1	</td>
<td align="right" style="width: 20%">NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
<td align="right">	NULL</td>
</tr>
<tr>
<td align="right" style="width: 20%">12345</td>
<td align="right">	99245</td>
<td align="right">	90</td>
<td align="right">	20</td>
<td align="right">	10</td>
<td align="right">	1	</td>
<td align="right" style="width: 20%">99112</td>
<td align="right">	NULL</td>
<td align="right">	30</td>
<td align="right">	20</td>
<td align="right">	1</td>
<td align="right">	99111</td>
<td align="right">	80</td>
<td align="right">	50</td>
<td align="right">	25</td>
<td align="right">	2</td>
</tr>
</table>
</div>
<p>I&#8217;ll post another recent problem found in the following MSDN thread <a href="http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/89d5954f-d518-4eb4-8c44-c124c6e1ee6d">Basic Crosstab Query</a></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SET</span> <span class="kw1">NOCOUNT</span> <span class="kw1">ON</span>;
GO
<span class="kw1">USE</span> tempdb;
GO
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #T <span class="br0">&#40;</span>
StoreID <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">5</span><span class="br0">&#41;</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
CriteriaNo <span class="kw1">int</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
<span class="kw1">Result</span> <span class="kw1">int</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>, 
Position <span class="kw1">int</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
<span class="kw1">PRIMARY</span> <span class="kw1">KEY</span> <span class="br0">&#40;</span>StoreID, CriteriaNo<span class="br0">&#41;</span>
<span class="br0">&#41;</span>;
GO
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> #T<span class="br0">&#40;</span>StoreID, CriteriaNo, <span class="kw1">Result</span>, Position<span class="br0">&#41;</span>
<span class="kw1">SELECT</span> <span class="st0">'0001'</span>, <span class="nu0">9</span>, <span class="nu0">10</span>, <span class="nu0">1</span> <span class="kw1">UNION</span> <span class="sy0">ALL</span> 
<span class="kw1">SELECT</span> <span class="st0">'0002'</span>, <span class="nu0">9</span>, <span class="nu0">12</span>, <span class="nu0">2</span> <span class="kw1">UNION</span> <span class="sy0">ALL</span> 
<span class="kw1">SELECT</span> <span class="st0">'0001'</span>, <span class="nu0">10</span>, <span class="nu0">5</span>, <span class="nu0">1</span> <span class="kw1">UNION</span> <span class="sy0">ALL</span>
<span class="kw1">SELECT</span> <span class="st0">'0002'</span>, <span class="nu0">10</span>, <span class="nu0">6</span>, <span class="nu0">2</span>;
GO
<span class="co1">-- dynamic</span>
<span class="kw1">DECLARE</span> @<span class="kw1">sql</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="kw2">MAX</span><span class="br0">&#41;</span>, @Cols <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="kw2">max</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">SELECT</span> @Cols <span class="sy0">=</span> <span class="br0">&#40;</span><span class="kw1">select</span> <span class="st0">', '</span> <span class="sy0">+</span> <span class="st0">'MAX(case when CriteriaNo = '</span> <span class="sy0">+</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span>, CriteriaNo<span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">' then Result else 0 end) AS CriteriaNo'</span> <span class="sy0">+</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span>, CriteriaNo<span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">', MAX(case when CriteriaNo = '</span> <span class="sy0">+</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span>, CriteriaNo<span class="br0">&#41;</span> <span class="sy0">+</span> 
<span class="st0">' then Position else 0 end) AS CriteriaPosition'</span> <span class="sy0">+</span> <span class="kw1">CONVERT</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span>, CriteriaNo<span class="br0">&#41;</span>
<span class="kw1">from</span> <span class="br0">&#40;</span><span class="kw1">select</span> <span class="kw1">distinct</span> CriteriaNo <span class="kw1">from</span> #T<span class="br0">&#41;</span> X <span class="kw1">ORDER</span> <span class="kw1">By</span> CriteriaNo 
<span class="kw1">FOR</span> XML <span class="kw1">PATH</span><span class="br0">&#40;</span><span class="st0">''</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SET</span> @<span class="kw1">sql</span> <span class="sy0">=</span> <span class="st0">'SELECT StoreID'</span> <span class="sy0">+</span> @Cols <span class="sy0">+</span> <span class="st0">', SUM(Result) as PerformancePrint</span>
<span class="st0">FROM #T</span>
<span class="st0">GROUP BY StoreID'</span>
&nbsp;
<span class="kw1">EXECUTE</span><span class="br0">&#40;</span>@<span class="kw1">sql</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SET NOCOUNT ON;
GO
USE tempdb;
GO
CREATE TABLE #T (
StoreID char(5) NOT NULL,
CriteriaNo int NOT NULL,
Result int NOT NULL, 
Position int NOT NULL,
PRIMARY KEY (StoreID, CriteriaNo)
);
GO
INSERT INTO #T(StoreID, CriteriaNo, Result, Position)
SELECT '0001', 9, 10, 1 UNION ALL 
SELECT '0002', 9, 12, 2 UNION ALL 
SELECT '0001', 10, 5, 1 UNION ALL
SELECT '0002', 10, 6, 2;
GO
-- dynamic
DECLARE @sql nvarchar(MAX), @Cols nvarchar(max);

SELECT @Cols = (select ', ' + 'MAX(case when CriteriaNo = ' + CONVERT(varchar(20), CriteriaNo) + 
' then Result else 0 end) AS CriteriaNo' + CONVERT(varchar(20), CriteriaNo) + 
', MAX(case when CriteriaNo = ' + CONVERT(varchar(20), CriteriaNo) + 
' then Position else 0 end) AS CriteriaPosition' + CONVERT(varchar(20), CriteriaNo)
from (select distinct CriteriaNo from #T) X ORDER By CriteriaNo 
FOR XML PATH(''))

SET @sql = 'SELECT StoreID' + @Cols + ', SUM(Result) as PerformancePrint
FROM #T
GROUP BY StoreID'

EXECUTE(@sql)</pre></div></div>

<p>See also my TechNet WiKi article on this same topic with more code samples</p>
<p><a href="http://social.technet.microsoft.com/wiki/contents/articles/17510.t-sql-dynamic-pivot-on-multiple-columns.aspx">T-SQL: Dynamic Pivot on Multiple Columns</a></p>
<p>*** <strong>Remember, if you have a SQL related question, try our <a href="http://forum.lessthandot.com/viewforum.php?f=17">Microsoft SQL Server Programming</a> forum or our <a href="http://forum.lessthandot.com/viewforum.php?f=22">Microsoft SQL Server Admin</a> forum</strong><ins></ins></p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/understanding-sql-server-2000-pivot/'>Understanding SQL Server 2000 Pivot with Aggregates</a><p>This month's T-SQL Tuesday is being hosted by our very own, Jes Borland (Twitter |&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/use-alter-table-alter-column-to-change-d/'>Use alter table alter column to change datatypes for a column in SQL Server</a><p>This question popped in the microsoft.public.sqlserver.programming forum yesterday. A person wanted to change a column&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2>Naomi Nosonovsky, Senior Software Developer, has more than 15 years of enterprise experience in analysis, design, development and implementation of high-performance client/server data management solutions.

She is a Personality of the Year for 2008, 2009, 2010 and 2011 at www.universalthread.com in .NET, SQL Server & VFP categories.

She is also an All Star contributor/MCC Community Contributor at forums.asp.net and MSDN T-SQL forum.


 
	



    

    


<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://www.facebook.com/profile.php?id=http://www.facebook.com/?sk=messages&tid=1240691655679#!/profile.php?id=10395470" title="Naomi at Facebook" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Facebook" /></a><a href="http://www.linkedin.com/profile?viewProfile=&key=55538716&trk=tab_pro" title="Naomi at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://delicious.com/http://delicious.com/naomi_nos" title="Naomi at delicious" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_delicious.png" alt="delicious" /></a><a href="/index.php/author/naomi/feed/" title="Blog RSS feed for Naomi" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 45,556 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/naomi/">Read More Posts by Naomi Nosonovsky</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&text=RT @LessThanDot Blog - Dynamic PIVOT on multiple columns by naomi" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&title=Dynamic PIVOT on multiple columns&source=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&title=Dynamic PIVOT on multiple columns" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&quote=Dynamic PIVOT on multiple columns" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/&title=Dynamic PIVOT on multiple columns" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		24 Comments	</h4>
			<ol class="comments-list">
					<li class="comment even thread-even depth-1" id="comment-4322">
				<div id="div-comment-4322" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/462c063e634f70922c0c83c5fecf8f4c?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/462c063e634f70922c0c83c5fecf8f4c?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4322">
			May 29, 2011 at 2:20 pm</a>		</div>

		<p>Why do you need to create dynamic sql if you already know the column names you are working with?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4322#respond' onclick='return addComment.moveForm( "div-comment-4322", "4322", "respond", "1193" )' aria-label='Reply to Boris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-4323">
				<div id="div-comment-4323" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4323">
			May 29, 2011 at 2:32 pm</a>		</div>

		<p>Good point! However, in the examples I shown I do not know the column names of the result in advance, hence I create them dynamically.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4323#respond' onclick='return addComment.moveForm( "div-comment-4323", "4323", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-SQLDenis even thread-even depth-1" id="comment-4324">
				<div id="div-comment-4324" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">SQLDenis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4324">
			May 29, 2011 at 5:12 pm</a>		</div>

		<p>I do the same kind of thing..it would be nice if SQL Server had a dynamic crosstab query built in</p>
<p>BTW a couple o weeks I built a dynamic pivot query that had over a 1000 columns for a report&#8230;.fun stuff</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4324#respond' onclick='return addComment.moveForm( "div-comment-4324", "4324", "respond", "1193" )' aria-label='Reply to SQLDenis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4325">
				<div id="div-comment-4325" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/462c063e634f70922c0c83c5fecf8f4c?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/462c063e634f70922c0c83c5fecf8f4c?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4325">
			May 30, 2011 at 1:46 am</a>		</div>

		<p>So the first two bits of code are not at all related to the third? I found it very confusing because the first two do not need to use dynamic sql and the third is for a different query and is not explained at all.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4325#respond' onclick='return addComment.moveForm( "div-comment-4325", "4325", "respond", "1193" )' aria-label='Reply to Boris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-4326">
				<div id="div-comment-4326" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4326">
			May 30, 2011 at 9:39 am</a>		</div>

		<p>The first code is to create a table we&#8217;re going to work with. We can use either temp table or CTE or derived table. I found that Temp table performs quicker than CTE or derived tables under certain circumstances, so the first piece of code creates a table which we want to transform. The actual transformation is done in the second code. The third code is another variation of the theme, but it&#8217;s slightly different than the first. In the third variation of the code we don&#8217;t know the field names we&#8217;re transforming, so it makes it even more complicated than the first.</p>
<p>I also made some changes in the blog to make it more transparent.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4326#respond' onclick='return addComment.moveForm( "div-comment-4326", "4326", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4327">
				<div id="div-comment-4327" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/462c063e634f70922c0c83c5fecf8f4c?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/462c063e634f70922c0c83c5fecf8f4c?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Boris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4327">
			May 30, 2011 at 10:14 am</a>		</div>

		<p>So the first 2 are from SalesOrderHeader in AdventureWorks and the 3rd is a different query on a different table from a random post on MSDN? The first two dont need dynamic sql cos u know the field names but u use it for some reason, and the 1 from the random post does need it cos u dont know the names? No wonder im confused lol&#8230;</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4327#respond' onclick='return addComment.moveForm( "div-comment-4327", "4327", "respond", "1193" )' aria-label='Reply to Boris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-4328">
				<div id="div-comment-4328" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4328">
			May 30, 2011 at 10:26 am</a>		</div>

		<p>In the first problem, we don&#8217;t know in advance all the quarters and years &#8211; hence dynamic query.</p>
<p>We have this table</p>
<pre>Quarter   Year   OrdersCount     TotalDue&lt;br /&gt;
 Q3       2001       10             $100&lt;br /&gt;
 Q4       2001       50             $2332&lt;br /&gt;
 Q1       2002       74             $4567</pre>
<p>
etc.</p>
<p>We don&#8217;t know the exact quarters and years and we want to transform all of them into a row, e.g.</p>
<pre>&lt;br /&gt;
Q3-2001 Cnt  Q3-2001 Sales  Q4-2001 Cnt   Q4-2001 Sales&lt;br /&gt;
    10      $100                 50                   $2332&lt;br /&gt;</pre>
<p>
Similar to what you produce in SSRS, but I wanted to show pure T-SQL solution.</p>
<p>The second problem is not related to the first, but IMHO, it demonstrates another interesting twist in constructing dynamic query. I could have used another AW example, but I already had the solution for the thread saved, so I just used the existing thread and a solution as an example.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4328#respond' onclick='return addComment.moveForm( "div-comment-4328", "4328", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4318">
				<div id="div-comment-4318" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/75811030f0b86dee267c97615894d360?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/75811030f0b86dee267c97615894d360?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">mike</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4318">
			October 26, 2012 at 9:59 am</a>		</div>

		<p>Hi,</p>
<p>The &#8220;claims&#8221; dynamic code only produces the first column for me.  Can you check it and see if it is correct??  I am a beginner with dynamic sql, and not sure where to look for the error!</p>
<p>thanks<br />
Mike</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4318#respond' onclick='return addComment.moveForm( "div-comment-4318", "4318", "respond", "1193" )' aria-label='Reply to mike'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-4319">
				<div id="div-comment-4319" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4319">
			October 30, 2012 at 12:14 pm</a>		</div>

		<p>Sorry, I didn&#8217;t see your comment earlier. I just re-run the code from the article as is in SQL Server 2012 and I got many columns as output. Have you copied the code exactly?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4319#respond' onclick='return addComment.moveForm( "div-comment-4319", "4319", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4329">
				<div id="div-comment-4329" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/363f049a5e38d9bf17a6522a83ce1f3b?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/363f049a5e38d9bf17a6522a83ce1f3b?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">RoMe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4329">
			December 6, 2012 at 4:16 am</a>		</div>

		<p>Hi,<br />
first of all thanks! As a SQL &#8220;beginner&#8221; this was of great help.<br />
I&#8217;m experiencing the same problem as Mike: &#8220;The &#8220;claims&#8221; dynamic code only produces the first column for me.&#8221;<br />
I&#8217;m using sql express 2005 (by any chance could this be the problem?)<br />
Thanks!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4329#respond' onclick='return addComment.moveForm( "div-comment-4329", "4329", "respond", "1193" )' aria-label='Reply to RoMe'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-4330">
				<div id="div-comment-4330" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4330">
			December 6, 2012 at 5:40 am</a>		</div>

		<p>Very strange. What do you see as printed SQL and did you try to execute it by itself?</p>
<p>Also, what is the compatibility level of your TempDB?</p>
<p>I don&#8217;t have SQL 2005 to test, so I just tested this code in SQL 2012 and got 3 rows, although first two rows had NULLs in most of the columns.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4330#respond' onclick='return addComment.moveForm( "div-comment-4330", "4330", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4320">
				<div id="div-comment-4320" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/a1c388e8735eceb3bc28ccb135aa413c?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/a1c388e8735eceb3bc28ccb135aa413c?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">krishna</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4320">
			January 15, 2013 at 8:14 am</a>		</div>

		<p>i was wondering if we have multiple columns and have to convert them to rows how to we do that.</p>
<p>eg:  product1 product1 product3<br />
          1       2         3<br />
now if we have to have all the columns into 1 column and their respective values into another column, how do we do it</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4320#respond' onclick='return addComment.moveForm( "div-comment-4320", "4320", "respond", "1193" )' aria-label='Reply to krishna'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-4321">
				<div id="div-comment-4321" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4321">
			January 15, 2013 at 8:28 am</a>		</div>

		<p>I think in your case you just need dynamic UNPIVOT, right?</p>
<p>E.g. do you want to get</p>
<pre>&lt;br /&gt;
ProductName Quantity&lt;br /&gt;
Product1      1&lt;br /&gt;
Product2      2&lt;br /&gt;
Product3      3&lt;br /&gt;</pre>
<p>
but you don&#8217;t know the names of products columns in advance?</p>
<p>If so, that&#8217;s dynamic UNPIVOT &#8211; slightly different topic than the topic of this blog post.</p>
<p>I suggest you to post your question either in the SQL forum here or in MSDN Transact-SQL forum with more information and someone will be able to help you better.   </p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4321#respond' onclick='return addComment.moveForm( "div-comment-4321", "4321", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4315">
				<div id="div-comment-4315" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/4e3100ed0716d3035848dec21f5c63f1?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/4e3100ed0716d3035848dec21f5c63f1?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Prawin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4315">
			August 6, 2013 at 6:19 pm</a>		</div>

		<p>Thanks for the article..The second query was very helpful.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4315#respond' onclick='return addComment.moveForm( "div-comment-4315", "4315", "respond", "1193" )' aria-label='Reply to Prawin'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-4316">
				<div id="div-comment-4316" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4316">
			August 6, 2013 at 6:32 pm</a>		</div>

		<p>I am glad this helped</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4316#respond' onclick='return addComment.moveForm( "div-comment-4316", "4316", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4317">
				<div id="div-comment-4317" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9fe228cc5d116177a8c2f7e3936d1a15?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9fe228cc5d116177a8c2f7e3936d1a15?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">samith</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4317">
			August 22, 2013 at 5:56 am</a>		</div>

		<p>good 1</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4317#respond' onclick='return addComment.moveForm( "div-comment-4317", "4317", "respond", "1193" )' aria-label='Reply to samith'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-505845">
				<div id="div-comment-505845" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/3333c9482adb44bf9545a1e2e5413047?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/3333c9482adb44bf9545a1e2e5413047?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Lou Carey</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-505845">
			April 4, 2014 at 12:21 am</a>		</div>

		<p>Thanks for the article! The 2nd example was very helpful.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=505845#respond' onclick='return addComment.moveForm( "div-comment-505845", "505845", "respond", "1193" )' aria-label='Reply to Lou Carey'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 parent" id="comment-1023823">
				<div id="div-comment-1023823" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/e8740695790c168e0721898d5f4a5b89?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/e8740695790c168e0721898d5f4a5b89?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://NA/' rel='external nofollow' class='url'>Kevin</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-1023823">
			June 2, 2014 at 11:48 pm</a>		</div>

		<p>I have a different issue I&#8217;m trying to solve. I have 4 columns that are part of a larger table. The columns are trains, cars, planes and boats. Each column has a value from 1 to 15. Each value represents a different manufacturer. So I could have:<br />
Train, Car, Plane, Boat,<br />
1,5,3,14<br />
4,5,10,11<br />
4,14,5,7<br />
12,11,10,9<br />
3,5,10,2<br />
5,1,3,15<br />
10,4,10,11</p>
<p>1=Ford<br />
2=GM<br />
3=Saab<br />
4=GE<br />
5=Izhmash<br />
6=Volvo<br />
7=TGV<br />
8=HSBC<br />
9=Welcraft<br />
10=Lockheed<br />
11=Boeing<br />
12=SeverStal<br />
13=Samsung<br />
14=Toyota<br />
15=Hundai</p>
<p>So the pivot would be:<br />
        Ford, GM, Saab, GE, Izhmash, Volvo, TGV, HSBC, Welcraft, and so on<br />
Boat<br />
Car<br />
Plane<br />
Train</p>
<p>with the intersection being the count of each boat, car, plane and train by Manufacturer. Since the values of each column are the same 1-15, I figure there must be a way to do a union between each vehicle and this would allow me to make 1 pass through the data. Other than that my only option is to do 4 sets of case statements to process each column row by row?</p>
<p>Thanks,</p>
<p>Kevin</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=1023823#respond' onclick='return addComment.moveForm( "div-comment-1023823", "1023823", "respond", "1193" )' aria-label='Reply to Kevin'>Reply</a></div>
				</div>
		<ol class="children">
		<li class="comment even depth-2" id="comment-1029391">
				<div id="div-comment-1029391" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/e8740695790c168e0721898d5f4a5b89?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/e8740695790c168e0721898d5f4a5b89?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://NA/' rel='external nofollow' class='url'>Kevin</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-1029391">
			June 3, 2014 at 9:45 am</a>		</div>

		<p>This is working code for 1 of 4 columns. I&#8217;m trying to integrate the other 3.</p>
<p>SELECT &#8216;SourceCount&#8217; AS &#8216;Count by Source ID&#8217;,<br />
[ 1 ] AS &#8216;Ford&#8217;,<br />
[ 2 ] AS &#8216;GM&#8217;,<br />
[ 3 ] AS &#8216;Saab&#8217;,<br />
[ 4 ] AS &#8216;GE&#8217;,<br />
[ 5 ] AS &#8216;Izhmash&#8217;,<br />
[ 6 ] AS &#8216;Volvo&#8217;,<br />
[ 7 ] AS &#8216;TGV&#8217;,<br />
[ 8 ] AS &#8216;HSBC&#8217;,<br />
[ 9 ] AS &#8216;Welcraft&#8217;,<br />
[ 10 ] AS &#8216;Lockheed&#8217;,<br />
[ 11 ] AS &#8216;Boeing&#8217;,<br />
[ 12 ] AS &#8216;SeverStal&#8217;,<br />
[ 13 ] AS &#8216;Samsung&#8217;,<br />
[ 14 ] AS &#8216;Toyota&#8217;,<br />
[ 15 ] AS &#8216;Hundai&#8217;<br />
FROM<br />
(<br />
SELECT Boat<br />
FROM [Transport]<br />
) AS SourceTable</p>
<p>PIVOT<br />
(<br />
COUNT(Boat)<br />
FOR [Boat]<br />
IN ([ 1 ],<br />
	[ 2 ],<br />
	[ 3 ],<br />
	[ 4 ],<br />
	[ 5 ],<br />
	[ 6 ],<br />
	[ 7 ],<br />
	[ 8 ],<br />
	[ 9 ],<br />
	[ 10 ],<br />
	[ 12 ],<br />
	[ 13 ],<br />
	[ 14 ],<br />
	[ 15 ] )<br />
) AS PivotTable;</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=1029391#respond' onclick='return addComment.moveForm( "div-comment-1029391", "1029391", "respond", "1193" )' aria-label='Reply to Kevin'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor odd alt thread-even depth-1" id="comment-1029764">
				<div id="div-comment-1029764" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-1029764">
			June 3, 2014 at 10:24 am</a>		</div>

		<p>Can you post desired result?</p>
<p>Also, I suggest to post your question (with DDL, insert statements and desired result) in MSDN Transact-SQL forum. I (or someone else) will most likely be able to help you in that forum.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=1029764#respond' onclick='return addComment.moveForm( "div-comment-1029764", "1029764", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="comment-1448224">
				<div id="div-comment-1448224" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/b3fb547cc2eaa26ea292a95065103285?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/b3fb547cc2eaa26ea292a95065103285?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">David Johnson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-1448224">
			July 25, 2014 at 10:40 am</a>		</div>

		<p>Thanks for the post, Naomi.  It was very helpful just now when I needed to extrapolate all the run times of each SQL job on a server.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=1448224#respond' onclick='return addComment.moveForm( "div-comment-1448224", "1448224", "respond", "1193" )' aria-label='Reply to David Johnson'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="comment-2880417">
				<div id="div-comment-2880417" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/641f740d952ddfdaf46ab574ac973fdd?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/641f740d952ddfdaf46ab574ac973fdd?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.mindstick.com/' rel='external nofollow' class='url'>Kamlakar Singh</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-2880417">
			November 29, 2014 at 2:26 am</a>		</div>

		<p>I will present how we can write a Dynamic PIVOT query with an example, where we dont need to mention the PIVOT columns each unique values.</p>
<p>Pivot is one the new relational operator introduced in SQL Server 2005. It provides easy mechanisms in SQL Server to transform rows into columns.<br />
for full implementation of Pivot with Dynamic columns check here: <a href="http://www.mindstick.com/Articles/8c51b7e5-92d6-42cc-9d09-57bfd4ad8e00/Pivot%20with%20Dynamic%20columns%20in%20SQL%20Server" rel="nofollow">Pivot with Dynamic columns</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=2880417#respond' onclick='return addComment.moveForm( "div-comment-2880417", "2880417", "respond", "1193" )' aria-label='Reply to Kamlakar Singh'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="comment-4545744">
				<div id="div-comment-4545744" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/d0db4110b8b7b405888aa04bf1ae90ae?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/d0db4110b8b7b405888aa04bf1ae90ae?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Helal</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4545744">
			August 17, 2015 at 12:58 pm</a>		</div>

		<p>Hi Naomi,<br />
I need to pivot my records in columns into rows. Below is sample data. Payer, ID, CLM are dynamic fields. I consider using your examples of Pivot on multiple columns but I can neither do aggregate or max functions. I just need to transpose , if this is the right word, the two rows into one row.</p>
<p>create table #columnstorows<br />
(<br />
Payer		varchar (5),<br />
ID		varchar (5),<br />
CLM		varchar (2),<br />
Paid1		float,<br />
Paid2		float,<br />
Paid3		float							        </p>
<p>)<br />
go<br />
insert into #columnstorows<br />
(Payer, ID,CLM	,Paid1, Paid2,Paid3)</p>
<p>select  &#8216;U001&#8242;,&#8217;00001&#8242;,&#8217;01&#8217;,&#8217;76.58&#8242;,&#8217;153.48&#8242;,&#8217;53.48&#8242;	 UNION ALL<br />
select  &#8216;U002&#8242;,&#8217;00001&#8242;,&#8217;01&#8217;,&#8217;19.53&#8242;,&#8217;96.43&#8242;,&#8217;200&#8242;	 </p>
<p>Go</p>
<p>select *<br />
From #columnstorows</p>
<p>Desired result:<br />
Payer1	Payer2 ID1 ID2	Paid1A	Paid1B	Paid2A	Paid2B	Paid3A	Paid3B<br />
U001	U002   001 002	76.58	19.53	 153.48	96.43	53.48	 200</p>
<p>Any help will be greatly appreciated.</p>
<p>Thank You</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4545744#respond' onclick='return addComment.moveForm( "div-comment-4545744", "4545744", "respond", "1193" )' aria-label='Reply to Helal'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor odd alt thread-even depth-1" id="comment-4549447">
				<div id="div-comment-4549447" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#comment-4549447">
			August 18, 2015 at 9:44 pm</a>		</div>

		<p>If there are only few rows in the table, then last solution (claims) should work for you just fine. You don&#8217;t need to partition by anything in the ROW_NUMBER() statement and you will use max(case when Rn = 1 then Payer end) as Payer1<br />
etc. and will generate them dynamically in a loop. If you want to generate letters A, B, etc. for column names use char(64 + Rn) in your column name generation</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/?replytocom=4549447#respond' onclick='return addComment.moveForm( "div-comment-4549447", "4549447", "respond", "1193" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/datadesign/dynamic-pivot-on-multiple-columns/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1193' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="428fca9bc1921c25c5121f9da7815cde"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552766012"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
