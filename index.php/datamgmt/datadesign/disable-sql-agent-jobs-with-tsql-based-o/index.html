<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Disable SQL Agent Jobs with TSQL based on events</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Disable SQL Agent Jobs with TSQL based on events" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Altering SQL Agent jobs during job runtime can give you some options as to how you can force other jobs to react based on events. There are a listing of system procedures in the MSDB database available for you to use so you can literally alter your entire timelines and schedules based on a failure, [&hellip;]" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Disable SQL Agent Jobs with TSQL based on events Comments Feed" href="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Space heater * power strip = support disaster' href='/index.php/itprofessionals/ethicsit/space-heater-power-strip-disaster/' />
<link rel='next' title='Answers To The SQL Server Quiz: Can You Answer All These Post' href='/index.php/datamgmt/datadesign/answers-to-the-sql-server-quiz-can-you-a/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/" />
<link rel='shortlink' href='/?p=367' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fdisable-sql-agent-jobs-with-tsql-based-o%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fdisable-sql-agent-jobs-with-tsql-based-o%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/datamgmt/datadesign/answers-to-the-sql-server-quiz-can-you-a/" rel="next">Answers To The SQL Server Quiz: Can You Answer All These Post</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/itprofessionals/ethicsit/space-heater-power-strip-disaster/" rel="prev">Space heater * power strip = support disaster</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/" class="post-title">Disable SQL Agent Jobs with TSQL based on events</a></h1>
					<div class="post-byline">by <a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)" rel="author">Ted Krueger (onpnt)</a> on March 26, 2009 in category <a href="/index.php/category/datamgmt/datadesign/" rel="category tag">Data Modelling and Design</a> <a href="/index.php/category/datamgmt/dbadmin/mssqlserveradmin/" rel="category tag">Microsoft SQL Server Admin</a>. Article views: 8,710 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&text=RT @LessThanDot Blog - Disable SQL Agent Jobs with TSQL based on events by @onpnt" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&title=Disable SQL Agent Jobs with TSQL based on events&source=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&title=Disable SQL Agent Jobs with TSQL based on events" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&quote=Disable SQL Agent Jobs with TSQL based on events" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&title=Disable SQL Agent Jobs with TSQL based on events" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>Altering SQL Agent jobs during job runtime can give you some options as to how you can force other jobs<br />
to react based on events.  There are a listing of system procedures in the MSDB database available for<br />
you to use so you can literally alter your entire timelines and schedules based on a failure, success or<br />
even OS or network related issues.  Here is a basic example of disabling and enabling a job<br />
based on a monitoring task.  </p>
<p>In this example there is a requirement to monitor a table that is being used to monitor finish good allocation<br />
to a manufacturing facility to prevent volume from going over capacity.  </p>
<p>Job 1 performs a monitoring task every 30 minutes.  Basically querying the table that holds the count of the volume<br />
the facility has received that day (starting at midnight).  At midnight the volume is replenished by means of the value<br />
specified in the same table.  There is a need to monitor the capacity and once under 2000 units are remaining,<br />
you are required to send notifications out to management.  Notifications should go out once.<br />
The key is the one notification.  This is one option of getting around that using the system procedures to alter job properties. </p>
<p>Step 1) create the table to monitor</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SET</span> ANSI_<span class="sy0">NULL</span>S <span class="kw1">ON</span>
GO
<span class="kw1">SET</span> QUOTED_IDENTIFIER <span class="kw1">ON</span>
GO
<span class="kw1">SET</span> ANSI_PADD<span class="sy0">IN</span>G <span class="kw1">ON</span>
GO
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> <span class="br0">&#91;</span>dbo<span class="br0">&#93;</span>.<span class="br0">&#91;</span>VOL_MONIT<span class="sy0">OR</span><span class="br0">&#93;</span><span class="br0">&#40;</span>
&nbsp; &nbsp; <span class="br0">&#91;</span>VolumeID<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw1">int</span><span class="br0">&#93;</span> <span class="kw1">IDENTITY</span><span class="br0">&#40;</span><span class="nu0">1</span>,<span class="nu0">1</span><span class="br0">&#41;</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
&nbsp; &nbsp; <span class="br0">&#91;</span>Facility<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw1">varchar</span><span class="br0">&#93;</span><span class="br0">&#40;</span><span class="nu0">50</span><span class="br0">&#41;</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
&nbsp; &nbsp; <span class="br0">&#91;</span>Volume<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw1">int</span><span class="br0">&#93;</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
&nbsp; &nbsp; <span class="br0">&#91;</span>Vol_Status<span class="br0">&#93;</span> <span class="br0">&#91;</span><span class="kw1">int</span><span class="br0">&#93;</span> <span class="sy0">NOT</span> <span class="sy0">NULL</span>,
&nbsp;<span class="kw1">CONSTRAINT</span> <span class="br0">&#91;</span>PK_VOL_MONIT<span class="sy0">OR</span><span class="br0">&#93;</span> <span class="kw1">PRIMARY</span> <span class="kw1">KEY</span> <span class="kw1">CLUSTERED</span> 
<span class="br0">&#40;</span>
&nbsp; &nbsp; <span class="br0">&#91;</span>VolumeID<span class="br0">&#93;</span> <span class="kw1">ASC</span>
<span class="br0">&#41;</span><span class="kw1">WITH</span> <span class="br0">&#40;</span>PAD_<span class="sy0">IN</span>DEX &nbsp;<span class="sy0">=</span> <span class="kw1">OFF</span>, STATISTICS_N<span class="sy0">OR</span>ECOMPUTE &nbsp;<span class="sy0">=</span> <span class="kw1">OFF</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IGN<span class="sy0">OR</span>E_DUP_KEY <span class="sy0">=</span> <span class="kw1">OFF</span>, <span class="sy0">ALL</span>OW_ROW_LOCKS &nbsp;<span class="sy0">=</span> <span class="kw1">ON</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy0">ALL</span>OW_PAGE_LOCKS &nbsp;<span class="sy0">=</span> <span class="kw1">ON</span>, <span class="kw1">FILLFACTOR</span> <span class="sy0">=</span> <span class="nu0">90</span><span class="br0">&#41;</span> <span class="kw1">ON</span> <span class="br0">&#91;</span><span class="kw1">PRIMARY</span><span class="br0">&#93;</span>
<span class="br0">&#41;</span> <span class="kw1">ON</span> <span class="br0">&#91;</span><span class="kw1">PRIMARY</span><span class="br0">&#93;</span>
&nbsp;
GO
<span class="kw1">SET</span> ANSI_PADD<span class="sy0">IN</span>G <span class="kw1">OFF</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[VOL_MONITOR](
	[VolumeID] [int] IDENTITY(1,1) NOT NULL,
	[Facility] [varchar](50) NOT NULL,
	[Volume] [int] NOT NULL,
	[Vol_Status] [int] NOT NULL,
 CONSTRAINT [PK_VOL_MONITOR] PRIMARY KEY CLUSTERED 
(
	[VolumeID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, 
			IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, 
			ALLOW_PAGE_LOCKS  = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF</pre></div></div>

<p>Insert the data in order to test out monitor</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> DBO.<span class="br0">&#91;</span>VOL_MONIT<span class="sy0">OR</span><span class="br0">&#93;</span>
<span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="st0">'AL Plant 1'</span>,<span class="nu0">20000</span>,<span class="nu0">15000</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">INSERT INTO DBO.[VOL_MONITOR]
VALUES ('AL Plant 1',20000,15000)</pre></div></div>

<p>Step 2) create the job to monitor the volume count.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @jobId <span class="kw1">BINARY</span><span class="br0">&#40;</span><span class="nu0">16</span><span class="br0">&#41;</span>
<span class="kw1">EXEC</span> @ReturnCode <span class="sy0">=</span> &nbsp;msdb.<span class="me1">dbo</span>.<span class="kw3">sp_add_job</span> @job_name<span class="sy0">=</span>N<span class="st0">'Capacity Restriction Monitor Plant 01'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @enabled<span class="sy0">=</span><span class="nu0">1</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @notify_level_eventlog<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @notify_level_email<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @notify_level_netsend<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @notify_level_page<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @delete_level<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @description<span class="sy0">=</span>N<span class="st0">'Monitors the levels of units allowe to be manufactured in plant 01.'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @category_name<span class="sy0">=</span>N<span class="st0">'[Uncategorized (Local)]'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @owner_login_name<span class="sy0">=</span>N<span class="st0">'{user}'</span>, @job_id <span class="sy0">=</span> @jobId <span class="kw1">OUTPUT</span>
<span class="kw1">IF</span> <span class="br0">&#40;</span><span class="kw2">@@ERROR</span> <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span> <span class="sy0">OR</span> @ReturnCode <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">GOTO</span> QuitWithRollback
<span class="coMULTI">/****** Object: &nbsp;Step [caller] &nbsp; &nbsp;Script Date: 03/26/2009 08:31:35 ******/</span>
<span class="kw1">EXEC</span> @ReturnCode <span class="sy0">=</span> msdb.<span class="me1">dbo</span>.<span class="kw3">sp_add_jobstep</span> @job_id<span class="sy0">=</span>@jobId, @step_name<span class="sy0">=</span>N<span class="st0">'caller'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @step_id<span class="sy0">=</span><span class="nu0">1</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @cmdexec_success_code<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @on_success_action<span class="sy0">=</span><span class="nu0">1</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @on_success_step_id<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @on_fail_action<span class="sy0">=</span><span class="nu0">2</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @on_fail_step_id<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @retry_attempts<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @retry_interval<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @os_run_priority<span class="sy0">=</span><span class="nu0">0</span>, @subsystem<span class="sy0">=</span>N<span class="st0">'TSQL'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @command<span class="sy0">=</span>N<span class="st0">'if (select vol_status from VOL_MONITOR) &lt;= 2000</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Begin</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EXEC msdb.dbo.sp_send_dbmail @recipients='</span><span class="st0">'manager_group@companym.com'</span><span class="st0">',</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @subject = '</span><span class="st0">'Plant 01 volume reaching maximum capacity'</span><span class="st0">',</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @body = '</span><span class="st0">'Plant 01 volume reaching maximum capacity'</span><span class="st0">',</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @body_format = '</span><span class="st0">'HTML'</span><span class="st0">',</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @profile_name = '</span><span class="st0">'DBA01'</span><span class="st0">'</span>
<span class="st0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; End'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @database_name<span class="sy0">=</span>N<span class="st0">'DBA05'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @flags<span class="sy0">=</span><span class="nu0">0</span>
<span class="kw1">IF</span> <span class="br0">&#40;</span><span class="kw2">@@ERROR</span> <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span> <span class="sy0">OR</span> @ReturnCode <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">GOTO</span> QuitWithRollback
<span class="kw1">EXEC</span> @ReturnCode <span class="sy0">=</span> msdb.<span class="me1">dbo</span>.<span class="kw3">sp_update_job</span> @job_id <span class="sy0">=</span> @jobId, @start_step_id <span class="sy0">=</span> <span class="nu0">1</span>
<span class="kw1">IF</span> <span class="br0">&#40;</span><span class="kw2">@@ERROR</span> <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span> <span class="sy0">OR</span> @ReturnCode <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">GOTO</span> QuitWithRollback
<span class="kw1">EXEC</span> @ReturnCode <span class="sy0">=</span> msdb.<span class="me1">dbo</span>.<span class="kw3">sp_add_jobschedule</span> @job_id<span class="sy0">=</span>@jobId, @name<span class="sy0">=</span>N<span class="st0">'30 minutes'</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @enabled<span class="sy0">=</span><span class="nu0">1</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @freq_type<span class="sy0">=</span><span class="nu0">4</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @freq_interval<span class="sy0">=</span><span class="nu0">1</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @freq_subday_type<span class="sy0">=</span><span class="nu0">4</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @freq_subday_interval<span class="sy0">=</span><span class="nu0">30</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @freq_relative_interval<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @freq_recurrence_factor<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @active_start_date<span class="sy0">=</span><span class="nu0">20090324</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @active_end_date<span class="sy0">=</span><span class="nu0">99991231</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @active_start_time<span class="sy0">=</span><span class="nu0">0</span>, 
&nbsp; &nbsp; &nbsp; &nbsp; @active_end_time<span class="sy0">=</span><span class="nu0">235959</span>
<span class="kw1">IF</span> <span class="br0">&#40;</span><span class="kw2">@@ERROR</span> <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span> <span class="sy0">OR</span> @ReturnCode <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">GOTO</span> QuitWithRollback
<span class="kw1">EXEC</span> @ReturnCode <span class="sy0">=</span> msdb.<span class="me1">dbo</span>.<span class="kw3">sp_add_jobserver</span> @job_id <span class="sy0">=</span> @jobId, @server_name <span class="sy0">=</span> N<span class="st0">'(local)'</span>
<span class="kw1">IF</span> <span class="br0">&#40;</span><span class="kw2">@@ERROR</span> <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span> <span class="sy0">OR</span> @ReturnCode <span class="sy0">&lt;&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">GOTO</span> QuitWithRollback
<span class="kw1">COMMIT</span> <span class="kw1">TRANSACTION</span>
<span class="kw1">GOTO</span> EndSave
QuitWithRollback:
&nbsp; &nbsp; <span class="kw1">IF</span> <span class="br0">&#40;</span><span class="kw2">@@TRANCOUNT</span> <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">ROLLBACK</span> <span class="kw1">TRANSACTION</span>
EndSave:</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @jobId BINARY(16)
EXEC @ReturnCode =  msdb.dbo.sp_add_job @job_name=N'Capacity Restriction Monitor Plant 01', 
		@enabled=1, 
		@notify_level_eventlog=0, 
		@notify_level_email=0, 
		@notify_level_netsend=0, 
		@notify_level_page=0, 
		@delete_level=0, 
		@description=N'Monitors the levels of units allowe to be manufactured in plant 01.', 
		@category_name=N'[Uncategorized (Local)]', 
		@owner_login_name=N'{user}', @job_id = @jobId OUTPUT
IF (@@ERROR &lt;&gt; 0 OR @ReturnCode &lt;&gt; 0) GOTO QuitWithRollback
/****** Object:  Step [caller]    Script Date: 03/26/2009 08:31:35 ******/
EXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'caller', 
		@step_id=1, 
		@cmdexec_success_code=0, 
		@on_success_action=1, 
		@on_success_step_id=0, 
		@on_fail_action=2, 
		@on_fail_step_id=0, 
		@retry_attempts=0, 
		@retry_interval=0, 
		@os_run_priority=0, @subsystem=N'TSQL', 
		@command=N'if (select vol_status from VOL_MONITOR) &lt;= 2000
		  Begin
			EXEC msdb.dbo.sp_send_dbmail @recipients=''manager_group@companym.com'',
				@subject = ''Plant 01 volume reaching maximum capacity'',
				@body = ''Plant 01 volume reaching maximum capacity'',
				@body_format = ''HTML'',
				@profile_name = ''DBA01''
		  End', 
		@database_name=N'DBA05', 
		@flags=0
IF (@@ERROR &lt;&gt; 0 OR @ReturnCode &lt;&gt; 0) GOTO QuitWithRollback
EXEC @ReturnCode = msdb.dbo.sp_update_job @job_id = @jobId, @start_step_id = 1
IF (@@ERROR &lt;&gt; 0 OR @ReturnCode &lt;&gt; 0) GOTO QuitWithRollback
EXEC @ReturnCode = msdb.dbo.sp_add_jobschedule @job_id=@jobId, @name=N'30 minutes', 
		@enabled=1, 
		@freq_type=4, 
		@freq_interval=1, 
		@freq_subday_type=4, 
		@freq_subday_interval=30, 
		@freq_relative_interval=0, 
		@freq_recurrence_factor=0, 
		@active_start_date=20090324, 
		@active_end_date=99991231, 
		@active_start_time=0, 
		@active_end_time=235959
IF (@@ERROR &lt;&gt; 0 OR @ReturnCode &lt;&gt; 0) GOTO QuitWithRollback
EXEC @ReturnCode = msdb.dbo.sp_add_jobserver @job_id = @jobId, @server_name = N'(local)'
IF (@@ERROR &lt;&gt; 0 OR @ReturnCode &lt;&gt; 0) GOTO QuitWithRollback
COMMIT TRANSACTION
GOTO EndSave
QuitWithRollback:
    IF (@@TRANCOUNT &gt; 0) ROLLBACK TRANSACTION
EndSave:</pre></div></div>

<p>So far we have successfully created a table to hold our capacity values that we negate based on units<br />
sent to eh facility and we have a job to monitor the capacity.  Problem is the job will send out an<br />
email to management every 30 minutes which is not something managers like much.  In order to keep the<br />
DBA from manually going in after the notification is sent we need to disable the job.  We can<br />
use sp_udpate_job to get that task done.</p>
<p>First query the sysjob table in MSDB to grab the job_id.  You can also use the name of the job but I<br />
think that is prone to typos and copying the job_id directly out of sysjob is a bit more stable.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> job_id,<span class="br0">&#91;</span>name<span class="br0">&#93;</span> <span class="kw1">from</span> msdb.<span class="me1">dbo</span>.<span class="me1">sysjobs</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select job_id,[name] from msdb.dbo.sysjobs</pre></div></div>

<p>This shows &#8220;8386ED61-E2A8-4DE5-B54C-4A7DFD3CDDEC&#8221; for the Capacity Restriction Monitor Plant 01 job_id</p>
<p>Syntax for sp_update_job is as follows.  One key note is you can use job_name or job_id to update the job with<br />
this system procedure BUT you cannot specify both.  Other questions I hear are does the SP update other properties<br />
when you do not specify them.  The answer is no, the SP will only update what parameter you specify.  </p>
<p>syntax</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="de1"><pre class="de1"><span class="kw3">sp_update_job</span> <span class="br0">&#91;</span> @job_id <span class="sy0">=</span><span class="br0">&#93;</span> job_id <span class="sy0">|</span> <span class="br0">&#91;</span>@job_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'job_name'</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@new_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'new_name'</span> <span class="br0">&#93;</span> 
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@enabled <span class="sy0">=</span><span class="br0">&#93;</span> enabled <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@description <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'description'</span> <span class="br0">&#93;</span> 
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@start_step_id <span class="sy0">=</span><span class="br0">&#93;</span> step_id <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@category_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'category'</span> <span class="br0">&#93;</span> 
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@owner_login_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'login'</span> <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_level_eventlog <span class="sy0">=</span><span class="br0">&#93;</span> eventlog_level <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_level_email <span class="sy0">=</span><span class="br0">&#93;</span> email_level <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_level_netsend <span class="sy0">=</span><span class="br0">&#93;</span> netsend_level <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_level_page <span class="sy0">=</span><span class="br0">&#93;</span> page_level <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_email_operator_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'email_name'</span> <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_netsend_operator_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'netsend_operator'</span> <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#91;</span>, <span class="br0">&#91;</span>@notify_page_operator_name <span class="sy0">=</span><span class="br0">&#93;</span> <span class="st0">'page_operator'</span> <span class="br0">&#93;</span>
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@delete_level <span class="sy0">=</span><span class="br0">&#93;</span> delete_level <span class="br0">&#93;</span> 
&nbsp; &nbsp; &nbsp;<span class="br0">&#91;</span>, <span class="br0">&#91;</span>@automatic_post <span class="sy0">=</span><span class="br0">&#93;</span> automatic_post <span class="br0">&#93;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_update_job [ @job_id =] job_id | [@job_name =] 'job_name'
     [, [@new_name =] 'new_name' ] 
     [, [@enabled =] enabled ]
     [, [@description =] 'description' ] 
     [, [@start_step_id =] step_id ]
     [, [@category_name =] 'category' ] 
     [, [@owner_login_name =] 'login' ]
     [, [@notify_level_eventlog =] eventlog_level ]
     [, [@notify_level_email =] email_level ]
     [, [@notify_level_netsend =] netsend_level ]
     [, [@notify_level_page =] page_level ]
     [, [@notify_email_operator_name =] 'email_name' ]
          [, [@notify_netsend_operator_name =] 'netsend_operator' ]
          [, [@notify_page_operator_name =] 'page_operator' ]
     [, [@delete_level =] delete_level ] 
     [, [@automatic_post =] automatic_post ]</pre></div></div>

<p>So to form this call and disable the job we need to add to the job this statement.</p>
<p>After the db mail send put issue a Go and then add</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">Exec</span> msdb.<span class="me1">dbo</span>.<span class="kw3">sp_update_job</span> @job_id <span class="sy0">=</span> <span class="st0">'8386ED61-E2A8-4DE5-B54C-4A7DFD3CDDEC'</span> , @enabled <span class="sy0">=</span> <span class="nu0">0</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Exec msdb.dbo.sp_update_job @job_id = '8386ED61-E2A8-4DE5-B54C-4A7DFD3CDDEC' , @enabled = 0</pre></div></div>

<p>Now when the job runs it will send the notifications out and disable the job so no further<br />
notifications will be sent.  </p>
<p>Every night at midnight we stated the volume should be replenished to the maximum allowed units.  This is<br />
simply another job to reset the Vol_Status in our table to the value in Volume.  The added requirement we need to<br />
add to that job is re-enabling out monitor.  If we don&#8217;t then the call to change the enable value in sysjob will remain<br />
0 and the we break out monitoring process.  So create another job scheduled for midnight with the statement of</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">Update</span> mem_vol <span class="kw1">set</span> vol_status <span class="sy0">=</span> volume
Go
<span class="kw1">Exec</span> msdb..<span class="kw3">sp_update_job</span> @job_id <span class="sy0">=</span> <span class="st0">'8386ED61-E2A8-4DE5-B54C-4A7DFD3CDDEC'</span> , @enabled <span class="sy0">=</span> <span class="nu0">1</span>
Go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Update mem_vol set vol_status = volume
Go
Exec msdb..sp_update_job @job_id = '8386ED61-E2A8-4DE5-B54C-4A7DFD3CDDEC' , @enabled = 1
Go</pre></div></div>

<p>Now the process has gone through a complete cycle and the monitor and volume count starts clean.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/sql-agent-job-notifications/'>SQL Agent Job Notifications</a><p>This falls under DBA scripting and automation. I am going to try to key on&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/sql-agent-job-history-purging/'>SQL Server Agent Job history purging</a><p>Most often early in a DBA's career they will go off on a job creation&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2>Ted Krueger is a SQL Server MVP and Author that has been working in development and database administration and the owner of a successful consulting business, DataMetrics Consulting.  Specialties range from High Availability and Disaster / Recovery setup and testing methods down to custom assembly development for SQL Server Reporting Services.  Ted blogs and is also one of the founders of LessThanDot.com technology community.  Some of the articles focused on are Backup / Recovery, Security, SSIS and working on SQL Server and using all of the SQL Server features available to create stable and scalable database services.  <br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/onpnt" title="onpnt at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.facebook.com/profile.php?id=https://www.facebook.com/onpntfirearms" title="onpnt at Facebook" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Facebook" /></a><a href="http://www.linkedin.com/pub/ted-krueger/2/183/b66" title="onpnt at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://www.datametricsconsulting.com/" title="onpnt at HomePage" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_homepage.png" alt="HomePage" /></a><a href="/index.php/author/onpnt/feed/" title="Blog RSS feed for onpnt" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 8,710 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/onpnt/">Read More Posts by Ted Krueger (onpnt)</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&text=RT @LessThanDot Blog - Disable SQL Agent Jobs with TSQL based on events by @onpnt" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&title=Disable SQL Agent Jobs with TSQL based on events&source=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&title=Disable SQL Agent Jobs with TSQL based on events" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&quote=Disable SQL Agent Jobs with TSQL based on events" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/&title=Disable SQL Agent Jobs with TSQL based on events" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		2 Comments	</h4>
			<ol class="comments-list">
					<li class="comment byuser comment-author-emtucifor even thread-even depth-1" id="comment-1108">
				<div id="div-comment-1108" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/27d6e9660735af7bad858dbf2f1eecbc?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/27d6e9660735af7bad858dbf2f1eecbc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Erik</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/#comment-1108">
			March 26, 2009 at 5:16 pm</a>		</div>

		<p>Instead of doing the complicated stuff of altering jobs (which I admit could be really useful), it would be a lot simpler to just store the &#8220;last notified datetime&#8221; in a table, and only send the notification when the current date is greater than the last notified date. That way your scheduled task can run as often as you want but only one notification per day will be sent.</p>
<p>Rather than using a &#8220;last notified datetime&#8221; it might make sense for someone to use &#8220;next notify datetime&#8221;. It might also make sense to work in some logic so that a new notification goes out only after the alert-condition has gone through a false phase first. (Such as, once capacity is under 1000, no new notification can be sent until it has exceeded 1000 and then dropped under again). This can be done with a simple bit column. Combined with the &#8220;last notified datetime&#8221; you can fine tune your IF statement all you like and not need to modify jobs.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/?replytocom=1108#respond' onclick='return addComment.moveForm( "div-comment-1108", "1108", "respond", "367" )' aria-label='Reply to Erik'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1109">
				<div id="div-comment-1109" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ce888ed68c0c393487310f5057a5f01d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/ce888ed68c0c393487310f5057a5f01d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.pakistanjobs.pk/' rel='external nofollow' class='url'>Qaisera</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/#comment-1109">
			April 6, 2009 at 10:28 pm</a>		</div>

		<p>I first time visit in this post.  I find this post is very useful and workable.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/?replytocom=1109#respond' onclick='return addComment.moveForm( "div-comment-1109", "1109", "respond", "367" )' aria-label='Reply to Qaisera'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/datadesign/disable-sql-agent-jobs-with-tsql-based-o/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='367' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="69421f032498c97020180038fddb8e24"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765822"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
