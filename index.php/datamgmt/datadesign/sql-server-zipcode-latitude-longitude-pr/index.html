<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   SQL Server Zipcode Latitude/Longitude proximity distance search</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   SQL Server Zipcode Latitude/Longitude proximity distance search" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Have you ever wanted to add functionality that allows you to perform simple radius searches based on Zip Code?  For example, Show me all the cities within 20 miles of a certain zip code or show me the 5 closest retail locations. You can easily add this&hellip;" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; SQL Server Zipcode Latitude/Longitude proximity distance search Comments Feed" href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Kaspersky Web Site Hacked With SQL Injection, How Embarrassing Is This?' href='/index.php/datamgmt/datadesign/kaspersky-web-site-hacked-with-sql-injec/' />
<link rel='next' title='SQL Server 2008 Proximity Search With The Geography Data Type' href='/index.php/datamgmt/datadesign/sql-server-2008-proximity-search-with-th/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/" />
<link rel='shortlink' href='/?p=323' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fsql-server-zipcode-latitude-longitude-pr%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fsql-server-zipcode-latitude-longitude-pr%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/datamgmt/datadesign/sql-server-2008-proximity-search-with-th/" rel="next">SQL Server 2008 Proximity Search With The Geography Data Type</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/datamgmt/datadesign/kaspersky-web-site-hacked-with-sql-injec/" rel="prev">Kaspersky Web Site Hacked With SQL Injection, How Embarrassing Is This?</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/" class="post-title">SQL Server Zipcode Latitude/Longitude proximity distance search</a></h1>
					<div class="post-byline">by <a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)" rel="author">George Mastros (gmmastros)</a> on February 11, 2009 in category <a href="/index.php/category/datamgmt/datadesign/" rel="category tag">Data Modelling and Design</a> <a href="/index.php/category/datamgmt/dbprogramming/mssqlserver/" rel="category tag">Microsoft SQL Server</a>. Article views: 154,829 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&text=RT @LessThanDot Blog - SQL Server Zipcode Latitude/Longitude proximity distance search by @gmmastros" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&title=SQL Server Zipcode Latitude/Longitude proximity distance search&source=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&title=SQL Server Zipcode Latitude/Longitude proximity distance search" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&quote=SQL Server Zipcode Latitude/Longitude proximity distance search" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&title=SQL Server Zipcode Latitude/Longitude proximity distance search" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>Have you ever wanted to add functionality that allows you to perform simple radius searches based on Zip Code?  For example, Show me all the cities within 20 miles of a certain zip code or show me the 5 closest retail locations. You can easily add this functionality to your database by importing a zip code database and writing a little code.  This article will show you where to get zip code data, how to import it to your database, and how to use the data to perform proximity searches.</p>
<p>Denis and I decided to show you how you can do simple radius searches based on Zip Codes, he did the SQL 2008 version here: /index.php/DataMgmt/DataDesign/sql-server-2008-proximity-search-with-th (using the geography data type) and I did the SQL Server 2000/2005 version.</p>
<p>The first thing we need to do is load our data.  There are various sources for this data, ranging from free to expensive monthly subscriptions. One source of free data is: http://download.geonames.org/export/zip/</p>
<p><span class="MT_red"><strong>** Note:</strong></span> Based on a comment from Steve_O, the format of the geonames file recently changed.  I have no control over those changes, and am not notified when changes occur.  If you have difficulty loading the data from the file in to the table, you may need to investigate the structure of the data to see if anything has changed.</p>
<p>Once you have downloaded your data, the next step is to import it in to your database.  You can use the following script to do it.</p>
<pre>If Exists(Select * 
          From   Information_Schema.Tables 
          Where  Table_Name = 'ZipCodes' 
                 And Table_Type = 'Base Table')
  Drop Table ZipCodes

CREATE TABLE [dbo].[ZipCodes](
[country code] [varchar](2) NULL,
[postal code] [varchar](20) NULL,
[place name] [varchar](180) NULL,
[admin name1] [varchar](100) NULL,
[admin code1] [varchar](20) NULL,
[admin name2] [varchar](100) NULL,
[admin code2] [varchar](20) NULL,
[admin name3] [varchar](100) NULL,
[admin code3] [varchar](20) NULL,
[latitude] [decimal](8, 4) NULL,
[longitude] [decimal](8, 4) NULL,
[accuracy] [int] NULL
)

DECLARE @bulk_cmd varchar(1000)
SET @bulk_cmd = 'BULK INSERT ZipCodes
    FROM ''C:YourFolderUS.txt''
    WITH (FIELDTERMINATOR=''t'', ROWTERMINATOR = '''+CHAR(10)+''')'

EXEC(@bulk_cmd)

Alter Table ZipCodes Drop Column Unused1, Unused2, Unused3

CREATE CLUSTERED INDEX IX_ZipCodes_Zip ON dbo.ZipCodes(ZipCode, Longitude, Latitude)
GO
CREATE NONCLUSTERED INDEX IX_ZipCodes_Longitude_Latitude ON dbo.ZipCodes(Longitude,Latitude, ZipCode)

GO

Select * From ZipCodes</pre>
<p>Next, we’ll need to add a couple of functions that will allow us to use this data.</p>
<p>The original function that calculates distances has been replaced with this one.  There was a flaw in the original version.  Based on rounding errors, the calculations fed in to the arc-cosine (acos) function could be greater than 1 or less than -1 which would cause a domain error.  To accommodate this flaw, I perform the calculations in multiple steps so that I can catch the values that result in the domain error.  </p>
<p>Credit for finding the flaw goes to <span class="MT_red"><strong>Chris</strong></span>.  Thank you.</p>
<pre>CREATE Function [dbo].[CalculateDistance]
	(@Longitude1 Decimal(8,5), 
	@Latitude1   Decimal(8,5),
	@Longitude2  Decimal(8,5),
	@Latitude2   Decimal(8,5))
Returns Float
As
Begin
Declare @Temp Float

Set @Temp = sin(@Latitude1/57.2957795130823) * sin(@Latitude2/57.2957795130823) + cos(@Latitude1/57.2957795130823) * cos(@Latitude2/57.2957795130823) * cos(@Longitude2/57.2957795130823 - @Longitude1/57.2957795130823)

if @Temp &gt; 1 
	Set @Temp = 1
Else If @Temp &lt; -1
	Set @Temp = -1

Return (3958.75586574 * acos(@Temp)	) 

End</pre>
<pre>Create Function [dbo].[LatitudePlusDistance](@StartLatitude Float, @Distance Float) Returns Float
As
Begin
    Return (Select @StartLatitude + Sqrt(@Distance * @Distance / 4766.8999155991))
End</pre>
<pre>Create Function [dbo].[LongitudePlusDistance]
    (@StartLongitude Float,
    @StartLatitude Float,
    @Distance Float)
Returns Float
AS
Begin
    Return (Select @StartLongitude + Sqrt(@Distance * @Distance / (4784.39411916406 * Cos(2 * @StartLatitude / 114.591559026165) * Cos(2 * @StartLatitude / 114.591559026165))))
End</pre>
<p>Finally, we can begin writing some interesting queries.  For example, return a list of zipcodes within 20 miles of zipcode 20013 (Washington, DC).</p>
<pre>-- Declare some variables that we will need.
Declare @Longitude Decimal(8,5),
        @Latitude Decimal(8,5),
        @MinLongitude Decimal(8,5),
        @MaxLongitude Decimal(8,5),
        @MinLatitude Decimal(8,5),
        @MaxLatitude Decimal(8,5)

-- Get the lat/long for the given zip
Select @Longitude = Longitude,
       @Latitude = Latitude
From   ZipCodes
Where  ZipCode = '20013'

-- Calculate the Max Lat/Long
Select @MaxLongitude = dbo.LongitudePlusDistance(@Longitude, @Latitude, 20),
       @MaxLatitude = dbo.LatitudePlusDistance(@Latitude, 20)

-- Calculate the min lat/long
Select @MinLatitude = 2 * @Latitude - @MaxLatitude,
       @MinLongitude = 2 * @Longitude - @MaxLongitude

-- The query to return all zips within a certain distance
Select ZipCode
From   ZipCodes
Where  Longitude Between @MinLongitude And @MaxLongitude
       And Latitude Between @MinLatitude And @MaxLatitude
       And dbo.CalculateDistance(@Longitude, @Latitude, Longitude, Latitude) &lt;= 20</pre>
<p>You could also use this for a &#8220;store locator&#8221;.  On a website, potential customers could enter their zipcode and you could present a list of top 5 closest stores.<br />
The query shown below assumes you have a Stores table with a ZipCode column.</p>
<pre>Declare @Longitude Decimal(8,5)
Declare @Latitude Decimal(8,5)

Select	@Longitude = Longitude,
		@Latitude = Latitude
From	ZipCodes
Where	ZipCode = '20013'

Select  Top 5 Stores.StoreName, ZipCodes.City,  dbo.CalculateDistance(@Longitude, @Latitude, ZipCodes.Longitude, ZipCodes.Latitude) As Distance 
From	@Stores As Stores
		Inner Join ZipCodes 
			On Stores.ZipCode = ZipCodes.ZipCode
Order By dbo.CalculateDistance(@Longitude, @Latitude, ZipCodes.Longitude, ZipCodes.Latitude)</pre>
<p>As you can see, these queries perform very well, and are relatively easy to write.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/sql-server-2008-proximity-search-with-th/'>SQL Server 2008 Proximity Search With The Geography Data Type</a><p>George and I decided to show you how you can do simple radius searches based&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/distance-calculation-showdown/'>Distance Calculation Showdown</a><p>A while back George, Denis and I did a series of posts on calculating distance&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2>George has been developing software professionally for 19 years, first for the department of defense, and then for various other companies.  In 1998, George started his software company, Orbit Software, specializing in School Bus Transportation software.  His specialty is refining SQL Server queries to deliver optimal performance.<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/gmmastros" title="gmmastros at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="/index.php/author/gmmastros/feed/" title="Blog RSS feed for gmmastros" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 154,829 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/gmmastros/">Read More Posts by George Mastros (gmmastros)</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&text=RT @LessThanDot Blog - SQL Server Zipcode Latitude/Longitude proximity distance search by @gmmastros" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&title=SQL Server Zipcode Latitude/Longitude proximity distance search&source=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&title=SQL Server Zipcode Latitude/Longitude proximity distance search" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&quote=SQL Server Zipcode Latitude/Longitude proximity distance search" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/&title=SQL Server Zipcode Latitude/Longitude proximity distance search" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		85 Comments	</h4>
			<ol class="comments-list">
					<li class="comment byuser comment-author-alexcuse even thread-even depth-1" id="comment-865">
				<div id="div-comment-865" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Alex Ullrich</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-865">
			February 12, 2009 at 7:39 pm</a>		</div>

		<p>I haven&#8217;t used your new function (I will have to do another test) but in SQL 2005 you can also use the CLR functions very effectively for calculations like this:</p>
<p><a href="/index.php/DataMgmt/DBProgramming/sql-server-distance-calculation-option-3" rel="nofollow">/index.php/DataMgmt/DBProgramming/sql-server-distance-calculation-option-3</a></p>
<p>I&#8217;m taking a better look at Denis&#8217; 2008 method right now, I want to test all three later.  I&#8217;d like to take a look at the new function against the other one (which I stole from you as well) and see how they stack up too.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=865#respond' onclick='return addComment.moveForm( "div-comment-865", "865", "respond", "323" )' aria-label='Reply to Alex Ullrich'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-SQLDenis odd alt thread-odd thread-alt depth-1" id="comment-866">
				<div id="div-comment-866" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">SQLDenis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-866">
			February 13, 2009 at 4:34 am</a>		</div>

		<p>Alex maybe you should create a post showing how to do it with the CLR</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=866#respond' onclick='return addComment.moveForm( "div-comment-866", "866", "respond", "323" )' aria-label='Reply to SQLDenis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-868">
				<div id="div-comment-868" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/de384bb2939d364ff6cf4725a85d5e38?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/de384bb2939d364ff6cf4725a85d5e38?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Chris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-868">
			February 13, 2009 at 8:35 am</a>		</div>

		<p>Thanks for sharing this.  I&#8217;m trying it out now.</p>
<p>I went looking for information on how to calculate distances using longitude and latitude using kilometers and came across this page: <a href="http://www.meridianworlddata.com/Distance-Calculation.asp" rel="nofollow">http://www.meridianworlddata.com/Distance-Calculation.asp</a></p>
<p>On there they list the following values that could be substituted for the first value in your CalculateDistance function:<br />
3437.74677 (nautical miles)<br />
6378.7 (kilometers)<br />
3963.0 (statute miles)</p>
<p>You used a value of 3958.75586574 &#8211; how did you arrive at your value?</p>
<p>I might suggest adding another input to the CalculateDistance function to allow for results to be generated in different units of measure (miles vs. kilometers).  I&#8217;ve done the same here but thought others could benefit from the same.</p>
<p>Thanks again.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=868#respond' onclick='return addComment.moveForm( "div-comment-868", "868", "respond", "323" )' aria-label='Reply to Chris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcuse odd alt thread-odd thread-alt depth-1" id="comment-869">
				<div id="div-comment-869" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Alex Ullrich</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-869">
			February 13, 2009 at 9:44 am</a>		</div>

		<p>Denis, its&#8217; in the link.  I guess I could post it here too but that would not be very DRY of me 😉</p>
<p>Actually it could be helpful for others to have all three in one place (then we could do a wrap-up post testing them all).  I&#8217;ll revisit the CLR version when I get a chance, or if I&#8217;m lazy just take the relevant bits out of that post.</p>
<p>Expect to see it next week.  I&#8217;ll stop rambling now!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=869#respond' onclick='return addComment.moveForm( "div-comment-869", "869", "respond", "323" )' aria-label='Reply to Alex Ullrich'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-871">
				<div id="div-comment-871" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/de384bb2939d364ff6cf4725a85d5e38?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/de384bb2939d364ff6cf4725a85d5e38?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Chris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-871">
			February 13, 2009 at 4:17 pm</a>		</div>

		<p>I worked with the code today and have a few more thoughts:</p>
<p>I downloaded the source zip code data using the link you provided.  You should know that there are a small number of instances when a single zipcode has multiple rows in the table.  I believe this happens when a zipcode spans multiple cities.  For my uses I’m picking the first record from each zipcode so as not to duplicate my results.</p>
<p>I did run into some errors:<br />
Trying to calculate the distance between ZipCode 11779 and itself throws the following error in SQL Server 2000:<br />
“A domain error occurred.”<br />
This doesn’t happen for all zipcodes, though.  Most seem to produce a very small distance difference and round out to 0.  Handling matching zipcodes up-front would take care of this.  I’ve also seen cases where two zip codes have the same coordinates (e.g., 72035 and 72033) and this can cause the same error.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=871#respond' onclick='return addComment.moveForm( "div-comment-871", "871", "respond", "323" )' aria-label='Reply to Chris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-873">
				<div id="div-comment-873" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-873">
			February 13, 2009 at 4:35 pm</a>		</div>

		<p>Chris,</p>
<p>It well known that some zip codes span multiple cities/towns.  It&#8217;s also well known that some cities have multiple zip codes.</p>
<p>I figured out what causes the domain error.  The CalculateDistance function uses the arc-cosine (acos) function.  It&#8217;s well documented in books on line that acos returns a domain error if you supply a value less than -1 or greater than +1.  Identification is half the battle, right.  I will post back again with a solution to this problem.</p>
<p>Thank you very much for bringing this to my attention.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=873#respond' onclick='return addComment.moveForm( "div-comment-873", "873", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-875">
				<div id="div-comment-875" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-875">
			February 13, 2009 at 4:49 pm</a>		</div>

		<p>Chris,</p>
<p>I modified the function to accommodate this problem.  I edited the blog to replace the flawed version of the function.</p>
<p>Thanks again for pointing out the problem.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=875#respond' onclick='return addComment.moveForm( "div-comment-875", "875", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-876">
				<div id="div-comment-876" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f7670ec0146ba2164fb3430e86978fa2?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f7670ec0146ba2164fb3430e86978fa2?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Dale R. Whitaker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-876">
			February 15, 2009 at 6:09 am</a>		</div>

		<p>I like this and admire what you shared with others.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=876#respond' onclick='return addComment.moveForm( "div-comment-876", "876", "respond", "323" )' aria-label='Reply to Dale R. Whitaker'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-864">
				<div id="div-comment-864" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/31f2e8b3fc566ef7067b49079eb53232?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/31f2e8b3fc566ef7067b49079eb53232?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Doug</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-864">
			March 31, 2009 at 12:30 pm</a>		</div>

		<p>Since @Distance is squared, how does one ask for a logitude 5 miles less than the one specified?<br />
It seems like the distance calculations are not valid fro negative numbers, true?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=864#respond' onclick='return addComment.moveForm( "div-comment-864", "864", "respond", "323" )' aria-label='Reply to Doug'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-844">
				<div id="div-comment-844" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/285d7cf571fca900956e620c67578600?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/285d7cf571fca900956e620c67578600?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">JayZ</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-844">
			May 5, 2009 at 8:57 am</a>		</div>

		<p>Very nice work, you saved me a lot of time.</p>
<p>Thanks you!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=844#respond' onclick='return addComment.moveForm( "div-comment-844", "844", "respond", "323" )' aria-label='Reply to JayZ'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-852">
				<div id="div-comment-852" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9d8218977d627b96180742d645d4f651?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9d8218977d627b96180742d645d4f651?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Henryc</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-852">
			May 14, 2009 at 9:40 pm</a>		</div>

		<p>Hello all,<br />
Nice work. We are working on an application where <br />
2 zip codes are entered in the same query and we want to have the option of varying the mileage radii around each zip code entered and we need to return a list of all the zip code values found in each radius set. <br />
For example, enter 30301 for origin and 50008 for destination and 20 mile radius around origin and 25 mile radius around the destination. Each record set stored in the database will contain origin and destiation zip codes. The table of zip code values will be compared to zip code table and any records where the origin and destination zip codes in the stored table that are included in the 2 sets will return these records, others will be excluded. Can you give any suggestions of the best way to construct this?<br />
Thanks</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=852#respond' onclick='return addComment.moveForm( "div-comment-852", "852", "respond", "323" )' aria-label='Reply to Henryc'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-857">
				<div id="div-comment-857" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/d573124bc7cfbb91eafcf9e9d5c32367?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/d573124bc7cfbb91eafcf9e9d5c32367?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">rod marsh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-857">
			May 19, 2009 at 3:39 am</a>		</div>

		<p>Great work.  Thank you very much.  Just incorporated this into a complicated search query and it worked a treat. A++</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=857#respond' onclick='return addComment.moveForm( "div-comment-857", "857", "respond", "323" )' aria-label='Reply to rod marsh'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-829">
				<div id="div-comment-829" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/6e3d50b43f9a24c6a39d559c71249fc4?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/6e3d50b43f9a24c6a39d559c71249fc4?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Smoker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-829">
			June 30, 2009 at 11:34 pm</a>		</div>

		<p>Can Someone tell me what&#8217;s the exact formula to calculate maximum latitude<br />
 and longitude</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=829#respond' onclick='return addComment.moveForm( "div-comment-829", "829", "respond", "323" )' aria-label='Reply to Smoker'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-830">
				<div id="div-comment-830" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-830">
			July 1, 2009 at 5:37 am</a>		</div>

		<p>@Smoker,</p>
<p>Your question confuses me.  Normally, Longitude has a range of -180 to +180 and Latitude has a range -90 to 90.  </p>
<p>Since these are constants, no formula is needed.</p>
<p>I suspect your question is more complicated than this.  As such, I encourage you to post a question on our forum, and I will be glad to help you out.  Please post your question here:</p>
<p><a href="http://forum.lessthandot.com/viewforum.php?f=17" rel="nofollow">http://forum.lessthandot.com/viewforum.php?f=17</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=830#respond' onclick='return addComment.moveForm( "div-comment-830", "830", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-833">
				<div id="div-comment-833" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/6e3d50b43f9a24c6a39d559c71249fc4?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/6e3d50b43f9a24c6a39d559c71249fc4?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Smoker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-833">
			July 1, 2009 at 8:56 am</a>		</div>

		<p>@George</p>
<p>Thanks for quick reply. I understand the range values but I want to know how<br />
you have calculated the values like 4784.39411916406 , 114.591559026165 ,<br />
4766.8999155991 in the LatitudePlusDistance and LongitudePlusDistance.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=833#respond' onclick='return addComment.moveForm( "div-comment-833", "833", "respond", "323" )' aria-label='Reply to Smoker'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-840">
				<div id="div-comment-840" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/69b5532063bb39d8f5283d9e2770a426?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/69b5532063bb39d8f5283d9e2770a426?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Maria</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-840">
			July 2, 2009 at 8:35 pm</a>		</div>

		<p>Hi George,</p>
<p>I was looking for the same kind of proximity search code base and found it here. <br />
Great Work. But In Functions LatitudePlusDistance and LongitudePlusDistance<br />
some Precalculated values are used like 4784.39411916406 , 114.591559026165 ,<br />
,4766.8999155991 which I am unable to understand. Can you please tell us how you have calculated those values</p>
<p>Thanks In Advance,<br />
Maria</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=840#respond' onclick='return addComment.moveForm( "div-comment-840", "840", "respond", "323" )' aria-label='Reply to Maria'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-895">
				<div id="div-comment-895" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/518667a889f39c167727c8047c5105bc?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/518667a889f39c167727c8047c5105bc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.naturalsolutionsmag.com/' rel='external nofollow' class='url'>Kris Boldt</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-895">
			July 30, 2009 at 3:51 pm</a>		</div>

		<p>Thanks for the code. It worked perfectly.  <br />
I was looking for a solution for this type of function and was having a hard time until I found this post. </p>
<p>Great job George!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=895#respond' onclick='return addComment.moveForm( "div-comment-895", "895", "respond", "323" )' aria-label='Reply to Kris Boldt'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-898">
				<div id="div-comment-898" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/fc478d29f6d8db3dd7f5959689b01ac2?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/fc478d29f6d8db3dd7f5959689b01ac2?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-898">
			August 1, 2009 at 2:53 pm</a>		</div>

		<p>This is great!  Thanks so much for sharing.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=898#respond' onclick='return addComment.moveForm( "div-comment-898", "898", "respond", "323" )' aria-label='Reply to John'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-859">
				<div id="div-comment-859" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f9cfd919e5442f5251ca08bd592589d0?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f9cfd919e5442f5251ca08bd592589d0?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Lou</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-859">
			August 29, 2009 at 9:36 am</a>		</div>

		<p>I cannot thank you enough for posting this&#8230;I&#8217;m working on an iPhone app to go along with an ASP-driven site that we have and I had no idea how to do this until I was directed to this article.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=859#respond' onclick='return addComment.moveForm( "div-comment-859", "859", "respond", "323" )' aria-label='Reply to Lou'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-896">
				<div id="div-comment-896" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/bd3882d0edbd8de91181ed26b035c19d?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/bd3882d0edbd8de91181ed26b035c19d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Michael</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-896">
			October 21, 2009 at 8:11 pm</a>		</div>

		<p>I used your setup and things for the most part appear the way they should. However, I have several that don&#8217;t seem to add up. </p>
<p>In comparing the results with Google Maps, some locations are off by a factor of 7. </p>
<p>For instance: <a href="http://www.google.com/maps?f=d&#038;source=s%5Fd&#038;saddr=10715+Downsville+Pike+Ste+100+MD+21740&#038;daddr=444+East+College+Ave+Ste+120+State+College+PA,+16801&#038;geocode=&#038;hl=en&#038;mra=ls&#038;sll=40.799159,-77.856052&#038;sspn=0.008836,0.01826&#038;g=444+East+College+Ave+Ste+120+State+College+PA,+16801&#038;ie=UTF8&#038;t=h&#038;z=8" rel="nofollow">http://www.google.com/maps?f=d&#038;source=s%5Fd&#038;saddr=10715+Downsville+Pike+Ste+100+MD+21740&#038;daddr=444+East+College+Ave+Ste+120+State+College+PA,+16801&#038;geocode=&#038;hl=en&#038;mra=ls&#038;sll=40.799159,-77.856052&#038;sspn=0.008836,0.01826&#038;g=444+East+College+Ave+Ste+120+State+College+PA,+16801&#038;ie=UTF8&#038;t=h&#038;z=8</a></p>
<p>Which uses these coordinates: <br />
long/lat<br />
40.799159,-77.856052<br />
40.22018,-78.140205</p>
<p>Google says the distance (driving) is 144 miles vs the query saying ~21 miles (as the crow flies). </p>
<p>I&#8217;ve looked up other people&#8217;s implementations and their calculations are practically the same. Such as: <a href="http://www.movable-type.co.uk/scripts/latlong.html" rel="nofollow">http://www.movable-type.co.uk/scripts/latlong.html</a> </p>
<p>Any ideas?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=896#respond' onclick='return addComment.moveForm( "div-comment-896", "896", "respond", "323" )' aria-label='Reply to Michael'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-897">
				<div id="div-comment-897" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-897">
			October 22, 2009 at 6:40 am</a>		</div>

		<p>Michael,</p>
<p>The calculate distance function I present here accepts 4 parameters.  It&#8217;s important that you send the data in to the function in the correct order.  Using your coordinates, if you pass lat,long,lat,long you will get 21 miles. If you pass long,lat,long,lat (the correct order of the parameters) you get 42.7 miles.</p>
<p>Using Google Earth (it has a straight line ruler tool), the distance between your coordinates is reported as 42.61.  The difference between Google Earth and my calculations is approximate 475 feet over the course of 42 miles (or 0.2% error).</p>
<p>By the way, your coordinates are wrong too.  They should be:<br />
40.798173,-77.856637<br />
39.607699,-77.753558</p>
<p>My distance calculation formula reports this as 82.4 miles (crow fly).  Google earth reports 82.2 miles.  Following a street network, Google earth reports 144 miles.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=897#respond' onclick='return addComment.moveForm( "div-comment-897", "897", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-818">
				<div id="div-comment-818" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/0254967b2d80ca777925ef1dd3aa444a?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/0254967b2d80ca777925ef1dd3aa444a?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Dhirendra Singh</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-818">
			October 26, 2009 at 4:15 am</a>		</div>

		<p>Great job George!<br />
Thanks for the code. It worked perfectly. </p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=818#respond' onclick='return addComment.moveForm( "div-comment-818", "818", "respond", "323" )' aria-label='Reply to Dhirendra Singh'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-894">
				<div id="div-comment-894" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo avatar-default' height='64' width='64' />			<cite class="fn"><a href='http://twitter.com/samsungln46b650' rel='external nofollow' class='url'>Saumsung Ln46b650</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-894">
			November 13, 2009 at 11:14 am</a>		</div>

		<p>I enjoyed your post. Thanks for sharing.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=894#respond' onclick='return addComment.moveForm( "div-comment-894", "894", "respond", "323" )' aria-label='Reply to Saumsung Ln46b650'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-emtucifor odd alt thread-odd thread-alt depth-1" id="comment-878">
				<div id="div-comment-878" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/27d6e9660735af7bad858dbf2f1eecbc?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/27d6e9660735af7bad858dbf2f1eecbc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Erik</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-878">
			December 14, 2009 at 5:13 pm</a>		</div>

		<p>For those who have been asking, the various constants used in George&#8217;s distance calculation come from:<br />
&#8211; Conversions to make different units of measure work: kilometers, miles, etc.<br />
&#8211; The nonuniform, ovoid shape of the Earth requiring different circumferences for equatorial vs. meridional calculations.<br />
&#8211; The particular Earth geometry system used. Some of these are NAD 27, NAD 83, WGS 84&#8211;see <a href="http://www.ngs.noaa.gov/faq.shtml" rel="nofollow">http://www.ngs.noaa.gov/faq.shtml</a> .</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=878#respond' onclick='return addComment.moveForm( "div-comment-878", "878", "respond", "323" )' aria-label='Reply to Erik'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi even thread-even depth-1" id="comment-851">
				<div id="div-comment-851" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-851">
			April 13, 2010 at 10:54 am</a>		</div>

		<p>George,</p>
<p>Why you&#8217;re using FLOAT for the @Temp?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=851#respond' onclick='return addComment.moveForm( "div-comment-851", "851", "respond", "323" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-816">
				<div id="div-comment-816" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/2efd1ec750126c8dddb494f2d0ef3c73?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/2efd1ec750126c8dddb494f2d0ef3c73?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">shankar</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-816">
			June 21, 2010 at 1:31 am</a>		</div>

		<p>Thanks for this script. Helped us.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=816#respond' onclick='return addComment.moveForm( "div-comment-816", "816", "respond", "323" )' aria-label='Reply to shankar'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-877">
				<div id="div-comment-877" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/312680f285e18dfc58e9cdc2f92a0d39?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/312680f285e18dfc58e9cdc2f92a0d39?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Kevin</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-877">
			July 8, 2010 at 8:49 am</a>		</div>

		<p>I am having an issue during the import process.  It seems that some of the data cannot be converted to Decimal(8, 5) and the bulk import fails because of this in the Longitude column </p>
<p>Any thoughts?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=877#respond' onclick='return addComment.moveForm( "div-comment-877", "877", "respond", "323" )' aria-label='Reply to Kevin'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-879">
				<div id="div-comment-879" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-879">
			July 8, 2010 at 9:19 am</a>		</div>

		<p>Kevin, can you tell me what you used for the source of your data so that I can (hopefully) reproduce the problem and fix it?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=879#respond' onclick='return addComment.moveForm( "div-comment-879", "879", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-880">
				<div id="div-comment-880" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/e347d31854e17e4aadbd768af5c0cec7?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/e347d31854e17e4aadbd768af5c0cec7?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Pollirrata</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-880">
			July 8, 2010 at 1:38 pm</a>		</div>

		<p>Great work!! It&#8217;s really nice having something like this&#8230;</p>
<p>@Kevin<br />
I faced some the same problem inserting Mexico&#8217;s data &#8217;cause the order of columns in txt file was different from script and our state abbreviations can be up to 4 characters&#8230; Just checking the file content worked for me &#8220;fixing&#8221; this issue&#8230; maybe this could help you&#8230;.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=880#respond' onclick='return addComment.moveForm( "div-comment-880", "880", "respond", "323" )' aria-label='Reply to Pollirrata'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-853">
				<div id="div-comment-853" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9d0cd1306970c301d6bb67758a8141ab?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9d0cd1306970c301d6bb67758a8141ab?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">RoyHink</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-853">
			July 30, 2010 at 11:46 am</a>		</div>

		<p>Great work, and Thank You for posting this!</p>
<p>I am a web coder (PHP/JS/Python) and know just enough SQL to do Selects, Updates and Joins. </p>
<p>I apologize upfront if I&#8217;m missing something basic and commonly understood!</p>
<p>I am running MSSQL 2000 on a WIN2003 R2 server</p>
<p>This code is throwing the following errors in Query Analyzer:</p>
<p>Server: Msg 156, Level 15, State 1, Procedure CalculateDistance, Line 21<br />
Incorrect syntax near the keyword &#8216;CREATE&#8217;.<br />
Server: Msg 111, Level 15, State 1, Procedure CalculateDistance, Line 21<br />
&#8216;CREATE FUNCTION&#8217; must be the first statement in a query batch.<br />
Server: Msg 137, Level 15, State 1, Procedure CalculateDistance, Line 24<br />
Must declare the variable &#8216;@StartLatitude&#8217;.<br />
Server: Msg 111, Level 15, State 1, Procedure CalculateDistance, Line 26<br />
&#8216;CREATE FUNCTION&#8217; must be the first statement in a query batch.<br />
Server: Msg 137, Level 15, State 1, Procedure CalculateDistance, Line 33<br />
Must declare the variable &#8216;@StartLongitude&#8217;.</p>
<p>Would you be willing to give me some direction?</p>
<p>Thanks</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=853#respond' onclick='return addComment.moveForm( "div-comment-853", "853", "respond", "323" )' aria-label='Reply to RoyHink'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-SQLDenis even thread-even depth-1" id="comment-854">
				<div id="div-comment-854" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">SQLDenis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-854">
			July 30, 2010 at 1:17 pm</a>		</div>

		<p>Roy, you need to either run each create function/create proc by itself or you need to put GO after the code block</p>
<p>
CREATE FUNCTION [dbo].[LatitudePlusDistance](@StartLatitude FLOAT, @Distance FLOAT) RETURNS FLOAT<br />
AS<br />
BEGIN<br />
    RETURN (SELECT @StartLatitude + SQRT(@Distance * @Distance / 4766.8999155991))<br />
END<br />
GO &#8212; &#8212; add this</p>
<p>CREATE FUNCTION [dbo].[LongitudePlusDistance]<br />
    (@StartLongitude FLOAT,<br />
    @StartLatitude FLOAT,<br />
    @Distance FLOAT)<br />
RETURNS FLOAT<br />
AS<br />
BEGIN<br />
    RETURN (SELECT @StartLongitude + SQRT(@Distance * @Distance / (4784.39411916406 * COS(2 * @StartLatitude / 114.591559026165) * COS(2 * @StartLatitude / 114.591559026165))))<br />
END</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=854#respond' onclick='return addComment.moveForm( "div-comment-854", "854", "respond", "323" )' aria-label='Reply to SQLDenis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-855">
				<div id="div-comment-855" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-855">
			July 30, 2010 at 2:10 pm</a>		</div>

		<p>Thanks for posting Denis. This is exactly what I would have suggested.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=855#respond' onclick='return addComment.moveForm( "div-comment-855", "855", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-856">
				<div id="div-comment-856" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9d0cd1306970c301d6bb67758a8141ab?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9d0cd1306970c301d6bb67758a8141ab?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">RoyHink</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-856">
			July 30, 2010 at 3:31 pm</a>		</div>

		<p>Thanks, SQLDenis, that worked perfectly.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=856#respond' onclick='return addComment.moveForm( "div-comment-856", "856", "respond", "323" )' aria-label='Reply to RoyHink'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-867">
				<div id="div-comment-867" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/abac47082b80d582de48ea621d712e03?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/abac47082b80d582de48ea621d712e03?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Mike Payne</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-867">
			August 3, 2010 at 2:17 pm</a>		</div>

		<p>I was having a problem (Domain Error) with my own query and ran into this site trying to fix it.</p>
<p>I definitely like this method better.</p>
<p>However, it does not return consistent results as it sits.</p>
<p>I noticed that a comparison of the two queries (on a zip code not producing the domain error) returned slightly different result sets.</p>
<p>Even though one zip code was coming back within 4.7 miles in a 5 mile radius search &#8211; this query was not returning it.</p>
<p>I ended up multiplying the Distance by 1.1 and restricting the results without the addition of .1</p>
<p>This returned identical results.  I think that this is a problem within the MAX/MIN Lat/Long functions.</p>
<p>This &#8220;quick fix&#8221; returned the right results for me &#8211; but I figured I would let you know, in case you wanted to research it further.</p>
<p>Thanks for the query either way.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=867#respond' onclick='return addComment.moveForm( "div-comment-867", "867", "respond", "323" )' aria-label='Reply to Mike Payne'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-874">
				<div id="div-comment-874" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5bc375904a375be2c2e0a86155c4d8f0?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5bc375904a375be2c2e0a86155c4d8f0?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">ashwani01</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-874">
			August 5, 2010 at 1:25 am</a>		</div>

		<p>IT Professionals are responsible for creating new technology for development.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=874#respond' onclick='return addComment.moveForm( "div-comment-874", "874", "respond", "323" )' aria-label='Reply to ashwani01'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-870">
				<div id="div-comment-870" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/8f8dccb3c9f7da102bffd2557ba3cad3?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/8f8dccb3c9f7da102bffd2557ba3cad3?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">David Lavoie</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-870">
			September 27, 2010 at 2:41 pm</a>		</div>

		<p>Someone could telle me wich values can I use in LatitudePlusDistance and LongitudePlusDistance for calculation with Km?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=870#respond' onclick='return addComment.moveForm( "div-comment-870", "870", "respond", "323" )' aria-label='Reply to David Lavoie'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-872">
				<div id="div-comment-872" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-872">
			September 27, 2010 at 3:34 pm</a>		</div>

		<p>David Lavoie,</p>
<p>I would recommend that you allow the calculations to process the data using miles.  If you want the results in KM, simply multiply values by 1.609344.  You could modify the CalculateDistance function to multiply by this value just prior to returning.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=872#respond' onclick='return addComment.moveForm( "div-comment-872", "872", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-893">
				<div id="div-comment-893" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f719c6b6957ee21bd94cdcb5fd937617?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f719c6b6957ee21bd94cdcb5fd937617?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.potenzmittel-apo.com/component/jootags/Cialis+Generika+rezeptfrei.html' rel='external nofollow' class='url'>generica cialis</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-893">
			November 25, 2010 at 11:22 am</a>		</div>

		<p>Hallo zusammen,<br />
Toller Blog, aber leider sehe ich nur die hÃ¤lfte.Ist Euch das bekannt?<br />
Liegt das an meinem Safari?</p>
<p>SchÃ¶ne GrÃ¼ÃŸe aus Odenthal</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=893#respond' onclick='return addComment.moveForm( "div-comment-893", "893", "respond", "323" )' aria-label='Reply to generica cialis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-821">
				<div id="div-comment-821" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/3de096b7117c5403837f5c9361888081?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/3de096b7117c5403837f5c9361888081?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Thanks</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-821">
			February 12, 2011 at 4:40 pm</a>		</div>

		<p>I rarely comment on posts but yours has really made life easier. Thank you for posting this.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=821#respond' onclick='return addComment.moveForm( "div-comment-821", "821", "respond", "323" )' aria-label='Reply to Thanks'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-839">
				<div id="div-comment-839" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/c53ad6d45b3f951efa94ee85ac9c71dc?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/c53ad6d45b3f951efa94ee85ac9c71dc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://zipcodes.qpzm.com/' rel='external nofollow' class='url'>Tom</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-839">
			June 20, 2011 at 4:01 pm</a>		</div>

		<p>This is fantastic, it is fast. So much faster than using a prepopulated distance table of millions or rows.</p>
<p>Awesome, thank you.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=839#respond' onclick='return addComment.moveForm( "div-comment-839", "839", "respond", "323" )' aria-label='Reply to Tom'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-828">
				<div id="div-comment-828" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5e5c7c8edbe4529d33ff3a9109f073c4?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5e5c7c8edbe4529d33ff3a9109f073c4?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Talib</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-828">
			August 8, 2011 at 3:43 am</a>		</div>

		<p>The idea was really nice and save my time, Excelent!</p>
<p>i was calculating the distance differently which was causing delay when i apply the functions on a 2 million table but this has really improved the performance!</p>
<p>thanks agains.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=828#respond' onclick='return addComment.moveForm( "div-comment-828", "828", "respond", "323" )' aria-label='Reply to Talib'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-841">
				<div id="div-comment-841" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/601f90823708c90639322cbb31c736e7?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/601f90823708c90639322cbb31c736e7?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-841">
			October 4, 2011 at 7:47 am</a>		</div>

		<p>George,</p>
<p>Thank you so much for this code. I would like to know the reason why you used those values to divide and multiply by. I mean some documentation/site for the values used in all functions.</p>
<p>In fact a few other users asked the same question, but would be very helpful if you could provide some answers.</p>
<p>Thank you so much.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=841#respond' onclick='return addComment.moveForm( "div-comment-841", "841", "respond", "323" )' aria-label='Reply to Matt'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-842">
				<div id="div-comment-842" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-842">
			October 4, 2011 at 8:49 am</a>		</div>

		<p>Matt,</p>
<p>The constants I use in the calculations exist because I originally used a different formula, and then reworked it in to this format.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=842#respond' onclick='return addComment.moveForm( "div-comment-842", "842", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-843">
				<div id="div-comment-843" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/601f90823708c90639322cbb31c736e7?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/601f90823708c90639322cbb31c736e7?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-843">
			October 4, 2011 at 9:07 am</a>		</div>

		<p>Thanks George.</p>
<p>I mean is it part of any formula (like haversine formula)? What is the formula you have used here?</p>
<p>What is the reason to use these values<br />
57.2957795130823 <br />
3958.75586574 <br />
4766.8999155991</p>
<p>The reason i ask is because, if i use them in my code, i need to document them and provide a reason to my managers as to why these constants are used. I can provide a link to your site, but the site does not answer these queries.</p>
<p>Any formula/documentayion/site would be a great help.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=843#respond' onclick='return addComment.moveForm( "div-comment-843", "843", "respond", "323" )' aria-label='Reply to Matt'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-858">
				<div id="div-comment-858" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/601f90823708c90639322cbb31c736e7?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/601f90823708c90639322cbb31c736e7?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-858">
			October 19, 2011 at 7:16 am</a>		</div>

		<p>Hi George,</p>
<p>When a zipcode spans multiple cities, then the below query</p>
<p>SELECT  @Longitude = Longitude,<br />
        @Latitude = Latitude<br />
FROM    ZipCodes<br />
WHERE   ZipCode = &#8216;20013&#8217;</p>
<p>takes longer to execute if the zipcodes table is large and returns the last row. Is it beneficial to use the min/max values instead?</p>
<p>What would you suggest?</p>
<p>Matt</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=858#respond' onclick='return addComment.moveForm( "div-comment-858", "858", "respond", "323" )' aria-label='Reply to Matt'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi odd alt thread-odd thread-alt depth-1" id="comment-823">
				<div id="div-comment-823" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-823">
			November 22, 2011 at 11:38 am</a>		</div>

		<p>George,</p>
<p>Can you please explain each constant you used and the formula used to calculate the bounding box?</p>
<p>Thanks in advance.<br />
&#8212;&#8212;&#8212;&#8212;&#8211;<br />
Also, assuming we pass distance in km, how the formulas should be adjusted? E.g. how to find all rows in the database that are in the radius of 25 km from the passed latitude and longitude?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=823#respond' onclick='return addComment.moveForm( "div-comment-823", "823", "respond", "323" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-824">
				<div id="div-comment-824" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-824">
			November 22, 2011 at 12:01 pm</a>		</div>

		<p>Naomi,</p>
<p>I started with a function I found on the internet about 10 years ago.  Originally it was a multi-step function which I converted to a single formula.  </p>
<p>The conversion between miles and kilometers is well known.  All you need to do is multiply distance by 0.621371192 to convert to kilometers. In fact, every place you see @Distance, replace with (@Distance * 0.621371192).</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=824#respond' onclick='return addComment.moveForm( "div-comment-824", "824", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi odd alt thread-odd thread-alt depth-1" id="comment-825">
				<div id="div-comment-825" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-825">
			November 22, 2011 at 12:29 pm</a>		</div>

		<p>In the CalculateDistance the RETURN (3958.75586574 * ACOS(@Temp) ) first number is the Earth Radius in miles.</p>
<p>I assume we need this radius in km for kilometers.</p>
<p>In the LatitudePlusDistance and the other function I don&#8217;t understand where all these constants come from and what are they. If we passed our distance in km, how these two formulas need to be adjusted?</p>
<p>Can you please post a section for km calculations?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=825#respond' onclick='return addComment.moveForm( "div-comment-825", "825", "respond", "323" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi even thread-even depth-1" id="comment-826">
				<div id="div-comment-826" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-826">
			November 22, 2011 at 1:10 pm</a>		</div>

		<p>Also, the coefficient is 1.609344 from miles to km.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=826#respond' onclick='return addComment.moveForm( "div-comment-826", "826", "respond", "323" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-827">
				<div id="div-comment-827" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/98c82d4cf854a6a2fc9cb932fb960694?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/98c82d4cf854a6a2fc9cb932fb960694?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Brenda</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-827">
			November 24, 2011 at 7:17 am</a>		</div>

		<p>George,</p>
<p>Thank you so much for this code. It has greatly helped me. </p>
<p>This is what i did for KM conversion. All i did is, write a CalculateDistanceInKms udf and in the last line, did as you suggested in one of your earlier posts.</p>
<p>RETURN (1.609344 * ACOS(@Temp)) </p>
<p>Please let me know if this is correct. </p>
<p>Brenda</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=827#respond' onclick='return addComment.moveForm( "div-comment-827", "827", "respond", "323" )' aria-label='Reply to Brenda'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-845">
				<div id="div-comment-845" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/3af873c687c7a7a1e0134b091ae971d7?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/3af873c687c7a7a1e0134b091ae971d7?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Tony</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-845">
			March 19, 2012 at 5:46 pm</a>		</div>

		<p>Works great, thanks for saving me about a week!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=845#respond' onclick='return addComment.moveForm( "div-comment-845", "845", "respond", "323" )' aria-label='Reply to Tony'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-849">
				<div id="div-comment-849" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/4a1a554c30065bb7f21dd40566f6ff37?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/4a1a554c30065bb7f21dd40566f6ff37?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">DrDomski</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-849">
			March 28, 2012 at 6:43 pm</a>		</div>

		<p>Props for sharing this with the community. Thank you.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=849#respond' onclick='return addComment.moveForm( "div-comment-849", "849", "respond", "323" )' aria-label='Reply to DrDomski'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-860">
				<div id="div-comment-860" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/68a1a5a1ac8932d7a4929b15d9653c67?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/68a1a5a1ac8932d7a4929b15d9653c67?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Steve_O</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-860">
			April 11, 2012 at 2:19 pm</a>		</div>

		<p>I must be missing something on the first piece.  I&#8217;ve downloaded the US zip file &amp; am attempting to bulk insert it into SQL 2008 R2.</p>
<p>I&#8217;m using SQL Server Express 2008 R2, and the table will create okay, but the Bulk Insert keeps failing.  </p>
<p>I get several error messages.  This one is repeated once for each of the first 10 rows of the text file.<br />
Msg 4863, Level 16, State 1, Line 1<br />
Bulk load data conversion error (truncation) for row 1, column 1 (Country).</p>
<p>Then, I get these two errors:<br />
Msg 7399, Level 16, State 1, Line 1<br />
The OLE DB provider &#8220;BULK&#8221; for linked server &#8220;(null)&#8221; reported an error. The provider did not give any information about the error.<br />
Msg 7330, Level 16, State 2, Line 1<br />
Cannot fetch a row from OLE DB provider &#8220;BULK&#8221; for linked server &#8220;(null)&#8221;.</p>
<p>Can this be bulk inserted into a SQL EXPRESS 2008 R2 database?  Or is it something else?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=860#respond' onclick='return addComment.moveForm( "div-comment-860", "860", "respond", "323" )' aria-label='Reply to Steve_O'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-861">
				<div id="div-comment-861" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-861">
			April 11, 2012 at 2:48 pm</a>		</div>

		<p>@Steve_O</p>
<p>I haven&#8217;t downloaded a file in a really long time.  It&#8217;s possible that geonames.org has changed the format of the file.  I would encourage you to open the file using an ASCII editor (like notepad) and examining the columns.  You may need to make adjustments to the structure of the table you are importing the data in to.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=861#respond' onclick='return addComment.moveForm( "div-comment-861", "861", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-862">
				<div id="div-comment-862" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/68a1a5a1ac8932d7a4929b15d9653c67?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/68a1a5a1ac8932d7a4929b15d9653c67?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Steve_O</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-862">
			April 12, 2012 at 9:14 am</a>		</div>

		<p>George &#8211; thanks for the reply.  Geonames.org HAD changed the format of the file.  This structure now works for US (testing now with others).  </p>
<p>        [geonameID] int NULL,<br />
	[name] varchar(200) NULL,<br />
	[ASCIIName] varchar(200) NULL,<br />
	[AlternateNames] varchar(5000) NULL,<br />
	[latitude] decimal(8,5) NULL,<br />
	[longitude] decimal(8,5) NULL,<br />
	[FeatureClass] char(1) NULL,<br />
	[FeatureCode] varchar(10) NULL,<br />
	[CountryCode] varchar(2) NULL,<br />
	[AlternateCountryCode] varchar(60) NULL,<br />
	[FIPSCode] varchar(20) NULL,<br />
	[CountyCode] varchar(80) NULL,<br />
	[Admin3Code] varchar(20) NULL,<br />
	[Admin4Code] varchar(20) NULL,<br />
	[population] bigint NULL,<br />
	[elevation_meters] int NULL,<br />
	[DigitalElevationMdl] int NULL,<br />
	[TimeZone] varchar(40) NULL,<br />
	[ModDate] varchar(10) NULL</p>
<p>However, not ALL countries are in the above format. FYI, the AlternateNames above must be changed from varchar(5000) to varchar(MAX) to prevent truncation &amp; to load for AllCountries.   </p>
<p>Some countries are in this format:<br />
    [CountryCode] [varchar](2) NULL,<br />
    [ZipCode] [varchar](5) NULL,<br />
    [PostalCode] varchar(20) NULL,<br />
    [City] varchar(180) NULL,<br />
    [subdivision_StateName] varchar(100) NULL,<br />
    [subdivision_StateCode] varchar(20) NULL,<br />
    [subdivision_CountyProvinceName] varchar(100) NULL,<br />
    [subdivision_CountyProvinceCode] varchar (20) NULL,<br />
    [subdivision_CommunityName] varchar (100) NULL,<br />
    [subdivision_CommunityCode] varchar (20) NULL,<br />
    [latitude] decimal(8,5) NULL,<br />
    [longitude] decimal(8,5) NULL,<br />
    [accuracy] varchar(1) NULL</p>
<p>I haven&#8217;t looked to see why some files are in one format vs another, but this was my issue.  If you can edit the article, it might be wise to just add the caveat to verify the file structure.  Thanks for the help, and for the GREAT utility.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=862#respond' onclick='return addComment.moveForm( "div-comment-862", "862", "respond", "323" )' aria-label='Reply to Steve_O'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-863">
				<div id="div-comment-863" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-863">
			April 12, 2012 at 9:27 am</a>		</div>

		<p>@Steve_O,</p>
<p>Thank you for investigating this issue, and also for posting the corrected table structure.  I have updated the article as you suggested and also gave you credit for bringing this to my attention.</p>
<p>I&#8217;m glad you found this useful.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=863#respond' onclick='return addComment.moveForm( "div-comment-863", "863", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-881">
				<div id="div-comment-881" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Jim Schell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-881">
			April 24, 2012 at 2:04 pm</a>		</div>

		<p>George,</p>
<p>Question from a noob here. I follow your function, some of the math is a little over my head to say the least. </p>
<p>WHat I am curious about is how to take the dbo.calculatedistance value and convert it to feet.</p>
<p>I have to hard code the distance value of say 500 feet which is .094696 feet, what I get back in the calculatedistance function used as part of select is all decimal as expected. How can we convert this to feet on the fly?</p>
<p>Case study is I need to know every hydrant within 500 feet of a specific lat long and part of the recordset should the actual distance because not every hydrant is actually 500 feet away. </p>
<p>Hope this make sense?</p>
<p>Thanks</p>
<p>Jim</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=881#respond' onclick='return addComment.moveForm( "div-comment-881", "881", "respond", "323" )' aria-label='Reply to Jim Schell'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-882">
				<div id="div-comment-882" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-882">
			April 24, 2012 at 2:36 pm</a>		</div>

		<p>Jim,</p>
<p>The CalculateDistance function returns Miles.  You could modify the function to multiply by 5280 to convert to feet.  Change the last line to: </p>
<p>Return (5280 * 3958.75586574 * acos(@Temp) )</p>
<p>I have some concerns about your approach for the case study.  The premise for this is to calculate straight line distances (crow fly).  Does your 500 feet requirement represent crow fly distances or is it road distances.  For example, a hydrant could be around the corner and could be within 500 feet as the crow flies, but actually be 700 feet if you restrict your movement to following the roads.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=882#respond' onclick='return addComment.moveForm( "div-comment-882", "882", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-883">
				<div id="div-comment-883" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Jim Schell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-883">
			April 25, 2012 at 7:08 am</a>		</div>

		<p>George,</p>
<p>Thanks for the response!!!</p>
<p>I used this before I saw your response:</p>
<p>ROUND(dbo.CalculateDistance(@Longitude, @Latitude, Longtitude, Latitude)* 5280,0) AS Hyd_Dist</p>
<p>as a field being returned giving me the number of feet the hydrant is based on the lat/long of the hydrant and the lat/long of the building in question. Obviously I have zero control over where google says the centroid point is that they say the address belongs to.</p>
<p>The 500 feet was an arbitrary number for testing. Different jurisdictions have different requirements, some 300 some 250 etc, but you are correct it is as the crow flies and not by road segment. I have zero access to a road segment table and quite frankly it would be over my head for sure. </p>
<p>The end result here is to pull up a crystal report with a googlemap or similar type map in the report and populate the hydrants and the address with color coded push pin type markers indicating the house and the gpm (gallons per minute) flow of the hydrant.</p>
<p>The plans examiner would click a command button inside an app open a the crystal report giving him/her the birds eye view of the building and the hydrants near by. Giving them visual information about where the nearest hydrants are in relation to the building they are looking at.</p>
<p>Sorry the long response, hoefully this make sense now?</p>
<p>Thanks</p>
<p>Jim</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=883#respond' onclick='return addComment.moveForm( "div-comment-883", "883", "respond", "323" )' aria-label='Reply to Jim Schell'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-884">
				<div id="div-comment-884" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-884">
			April 25, 2012 at 9:40 am</a>		</div>

		<p>Jim,</p>
<p>Thanks for the feedback.</p>
<p>I&#8217;ve written similar functionality for students walking to a bus stop.  I needed to use actual road distances, which makes the process considerably more difficult.</p>
<p>I&#8217;m glad you got this working.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=884#respond' onclick='return addComment.moveForm( "div-comment-884", "884", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-885">
				<div id="div-comment-885" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Jim Schell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-885">
			April 25, 2012 at 4:12 pm</a>		</div>

		<p>Yes it would and not having access to a road segment table let alone trying to tie that together would be a nightmare!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=885#respond' onclick='return addComment.moveForm( "div-comment-885", "885", "respond", "323" )' aria-label='Reply to Jim Schell'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-887">
				<div id="div-comment-887" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Jim Schell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-887">
			April 26, 2012 at 3:32 pm</a>		</div>

		<p>George et al,</p>
<p>Here is the 64 dollar question. How can we determine the cardinal compass point between two lat long points,</p>
<p>latlongA is NEWS&#8230; of latlongB I can only see the need for 8 compass points but there could easily be ENE, NE or NNE etc.</p>
<p>This is a spin on the locate 5 occuancies from my position 2 are NE of me,1 is W and the other 2 are S of me.</p>
<p>Make Sense?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=887#respond' onclick='return addComment.moveForm( "div-comment-887", "887", "respond", "323" )' aria-label='Reply to Jim Schell'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-888">
				<div id="div-comment-888" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-888">
			April 26, 2012 at 5:16 pm</a>		</div>

		<p>Jim,</p>
<p>Calculating the angle between coordinates is tricky because the coordinates we are talking about here (Latitude/Longitude) have values represented in degrees.  The problem is that you cannot directly use the Lat/Long values because a degree change in latitude is shorter at the equator than a change of 1 degree near the north or south pole.</p>
<p>If I get a chance, I&#8217;ll see if I can work something up for this.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=888#respond' onclick='return addComment.moveForm( "div-comment-888", "888", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-889">
				<div id="div-comment-889" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Jim Schell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-889">
			April 26, 2012 at 10:32 pm</a>		</div>

		<p>George,</p>
<p>I morphed this code with yours to kitbash something that would work. THE NE, NW, SW &amp; SE char return does not work, logic error somewhere in there&#8230;</p>
<p><codeblock lang="TSQL" line="1">ALTER FUNCTION [dbo].[CalculateBearing]<br />
(@Longitude1 DECIMAL(10,6),<br />
@Latitude1   DECIMAL(10,6),<br />
@Longitude2  DECIMAL(10,6),<br />
@Latitude2   DECIMAL(10,6))<br />
RETURNS VARCHAR<br />
AS<br />
BEGIN<br />
DECLARE @Cardinal CHAR (8)<br />
DECLARE @Bearing DECIMAL(10,6)<br />
DECLARE @x DECIMAL(10,6)<br />
DECLARE @y DECIMAL(10,6)<br />
DECLARE @dLat DECIMAL(10,6)<br />
DECLARE @dLon DECIMAL(10,6)<br />
DECLARE @rLat1 DECIMAL(10,6)<br />
DECLARE @rLat2 DECIMAL(10,6)</p>
<p>IF @Longitude1 IS NULL OR @Longitude2 IS NULL OR @Latitude1 IS NULL OR @Latitude2 IS NULL<br />
SET @Bearing = NULL<br />
ELSE<br />
BEGIN<br />
SET @dlat = Radians(@Latitude2 &#8211; @Latitude1)<br />
SET @dlon = Radians(@Longitude2 &#8211; @Longitude1)<br />
SET @rLat1 = Radians(@Latitude1)<br />
SET @rLat2 = Radians(@Latitude2)<br />
SET @y = sin(@dlon)*cos(@rLat2)<br />
SET @x = cos(@rLat1)*sin(@rLat2)-sin(@rLat1)*cos(@rlat2)*cos(@dlon)<br />
IF (@x = 0 and @y = 0)<br />
SET @Bearing = null<br />
ELSE<br />
BEGIN<br />
SET @Bearing = cast((Degrees(atn2(@y,@x)) + 360) as decimal(10,6)) % 360<br />
END<br />
END<br />
IF @Bearing GT 0     and @Bearing LT 22.6  SET @Cardinal = &#8216;N&#8217;  <br />
IF @Bearing GT 22.5  and @Bearing LT 67.6  SET @Cardinal = &#8216;NE&#8217; <br />
IF @Bearing GT 67.5  and @Bearing LT 112.6 SET @Cardinal = &#8216;E&#8217;  <br />
IF @Bearing GT 112.5 and @Bearing LT 157.6 SET @Cardinal = &#8216;SE&#8217; <br />
IF @Bearing GT 157.5 and @Bearing LT 202.6 SET @Cardinal = &#8216;S&#8217;  <br />
IF @Bearing GT 202.5 and @Bearing LT 247.6 SET @Cardinal = &#8216;SW&#8217; <br />
IF @Bearing GT 247.5 and @Bearing LT 292.6 SET @Cardinal = &#8216;W&#8217;  <br />
IF @Bearing GT 292.5 and @Bearing LT 337.6 SET @Cardinal = &#8216;NW&#8217; <br />
IF @Bearing GT 337.5 and @Bearing LTE 360.0 SET @Cardinal = &#8216;N&#8217;   </p>
<p>&#8212; Return the result of the function<br />
RETURN @Cardinal <br />
END<br />
GO</codeblock></p>
<p>The original version of this code returned a float datatype of the bearing in degrees.</p>
<p>Jim</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=889#respond' onclick='return addComment.moveForm( "div-comment-889", "889", "respond", "323" )' aria-label='Reply to Jim Schell'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-890">
				<div id="div-comment-890" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/25b6d998dda09992685d39e33686547f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Jim Schell</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-890">
			April 27, 2012 at 6:05 am</a>		</div>

		<p>George et al,</p>
<p>The formatting did not stick for my previous post.</p>
<p>Ugh, how dow I fix that?</p>
<p>Jim</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=890#respond' onclick='return addComment.moveForm( "div-comment-890", "890", "respond", "323" )' aria-label='Reply to Jim Schell'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-815">
				<div id="div-comment-815" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/0f92abb8d528e638be6dd3d533f50912?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/0f92abb8d528e638be6dd3d533f50912?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Paul</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-815">
			May 9, 2012 at 12:34 pm</a>		</div>

		<p>Hi George,</p>
<p>It looks like they changed the format of the data file again. I looked at the readme and it gives a completely different list of fields. I am not sure which ones to use now. Any help would be appreciated as this would be perfect if I can get it working. </p>
<p>Also, the above code references a column called Zipecode when there is no such column in the create table statement. Unless I am missing something&#8230;</p>
<p>Paul</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=815#respond' onclick='return addComment.moveForm( "div-comment-815", "815", "respond", "323" )' aria-label='Reply to Paul'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-817">
				<div id="div-comment-817" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/0f92abb8d528e638be6dd3d533f50912?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/0f92abb8d528e638be6dd3d533f50912?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Paul</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-817">
			May 10, 2012 at 7:45 am</a>		</div>

		<p>Good morning George,</p>
<p>Well, I managed to get it all working. I went in and changed all the field names. The following create table worked for me.</p>
<p>CREATE TABLE [dbo].[ZipCodes](<br />
	[country code] [varchar](2) NULL,<br />
	[postal code] [varchar](20) NULL,<br />
	[place name] [varchar](180) NULL,<br />
	[admin name1] [varchar](100) NULL,<br />
	[admin code1] [varchar](20) NULL,<br />
	[admin name2] [varchar](100) NULL,<br />
	[admin code2] [varchar](20) NULL,<br />
	[admin name3] [varchar](100) NULL,<br />
	[admin code3] [varchar](20) NULL,<br />
	[latitude] [decimal](8, 4) NULL,<br />
	[longitude] [decimal](8, 4) NULL,<br />
	[accuracy] [int] NULL<br />
)</p>
<p>
I created all of the funtions and it works perfectly. Here is my next question. How do I access these funtions in Access? The company I work for has a set of legacy Access front ends that use my SQL DB as its data source. Can I simply write your funtions in Access? If so, is there anything I should look for when changing the format? I have already linked at local table to the SQL table with no problems&#8230;</p>
<p>Thank you for any help..</p>
<p>Paul</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=817#respond' onclick='return addComment.moveForm( "div-comment-817", "817", "respond", "323" )' aria-label='Reply to Paul'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-819">
				<div id="div-comment-819" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-819">
			May 10, 2012 at 9:33 am</a>		</div>

		<p>Paul,</p>
<p>Thanks for the feedback.  I&#8217;ve been swamped at my &#8220;paying&#8221; job and haven&#8217;t had a chance to look at this.  You should be able to create the functions within SQL and then call them using Access as the front end application.  </p>
<p>I haven&#8217;t used Access in a really long time, so I am probably not the best person to give advice on this.  I do know an Access expert and will try to get that person to look at your question and provide an answer.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=819#respond' onclick='return addComment.moveForm( "div-comment-819", "819", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-remou even thread-even depth-1" id="comment-820">
				<div id="div-comment-820" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/adb9f3f81dc0b13a7339a10d0abedbfc?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/adb9f3f81dc0b13a7339a10d0abedbfc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">remou</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-820">
			May 11, 2012 at 6:58 am</a>		</div>

		<p>Hi Paul, here are a few rough ideas in case you have not got around to figuring it out yet. You can refer to a function by name in a passthrough query (<a href="http://support.microsoft.com/kb/303968" rel="nofollow">http://support.microsoft.com/kb/303968</a>), so, for example,</p>
<p>  SELECT dbo.CalculateDistance<br />
  (-114.0812,51.0171,-116.0812,52.0171) AS Distance</p>
<p>And in VBA:</p>
<p>   Dim rs As New ADODB.Recordset<br />
   Dim cn As New ADODB.Connection</p>
<p>   Long1 = -114.0812<br />
   Lat1 = 51.0171<br />
   Long2 = -114.0412<br />
   Lat2 = 51.0571<br />
   cn.Open scon</p>
<p>   rs.Open &#8220;SELECT dbo.CalculateDistance(&#8221; _<br />
      &amp; Long1 &amp; &#8220;,&#8221; &amp; Lat1 _<br />
      &amp; &#8220;,&#8221; &amp; Long2 &amp; &#8220;,&#8221; &amp; Lat2 &amp; &#8220;) AS Distance&#8221;, cn<br />
   Debug.Print rs!distance</p>
<p>And so forth.</p>
<p>I hope I have not missed your point.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=820#respond' onclick='return addComment.moveForm( "div-comment-820", "820", "respond", "323" )' aria-label='Reply to remou'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-822">
				<div id="div-comment-822" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/40d3d34d2a03d5dad0151a20f6648238?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/40d3d34d2a03d5dad0151a20f6648238?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Paul</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-822">
			May 14, 2012 at 12:29 pm</a>		</div>

		<p>Hi remou,</p>
<p>thanks for your suggestions. I will give them a try and report back&#8230; </p>
<p>Presumably, I would put the VBA code in the form I want to results to show up in?</p>
<p>Paul</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=822#respond' onclick='return addComment.moveForm( "div-comment-822", "822", "respond", "323" )' aria-label='Reply to Paul'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-remou even thread-even depth-1" id="comment-831">
				<div id="div-comment-831" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/adb9f3f81dc0b13a7339a10d0abedbfc?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/adb9f3f81dc0b13a7339a10d0abedbfc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">remou</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-831">
			July 4, 2012 at 10:39 am</a>		</div>

		<p>Hi Paul<br />
You can create a function in any module and feed in the necessary latitude and longitude, or you can put it in the code behind a form and refer to various text boxes on the form.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=831#respond' onclick='return addComment.moveForm( "div-comment-831", "831", "respond", "323" )' aria-label='Reply to remou'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-832">
				<div id="div-comment-832" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/14d3a0081f2052b77a32059516dbce85?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/14d3a0081f2052b77a32059516dbce85?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Garrett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-832">
			February 21, 2013 at 11:00 am</a>		</div>

		<p>Great post.  One question though.  I&#8217;m trying to get store locater values back for both U.S. and Canada.  This process works fine when they are done individually but when I enter a Canadian Postal Code of V5K0A1 (Vancouver) it is telling me that a store located in 98055 (Renton, WA) is thousands of miles away.  Any ideas?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=832#respond' onclick='return addComment.moveForm( "div-comment-832", "832", "respond", "323" )' aria-label='Reply to Garrett'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-834">
				<div id="div-comment-834" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-834">
			February 21, 2013 at 11:05 am</a>		</div>

		<p>Garrett,</p>
<p>Can you share the latitude/longitude values you are using for your store located in Renton, WA, and the Latitude/Longitude value you are using for Canadian postal code V5K0A1 ?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=834#respond' onclick='return addComment.moveForm( "div-comment-834", "834", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-835">
				<div id="div-comment-835" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/14d3a0081f2052b77a32059516dbce85?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/14d3a0081f2052b77a32059516dbce85?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Garrett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-835">
			February 21, 2013 at 12:54 pm</a>		</div>

		<p>Well shoot!  I didn&#8217;t even think to look at the raw database values.  Duh!  That appears to be my problem.  Apparently the download I received has them incorrect.  I will go out to the site you listed and pull them in from there, but here are the values.<br />
V5K0A1<br />
Lat: 49.2889<br />
Long:  -23.036</p>
<p>98055<br />
Lat:  47.4717<br />
Long:  -122.1915</p>
<p>Thanks for pointing out the obvious as I seem to have overlooked it.  It always comes back to the data.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=835#respond' onclick='return addComment.moveForm( "div-comment-835", "835", "respond", "323" )' aria-label='Reply to Garrett'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-836">
				<div id="div-comment-836" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-836">
			February 21, 2013 at 1:04 pm</a>		</div>

		<p>Garrett,</p>
<p>Been there, done that.  Data is the lifeblood of any application.</p>
<p>The difference here is that I have tons of experience with this user defined function, and therefore I have complete faith that it works properly and returns an accurate result.  You don&#8217;t have that experience yet, which is probably why I immediately thought of the data, and you didn&#8217;t.</p>
<p>Best of luck with your project.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=836#respond' onclick='return addComment.moveForm( "div-comment-836", "836", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-837">
				<div id="div-comment-837" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/54d0f36280eb03aad73b3a68e4690003?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/54d0f36280eb03aad73b3a68e4690003?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Al</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-837">
			February 21, 2013 at 1:04 pm</a>		</div>

		<p>This is really helpful. I believe its been asked, but I can&#8217;t seem to find the answer. Can you explain what the following constants in your functions refer to:</p>
<p>LatitudePlusDistance: 4766.8999155991</p>
<p>LongitudePlusDistance: 4784.39411916406 and 114.591559026165</p>
<p>Thanks!</p>
<p>For anyone else interested, the values in the distace calculator are 3958.75586574 (radius of Earth in miles) and 57.2957795130823 (degree to radian conversion factor)</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=837#respond' onclick='return addComment.moveForm( "div-comment-837", "837", "respond", "323" )' aria-label='Reply to Al'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-838">
				<div id="div-comment-838" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-838">
			February 21, 2013 at 1:11 pm</a>		</div>

		<p>Al,</p>
<p>Those constants were derived by taking the distance formula, making the distance a variable, and solving for Latitude (and then again for Longitude).</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=838#respond' onclick='return addComment.moveForm( "div-comment-838", "838", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-886">
				<div id="div-comment-886" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/54a4d2666cf4fb6e6cdefbd10367aeae?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/54a4d2666cf4fb6e6cdefbd10367aeae?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.jamier.net/' rel='external nofollow' class='url'>Jamie Rytlewski</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-886">
			April 24, 2013 at 6:26 am</a>		</div>

		<p>Thanks for the post. I&#8217;d like to mention that the file with the Latitude/Longitude had some inaccurate Lat/Lon. I created a console app that will update the lat/lon from Bing Maps if anyone is interested. </p>
<p>Where I found the problem was with two zip codes that are next to each other, but were considered 7 miles apart with the download. I checked the values in Bing and Google and found out that the lat/lon was incorrect.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=886#respond' onclick='return addComment.moveForm( "div-comment-886", "886", "respond", "323" )' aria-label='Reply to Jamie Rytlewski'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-846">
				<div id="div-comment-846" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/1184e45784dc1f7fbe96a38d311ad7b1?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/1184e45784dc1f7fbe96a38d311ad7b1?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='/index.php/DataMgmt/DataDesign/sql-server-zipcode-latitude-longitude-pr' rel='external nofollow' class='url'>Chris</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-846">
			June 10, 2013 at 8:38 pm</a>		</div>

		<p>can this be converted to Kilometers.  I know a reply saidf to change the Return  vlaue to (6378.7) is all that is needed to convert everything from miles to Kilometeres.</p>
<p>Chris</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=846#respond' onclick='return addComment.moveForm( "div-comment-846", "846", "respond", "323" )' aria-label='Reply to Chris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-847">
				<div id="div-comment-847" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/1184e45784dc1f7fbe96a38d311ad7b1?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/1184e45784dc1f7fbe96a38d311ad7b1?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Chris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-847">
			June 10, 2013 at 9:36 pm</a>		</div>

		<p>Thanks great post,  I want to convert all calculations from Miles to Kilometeres.  Is Return (6378.7 * acos(@Temp) )   enough ?  Or do I need to change anything else ?  in the procedures provided</p>
<p>I want to do speed tests between long/lat for float datatypes, compare to the new geography datatypes,  I have already converted long/lat to a new column Geography and need to play with spatial indexes next.   </p>
<p>Thanks, chris</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=847#respond' onclick='return addComment.moveForm( "div-comment-847", "847", "respond", "323" )' aria-label='Reply to Chris'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor even thread-even depth-1" id="comment-848">
				<div id="div-comment-848" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-848">
			June 11, 2013 at 1:14 pm</a>		</div>

		<p>Yes.  That is all you need to do to convert this to kilometers.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=848#respond' onclick='return addComment.moveForm( "div-comment-848", "848", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-850">
				<div id="div-comment-850" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-850">
			June 11, 2013 at 1:27 pm</a>		</div>

		<p>SQLDenis blogged about the geography data type here:  <a href="/index.php/DataMgmt/DataDesign/sql-server-2008-proximity-search-with-th" rel="nofollow">/index.php/DataMgmt/DataDesign/sql-server-2008-proximity-search-with-th</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=850#respond' onclick='return addComment.moveForm( "div-comment-850", "850", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-891">
				<div id="div-comment-891" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/d725e369a04751266cf15bd7964c1825?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/d725e369a04751266cf15bd7964c1825?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Murugan Kathisath</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-891">
			November 17, 2013 at 5:01 am</a>		</div>

		<p>George,<br />
       I have only Latitude and Longitude(millions of records for US Trucks) in SQL my table,<br />
now i need to find State Code from Given Latitude and Longitude.Please help me.</p>
<p>The above functionality not accurate for boundary cross for each state.I need accurate state which one give latitude and longitude.</p>
<p>Regards,<br />
Murugan K<br />
India.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=891#respond' onclick='return addComment.moveForm( "div-comment-891", "891", "respond", "323" )' aria-label='Reply to Murugan Kathisath'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-gmmastros bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-892">
				<div id="div-comment-892" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f3b9936c43f72d26a385f7e9ea90769d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">George Mastros (gmmastros)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-892">
			November 18, 2013 at 8:24 am</a>		</div>

		<p>Murugan,</p>
<p>This is the wrong solution for that.  To do this accurately, you&#8217;ll need to get the boundary points for each state and then do boundary analysis.</p>
<p>I&#8217;ve done this before using just T-SQL, but I have never come up with an acceptably performing solution.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=892#respond' onclick='return addComment.moveForm( "div-comment-892", "892", "respond", "323" )' aria-label='Reply to George Mastros (gmmastros)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-899">
				<div id="div-comment-899" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/d725e369a04751266cf15bd7964c1825?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/d725e369a04751266cf15bd7964c1825?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Murugan kathisath</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#comment-899">
			December 5, 2013 at 7:21 am</a>		</div>

		<p>George,<br />
       Thank  for your reply,please suggest any Links or Concept in sql server.I need state code based on Latitude and Longitude without Google API service.The above functionality is fine for all states,but boundary points only difficult to get accurate state.Please help me .</p>
<p>Regards,<br />
Murugan K<br />
Email : <a href="mailto:muruganprofiles@gmail.com">muruganprofiles@gmail.com</a><br />
India.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/?replytocom=899#respond' onclick='return addComment.moveForm( "div-comment-899", "899", "respond", "323" )' aria-label='Reply to Murugan kathisath'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/datadesign/sql-server-zipcode-latitude-longitude-pr/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='323' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="31fefc0e570cb3860f2a6d4b38c6490d"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765990"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
