<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Changing exec to sp_executesql doesn&#8217;t provide any benefit if you are not using parameters correctly</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Changing exec to sp_executesql doesn&#8217;t provide any benefit if you are not using parameters correctly" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="Changing exec to sp_executesql doesn't provide any benefit if you are not using parameters correctlyI was looking through some code recently and noticed all these sp_executesql calls which did not use parameters correctly.A typical SQL stateme&hellip;" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Changing exec to sp_executesql doesn&#8217;t provide any benefit if you are not using parameters correctly Comments Feed" href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Finding motivation after a smack in the face' href='/index.php/itprofessionals/ethicsit/finding-motivation-after-a-smack-in-the/' />
<link rel='next' title='Avoid Conversions In Execution Plans By Using sp_executesql Instead of Exec' href='/index.php/datamgmt/datadesign/avoid-conversions-in-execution-plans-by/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/" />
<link rel='shortlink' href='/?p=462' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fchanging-exec-to-sp_executesql-doesn-t-p%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Fchanging-exec-to-sp_executesql-doesn-t-p%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/datamgmt/datadesign/avoid-conversions-in-execution-plans-by/" rel="next">Avoid Conversions In Execution Plans By Using sp_executesql Instead of Exec</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/itprofessionals/ethicsit/finding-motivation-after-a-smack-in-the/" rel="prev">Finding motivation after a smack in the face</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/" class="post-title">Changing exec to sp_executesql doesn&#8217;t provide any benefit if you are not using parameters correctly</a></h1>
					<div class="post-byline">by <a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis" rel="author">SQLDenis</a> on June 9, 2009 in category <a href="/index.php/category/datamgmt/datadesign/" rel="category tag">Data Modelling and Design</a>. Article views: 34,240 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&text=RT @LessThanDot Blog - Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are... by @denisgobo" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&title=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly&source=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&title=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&quote=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&title=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>Changing exec to sp_executesql doesn&#8217;t provide any benefit if you are not using parameters correctly</p>
<p>I was looking through some code recently and noticed all these sp_executesql calls which did not use parameters correctly.<br />
A typical SQL statement would look like this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>
<span class="kw1">declare</span> @Col1 <span class="kw1">int</span>
&nbsp;
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">4</span>,@Col1 <span class="sy0">=</span> <span class="nu0">5</span>
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from test</span>
<span class="st0">where Col2 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col2<span class="br0">&#41;</span><span class="sy0">+</span> <span class="st0">'</span>
<span class="st0">and Col1 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col1<span class="br0">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> @<span class="kw1">SQL</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @Col2 smallint
declare @Col1 int

select @Col2 = 4,@Col1 = 5

declare @SQL nvarchar(1000)
select @SQL = 'select * from test
where Col2 = ' + convert(varchar(10),@Col2)+ '
and Col1 = ' + convert(varchar(10),@Col1)



exec sp_executesql @SQL</pre></div></div>

<p>What that code does is it builds a SQL statement and executes it. The problem is that when you do something like that the query plan will not be reused when you change the values of @Col2  and @Col1. When a new plan is generated everytime your values change you will bloat SQL Server&#8217;s procedure cache and less memory will be available for data.<br />
Below is some code to demonstrate what I mean, I have tested this code on SQL Server 2008 only!!</p>
<p>First create this table</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">create</span> <span class="kw1">table</span> dbo.<span class="me1">test</span> <span class="br0">&#40;</span>Col1 <span class="kw1">int</span> <span class="kw1">primary</span> <span class="kw1">key</span>,
Col2 <span class="kw1">smallint</span> not null,
SomeDate <span class="kw1">datetime</span> <span class="kw1">default</span> <span class="kw2">getdate</span><span class="br0">&#40;</span><span class="br0">&#41;</span>,
SomeValue <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span> <span class="kw1">default</span> <span class="st0">'ABCDEFG'</span><span class="br0">&#41;</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">create table dbo.test (Col1 int primary key,
Col2 smallint not null,
SomeDate datetime default getdate(),
SomeValue char(10) default 'ABCDEFG')
GO</pre></div></div>

<p>Insert a bunch of rows</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">insert</span> dbo.<span class="me1">test</span><span class="br0">&#40;</span>Col1,Col2<span class="br0">&#41;</span>
<span class="kw1">select</span> number<span class="sy0">+</span> <span class="nu0">1</span>,number <span class="kw1">from</span> master..<span class="me1">spt_values</span>
<span class="kw1">where</span> type <span class="sy0">=</span> <span class="st0">'P'</span>
<span class="kw1">order</span> <span class="kw1">by</span> number</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">insert dbo.test(Col1,Col2)
select number+ 1,number from master..spt_values
where type = 'P'
order by number</pre></div></div>

<p>Now let&#8217;s see what we inserted</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> dbo.<span class="me1">test</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from dbo.test</pre></div></div>

<p>(results abridged)<br />
Col1	Col2	SomeDate	SomeValue<br />
1	0	2009-06-09 11:50:04.327	ABCDEFG<br />
2	1	2009-06-09 11:50:04.327	ABCDEFG<br />
3	2	2009-06-09 11:50:04.327	ABCDEFG<br />
4	3	2009-06-09 11:50:04.327	ABCDEFG<br />
5	4	2009-06-09 11:50:04.327	ABCDEFG<br />
6	5	2009-06-09 11:50:04.327	ABCDEFG<br />
7	6	2009-06-09 11:50:04.327	ABCDEFG<br />
&#8230;..<br />
&#8230;..<br />
&#8230;..<br />
2047	2046	2009-06-09 11:50:04.327	ABCDEFG<br />
2048	2047	2009-06-09 11:50:04.327	ABCDEFG  </p>
<p>First let&#8217;s clear our procedure cache</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">dbcc</span> freeproccache</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">dbcc freeproccache</pre></div></div>

<p>run these 2 queries 5 times</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> dbo.<span class="me1">test</span>
<span class="kw1">where</span> Col2 <span class="sy0">=</span> <span class="nu0">3</span>
and Col1 <span class="sy0">=</span> <span class="nu0">4</span>
go
&nbsp;
<span class="kw1">select</span> <span class="sy0">*</span> <span class="kw1">from</span> dbo.<span class="me1">test</span>
<span class="kw1">where</span> Col2 <span class="sy0">=</span> <span class="nu0">4</span>
and Col1 <span class="sy0">=</span> <span class="nu0">5</span>
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select * from dbo.test
where Col2 = 3
and Col1 = 4
go

select * from dbo.test
where Col2 = 4
and Col1 = 5
go</pre></div></div>

<p>Now run the following query to see how many plans we have.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> q.<span class="kw1">text</span>,cp.<span class="me1">usecounts</span>,cp.<span class="me1">objtype</span>,p.<span class="sy0">*</span>,
q.<span class="sy0">*</span>,
cp.<span class="me1">plan_handle</span>
<span class="kw1">from</span>
sys.<span class="me1">dm_exec_cached_plans</span> cp
cross apply sys.<span class="me1">dm_exec_query_plan</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> p
cross apply sys.<span class="me1">dm_exec_sql_text</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> <span class="kw1">as</span> q
<span class="kw1">where</span>
cp.<span class="me1">cacheobjtype</span> <span class="sy0">=</span> <span class="st0">'Compiled Plan'</span> and q.<span class="kw1">text</span> &nbsp;like <span class="st0">'%dbo.test%'</span>
and q.<span class="kw1">text</span> &nbsp;not like <span class="st0">'%sys.dm_exec_cached_plans %'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select q.text,cp.usecounts,cp.objtype,p.*,
q.*,
cp.plan_handle
from
sys.dm_exec_cached_plans cp
cross apply sys.dm_exec_query_plan(cp.plan_handle) p
cross apply sys.dm_exec_sql_text(cp.plan_handle) as q
where
cp.cacheobjtype = 'Compiled Plan' and q.text  like '%dbo.test%'
and q.text  not like '%sys.dm_exec_cached_plans %'</pre></div></div>

<p>As you can see we have 2 plans and each was used 5 times. So for each change in the value a new plan gets generated</p>
<p>Let&#8217;s clear the cache again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">dbcc</span> freeproccache</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">dbcc freeproccache</pre></div></div>

<p>Using dynamic SQL with changing parameters also creates a new plan every time you change the values of the parameters.<br />
Run the following block of code 5 times</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>
<span class="kw1">declare</span> @Col1 <span class="kw1">int</span>
&nbsp;
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">11</span>,@Col1 <span class="sy0">=</span> <span class="nu0">12</span>
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col2<span class="br0">&#41;</span><span class="sy0">+</span> <span class="st0">'</span>
<span class="st0">and Col1 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col1<span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="br0">&#40;</span>@<span class="kw1">SQL</span><span class="br0">&#41;</span>
&nbsp;
go
&nbsp;
<span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>
<span class="kw1">declare</span> @Col1 <span class="kw1">int</span>
&nbsp;
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">12</span>,@Col1 <span class="sy0">=</span> <span class="nu0">13</span>
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col2<span class="br0">&#41;</span><span class="sy0">+</span> <span class="st0">'</span>
<span class="st0">and Col1 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col1<span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="br0">&#40;</span>@<span class="kw1">SQL</span><span class="br0">&#41;</span>
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @Col2 smallint
declare @Col1 int

select @Col2 = 11,@Col1 = 12

declare @SQL varchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = ' + convert(varchar(10),@Col2)+ '
and Col1 = ' + convert(varchar(10),@Col1)


exec (@SQL)

go

declare @Col2 smallint
declare @Col1 int

select @Col2 = 12,@Col1 = 13

declare @SQL varchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = ' + convert(varchar(10),@Col2)+ '
and Col1 = ' + convert(varchar(10),@Col1)


exec (@SQL)
go</pre></div></div>

<p>Now let&#8217;s see how many plans we have</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> q.<span class="kw1">text</span>,cp.<span class="me1">usecounts</span>,cp.<span class="me1">objtype</span>,p.<span class="sy0">*</span>,
q.<span class="sy0">*</span>,
cp.<span class="me1">plan_handle</span>
<span class="kw1">from</span>
sys.<span class="me1">dm_exec_cached_plans</span> cp
cross apply sys.<span class="me1">dm_exec_query_plan</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> p
cross apply sys.<span class="me1">dm_exec_sql_text</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> <span class="kw1">as</span> q
<span class="kw1">where</span>
cp.<span class="me1">cacheobjtype</span> <span class="sy0">=</span> <span class="st0">'Compiled Plan'</span> and q.<span class="kw1">text</span> &nbsp;like <span class="st0">'%dbo.test%'</span>
and q.<span class="kw1">text</span> &nbsp;not like <span class="st0">'%sys.dm_exec_cached_plans %'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select q.text,cp.usecounts,cp.objtype,p.*,
q.*,
cp.plan_handle
from
sys.dm_exec_cached_plans cp
cross apply sys.dm_exec_query_plan(cp.plan_handle) p
cross apply sys.dm_exec_sql_text(cp.plan_handle) as q
where
cp.cacheobjtype = 'Compiled Plan' and q.text  like '%dbo.test%'
and q.text  not like '%sys.dm_exec_cached_plans %'</pre></div></div>

<p>As you can see we have 2 plans with a count of 5 for each.</p>
<p>Now let&#8217;s convert that query to use sp_executesql instead of exec</p>
<p>Run the query below</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>
<span class="kw1">declare</span> @Col1 <span class="kw1">int</span>
&nbsp;
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">3</span>,@Col1 <span class="sy0">=</span> <span class="nu0">4</span>
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col2<span class="br0">&#41;</span><span class="sy0">+</span> <span class="st0">'</span>
<span class="st0">and Col1 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col1<span class="br0">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> @<span class="kw1">SQL</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @Col2 smallint
declare @Col1 int

select @Col2 = 3,@Col1 = 4

declare @SQL varchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = ' + convert(varchar(10),@Col2)+ '
and Col1 = ' + convert(varchar(10),@Col1)



exec sp_executesql @SQL</pre></div></div>

<p>And you get the following message<br />
<strong>Server: Msg 214, Level 16, State 2, Procedure sp_executesql, Line 1<br />
Procedure expects parameter &#8216;@statement&#8217; of type &#8216;ntext/nchar/nvarchar&#8217;.</strong></p>
<p>This is because sp_executesql expects nvarchar and not varchar</p>
<p>Below is the correct query(but it is not correctly parameterized). First clear the cache again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">dbcc</span> freeproccache</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">dbcc freeproccache</pre></div></div>

<p>Now run the following queries 5 times each</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>
<span class="kw1">declare</span> @Col1 <span class="kw1">int</span>
&nbsp;
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">23</span>,@Col1 <span class="sy0">=</span> <span class="nu0">24</span>
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col2<span class="br0">&#41;</span><span class="sy0">+</span> <span class="st0">'</span>
<span class="st0">and Col1 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col1<span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> @<span class="kw1">SQL</span>
Go
&nbsp;
&nbsp;
<span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>
<span class="kw1">declare</span> @Col1 <span class="kw1">int</span>
&nbsp;
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">22</span>,@Col1 <span class="sy0">=</span> <span class="nu0">23</span>
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col2<span class="br0">&#41;</span><span class="sy0">+</span> <span class="st0">'</span>
<span class="st0">and Col1 = '</span> <span class="sy0">+</span> <span class="kw1">convert</span><span class="br0">&#40;</span><span class="kw1">varchar</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,@Col1<span class="br0">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> @<span class="kw1">SQL</span>
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @Col2 smallint
declare @Col1 int

select @Col2 = 23,@Col1 = 24

declare @SQL nvarchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = ' + convert(varchar(10),@Col2)+ '
and Col1 = ' + convert(varchar(10),@Col1)


exec sp_executesql @SQL
Go


declare @Col2 smallint
declare @Col1 int

select @Col2 = 22,@Col1 = 23

declare @SQL nvarchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = ' + convert(varchar(10),@Col2)+ '
and Col1 = ' + convert(varchar(10),@Col1)



exec sp_executesql @SQL
GO</pre></div></div>

<p>Now check again for the plans</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> q.<span class="kw1">text</span>,cp.<span class="me1">usecounts</span>,cp.<span class="me1">objtype</span>,p.<span class="sy0">*</span>,
q.<span class="sy0">*</span>,
cp.<span class="me1">plan_handle</span>
<span class="kw1">from</span>
sys.<span class="me1">dm_exec_cached_plans</span> cp
cross apply sys.<span class="me1">dm_exec_query_plan</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> p
cross apply sys.<span class="me1">dm_exec_sql_text</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> <span class="kw1">as</span> q
<span class="kw1">where</span>
cp.<span class="me1">cacheobjtype</span> <span class="sy0">=</span> <span class="st0">'Compiled Plan'</span> and q.<span class="kw1">text</span> &nbsp;like <span class="st0">'%dbo.test%'</span>
and q.<span class="kw1">text</span> &nbsp;not like <span class="st0">'%sys.dm_exec_cached_plans %'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select q.text,cp.usecounts,cp.objtype,p.*,
q.*,
cp.plan_handle
from
sys.dm_exec_cached_plans cp
cross apply sys.dm_exec_query_plan(cp.plan_handle) p
cross apply sys.dm_exec_sql_text(cp.plan_handle) as q
where
cp.cacheobjtype = 'Compiled Plan' and q.text  like '%dbo.test%'
and q.text  not like '%sys.dm_exec_cached_plans %'</pre></div></div>

<p>As you can see we have 2 plans with a count of 5 for each. This is because we didn&#8217;t use sp_executesql correctly and the engine couldn&#8217;t reuse the plan. Here is what Books On Line has to say</p>
<blockquote><p>sp_executesql can be used instead of stored procedures to execute a Transact-SQL statement a number of times when the change in parameter values to the statement is the only variation. Because the Transact-SQL statement itself remains constant and only the parameter values change, the Microsoft® SQL Server™ query optimizer is likely to reuse the execution plan it generates for the first execution.</p></blockquote>
<p>Below is the query which is correctly parameterized. As you can see we have variables inside the string and at execution time we pass values by means of other variables to it.</p>
<p> First clear the cache again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">dbcc</span> freeproccache</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">dbcc freeproccache</pre></div></div>

<p>Now run the following queries 5 times each</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>, @Col1 <span class="kw1">int</span>
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">3</span>,@Col1 <span class="sy0">=</span> <span class="nu0">4</span>
&nbsp;
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = @InnerCol2 and Col1 = @InnerCol1'</span> 
&nbsp;
<span class="kw1">declare</span> @ParmDefinition <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span>
<span class="kw1">SET</span> @ParmDefinition <span class="sy0">=</span> N<span class="st0">'@InnerCol2 smallint ,@InnerCol1 int'</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> &nbsp;@<span class="kw1">SQL</span>,@ParmDefinition,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol2 &nbsp;<span class="sy0">=</span> @Col2,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol1 &nbsp;<span class="sy0">=</span> @Col1
go
&nbsp;
&nbsp;
<span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>, @Col1 <span class="kw1">int</span>
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">3</span>,@Col1 <span class="sy0">=</span> <span class="nu0">4</span>
&nbsp;
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = @InnerCol2 and Col1 = @InnerCol1'</span> 
&nbsp;
<span class="kw1">declare</span> @ParmDefinition <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span>
<span class="kw1">SET</span> @ParmDefinition <span class="sy0">=</span> N<span class="st0">'@InnerCol2 smallint ,@InnerCol1 int'</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> &nbsp;@<span class="kw1">SQL</span>,@ParmDefinition,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol2 &nbsp;<span class="sy0">=</span> @Col2,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol1 &nbsp;<span class="sy0">=</span> @Col1
&nbsp;
go</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @Col2 smallint, @Col1 int
select @Col2 = 3,@Col1 = 4


declare @SQL nvarchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = @InnerCol2 and Col1 = @InnerCol1' 

declare @ParmDefinition nvarchar(500)
SET @ParmDefinition = N'@InnerCol2 smallint ,@InnerCol1 int'



exec sp_executesql 	@SQL,@ParmDefinition,
			@InnerCol2 	= @Col2,
			@InnerCol1 	= @Col1
go


declare @Col2 smallint, @Col1 int
select @Col2 = 3,@Col1 = 4


declare @SQL nvarchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = @InnerCol2 and Col1 = @InnerCol1' 

declare @ParmDefinition nvarchar(500)
SET @ParmDefinition = N'@InnerCol2 smallint ,@InnerCol1 int'



exec sp_executesql 	@SQL,@ParmDefinition,
			@InnerCol2 	= @Col2,
			@InnerCol1 	= @Col1

go</pre></div></div>

<p>Check the plans again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> q.<span class="kw1">text</span>,cp.<span class="me1">usecounts</span>,cp.<span class="me1">objtype</span>,p.<span class="sy0">*</span>,
q.<span class="sy0">*</span>,
cp.<span class="me1">plan_handle</span>
<span class="kw1">from</span>
sys.<span class="me1">dm_exec_cached_plans</span> cp
cross apply sys.<span class="me1">dm_exec_query_plan</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> p
cross apply sys.<span class="me1">dm_exec_sql_text</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> <span class="kw1">as</span> q
<span class="kw1">where</span>
cp.<span class="me1">cacheobjtype</span> <span class="sy0">=</span> <span class="st0">'Compiled Plan'</span> and q.<span class="kw1">text</span> &nbsp;like <span class="st0">'%dbo.test%'</span>
and q.<span class="kw1">text</span> &nbsp;not like <span class="st0">'%sys.dm_exec_cached_plans %'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select q.text,cp.usecounts,cp.objtype,p.*,
q.*,
cp.plan_handle
from
sys.dm_exec_cached_plans cp
cross apply sys.dm_exec_query_plan(cp.plan_handle) p
cross apply sys.dm_exec_sql_text(cp.plan_handle) as q
where
cp.cacheobjtype = 'Compiled Plan' and q.text  like '%dbo.test%'
and q.text  not like '%sys.dm_exec_cached_plans %'</pre></div></div>

<p>And you will see that we have only one plan with a count of 10</p>
<p>Instead of running the query like we did before we can also do the following. We only have to declare everything once and then we just need to change the values of the parameters before executing</p>
<p>First clear the cache yet again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
</pre></td><td class="de1"><pre class="de1"><span class="kw1">dbcc</span> freeproccache</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">dbcc freeproccache</pre></div></div>

<p>Here is the rewritten query, execute it 5 times</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @Col2 <span class="kw1">smallint</span>, @Col1 <span class="kw1">int</span>
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">3</span>,@Col1 <span class="sy0">=</span> <span class="nu0">4</span>
&nbsp;
&nbsp;
<span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">1000</span><span class="br0">&#41;</span>
<span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'select * from dbo.test</span>
<span class="st0">where Col2 = @InnerCol2 and Col1 = @InnerCol1'</span> 
&nbsp;
<span class="kw1">declare</span> @ParmDefinition <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="nu0">500</span><span class="br0">&#41;</span>
<span class="kw1">SET</span> @ParmDefinition <span class="sy0">=</span> N<span class="st0">'@InnerCol2 smallint ,@InnerCol1 int'</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> &nbsp;@<span class="kw1">SQL</span>,@ParmDefinition,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol2 &nbsp;<span class="sy0">=</span> @Col2,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol1 &nbsp;<span class="sy0">=</span> @Col1
&nbsp;
<span class="co1">--change param values and run the same query</span>
<span class="kw1">select</span> @Col2 <span class="sy0">=</span> <span class="nu0">2</span>,@Col1 <span class="sy0">=</span> <span class="nu0">3</span>
<span class="kw1">exec</span> <span class="kw3">sp_executesql</span> &nbsp;@<span class="kw1">SQL</span>,@ParmDefinition,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol2 &nbsp;<span class="sy0">=</span> @Col2,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @InnerCol1 &nbsp;<span class="sy0">=</span> @Col1
&nbsp;
go </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @Col2 smallint, @Col1 int
select @Col2 = 3,@Col1 = 4


declare @SQL nvarchar(1000)
select @SQL = 'select * from dbo.test
where Col2 = @InnerCol2 and Col1 = @InnerCol1' 

declare @ParmDefinition nvarchar(500)
SET @ParmDefinition = N'@InnerCol2 smallint ,@InnerCol1 int'



exec sp_executesql 	@SQL,@ParmDefinition,
			@InnerCol2 	= @Col2,
			@InnerCol1 	= @Col1

--change param values and run the same query
select @Col2 = 2,@Col1 = 3
exec sp_executesql 	@SQL,@ParmDefinition,
			@InnerCol2 	= @Col2,
			@InnerCol1 	= @Col1

go </pre></div></div>

<p>And we will check the plans yet again</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="de1"><pre class="de1"><span class="kw1">select</span> q.<span class="kw1">text</span>,cp.<span class="me1">usecounts</span>,cp.<span class="me1">objtype</span>,p.<span class="sy0">*</span>,
q.<span class="sy0">*</span>,
cp.<span class="me1">plan_handle</span>
<span class="kw1">from</span>
sys.<span class="me1">dm_exec_cached_plans</span> cp
cross apply sys.<span class="me1">dm_exec_query_plan</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> p
cross apply sys.<span class="me1">dm_exec_sql_text</span><span class="br0">&#40;</span>cp.<span class="me1">plan_handle</span><span class="br0">&#41;</span> <span class="kw1">as</span> q
<span class="kw1">where</span>
cp.<span class="me1">cacheobjtype</span> <span class="sy0">=</span> <span class="st0">'Compiled Plan'</span> and q.<span class="kw1">text</span> &nbsp;like <span class="st0">'%dbo.test%'</span>
and q.<span class="kw1">text</span> &nbsp;not like <span class="st0">'%sys.dm_exec_cached_plans %'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">select q.text,cp.usecounts,cp.objtype,p.*,
q.*,
cp.plan_handle
from
sys.dm_exec_cached_plans cp
cross apply sys.dm_exec_query_plan(cp.plan_handle) p
cross apply sys.dm_exec_sql_text(cp.plan_handle) as q
where
cp.cacheobjtype = 'Compiled Plan' and q.text  like '%dbo.test%'
and q.text  not like '%sys.dm_exec_cached_plans %'</pre></div></div>

<p>As you can see we still have a count of 10 and only one plan.</p>
<p>As you can see sp_executesql can be beneficial for performance when used correctly. Using sp_executesql will also give you some additional features you can&#8217;t do with EXEC.</p>
<p>How would you get a count of rows in a table? with EXEC you need to use a temp table and populate that, with sp_executesql you can use an output variable</p>
<p>Take a look at the following queries</p>
<p>Here is the EXEC version</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="de1"><pre class="de1"><span class="co1">--EXEC (SQL)</span>
<span class="kw1">DECLARE</span> @TableName <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>,
@TableCount <span class="kw1">INT</span>,
@<span class="kw1">SQL</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="kw1">CREATE</span> <span class="kw1">TABLE</span> #temp <span class="br0">&#40;</span>Totalcount <span class="kw1">INT</span><span class="br0">&#41;</span>
<span class="kw1">SELECT</span> @TableName <span class="sy0">=</span> <span class="st0">'test'</span>
<span class="kw1">SELECT</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="st0">'Insert into #temp Select Count(*) from '</span> <span class="sy0">+</span> @TableName
&nbsp;
<span class="kw1">EXEC</span><span class="br0">&#40;</span> @<span class="kw1">SQL</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SELECT</span> @TableCount <span class="sy0">=</span> Totalcount <span class="kw1">FROM</span> #temp
&nbsp;
<span class="kw1">SELECT</span> @TableCount <span class="kw1">as</span> TheCount
&nbsp;
<span class="kw1">DROP</span> <span class="kw1">TABLE</span> #temp
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">--EXEC (SQL)
DECLARE @TableName VARCHAR(100),
@TableCount INT,
@SQL NVARCHAR(100)
 
 
CREATE TABLE #temp (Totalcount INT)
SELECT @TableName = 'test'
SELECT @SQL = 'Insert into #temp Select Count(*) from ' + @TableName
 
EXEC( @SQL)
 
SELECT @TableCount = Totalcount FROM #temp
 
SELECT @TableCount as TheCount
 
DROP TABLE #temp
GO</pre></div></div>

<p>Here is the sp_executesql version</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="de1"><pre class="de1"><span class="co1">--sp_executesql</span>
<span class="kw1">DECLARE</span> @TableName <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>,
@TableCount <span class="kw1">INT</span>,
@<span class="kw1">SQL</span> <span class="kw1">NVARCHAR</span><span class="br0">&#40;</span><span class="nu0">100</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">SELECT</span> @TableName <span class="sy0">=</span> <span class="st0">'Test'</span>
<span class="kw1">SELECT</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> N<span class="st0">'SELECT @InnerTableCount = COUNT(*) FROM '</span> <span class="sy0">+</span> @TableName
&nbsp;
<span class="kw1">EXEC</span> <span class="kw3">SP_EXECUTESQL</span> @<span class="kw1">SQL</span>, N<span class="st0">'@InnerTableCount INT OUTPUT'</span>, @TableCount <span class="kw1">OUTPUT</span>
&nbsp;
<span class="kw1">SELECT</span> @TableCount
GO</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">--sp_executesql
DECLARE @TableName VARCHAR(100),
@TableCount INT,
@SQL NVARCHAR(100)
 
SELECT @TableName = 'Test'
SELECT @SQL = N'SELECT @InnerTableCount = COUNT(*) FROM ' + @TableName
 
EXEC SP_EXECUTESQL @SQL, N'@InnerTableCount INT OUTPUT', @TableCount OUTPUT
 
SELECT @TableCount
GO</pre></div></div>

<p>There are more differences between EXEC and sp_executesql, one of the more important one is that sp_executesql can protect you from <strong>SQL Injection</strong>. I encourage you to read <a href="http://www.sommarskog.se/dynamic_sql.html">The curse and blessings of dynamic SQL</a> to learn more stuff</p>
<p>I have written a follow up to this post that explains how to avoid conversions. Here is the link: <a href="/index.php/DataMgmt/DataDesign/avoid-conversions-in-execution-plans-by">Avoid Conversions In Execution Plans By Using sp_executesql Instead of Exec</a></p>
<p></p>
<p>*** <strong>If you have a SQL related question try our <a href="http://forum.lessthandot.com/viewforum.php?f=17">Microsoft SQL Server Programming</a> forum or our <a href="http://forum.lessthandot.com/viewforum.php?f=22">Microsoft SQL Server Admin</a> forum</strong><ins></ins></p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/avoid-conversions-in-execution-plans-by/'>Avoid Conversions In Execution Plans By Using sp_executesql Instead of Exec</a><p>Yesterday in the Changing exec to sp_executesql doesn't provide any benefit if you are not&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/do-you-use-column-param-or-param-is-null/'>Do you use  Column=@Param OR @Param IS NULL in your WHERE clause? Don't, it doesn't perform</a><p>You see this kind of question all the time in newsgroups/forums, someone wants to return&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://www.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d.png" alt="User bio image"/>Denis has been working with SQL Server since version 6.5. Although he worked as an ASP/JSP/ColdFusion developer before the dot com bust, he has been working exclusively as a database developer/architect since 2002. In addition to English, Denis is also fluent in Croatian and Dutch, but he can curse in many other languages and dialects (just ask the SQL optimizer) He lives in Princeton, NJ with his wife and three kids.<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/denisgobo" title="SQLDenis at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.facebook.com/profile.php?id=http://www.facebook.com/denis.gobo" title="SQLDenis at Facebook" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Facebook" /></a><a href="http://www.linkedin.com/in/denisgobo" title="SQLDenis at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://denisgobo.blogspot.com/" title="SQLDenis at HomePage" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_homepage.png" alt="HomePage" /></a><a href="http://www.flickr.com/photos/denisgobo//" title="SQLDenis at Flickr" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_flickr.png" alt="Flickr" /></a><a href="/index.php/author/SQLDenis/feed/" title="Blog RSS feed for SQLDenis" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 34,240 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/SQLDenis/">Read More Posts by SQLDenis</a>
						</div>
					</div>
					<div>
						<label>Tags:</label> <a href="/index.php/tag/dynamic-sql/" rel="tag">dynamic sql</a>, <a href="/index.php/tag/exec/" rel="tag">exec</a>, <a href="/index.php/tag/sp_executesql/" rel="tag">sp_executesql</a>, <a href="/index.php/tag/sql/" rel="tag">sql</a> 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&text=RT @LessThanDot Blog - Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are... by @denisgobo" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&title=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly&source=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&title=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&quote=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/&title=Changing exec to sp_executesql doesn&amp;#8217;t provide any benefit if you are not using parameters correctly" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		10 Comments	</h4>
			<ol class="comments-list">
					<li class="comment even thread-even depth-1" id="comment-1421">
				<div id="div-comment-1421" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/51394ae0a08d1029370173c49d384552?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/51394ae0a08d1029370173c49d384552?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Natas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1421">
			June 10, 2009 at 6:36 am</a>		</div>

		<p>Wow, I didn&#8217;t know that. Will have to revisit some procs that run dynamic SQL</p>
<p>thanks</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1421#respond' onclick='return addComment.moveForm( "div-comment-1421", "1421", "respond", "462" )' aria-label='Reply to Natas'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1422">
				<div id="div-comment-1422" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5178fd512aa69c7743fbdfbb3247576e?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5178fd512aa69c7743fbdfbb3247576e?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Impal3r</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1422">
			June 10, 2009 at 7:35 am</a>		</div>

		<p>This is very interesting, I never knew that sp_executesql could use output parameters, this will make my life soooo much easier</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1422#respond' onclick='return addComment.moveForm( "div-comment-1422", "1422", "respond", "462" )' aria-label='Reply to Impal3r'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi even thread-even depth-1" id="comment-1416">
				<div id="div-comment-1416" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1416">
			August 21, 2009 at 10:59 am</a>		</div>

		<p>Excellent</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1416#respond' onclick='return addComment.moveForm( "div-comment-1416", "1416", "respond", "462" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1415">
				<div id="div-comment-1415" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/4f27e3eaed833a6edab06b6def822975?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/4f27e3eaed833a6edab06b6def822975?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">NikX</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1415">
			October 5, 2009 at 5:51 am</a>		</div>

		<p>Excellent step by step process..</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1415#respond' onclick='return addComment.moveForm( "div-comment-1415", "1415", "respond", "462" )' aria-label='Reply to NikX'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1414">
				<div id="div-comment-1414" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/cc964d13a1f1ac241ec3a8a1adc6edbc?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/cc964d13a1f1ac241ec3a8a1adc6edbc?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Matthew</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1414">
			November 22, 2009 at 8:40 pm</a>		</div>

		<p>Excellent post. I was not aware of these subtle differences. The MSDN article on this topic could do with an update by you!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1414#respond' onclick='return addComment.moveForm( "div-comment-1414", "1414", "respond", "462" )' aria-label='Reply to Matthew'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1423">
				<div id="div-comment-1423" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/cdb2d1959dd34221a9a2d00723347c1b?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/cdb2d1959dd34221a9a2d00723347c1b?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Andrew Eisenberg</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1423">
			May 11, 2010 at 5:35 pm</a>		</div>

		<p>real power of sp_executesql lies not only in the aformentioned re-use <br />
of cached plans while changing param values passed, but the output <br />
param returned can be a variable of type XML, thus you get back a <br />
@var XML that can then be + create a function returning a table (reads contents of said<br />
@var and returns contents) magical ?!</p>
<p>declare @Paged XML<br />
declare @spe varchar(max)<br />
set @Paged = (<br />
select Case_ID, Created_By, Date_Approved,<br />
  from ( select cs.* <br />
           from   #CaseCollection cs,<br />
                  #Case           c<br />
          where cs.case_id  = c.Case_ID<br />
       ) x<br />
   for XML RAW(&#8216;PagedCases&#8217;))</p>
<p>EXEC sp_executesql<br />
       @spe<br />
   , N&#8217;@Paged    XML output&#8217;<br />
   ,   @Paged=@Paged output </p>
<p>   select a.*, b.*<br />
     from     a<br />
        , dbo.function (@Paged) b &#8212; of course create the func mentioned above<br />
    where   a.case_id = a.case_id </p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1423#respond' onclick='return addComment.moveForm( "div-comment-1423", "1423", "respond", "462" )' aria-label='Reply to Andrew Eisenberg'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1418">
				<div id="div-comment-1418" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61140952e548434f8023a0456447d404?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61140952e548434f8023a0456447d404?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Igor</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1418">
			February 8, 2012 at 2:33 am</a>		</div>

		<p>Thank you very much for this article!!</p>
<p>P.S.<br />
&#8220;How would you get a count of rows in a table? with EXEC you need to use a temp table and populate that&#8221; &#8211; when use EXEC it&#8217;s very simple with @@ROWCOUNT =))</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1418#respond' onclick='return addComment.moveForm( "div-comment-1418", "1418", "respond", "462" )' aria-label='Reply to Igor'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-SQLDenis bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-1419">
				<div id="div-comment-1419" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">SQLDenis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1419">
			February 8, 2012 at 2:41 am</a>		</div>

		<p>Igor,</p>
<p>@@rowcount only works if you are actually returning all the rows from the table, so for a table with 10 million rows you would return all rows to get a count? Seems very expensive to me</p>
<p>In this example @@rowcount is one</p>
<p>select count(*) from sys.objects</p>
<p>select @@rowcount</p>
<p>so the only way to make it work is</p>
<p>select object_id from sys.objects</p>
<p>select @@rowcount</p>
<p>But now you have an extra result set</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1419#respond' onclick='return addComment.moveForm( "div-comment-1419", "1419", "respond", "462" )' aria-label='Reply to SQLDenis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1420">
				<div id="div-comment-1420" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61140952e548434f8023a0456447d404?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61140952e548434f8023a0456447d404?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Igor</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1420">
			February 8, 2012 at 3:13 am</a>		</div>

		<p>SQLDenis, I was mistaken because my query is INSERT and therefore I can use @@ROWCOUNT.</p>
<p>Sorry for my closed-mind comment 🙂</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1420#respond' onclick='return addComment.moveForm( "div-comment-1420", "1420", "respond", "462" )' aria-label='Reply to Igor'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1417">
				<div id="div-comment-1417" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/a3ce4a1c9d4d59fd5a6f7ff7ecc62961?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/a3ce4a1c9d4d59fd5a6f7ff7ecc62961?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Santosh Mishra</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#comment-1417">
			August 20, 2012 at 1:56 pm</a>		</div>

		<p>Hi,<br />
 You really have explained the usage of parameterized dynamic query very well. But I have scenario where I am unanble to use this parameterized query. What I want is like I am passing few input parameters that can be null. If the input parameter&#8217;s value is NULL, then this filter should not be applied. somethink like below:</p>
<p>declare @a varchar(10), @b int<br />
set @a=null<br />
set @b=null</p>
<p>declare @qry nvarchar(1000)<br />
set @qry=N&#8217;select * from dbo.Table1 where 1=1 &#8216;</p>
<p>if @a is  not null<br />
set @qry= @qry + N&#8217; and col1=&#8221;&#8217; + @a + &#8221;&#8221;</p>
<p>if @b is not null<br />
set @qry = @qry + N&#8217; and col2=&#8217; &amp; cast(@b as varchar)</p>
<p>exec sp_executesql @qry</p>
<p>
How can I use parameterized dynamic query in this case?</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/?replytocom=1417#respond' onclick='return addComment.moveForm( "div-comment-1417", "1417", "respond", "462" )' aria-label='Reply to Santosh Mishra'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/datadesign/changing-exec-to-sp_executesql-doesn-t-p/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='462' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="d1f491a404d6854880943e5c3cd9ca25"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765658"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
