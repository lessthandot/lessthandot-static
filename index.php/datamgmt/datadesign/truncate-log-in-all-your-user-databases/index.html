<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Shrink log in all your user databases</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Shrink log in all your user databases" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="A recent post in the forum I frequent presented an interesting problem &#8211; shrink log file in all user databases. See the reasons why it may not be a good idea explained in Do not truncate your LDF files and Why you want to be restrictive with shrink of database files. The first idea that [&hellip;]" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Shrink log in all your user databases Comments Feed" href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='How to get data out of Microsoft Dynamics Great Plains' href='/index.php/datamgmt/datadesign/how-to-get-data-out-of-microsoft-dynamic-2/' />
<link rel='next' title='Vulnerability in Microsoft Office Web Components control could allow remote code execution' href='/index.php/sysadmins/os/vulnerability-in-microsoft-office-web-co/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/" />
<link rel='shortlink' href='/?p=506' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Ftruncate-log-in-all-your-user-databases%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdatadesign%2Ftruncate-log-in-all-your-user-databases%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/sysadmins/os/vulnerability-in-microsoft-office-web-co/" rel="next">Vulnerability in Microsoft Office Web Components control could allow remote code execution</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/datamgmt/datadesign/how-to-get-data-out-of-microsoft-dynamic-2/" rel="prev">How to get data out of Microsoft Dynamics Great Plains</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/" class="post-title">Shrink log in all your user databases</a></h1>
					<div class="post-byline">by <a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky" rel="author">Naomi Nosonovsky</a> on July 11, 2009 in category <a href="/index.php/category/datamgmt/datadesign/" rel="category tag">Data Modelling and Design</a>. Article views: 39,373 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&text=RT @LessThanDot Blog - Shrink log in all your user databases by naomi" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&title=Shrink log in all your user databases&source=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&title=Shrink log in all your user databases" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&quote=Shrink log in all your user databases" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&title=Shrink log in all your user databases" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>A recent post in the forum I frequent presented an interesting problem &#8211; shrink log file in all user databases. See the reasons why it may not be a good idea explained in <a href="/index.php/DataMgmt/DBAdmin/MSSQLServerAdmin/do-not-truncate-your-ldf-files">Do not truncate your LDF files</a> and <a href="http://www.karaszi.com/SQLServer/info_dont_shrink.asp">Why you want to be restrictive with shrink of database files</a>. </p>
<p>The first idea that came to mind was to use sp_MSForEachDB non-documented stored procedure for this task. You can find this <a href="http://www.mssqltips.com/tip.asp?tip=1905&amp;ctc">article by Arshad Ali</a> very helpful in understanding sp_MsForEachTable and sp_MSForEachDB stored procedures and their parameters.<br />
<span id="more-506"></span><br />
<span class="MT_red">UPDATE</span><br />
Based on Duncan&#8217;s comments the better code than I suggested would be</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="de1"><pre class="de1">sp_MSForEachDb <span class="st0">'IF '</span><span class="st0">'?'</span><span class="st0">' NOT IN ('</span><span class="st0">'master'</span><span class="st0">', '</span><span class="st0">'tempdb'</span><span class="st0">', '</span><span class="st0">'tempdev'</span><span class="st0">', '</span><span class="st0">'model'</span><span class="st0">', '</span><span class="st0">'msdb'</span><span class="st0">')</span>
<span class="st0">AND (SELECT recovery_model FROM master.sys.databases WHERE name = '</span><span class="st0">'?'</span><span class="st0">') = 1</span>
<span class="st0">AND (SELECT is_read_only FROM master.sys.databases WHERE name = '</span><span class="st0">'?'</span><span class="st0">') = 0</span>
<span class="st0">BEGIN</span>
<span class="st0">declare @LogFile nvarchar(2000)</span>
<span class="st0">USE [?]</span>
<span class="st0">SELECT @LogFile = sys.database_files.name</span>
<span class="st0">FROM sys.database_files</span>
<span class="st0">WHERE (sys.database_files.type = 1)</span>
<span class="st0">PRINT @LogFile</span>
<span class="st0">EXEC('</span><span class="st0">'ALTER DATABASE [?] SET RECOVERY SIMPLE'</span><span class="st0">')</span>
<span class="st0">DBCC SHRINKFILE (@LogFile, 1)</span>
<span class="st0">EXEC('</span><span class="st0">'ALTER DATABASE [?] SET RECOVERY FULL'</span><span class="st0">')</span>
<span class="st0">END'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_MSForEachDb 'IF ''?'' NOT IN (''master'', ''tempdb'', ''tempdev'', ''model'', ''msdb'')
AND (SELECT recovery_model FROM master.sys.databases WHERE name = ''?'') = 1
AND (SELECT is_read_only FROM master.sys.databases WHERE name = ''?'') = 0
BEGIN
declare @LogFile nvarchar(2000)
USE [?]
SELECT @LogFile = sys.database_files.name
FROM sys.database_files
WHERE (sys.database_files.type = 1)
PRINT @LogFile
EXEC(''ALTER DATABASE [?] SET RECOVERY SIMPLE'')
DBCC SHRINKFILE (@LogFile, 1)
EXEC(''ALTER DATABASE [?] SET RECOVERY FULL'')
END'</pre></div></div>

<p>It may be even a better idea of using dynamic SQL and implicit looping through databases instead of undocumented SP, like this</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="de1"><pre class="de1"><span class="kw1">declare</span> @<span class="kw1">SQL</span> <span class="kw1">nvarchar</span><span class="br0">&#40;</span><span class="kw2">max</span><span class="br0">&#41;</span>
&nbsp;
&nbsp; <span class="kw1">select</span> @<span class="kw1">SQL</span> <span class="sy0">=</span> <span class="kw1">coalesce</span><span class="br0">&#40;</span>@<span class="kw1">SQL</span> <span class="sy0">+</span> <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">13</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="kw1">char</span><span class="br0">&#40;</span><span class="nu0">10</span><span class="br0">&#41;</span>,<span class="st0">''</span><span class="br0">&#41;</span> <span class="sy0">+</span> N<span class="st0">'</span>
<span class="st0"> Use '</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>d.<span class="br0">&#91;</span>name<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">';'</span> <span class="sy0">+</span> <span class="kw1">CHAR</span><span class="br0">&#40;</span><span class="nu0">13</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">'</span>
<span class="st0"> ALTER DATABASE '</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>d.<span class="br0">&#91;</span>name<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">' SET RECOVERY SIMPLE;</span>
<span class="st0"> DBCC SHRINKFILE ('</span> <span class="sy0">+</span> <span class="kw2">quotename</span><span class="br0">&#40;</span>mf.<span class="br0">&#91;</span>name<span class="br0">&#93;</span>,<span class="st0">''</span><span class="st0">''</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">', 1);</span>
<span class="st0"> ALTER DATABASE '</span> <span class="sy0">+</span> <span class="kw2">QUOTENAME</span><span class="br0">&#40;</span>d.<span class="br0">&#91;</span>name<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">' SET RECOVERY FULL;'</span>
<span class="kw1">FROM</span> sys.<span class="me1">databases</span> d
<span class="kw1">INNER</span> <span class="sy0">JOIN</span> sys.<span class="me1">master_files</span> mf <span class="kw1">ON</span> <span class="br0">&#91;</span>d<span class="br0">&#93;</span>.<span class="br0">&#91;</span>database_id<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="br0">&#91;</span>mf<span class="br0">&#93;</span>.<span class="br0">&#91;</span>database_id<span class="br0">&#93;</span>
<span class="kw1">WHERE</span>
&nbsp; &nbsp; d.<span class="br0">&#91;</span>database_id<span class="br0">&#93;</span> <span class="sy0">&gt;</span> <span class="nu0">4</span> <span class="co1">--no sys dbs</span>
&nbsp; &nbsp; <span class="sy0">AND</span> d.<span class="me1">recovery_model</span> <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="sy0">AND</span> d.<span class="me1">is_read_only</span> <span class="sy0">=</span> <span class="nu0">0</span>
&nbsp; &nbsp; <span class="sy0">AND</span> mf.<span class="br0">&#91;</span>type<span class="br0">&#93;</span> <span class="sy0">=</span> <span class="nu0">1</span> <span class="co1">--log files</span>
<span class="kw1">ORDER</span> <span class="kw1">BY</span> d.<span class="me1">name</span>
&nbsp;
<span class="co1">--print @SQL</span>
&nbsp;
<span class="kw1">execute</span> <span class="br0">&#40;</span>@<span class="kw1">SQL</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">declare @SQL nvarchar(max)

  select @SQL = coalesce(@SQL + char(13) + char(10),'') + N'
 Use ' + QUOTENAME(d.[name]) + ';' + CHAR(13) + '
 ALTER DATABASE ' + QUOTENAME(d.[name]) + ' SET RECOVERY SIMPLE;
 DBCC SHRINKFILE (' + quotename(mf.[name],'''') + ', 1);
 ALTER DATABASE ' + QUOTENAME(d.[name]) + ' SET RECOVERY FULL;'
FROM sys.databases d
INNER JOIN sys.master_files mf ON [d].[database_id] = [mf].[database_id]
WHERE
    d.[database_id] &gt; 4 --no sys dbs
    AND d.recovery_model = 1
    AND d.is_read_only = 0
    AND mf.[type] = 1 --log files
ORDER BY d.name

--print @SQL

execute (@SQL)</pre></div></div>

<p>(code based on this <a href="http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/414973eb-a84b-40c4-8a21-919d92947ed0/#4c9c3420-495c-4e0f-ad94-6fbb4b7c44fb">MSDN thread</a>)<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-<br />
Interestingly, this solution, proposed by Borislav Borissov, still attempts to change recovery model in TempDB &#8211; not clear why:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="de1"><pre class="de1">sp_MSForEachDb <span class="st0">'IF LOWER('</span><span class="st0">'?'</span><span class="st0">') NOT IN ('</span><span class="st0">'master'</span><span class="st0">', '</span><span class="st0">'tempdb'</span><span class="st0">', '</span><span class="st0">'tempdev'</span><span class="st0">', '</span><span class="st0">'model'</span><span class="st0">', '</span><span class="st0">'msdb'</span><span class="st0">')</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BEGIN</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; declare @LogFile nvarchar(2000)</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; declare @ExeString nvarchar(2000)</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USE [?]</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SELECT @LogFile = sys.sysaltfiles.name</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FROM sys.sysdatabases</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INNER JOIN sys.sysaltfiles ON sys.sysdatabases.dbid = sys.sysaltfiles.dbid</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE (sys.sysaltfiles.fileid = 1) AND (sys.sysdatabases.name = '</span><span class="st0">'?'</span><span class="st0">')</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print @LogFile</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ALTER DATABASE [?] SET RECOVERY SIMPLE</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DBCC SHRINKFILE (@LogFile, 1)</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ALTER DATABASE [?] SET RECOVERY FULL</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; END'</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_MSForEachDb 'IF LOWER(''?'') NOT IN (''master'', ''tempdb'', ''tempdev'', ''model'', ''msdb'')
                 BEGIN
                     declare @LogFile nvarchar(2000)
                     declare @ExeString nvarchar(2000)
                     USE [?]
                     SELECT @LogFile = sys.sysaltfiles.name
                            FROM sys.sysdatabases
                     INNER JOIN sys.sysaltfiles ON sys.sysdatabases.dbid = sys.sysaltfiles.dbid
                     WHERE (sys.sysaltfiles.fileid = 1) AND (sys.sysdatabases.name = ''?'')
                     print @LogFile
                     ALTER DATABASE [?] SET RECOVERY SIMPLE
                     DBCC SHRINKFILE (@LogFile, 1)
                     ALTER DATABASE [?] SET RECOVERY FULL
                 END'</pre></div></div>

<p>However, the solution suggested by George Mastros of first creating a stored procedure and then executing it, works fine</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="tsql"><thead><tr><td colspan="2"  class="head">T-SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="de1"><pre class="de1">sp_msforeachdb <span class="st0">'If '</span><span class="st0">'?'</span><span class="st0">' Not In ('</span><span class="st0">'master'</span><span class="st0">','</span><span class="st0">'tempdb'</span><span class="st0">','</span><span class="st0">'model'</span><span class="st0">','</span><span class="st0">'msdb'</span><span class="st0">') </span>
<span class="st0"> &nbsp; &nbsp; &nbsp;Begin</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Declare @LogFile nvarchar(2000)</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Select @LogFile = Name From master..sysaltfiles Where db_name(dbid) = '</span><span class="st0">'?'</span><span class="st0">' And Fileid = 2</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Set @LogFile = '</span><span class="st0">'Create Procedure dbo.ShrinkMe As </span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ALTER DATABASE [?] SET RECOVERY SIMPLE</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dbcc ShrinkFile(['</span><span class="st0">' + @LogFile + '</span><span class="st0">'])</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ALTER DATABASE [?] SET RECOVERY FULL'</span><span class="st0">'</span>
&nbsp;
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;use [?]</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If Exists(Select * From [?].Information_Schema.Routines Where Specific_Name = '</span><span class="st0">'ShrinkMe'</span><span class="st0">')</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Begin</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;drop Procedure ShrinkMe</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;End</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;use [?] &nbsp; &nbsp; </span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Exec (@LogFile) &nbsp; </span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--print(@LogFile)</span>
<span class="st0"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exec [?].dbo.ShrinkMe</span>
<span class="st0"> &nbsp; &nbsp; &nbsp;End '</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">sp_msforeachdb 'If ''?'' Not In (''master'',''tempdb'',''model'',''msdb'') 
      Begin
            Declare @LogFile nvarchar(2000)
            Select @LogFile = Name From master..sysaltfiles Where db_name(dbid) = ''?'' And Fileid = 2
            Set @LogFile = ''Create Procedure dbo.ShrinkMe As 
                  ALTER DATABASE [?] SET RECOVERY SIMPLE
                  dbcc ShrinkFile(['' + @LogFile + ''])
                  ALTER DATABASE [?] SET RECOVERY FULL''
 
            use [?]
            If Exists(Select * From [?].Information_Schema.Routines Where Specific_Name = ''ShrinkMe'')
                  Begin
                        drop Procedure ShrinkMe
                  End
            use [?]     
            Exec (@LogFile)   
            --print(@LogFile)
            exec [?].dbo.ShrinkMe
      End '</pre></div></div>

<p>This link allows to check the recovery model for the database<br />
 http://blog.sqlauthority.com/2009/07/16/sql-server-four-different-ways-to-find-recovery-model-for-database/</p>
<p>*** <strong>Remember, if you have a SQL related question, try our <a href="http://forum.lessthandot.com/viewforum.php?f=17">Microsoft SQL Server Programming</a> forum or our <a href="http://forum.lessthandot.com/viewforum.php?f=22">Microsoft SQL Server Admin</a> forum</strong><ins></ins></p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/datadesign/location-of-files-for-new/'>Location of files for new database in SQL Server</a><p>The following question was asked I've got a sql server that's set up to have&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbadmin/sql-server-dba-tip-6/'>SQL Server DBA Tip 3 - Server Configuration â€“ Model Database</a><p>The Model database is used as a template for all user databases that are created&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2>Naomi Nosonovsky, Senior Software Developer, has more than 15 years of enterprise experience in analysis, design, development and implementation of high-performance client/server data management solutions.

She is a Personality of the Year for 2008, 2009, 2010 and 2011 at www.universalthread.com in .NET, SQL Server & VFP categories.

She is also an All Star contributor/MCC Community Contributor at forums.asp.net and MSDN T-SQL forum.


 
	



    

    


<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://www.facebook.com/profile.php?id=http://www.facebook.com/?sk=messages&tid=1240691655679#!/profile.php?id=10395470" title="Naomi at Facebook" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Facebook" /></a><a href="http://www.linkedin.com/profile?viewProfile=&key=55538716&trk=tab_pro" title="Naomi at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://delicious.com/http://delicious.com/naomi_nos" title="Naomi at delicious" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_delicious.png" alt="delicious" /></a><a href="/index.php/author/naomi/feed/" title="Blog RSS feed for Naomi" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 39,373 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/naomi/">Read More Posts by Naomi Nosonovsky</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&text=RT @LessThanDot Blog - Shrink log in all your user databases by naomi" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&title=Shrink log in all your user databases&source=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&title=Shrink log in all your user databases" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&quote=Shrink log in all your user databases" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/&title=Shrink log in all your user databases" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		7 Comments	</h4>
			<ol class="comments-list">
					<li class="comment byuser comment-author-SQLDenis even thread-even depth-1" id="comment-1560">
				<div id="div-comment-1560" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">SQLDenis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1560">
			July 12, 2009 at 4:33 am</a>		</div>

		<p>Can&#8217;t wait for onpnt&#8217;s reply  ðŸ™‚</p>
<p>I understand this is what someone asked for but you should NOT shrink your files</p>
<p>onpnt explains why here: <a href="/index.php/DataMgmt/DBAdmin/MSSQLServerAdmin/do-not-truncate-your-ldf-files">/index.php/DataMgmt/DBAdmin/MSSQLServerAdmin/do-not-truncate-your-ldf-files</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1560#respond' onclick='return addComment.moveForm( "div-comment-1560", "1560", "respond", "506" )' aria-label='Reply to SQLDenis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-1561">
				<div id="div-comment-1561" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1561">
			July 12, 2009 at 6:39 am</a>		</div>

		<p>I believe onpnt said that Shrinkfile is OK. ðŸ™‚</p>
<p>Thanks for the feedback.</p>
<p>BTW, I changed the blog&#8217;s title now.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1561#respond' onclick='return addComment.moveForm( "div-comment-1561", "1561", "respond", "506" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-onpnt even thread-even depth-1" id="comment-1562">
				<div id="div-comment-1562" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9666550a97e912e0dff5023dddb78e64?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9666550a97e912e0dff5023dddb78e64?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Ted Krueger (onpnt)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1562">
			July 13, 2009 at 7:15 pm</a>		</div>

		<p>shrinkfile still causes fragmentation on disk and countless shrinkfiles can become an issue.  It is of course the best course if you have a file growth issue and you need to do something about it.  I thought of throwing a party when I saw truncate removed in 2008.  ðŸ˜‰  Just last week I had to do a shrinkfile on a log that went out there due to a index maintenance and backup issue that made the log go to around 70GB.  It&#8217;s not really a problem but did cause a problem with my mirror and it was a mistake on my part and should have been avoided.  </p>
<p>I highly recommend reading a few things and concerns on anything that goes with shrink though so understand what you really are doing to things and performance.  </p>
<p>8 Steps to better Transaction Log throughput<br />
<a href="http://www.sqlskills.com/blogs/kimberly/post/8-Steps-to-better-Transaction-Log-throughput.aspx">http://www.sqlskills.com/blogs/kimberly/post/8-Steps-to-better-Transaction-Log-throughput.aspx</a></p>
<p>Transaction Log VLFs &#8211; too many or too few?<br />
<a href="http://www.sqlskills.com/BLOGS/KIMBERLY/post/Transaction-Log-VLFs-too-many-or-too-few.aspx">http://www.sqlskills.com/BLOGS/KIMBERLY/post/Transaction-Log-VLFs-too-many-or-too-few.aspx</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1562#respond' onclick='return addComment.moveForm( "div-comment-1562", "1562", "respond", "506" )' aria-label='Reply to Ted Krueger (onpnt)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-onpnt odd alt thread-odd thread-alt depth-1" id="comment-1563">
				<div id="div-comment-1563" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/9666550a97e912e0dff5023dddb78e64?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/9666550a97e912e0dff5023dddb78e64?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Ted Krueger (onpnt)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1563">
			July 13, 2009 at 7:21 pm</a>		</div>

		<p>On the blog, the procedure has some concerns with it. Not really the procedure but the concept of what it is doing is a problem.  Setting the recovery to simple really doesn&#8217;t solve the problem at hand.  Log backups and proper log maintenance will.  The largest problem that is faced in doing the steps of altering the recovery mode however, is the state you put the db in.  Basically you are putting yourself in a critical state that you cannot recover from and could very well lose your db if this goes bad.  I would recommend not going in this route and treating every log (single or groups) for each db uniquely and set the growth and size depending on the type and level of transactions coming into the db.  given some time you can keep logs well in check and not a problem that you come back from vacations to ðŸ™‚</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1563#respond' onclick='return addComment.moveForm( "div-comment-1563", "1563", "respond", "506" )' aria-label='Reply to Ted Krueger (onpnt)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1564">
				<div id="div-comment-1564" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/f0cc18150ac085b0c6598de5509f9590?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f0cc18150ac085b0c6598de5509f9590?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.google.com/' rel='external nofollow' class='url'>The Review Site</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1564">
			November 12, 2009 at 5:52 am</a>		</div>

		<p>Good post congratulations.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1564#respond' onclick='return addComment.moveForm( "div-comment-1564", "1564", "respond", "506" )' aria-label='Reply to The Review Site'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1565">
				<div id="div-comment-1565" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/a7bf522d037a206132df765b47ad45bf?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/a7bf522d037a206132df765b47ad45bf?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Duncan Dubick</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1565">
			May 5, 2010 at 9:33 am</a>		</div>

		<p>I needed a script like this and came across this one.  Had to modify it a bit since the first script listed is shrinking file_id 1 (which is the primary data file).  I changed this so it is looking at the type field (=1) in master.sys.databases. Also, this script doesn&#8217;t check to see if the database was in simple recovery model to start with!  Changed all of my simple databases to Full.  Lastly, the &#8216;tempdb error&#8217; is caused by sql validating the generated code for each iteration.  Since you can&#8217;t change the recovery model on tempdb it is spitting out the message.  I hid those lines in exec statements.</p>
<p>
sp_MSForEachDb &#8216;IF &#8221;?&#8221; NOT IN (&#8221;master&#8221;, &#8221;tempdb&#8221;, &#8221;tempdev&#8221;, &#8221;model&#8221;, &#8221;msdb&#8221;)<br />
					AND (SELECT recovery_model FROM master.sys.databases WHERE name = &#8221;?&#8221;) = 1<br />
					AND (SELECT is_read_only FROM master.sys.databases WHERE name = &#8221;?&#8221;) = 0<br />
                BEGIN<br />
                    declare @LogFile nvarchar(2000)<br />
                    USE [?]<br />
                    SELECT @LogFile = sys.database_files.name<br />
                           FROM sys.database_files<br />
                    WHERE (sys.database_files.type = 1)<br />
                    PRINT @LogFile<br />
                    EXEC(&#8221;ALTER DATABASE [?] SET RECOVERY SIMPLE&#8221;)<br />
                    DBCC SHRINKFILE (@LogFile, 1)<br />
                    EXEC(&#8221;ALTER DATABASE [?] SET RECOVERY FULL&#8221;)<br />
                END&#8217;</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1565#respond' onclick='return addComment.moveForm( "div-comment-1565", "1565", "respond", "506" )' aria-label='Reply to Duncan Dubick'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi bypostauthor even thread-even depth-1" id="comment-1566">
				<div id="div-comment-1566" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#comment-1566">
			May 5, 2010 at 9:45 am</a>		</div>

		<p>Duncan,</p>
<p>Thanks a lot for your comment &#8211; very valid points. I&#8217;m also thinking, that using undocumented stored procedure could have been a wrong idea to begin with.</p>
<p>Take a look here for a similar problem of looping through all databases</p>
<p><a href="http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/414973eb-a84b-40c4-8a21-919d92947ed0/#4c9c3420-495c-4e0f-ad94-6fbb4b7c44fb">Relevant MSDN thread</a></p>
<p>Please take a look at last comment by Adam Haines in the mentioned thread &#8211; very important!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/?replytocom=1566#respond' onclick='return addComment.moveForm( "div-comment-1566", "1566", "respond", "506" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/datadesign/truncate-log-in-all-your-user-databases/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='506' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="eeb69a3cb92300456b6a5f4162093851"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552766018"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
