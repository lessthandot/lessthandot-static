<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   SSIS Deployment with PowerShell: Adding Environment References</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   SSIS Deployment with PowerShell: Adding Environment References" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="This blog post explains how you can add environment references in a PowerShell deployment script for SSIS 2012." />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; SSIS Deployment with PowerShell: Adding Environment References Comments Feed" href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='August 2013 PASSMN Meeting' href='/index.php/itprofessionals/professionaldevelopment/august-2013-passmn-meeting/' />
<link rel='next' title='Technical nepotism&#8230;do you suffer from it?' href='/index.php/itprofessionals/itprocesses/technical-nepotism-do-you-suffer/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/" />
<link rel='shortlink' href='/?p=2146' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdbadmin%2Fmssqlserveradmin%2Fssis-deployment-with-powershell-adding%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdbadmin%2Fmssqlserveradmin%2Fssis-deployment-with-powershell-adding%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/itprofessionals/itprocesses/technical-nepotism-do-you-suffer/" rel="next">Technical nepotism&#8230;do you suffer from it?</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/itprofessionals/professionaldevelopment/august-2013-passmn-meeting/" rel="prev">August 2013 PASSMN Meeting</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/" class="post-title">SSIS Deployment with PowerShell: Adding Environment References</a></h1>
					<div class="post-byline">by <a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck" rel="author">Koen Verbeeck</a> on August 21, 2013 in category <a href="/index.php/category/webdev/business-intelligence/" rel="category tag">Business Intelligence</a> <a href="/index.php/category/datamgmt/dbprogramming/mssqlserver/" rel="category tag">Microsoft SQL Server</a> <a href="/index.php/category/datamgmt/dbadmin/mssqlserveradmin/" rel="category tag">Microsoft SQL Server Admin</a> <a href="/index.php/category/datamgmt/ssis/" rel="category tag">SSIS</a>. Article views: 36,927 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&text=RT @LessThanDot Blog - SSIS Deployment with PowerShell: Adding Environment References by @Ko_Ver" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&title=SSIS Deployment with PowerShell: Adding Environment References&source=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&title=SSIS Deployment with PowerShell: Adding Environment References" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&quote=SSIS Deployment with PowerShell: Adding Environment References" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&title=SSIS Deployment with PowerShell: Adding Environment References" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p style="text-align: justify;">With the release of the revamped Integration Services in SQL Server 2012, a bunch of new deployment methods were introduced for the project deployment model. My article <a href="http://www.sqlservercentral.com/articles/Integration+Services+(SSIS)/101240/">SSIS Deployments with SQL Server 2012</a> gives an overview of these deployment methods. One of these methods is using PowerShell to deploy your project to the SSIS Catalog. Matt Masson (<a href="http://www.mattmasson.com/">blog</a> | <a href="https://twitter.com/mattmasson">twitter</a>) has an excellent blog post on the subject: <a href="http://www.mattmasson.com/2012/06/publish-to-ssis-catalog-using-powershell/">Publish to SSIS Catalog using PowerShell</a>.</p>
<p style="text-align: justify;">However, there’s one small step missing in the deployment script posted by Matt. I’ll use this blog article to post the entire deployment script, so that I have a full script online as an easy reference.</p>
<p style="text-align: justify;">I have a very simple SSIS project that I want to deploy to the Catalog. It contains only one package that transfers data from AdventureWorks to another database. It has two connection managers: one for each database. Nothing fancy here.</p>
<p style="text-align: justify;"><a href="/media/users/koenverbeeck/SSISDeploymentPowershell/ssisproject.png?mtime=1377025062"><img src="/wp-content/uploads/users/koenverbeeck/SSISDeploymentPowershell/ssisproject.png?mtime=1377025062" alt="" width="542" height="385" /></a></p>
<p><span style="text-align: justify;">When I deploy the project, I want to hook the OLE_TEST connection manager to an environment, so that I can easily change the destination server and/or database.</span></p>
<p style="text-align: justify;">The original script from Matt’s blog – modified for my project – looks like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="powershell"><thead><tr><td colspan="2"  class="head">PowerShell</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="de1"><pre class="de1"><span class="co1"># Variables</span>
<span class="re0">$SSIS_server</span> <span class="sy0">=</span><span class="st0">&quot;localhost&quot;</span>
<span class="re0">$ProjectFilePath</span> <span class="sy0">=</span> <span class="st0">&quot;E:TestSSIS2012PowerShell_TestPowerShell_TestbinDevelopmentPowerShell_Test.ispac&quot;</span>
&nbsp;
<span class="re0">$ProjectName</span> <span class="sy0">=</span> <span class="st0">&quot;PowerShell_Test&quot;</span>
<span class="re0">$FolderName</span> <span class="sy0">=</span> <span class="st0">&quot;PowerShellTest&quot;</span>
<span class="re0">$EnvironmentName</span> <span class="sy0">=</span> <span class="st0">&quot;Test2&quot;</span>
&nbsp;
<span class="co1"># Load the IntegrationServices Assembly</span>
<span class="br0">&#91;</span><span class="re4">System.Reflection.Assembly</span><span class="br0">&#93;</span>::<span class="re5">LoadWithPartialName</span><span class="br0">&#40;</span><span class="st0">&quot;Microsoft.SqlServer.Management.IntegrationServices&quot;</span><span class="br0">&#41;</span> <span class="sy0">|</span> <span class="kw1">Out-Null</span>;
&nbsp;
<span class="co1"># Store the IntegrationServices Assembly namespace to avoid typing it every time</span>
<span class="re0">$ISNamespace</span> <span class="sy0">=</span> <span class="st0">&quot;Microsoft.SqlServer.Management.IntegrationServices&quot;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Connecting to server ...&quot;</span>
&nbsp;
<span class="co1"># Create a connection to the server</span>
<span class="re0">$sqlConnectionString</span> <span class="sy0">=</span> <span class="st0">&quot;Data Source=&quot;</span> <span class="sy0">+</span> <span class="re0">$SSIS_server</span> <span class="sy0">+</span> <span class="st0">&quot;;Initial Catalog=master;Integrated Security=SSPI;&quot;</span>
<span class="re0">$sqlConnection</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> System.Data.SqlClient.SqlConnection <span class="re0">$sqlConnectionString</span>
&nbsp;
<span class="co1"># Create the Integration Services object</span>
<span class="re0">$integrationServices</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> $ISNamespace<span class="st0">&quot;.IntegrationServices&quot;</span> <span class="re0">$sqlConnection</span>
&nbsp;
<span class="re0">$catalog</span> <span class="sy0">=</span> <span class="re0">$integrationServices</span>.Catalogs<span class="br0">&#91;</span><span class="st0">&quot;SSISDB&quot;</span><span class="br0">&#93;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Creating Folder &quot;</span> <span class="re0">$FolderName</span> <span class="st0">&quot; ...&quot;</span>
&nbsp;
<span class="co1"># Create a new folder</span>
<span class="re0">$folder</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> $ISNamespace<span class="st0">&quot;.CatalogFolder&quot;</span> <span class="br0">&#40;</span><span class="re0">$catalog</span><span class="sy0">,</span> <span class="re0">$FolderName</span><span class="sy0">,</span> <span class="st0">&quot;Folder description&quot;</span><span class="br0">&#41;</span>
<span class="re0">$folder</span>.Create<span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Deploying &quot;</span> <span class="re0">$ProjectName</span> <span class="st0">&quot; project ...&quot;</span>
&nbsp;
<span class="co1"># Read the project file, and deploy it to the folder</span>
<span class="br0">&#91;</span><span class="re3">byte</span><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="re0">$projectFile</span> <span class="sy0">=</span> <span class="br0">&#91;</span>System.IO.File<span class="br0">&#93;</span>::ReadAllBytes<span class="br0">&#40;</span><span class="re0">$ProjectFilePath</span><span class="br0">&#41;</span>
<span class="re0">$folder</span>.DeployProject<span class="br0">&#40;</span><span class="re0">$ProjectName</span><span class="sy0">,</span> <span class="re0">$projectFile</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Creating environment ...&quot;</span>
&nbsp;
<span class="re0">$environment</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> $ISNamespace<span class="st0">&quot;.EnvironmentInfo&quot;</span> <span class="br0">&#40;</span><span class="re0">$folder</span><span class="sy0">,</span> <span class="re0">$EnvironmentName</span><span class="sy0">,</span> <span class="st0">&quot;Description&quot;</span><span class="br0">&#41;</span>
<span class="re0">$environment</span>.Create<span class="br0">&#40;</span><span class="br0">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Adding server variables ...&quot;</span>
&nbsp;
<span class="co1"># Adding variable to our environment</span>
<span class="co1"># Constructor args: variable name, type, default value, sensitivity, description</span>
<span class="re0">$environment</span>.Variables.Add<span class="br0">&#40;</span><span class="st0">&quot;ServerName&quot;</span><span class="sy0">,</span> <span class="br0">&#91;</span>System.TypeCode<span class="br0">&#93;</span>::String<span class="sy0">,</span> <span class="re0">$SSIS_server</span><span class="sy0">,</span> <span class="re0">$false</span><span class="sy0">,</span> <span class="st0">&quot;ServerName&quot;</span><span class="br0">&#41;</span>
<span class="re0">$environment</span>.Variables.Add<span class="br0">&#40;</span><span class="st0">&quot;DatabaseName&quot;</span><span class="sy0">,</span><span class="br0">&#91;</span>System.TypeCode<span class="br0">&#93;</span>::String<span class="sy0">,</span> <span class="st0">&quot;Test2&quot;</span><span class="sy0">,</span> <span class="re0">$false</span><span class="sy0">,</span><span class="st0">&quot;DatabaseName&quot;</span><span class="br0">&#41;</span>
<span class="re0">$environment</span>.Alter<span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Adding environment reference to project ...&quot;</span>
&nbsp;
<span class="co1"># making project refer to this environment</span>
<span class="re0">$project</span> <span class="sy0">=</span> <span class="re0">$folder</span>.Projects<span class="br0">&#91;</span><span class="re0">$ProjectName</span><span class="br0">&#93;</span>
<span class="re0">$project</span>.References.Add<span class="br0">&#40;</span><span class="re0">$EnvironmentName</span><span class="sy0">,</span> <span class="re0">$folder</span>.Name<span class="br0">&#41;</span>
<span class="re0">$project</span>.Alter<span class="br0">&#40;</span><span class="br0">&#41;</span> 
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;All done.&quot;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse"># Variables
$SSIS_server ="localhost"
$ProjectFilePath = "E:TestSSIS2012PowerShell_TestPowerShell_TestbinDevelopmentPowerShell_Test.ispac"

$ProjectName = "PowerShell_Test"
$FolderName = "PowerShellTest"
$EnvironmentName = "Test2"
 
# Load the IntegrationServices Assembly
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SqlServer.Management.IntegrationServices") | Out-Null;
 
# Store the IntegrationServices Assembly namespace to avoid typing it every time
$ISNamespace = "Microsoft.SqlServer.Management.IntegrationServices"
 
Write-Host "Connecting to server ..."
 
# Create a connection to the server
$sqlConnectionString = "Data Source=" + $SSIS_server + ";Initial Catalog=master;Integrated Security=SSPI;"
$sqlConnection = New-Object System.Data.SqlClient.SqlConnection $sqlConnectionString
 
# Create the Integration Services object
$integrationServices = New-Object $ISNamespace".IntegrationServices" $sqlConnection

$catalog = $integrationServices.Catalogs["SSISDB"]
 
Write-Host "Creating Folder " $FolderName " ..."
 
# Create a new folder
$folder = New-Object $ISNamespace".CatalogFolder" ($catalog, $FolderName, "Folder description")
$folder.Create()
 
Write-Host "Deploying " $ProjectName " project ..."
 
# Read the project file, and deploy it to the folder
[byte[]] $projectFile = [System.IO.File]::ReadAllBytes($ProjectFilePath)
$folder.DeployProject($ProjectName, $projectFile)
 
Write-Host "Creating environment ..."
 
$environment = New-Object $ISNamespace".EnvironmentInfo" ($folder, $EnvironmentName, "Description")
$environment.Create()            
 
Write-Host "Adding server variables ..."
 
# Adding variable to our environment
# Constructor args: variable name, type, default value, sensitivity, description
$environment.Variables.Add("ServerName", [System.TypeCode]::String, $SSIS_server, $false, "ServerName")
$environment.Variables.Add("DatabaseName",[System.TypeCode]::String, "Test2", $false,"DatabaseName")
$environment.Alter()
 
Write-Host "Adding environment reference to project ..."
 
# making project refer to this environment
$project = $folder.Projects[$ProjectName]
$project.References.Add($EnvironmentName, $folder.Name)
$project.Alter() 
 
Write-Host "All done."</pre></div></div>

<p style="text-align: justify;">The script deploys the project to the Catalog, creates an environment and links the environment to the project. The environment has two variables: one to set the server name and one to set the database. Let’s inspect the results. When you right-click on the project, you can choose <em>Configure</em>. In the Configure window, you can see the connection managers used in the project in the Connection Managers tab. When we take a look at the Initial Catalog property of the OLE_TEST connection manager, you can see it is not yet linked to an environment variable.</p>
<p style="text-align: justify;"><a href="/media/users/koenverbeeck/SSISDeploymentPowershell/configureProject_before.png?mtime=1377025062"><img src="/wp-content/uploads/users/koenverbeeck/SSISDeploymentPowershell/configureProject_before.png?mtime=1377025062" alt="" width="785" height="536" /></a></p>
<p><span style="text-align: justify;">Instead, it is still linked to the default design-time value. Remark that you can configure a package/project with an environment without actually using parameters. This is because a few properties of a connection manager are linked to parameters behind the scenes. For example, the Initial Catalog property is linked to the parameter with the name </span><em>[CM.&lt;connection manager name&gt;.InitialCatalog]</em><span style="text-align: justify;">. You can find the parameter name at the top of the </span><em>Set Parameter Value</em><span style="text-align: justify;"> dialog box.</span></p>
<p style="text-align: justify;">To link the environment variables to the connection manager, we need to add just a few lines to the script:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="powershell"><thead><tr><td colspan="2"  class="head">PowerShell</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="de1"><pre class="de1"><span class="kw1">Write-Host</span> <span class="st0">&quot;Setting environment variable on package connection string ...&quot;</span>
<span class="re0">$ssisPackage</span> <span class="sy0">=</span> <span class="re0">$project</span>.Packages.Item<span class="br0">&#40;</span><span class="st0">&quot;PowerShellTest.dtsx&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="re0">$parServerName</span> <span class="sy0">=</span> <span class="st0">&quot;CM.OLE_Test.ServerName&quot;</span>
<span class="re0">$ssisPackage</span>.Parameters<span class="br0">&#91;</span><span class="re0">$parServerName</span><span class="br0">&#93;</span>.<span class="kw2">Set</span><span class="br0">&#40;</span><span class="st0">&quot;Referenced&quot;</span><span class="sy0">,</span><span class="st0">&quot;ServerName&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="re0">$parDatabaseName</span> <span class="sy0">=</span> <span class="st0">&quot;CM.OLE_Test.InitialCatalog&quot;</span>
<span class="re0">$ssisPackage</span>.Parameters<span class="br0">&#91;</span><span class="re0">$parDatabaseName</span><span class="br0">&#93;</span>.<span class="kw2">Set</span><span class="br0">&#40;</span><span class="st0">&quot;Referenced&quot;</span><span class="sy0">,</span><span class="st0">&quot;DatabaseName&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="re0">$ssisPackage</span>.Alter<span class="br0">&#40;</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Write-Host "Setting environment variable on package connection string ..."
$ssisPackage = $project.Packages.Item("PowerShellTest.dtsx")

$parServerName = "CM.OLE_Test.ServerName"
$ssisPackage.Parameters[$parServerName].Set("Referenced","ServerName")

$parDatabaseName = "CM.OLE_Test.InitialCatalog"
$ssisPackage.Parameters[$parDatabaseName].Set("Referenced","DatabaseName")

$ssisPackage.Alter()</pre></div></div>

<p style="text-align: justify;">When you deploy the project to the server with these adjustments, we get the result we want:</p>
<p style="text-align: justify;"><a href="/media/users/koenverbeeck/SSISDeploymentPowershell/configureProject_after.png?mtime=1377025061"><img src="/wp-content/uploads/users/koenverbeeck/SSISDeploymentPowershell/configureProject_after.png?mtime=1377025061" alt="" width="747" height="375" /></a></p>
<p><span style="text-align: justify;">The environment variables are now linked to the two properties of the connection manager. When you run the package and choose the environment, the data is transferred to another database different from the one configured in the package, due to the reconfiguring of the connection manager by the environment variables.</span></p>
<p style="text-align: justify;"><a href="/media/users/koenverbeeck/SSISDeploymentPowershell/executePackage.png?mtime=1377025062"><img src="/wp-content/uploads/users/koenverbeeck/SSISDeploymentPowershell/executePackage.png?mtime=1377025062" alt="" width="530" height="363" /></a></p>
<p><span style="text-align: justify;">To wrap-up this post, here’s the entire deployment script for easier copy-paste:</span></p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="powershell"><thead><tr><td colspan="2"  class="head">PowerShell</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="de1"><pre class="de1"><span class="co1"># Variables</span>
<span class="re0">$SSIS_server</span> <span class="sy0">=</span><span class="st0">&quot;localhost&quot;</span>
<span class="re0">$ProjectFilePath</span> <span class="sy0">=</span> <span class="st0">&quot;E:TestSSIS2012PowerShell_TestPowerShell_TestbinDevelopmentPowerShell_Test.ispac&quot;</span>
&nbsp;
<span class="re0">$ProjectName</span> <span class="sy0">=</span> <span class="st0">&quot;PowerShell_Test&quot;</span>
<span class="re0">$FolderName</span> <span class="sy0">=</span> <span class="st0">&quot;PowerShellTest&quot;</span>
<span class="re0">$EnvironmentName</span> <span class="sy0">=</span> <span class="st0">&quot;Test2&quot;</span>
&nbsp;
<span class="co1"># Load the IntegrationServices Assembly</span>
<span class="br0">&#91;</span><span class="re4">System.Reflection.Assembly</span><span class="br0">&#93;</span>::<span class="re5">LoadWithPartialName</span><span class="br0">&#40;</span><span class="st0">&quot;Microsoft.SqlServer.Management.IntegrationServices&quot;</span><span class="br0">&#41;</span> <span class="sy0">|</span> <span class="kw1">Out-Null</span>;
&nbsp;
<span class="co1"># Store the IntegrationServices Assembly namespace to avoid typing it every time</span>
<span class="re0">$ISNamespace</span> <span class="sy0">=</span> <span class="st0">&quot;Microsoft.SqlServer.Management.IntegrationServices&quot;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Connecting to server ...&quot;</span>
&nbsp;
<span class="co1"># Create a connection to the server</span>
<span class="re0">$sqlConnectionString</span> <span class="sy0">=</span> <span class="st0">&quot;Data Source=&quot;</span> <span class="sy0">+</span> <span class="re0">$SSIS_server</span> <span class="sy0">+</span> <span class="st0">&quot;;Initial Catalog=master;Integrated Security=SSPI;&quot;</span>
<span class="re0">$sqlConnection</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> System.Data.SqlClient.SqlConnection <span class="re0">$sqlConnectionString</span>
&nbsp;
<span class="co1"># Create the Integration Services object</span>
<span class="re0">$integrationServices</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> $ISNamespace<span class="st0">&quot;.IntegrationServices&quot;</span> <span class="re0">$sqlConnection</span>
&nbsp;
<span class="re0">$catalog</span> <span class="sy0">=</span> <span class="re0">$integrationServices</span>.Catalogs<span class="br0">&#91;</span><span class="st0">&quot;SSISDB&quot;</span><span class="br0">&#93;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Creating Folder &quot;</span> <span class="re0">$FolderName</span> <span class="st0">&quot; ...&quot;</span>
&nbsp;
<span class="co1"># Create a new folder</span>
<span class="re0">$folder</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> $ISNamespace<span class="st0">&quot;.CatalogFolder&quot;</span> <span class="br0">&#40;</span><span class="re0">$catalog</span><span class="sy0">,</span> <span class="re0">$FolderName</span><span class="sy0">,</span> <span class="st0">&quot;Folder description&quot;</span><span class="br0">&#41;</span>
<span class="re0">$folder</span>.Create<span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Deploying &quot;</span> <span class="re0">$ProjectName</span> <span class="st0">&quot; project ...&quot;</span>
&nbsp;
<span class="co1"># Read the project file, and deploy it to the folder</span>
<span class="br0">&#91;</span><span class="re3">byte</span><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="re0">$projectFile</span> <span class="sy0">=</span> <span class="br0">&#91;</span>System.IO.File<span class="br0">&#93;</span>::ReadAllBytes<span class="br0">&#40;</span><span class="re0">$ProjectFilePath</span><span class="br0">&#41;</span>
<span class="re0">$folder</span>.DeployProject<span class="br0">&#40;</span><span class="re0">$ProjectName</span><span class="sy0">,</span> <span class="re0">$projectFile</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Creating environment ...&quot;</span>
&nbsp;
<span class="re0">$environment</span> <span class="sy0">=</span> <span class="kw1">New-Object</span> $ISNamespace<span class="st0">&quot;.EnvironmentInfo&quot;</span> <span class="br0">&#40;</span><span class="re0">$folder</span><span class="sy0">,</span> <span class="re0">$EnvironmentName</span><span class="sy0">,</span> <span class="st0">&quot;Description&quot;</span><span class="br0">&#41;</span>
<span class="re0">$environment</span>.Create<span class="br0">&#40;</span><span class="br0">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Adding server variables ...&quot;</span>
&nbsp;
<span class="co1"># Adding variable to our environment</span>
<span class="co1"># Constructor args: variable name, type, default value, sensitivity, description</span>
<span class="re0">$environment</span>.Variables.Add<span class="br0">&#40;</span><span class="st0">&quot;ServerName&quot;</span><span class="sy0">,</span> <span class="br0">&#91;</span>System.TypeCode<span class="br0">&#93;</span>::String<span class="sy0">,</span> <span class="re0">$SSIS_server</span><span class="sy0">,</span> <span class="re0">$false</span><span class="sy0">,</span> <span class="st0">&quot;ServerName&quot;</span><span class="br0">&#41;</span>
<span class="re0">$environment</span>.Variables.Add<span class="br0">&#40;</span><span class="st0">&quot;DatabaseName&quot;</span><span class="sy0">,</span><span class="br0">&#91;</span>System.TypeCode<span class="br0">&#93;</span>::String<span class="sy0">,</span> <span class="st0">&quot;Test2&quot;</span><span class="sy0">,</span> <span class="re0">$false</span><span class="sy0">,</span><span class="st0">&quot;DatabaseName&quot;</span><span class="br0">&#41;</span>
<span class="re0">$environment</span>.Alter<span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Adding environment reference to project ...&quot;</span>
&nbsp;
<span class="co1"># making project refer to this environment</span>
<span class="re0">$project</span> <span class="sy0">=</span> <span class="re0">$folder</span>.Projects<span class="br0">&#91;</span><span class="re0">$ProjectName</span><span class="br0">&#93;</span>
<span class="re0">$project</span>.References.Add<span class="br0">&#40;</span><span class="re0">$EnvironmentName</span><span class="sy0">,</span> <span class="re0">$folder</span>.Name<span class="br0">&#41;</span>
<span class="re0">$project</span>.Alter<span class="br0">&#40;</span><span class="br0">&#41;</span> 
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;Setting environment variable on package connection string ...&quot;</span>
<span class="re0">$ssisPackage</span> <span class="sy0">=</span> <span class="re0">$project</span>.Packages.Item<span class="br0">&#40;</span><span class="st0">&quot;PowerShellTest.dtsx&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="re0">$parServerName</span> <span class="sy0">=</span> <span class="st0">&quot;CM.OLE_Test.ServerName&quot;</span>
<span class="re0">$ssisPackage</span>.Parameters<span class="br0">&#91;</span><span class="re0">$parServerName</span><span class="br0">&#93;</span>.<span class="kw2">Set</span><span class="br0">&#40;</span><span class="st0">&quot;Referenced&quot;</span><span class="sy0">,</span><span class="st0">&quot;ServerName&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="re0">$parDatabaseName</span> <span class="sy0">=</span> <span class="st0">&quot;CM.OLE_Test.InitialCatalog&quot;</span>
<span class="re0">$ssisPackage</span>.Parameters<span class="br0">&#91;</span><span class="re0">$parDatabaseName</span><span class="br0">&#93;</span>.<span class="kw2">Set</span><span class="br0">&#40;</span><span class="st0">&quot;Referenced&quot;</span><span class="sy0">,</span><span class="st0">&quot;DatabaseName&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="re0">$ssisPackage</span>.Alter<span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">Write-Host</span> <span class="st0">&quot;All done.&quot;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse"># Variables
$SSIS_server ="localhost"
$ProjectFilePath = "E:TestSSIS2012PowerShell_TestPowerShell_TestbinDevelopmentPowerShell_Test.ispac"

$ProjectName = "PowerShell_Test"
$FolderName = "PowerShellTest"
$EnvironmentName = "Test2"
 
# Load the IntegrationServices Assembly
[System.Reflection.Assembly]::LoadWithPartialName("Microsoft.SqlServer.Management.IntegrationServices") | Out-Null;
 
# Store the IntegrationServices Assembly namespace to avoid typing it every time
$ISNamespace = "Microsoft.SqlServer.Management.IntegrationServices"
 
Write-Host "Connecting to server ..."
 
# Create a connection to the server
$sqlConnectionString = "Data Source=" + $SSIS_server + ";Initial Catalog=master;Integrated Security=SSPI;"
$sqlConnection = New-Object System.Data.SqlClient.SqlConnection $sqlConnectionString
 
# Create the Integration Services object
$integrationServices = New-Object $ISNamespace".IntegrationServices" $sqlConnection

$catalog = $integrationServices.Catalogs["SSISDB"]
 
Write-Host "Creating Folder " $FolderName " ..."
 
# Create a new folder
$folder = New-Object $ISNamespace".CatalogFolder" ($catalog, $FolderName, "Folder description")
$folder.Create()
 
Write-Host "Deploying " $ProjectName " project ..."
 
# Read the project file, and deploy it to the folder
[byte[]] $projectFile = [System.IO.File]::ReadAllBytes($ProjectFilePath)
$folder.DeployProject($ProjectName, $projectFile)
 
Write-Host "Creating environment ..."
 
$environment = New-Object $ISNamespace".EnvironmentInfo" ($folder, $EnvironmentName, "Description")
$environment.Create()            
 
Write-Host "Adding server variables ..."
 
# Adding variable to our environment
# Constructor args: variable name, type, default value, sensitivity, description
$environment.Variables.Add("ServerName", [System.TypeCode]::String, $SSIS_server, $false, "ServerName")
$environment.Variables.Add("DatabaseName",[System.TypeCode]::String, "Test2", $false,"DatabaseName")
$environment.Alter()
 
Write-Host "Adding environment reference to project ..."
 
# making project refer to this environment
$project = $folder.Projects[$ProjectName]
$project.References.Add($EnvironmentName, $folder.Name)
$project.Alter() 
 
Write-Host "Setting environment variable on package connection string ..."
$ssisPackage = $project.Packages.Item("PowerShellTest.dtsx")

$parServerName = "CM.OLE_Test.ServerName"
$ssisPackage.Parameters[$parServerName].Set("Referenced","ServerName")

$parDatabaseName = "CM.OLE_Test.InitialCatalog"
$ssisPackage.Parameters[$parDatabaseName].Set("Referenced","DatabaseName")

$ssisPackage.Alter()

Write-Host "All done."</pre></div></div>

<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/webdev/business-intelligence/sql-server-2012-business-intelligence/'>SQL Server 2012 Business Intelligence Whitepaper and Data Tools released</a><p>If you are into Business Intelligence, you are in luck, this week Microsoft has released&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/ssis-configuration-editor/'>SQL Server Integration Services tools to have – Configuration File Editor</a><p>In a previous post, SQL Server Integration Services tools to have – Expression Editor &amp;&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="/wp-content/uploads/2014/08/stickers-music-nirvana-s" alt="User bio image"/>Koen Verbeeck is a Microsoft Business Intelligence consultant at element61, helping clients to get insight in their data. Koen has a comprehensive knowledge of the SQL Server BI stack, with a particular love for Integration Services. He's also a speaker at various conferences.<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/Ko_Ver" title="koenverbeeck at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/in/kverbeeck" title="koenverbeeck at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="/index.php/author/koenverbeeck/feed/" title="Blog RSS feed for koenverbeeck" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 36,927 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/koenverbeeck/">Read More Posts by Koen Verbeeck</a>
						</div>
					</div>
					<div>
						<label>Tags:</label> <a href="/index.php/tag/catalog/" rel="tag">catalog</a>, <a href="/index.php/tag/deployment/" rel="tag">deployment</a>, <a href="/index.php/tag/powershell/" rel="tag">powershell</a>, <a href="/index.php/tag/sql-server/" rel="tag">sql server</a>, <a href="/index.php/tag/ssis-2/" rel="tag">ssis</a>, <a href="/index.php/tag/syndicated/" rel="tag">syndicated</a> 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&text=RT @LessThanDot Blog - SSIS Deployment with PowerShell: Adding Environment References by @Ko_Ver" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&title=SSIS Deployment with PowerShell: Adding Environment References&source=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&title=SSIS Deployment with PowerShell: Adding Environment References" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&quote=SSIS Deployment with PowerShell: Adding Environment References" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/&title=SSIS Deployment with PowerShell: Adding Environment References" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		3 Comments	</h4>
			<ol class="comments-list">
					<li class="comment even thread-even depth-1" id="comment-2096310">
				<div id="div-comment-2096310" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/aacc0b3778407dd794e71fa70a75adfe?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/aacc0b3778407dd794e71fa70a75adfe?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Rodolfo Alvarez</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/#comment-2096310">
			October 11, 2014 at 7:46 pm</a>		</div>

		<p>Thanks a lot! This works great.</p>
<p>I had trouble assigning the parameter values to the project, not to the package. I have a  project level connection manager. This is how I resolved it:</p>
<p>Write-Host &#8220;Setting environment variable on package connection string &#8230;&#8221;<br />
#$ssisPackage = $project.Packages.Item(&#8220;&#8221;PowerShellTest.dtsx&#8221;)<br />
$ssisProject = $folder.Projects.Item($ProjectName)</p>
<p>$parServerName = &#8220;CM.OLE_Test.ServerName&#8221;<br />
#$ssisPackage.Parameters[$parServerName].Set(&#8220;Referenced&#8221;,&#8221;ServerName&#8221;)<br />
$ssisProject.Parameters[$parServerName].Set(&#8220;Referenced&#8221;,&#8221;ServerName&#8221;)</p>
<p>$parDatabaseName = &#8220;CM.OLE_Test.InitialCatalog&#8221;<br />
#$ssisPackage.Parameters[$parDatabaseName].Set(&#8220;Referenced&#8221;,&#8221;DatabaseName&#8221;)<br />
$ssisProject.Parameters[$parDatabaseName].Set(&#8220;Referenced&#8221;,&#8221;DatabaseName&#8221;)</p>
<p>Now my problem is that when running any package the following message apears&gt;<br />
TITLE: Microsoft SQL Server Management Studio<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>The property &#8220;InitialCatalog&#8221; of connection manager &#8220;xxxxxx&#8221; is configured to use an environment variable, but no environment has been selected.  Select the &#8220;Environment&#8221; checkbox and specify the environment to use, or specify a literal value for the property.</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>How can I set the environment at a project level? Thanks in advance for any advice!</p>
<p>BUTTONS:</p>
<p>OK<br />
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/?replytocom=2096310#respond' onclick='return addComment.moveForm( "div-comment-2096310", "2096310", "respond", "2146" )' aria-label='Reply to Rodolfo Alvarez'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-5002673">
				<div id="div-comment-5002673" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/0ac274e3e9eb2ce29d122aecf85fca3e?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/0ac274e3e9eb2ce29d122aecf85fca3e?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Nico Atilano</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/#comment-5002673">
			April 19, 2016 at 9:06 pm</a>		</div>

		<p>Hi! i would like to ask regarding the part where you choose the environment when running a package, is it possible to automate it? like theres no need for me to tick the &#8220;Environment&#8221; checkbox. or it is ot possible to configure PowerShell to automatically check the &#8220;Environment&#8221; checkbox?</p>
<p>im referencing my question in the statement below:</p>
<p>&#8220;When you run the package and choose the environment, the data is transferred to another database different from the one configured in the package, due to the reconfiguring of the connection manager by the environment variables.&#8221;</p>
<p>Hoping to hear from you the soonest possible.</p>
<p>thank you very much.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/?replytocom=5002673#respond' onclick='return addComment.moveForm( "div-comment-5002673", "5002673", "respond", "2146" )' aria-label='Reply to Nico Atilano'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-koenverbeeck bypostauthor even thread-even depth-1" id="comment-5012795">
				<div id="div-comment-5012795" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/058ee33ff257e0210fa069bf7e94e036?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/058ee33ff257e0210fa069bf7e94e036?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Koen Verbeeck</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/#comment-5012795">
			April 26, 2016 at 6:35 am</a>		</div>

		<p>Hi Nico,</p>
<p>you can run SSIS packages in the SSIS catalog using stored procedures:<br />
<a href="https://msdn.microsoft.com/en-us/library/ff878034.aspx" title="catalog.create_execution" rel="nofollow">catalog.create_execution</a></p>
<p>The reference to the environment is passed as a parameter.<br />
There&#8217;s probably a powershell function that does the same thing.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/?replytocom=5012795#respond' onclick='return addComment.moveForm( "div-comment-5012795", "5012795", "respond", "2146" )' aria-label='Reply to Koen Verbeeck'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/dbadmin/mssqlserveradmin/ssis-deployment-with-powershell-adding/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='2146' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="b73dfe25b4b8714c029b37a6ad3006fa"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765952"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
