<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="This month's T-SQL Tuesday topic is a favorite of mine: CTEs. I show you how to write a recursive CTE to insert dates into a dates table." />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is Comments Feed" href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='SQL Server DBA Tip 10 – SQL Server Reporting – Offload the reporting factor' href='/index.php/datamgmt/dbadmin/sql-server-dba-tip-10-offload-the-reporting-factor/' />
<link rel='next' title='SQL Server DBA Tip 11 – SQL Server Configuration – MIN Memory' href='/index.php/datamgmt/dbadmin/sql-server-dba-tip-sql-server-min-memory/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/" />
<link rel='shortlink' href='/?p=1167' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdbprogramming%2Ft-sql-tuesday-18-a%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdbprogramming%2Ft-sql-tuesday-18-a%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/datamgmt/dbadmin/sql-server-dba-tip-sql-server-min-memory/" rel="next">SQL Server DBA Tip 11 – SQL Server Configuration – MIN Memory</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/datamgmt/dbadmin/sql-server-dba-tip-10-offload-the-reporting-factor/" rel="prev">SQL Server DBA Tip 10 – SQL Server Reporting – Offload the reporting factor</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/" class="post-title">T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is</a></h1>
					<div class="post-byline">by <a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland" rel="author">Jes Borland</a> on May 10, 2011 in category <a href="/index.php/category/datamgmt/dbadmin/" rel="category tag">Database Administration</a> <a href="/index.php/category/datamgmt/dbprogramming/" rel="category tag">Database Programming</a> <a href="/index.php/category/datamgmt/dbprogramming/mssqlserver/" rel="category tag">Microsoft SQL Server</a>. Article views: 15,712 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&text=RT @LessThanDot Blog - T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is by @grrl_geek" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&title=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is&source=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&title=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&quote=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&title=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p><a href="http://www.bobpusateri.com/archive/2011/04/invitation-to-t-sql-tuesday-18-ctes/"><img src="/wp-content/uploads/blogs/DataMgmt/olap_1.gif" alt="" title="" /></a></p>
<p>Welcome to T-SQL Tuesday #18, hosted by Bob Pusateri (<a href="http://www.bobpusateri.com/">blog</a> | <a href="http://twitter.com/sqlbob">twitter</a>). Bob, thanks for hosting. From past experience, I know it takes time and effort. </p>
<p>Bob asked us to write about something I embraced many years ago: Common Table Expressions (CTEs). “Have you ever solved or created a problem by using CTEs? Got a tip, trick, or something nifty to share? I’d love to see your posts about any of the above.” </p>
<p>I’ve used CTEs for many things, but always avoided learning a recursive CTE. So, I challenged myself to sit down, find a use for one, write the code for it, and blog it. Challenge met. </p>
<p align="center"><img src="/wp-content/uploads/users/grrlgeek/RecursionAgain250x200.png?mtime=1304994446" alt="" title="" /></p>
<p>I didn’t want to go down the manager/employee or order/item path. Those have been done, many times, and I’m not interested in them. Then I remembered a challenge I’d run into at my previous job that I had always looked for a new solution to: building a dates table. (I am not going to go into whether or not this is the <em>best</em> way or the <em>most efficient</em> way or the <em>prettiest</em> way to build this table. I believe those debates have been raging for years, and I have nothing new to add to any side of the argument. I simply wanted to <em>do it</em>.) </p>
<p><strong>What I Want</strong> </p>
<p><em>(If a woman can claim to know what she wants.)</em>  I want a table that shows me the date, and several pieces of information: the year, quarter, month, week, day of the week, day and day of the year. All of these can be found using DATEPART. My base query is:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @GoDate <span class="kw1">DATE</span> <span class="sy0">=</span> GETDATE<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="kw1">SELECT</span> @GoDate<span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @GoDate DATE = GETDATE()
SELECT @GoDate, 
	DATEPART(YY, @GoDate), 
	DATEPART(QQ, @GoDate), 
	DATEPART(MM, @GoDate), 
	DATEPART(WW, @GoDate), 
	DATEPART(DW, @GoDate), 
	DATEPART(DD, @GoDate), 
	DATEPART(DY, @GoDate)</pre></div></div>

<p><img src="/wp-content/uploads/users/grrlgeek/DateCTE1.JPG?mtime=1304994784" alt="" title="" /></p>
<p><strong>Step 1: A Recursive CTE </strong></p>
<p>First, I’m going to build a recursive CTE to select the current date, and then another year’s worth of dates. </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @GoDate <span class="kw1">DATE</span> <span class="sy0">=</span> GETDATE<span class="br0">&#40;</span><span class="br0">&#41;</span>
;<span class="kw1">WITH</span> DateCTE <span class="br0">&#40;</span>CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear<span class="br0">&#41;</span> <span class="kw1">AS</span> 
<span class="br0">&#40;</span> <span class="kw1">SELECT</span> @GoDate<span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span> 
&nbsp; <span class="kw1">UNION</span> <span class="kw1">ALL</span> 
&nbsp; <span class="kw1">SELECT</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span> 
&nbsp; <span class="kw1">FROM</span> DateCTE 
<span class="br0">&#41;</span>
<span class="kw1">SELECT</span> CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear
<span class="kw1">FROM</span> DateCTE <span class="kw1">AS</span> DC 
<span class="kw1">OPTION</span><span class="br0">&#40;</span>MAXRECURSION <span class="nu0">365</span><span class="br0">&#41;</span>;
<span class="kw1">GO</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @GoDate DATE = GETDATE()
;WITH DateCTE (CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear) AS 
( SELECT @GoDate, 
	DATEPART(YY, @GoDate), 
	DATEPART(QQ, @GoDate), 
	DATEPART(MM, @GoDate), 
	DATEPART(WW, @GoDate), 
	DATEPART(DW, @GoDate), 
	DATEPART(DD, @GoDate), 
	DATEPART(DY, @GoDate) 
  UNION ALL 
  SELECT DATEADD(DD, 1, CalendarDate), 
	DATEPART(YY, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(QQ, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(MM, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(WW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DD, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DY, DATEADD(DD, 1, CalendarDate)) 
  FROM DateCTE 
)
SELECT CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear
FROM DateCTE AS DC 
OPTION(MAXRECURSION 365);
GO</pre></div></div>

<p><strong>Breaking It Down</strong> </p>
<p>I declare my starting date variable (@GoDate), and define my CTE, listing what columns I want to return.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @GoDate <span class="kw1">DATE</span> <span class="sy0">=</span> GETDATE<span class="br0">&#40;</span><span class="br0">&#41;</span>
;<span class="kw1">WITH</span> DateCTE <span class="br0">&#40;</span>CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear<span class="br0">&#41;</span> <span class="kw1">AS</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @GoDate DATE = GETDATE()
;WITH DateCTE (CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear) AS</pre></div></div>

<p>The first query is the base query, to define where the recursion will start – the <strong>anchor member</strong>. </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="br0">&#40;</span> <span class="kw1">SELECT</span> @GoDate<span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span> </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">( SELECT @GoDate, 
	DATEPART(YY, @GoDate), 
	DATEPART(QQ, @GoDate), 
	DATEPART(MM, @GoDate), 
	DATEPART(WW, @GoDate), 
	DATEPART(DW, @GoDate), 
	DATEPART(DD, @GoDate), 
	DATEPART(DY, @GoDate) </pre></div></div>

<p>Then, the beauty of a CTE: it can reference itself, as I demonstrate with the UNION ALL and second query. This is the <strong>recursive member</strong>. Note that my FROM is not another table, but rather DateCTE. </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="de1"><pre class="de1">&nbsp; <span class="kw1">UNION</span> <span class="kw1">ALL</span> 
&nbsp; <span class="kw1">SELECT</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span> 
&nbsp; <span class="kw1">FROM</span> DateCTE 
<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">  UNION ALL 
  SELECT DATEADD(DD, 1, CalendarDate), 
	DATEPART(YY, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(QQ, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(MM, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(WW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DD, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DY, DATEADD(DD, 1, CalendarDate)) 
  FROM DateCTE 
)</pre></div></div>

<p>The final piece is a query, which is the result of all sets returned by the UNION ALL. In this query, I could also join to other tables, another really beautiful part of the CTE. (I find this especially useful when using CTEs for aggregation. Not to distract you. Or me. I have to finish this post first.) </p>
<p>Because I don’t have a WHERE clause in my second query, this could be an infinite loop. (Unless you believe the world is going to end on December 21, 2012. But that wasn’t coded into SQL Server.) How do I prevent this? I use the query hint OPTION (MAXRECURSION X). </p>
<p>What I learned while writing this post: if not explicitly specified, the default MAXRECURSION is 100. The range is 0 – 32,767. 0 indicates “no limit”. Also, and I quote from <a href="http://msdn.microsoft.com/en-us/library/ms181714.aspx">Books Online</a>, “When the specified or default number for MAXRECURSION limit is reached during query execution, the query is ended and an error is returned. Because of this error, all effects of the statement are rolled back. If the statement is a SELECT statement, partial results or no results may be returned. Any partial results returned may not include all rows on recursion levels beyond the specified maximum recursion level.” This will come back to haunt me later, as you will see. </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear
<span class="kw1">FROM</span> DateCTE <span class="kw1">AS</span> DC 
<span class="kw1">OPTION</span><span class="br0">&#40;</span>MAXRECURSION <span class="nu0">365</span><span class="br0">&#41;</span>;
<span class="kw1">GO</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear
FROM DateCTE AS DC 
OPTION(MAXRECURSION 365);
GO</pre></div></div>

<p>Here are my query results. Note that the count is 366 rows: the original anchor row, plus 365 recursions. <img src="/wp-content/uploads/users/grrlgeek/DateCTE2.JPG?mtime=1304994887" alt="" title="" /></p>
<p><strong>Step 2: The Dates Table</strong> </p>
<p>The query results aren’t very useful if you have to run the query every time you want to use it. Solution: build a table! </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
</pre></td><td class="de1"><pre class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> Dates
<span class="br0">&#40;</span>CalendarDate <span class="kw1">DATE</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateYear <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateQuarter <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateMonth <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateWeek <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateDayOfWeek <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateDay <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="sy0">,</span> 
&nbsp;DateDayOfYear <span class="kw1">INT</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">CREATE TABLE Dates
(CalendarDate DATE NOT NULL, 
 DateYear INT NOT NULL, 
 DateQuarter INT NOT NULL, 
 DateMonth INT NOT NULL, 
 DateWeek INT NOT NULL, 
 DateDayOfWeek INT NOT NULL, 
 DateDay INT NOT NULL, 
 DateDayOfYear INT NOT NULL)</pre></div></div>

<p>Next, I run the CTE query again, but this time with an INSERT instead of a SELECT. </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @GoDate <span class="kw1">DATE</span> <span class="sy0">=</span> GETDATE<span class="br0">&#40;</span><span class="br0">&#41;</span>
;<span class="kw1">WITH</span> DateCTE <span class="br0">&#40;</span>CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear<span class="br0">&#41;</span> <span class="kw1">AS</span> 
<span class="br0">&#40;</span> <span class="kw1">SELECT</span> @GoDate<span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span> 
&nbsp; <span class="kw1">UNION</span> <span class="kw1">ALL</span> 
&nbsp; <span class="kw1">SELECT</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span> 
&nbsp; <span class="kw1">FROM</span> DateCTE 
<span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> Dates 
<span class="kw1">SELECT</span> CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear
<span class="kw1">FROM</span> DateCTE <span class="kw1">AS</span> DC &nbsp;
<span class="kw1">OPTION</span><span class="br0">&#40;</span>MAXRECURSION <span class="nu0">365</span><span class="br0">&#41;</span>;
<span class="kw1">GO</span> </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @GoDate DATE = GETDATE()
;WITH DateCTE (CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear) AS 
( SELECT @GoDate, 
	DATEPART(YY, @GoDate), 
	DATEPART(QQ, @GoDate), 
	DATEPART(MM, @GoDate), 
	DATEPART(WW, @GoDate), 
	DATEPART(DW, @GoDate), 
	DATEPART(DD, @GoDate), 
	DATEPART(DY, @GoDate) 
  UNION ALL 
  SELECT DATEADD(DD, 1, CalendarDate), 
	DATEPART(YY, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(QQ, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(MM, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(WW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DD, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DY, DATEADD(DD, 1, CalendarDate)) 
  FROM DateCTE 
)
INSERT INTO Dates 
SELECT CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear
FROM DateCTE AS DC  
OPTION(MAXRECURSION 365);
GO </pre></div></div>

<p>Uh-oh! It blew up! </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1">Msg <span class="nu0">530</span><span class="sy0">,</span> Level <span class="nu0">16</span><span class="sy0">,</span> State <span class="nu0">1</span><span class="sy0">,</span> Line <span class="nu0">2</span>
The statement <span class="kw1">TERMINATED</span><span class="sy0">.</span> The maximum recursion <span class="nu0">365</span> has been exhausted <span class="kw1">BEFORE</span> statement completion<span class="sy0">.</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">Msg 530, Level 16, State 1, Line 2
The statement terminated. The maximum recursion 365 has been exhausted before statement completion.</pre></div></div>

<p>The MAXRECURSION level was reached, so the results are rolled back. (Remember when I said this would come back to haunt me? This is the ghost.) </p>
<p>My solution is to set a WHERE clause in the recursive query, limiting the number of days the query is run for. </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="de1"><pre class="de1"><span class="kw1">DECLARE</span> @GoDate <span class="kw1">DATE</span> <span class="sy0">=</span> GETDATE<span class="br0">&#40;</span><span class="br0">&#41;</span>
;<span class="kw1">WITH</span> DateCTE <span class="br0">&#40;</span>CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear<span class="br0">&#41;</span> <span class="kw1">AS</span> 
<span class="br0">&#40;</span> <span class="kw1">SELECT</span> @GoDate<span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> @GoDate<span class="br0">&#41;</span> 
&nbsp; <span class="kw1">UNION</span> <span class="kw1">ALL</span> 
&nbsp; <span class="kw1">SELECT</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>YY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>QQ<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>MM<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>WW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DW<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DD<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span> 
&nbsp; &nbsp; DATEPART<span class="br0">&#40;</span>DY<span class="sy0">,</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span><span class="br0">&#41;</span> 
&nbsp; <span class="kw1">FROM</span> DateCTE 
&nbsp; <span class="kw1">WHERE</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> CalendarDate<span class="br0">&#41;</span> <span class="sy0">&lt;=</span> DATEADD<span class="br0">&#40;</span>DD<span class="sy0">,</span> <span class="nu0">365</span><span class="sy0">,</span> @GoDate<span class="br0">&#41;</span>
<span class="br0">&#41;</span>
<span class="kw1">INSERT</span> <span class="kw1">INTO</span> Dates 
<span class="kw1">SELECT</span> CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear
<span class="kw1">FROM</span> DateCTE <span class="kw1">AS</span> DC 
<span class="kw1">OPTION</span><span class="br0">&#40;</span>MAXRECURSION <span class="nu0">365</span><span class="br0">&#41;</span>;
<span class="kw1">GO</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">DECLARE @GoDate DATE = GETDATE()
;WITH DateCTE (CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear) AS 
( SELECT @GoDate, 
	DATEPART(YY, @GoDate), 
	DATEPART(QQ, @GoDate), 
	DATEPART(MM, @GoDate), 
	DATEPART(WW, @GoDate), 
	DATEPART(DW, @GoDate), 
	DATEPART(DD, @GoDate), 
	DATEPART(DY, @GoDate) 
  UNION ALL 
  SELECT DATEADD(DD, 1, CalendarDate), 
	DATEPART(YY, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(QQ, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(MM, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(WW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DW, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DD, DATEADD(DD, 1, CalendarDate)), 
	DATEPART(DY, DATEADD(DD, 1, CalendarDate)) 
  FROM DateCTE 
  WHERE DATEADD(DD, 1, CalendarDate) &lt;= DATEADD(DD, 365, @GoDate)
)
INSERT INTO Dates 
SELECT CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear
FROM DateCTE AS DC 
OPTION(MAXRECURSION 365);
GO</pre></div></div>

<p>I check my results in the table: </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="sql"><thead><tr><td colspan="2"  class="head">SQL</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
</pre></td><td class="de1"><pre class="de1"><span class="kw1">SELECT</span> CalendarDate<span class="sy0">,</span> DateYear<span class="sy0">,</span> DateQuarter<span class="sy0">,</span> DateMonth<span class="sy0">,</span> DateWeek<span class="sy0">,</span> DateDayOfWeek<span class="sy0">,</span> DateDay<span class="sy0">,</span> DateDayOfYear
<span class="kw1">FROM</span> Dates 
<span class="kw1">ORDER</span> <span class="kw1">BY</span> CalendarDate</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">SELECT CalendarDate, DateYear, DateQuarter, DateMonth, DateWeek, DateDayOfWeek, DateDay, DateDayOfYear
FROM Dates 
ORDER BY CalendarDate</pre></div></div>

<p>My results:</p>
<p><img src="/wp-content/uploads/users/grrlgeek/DateCTE4.JPG?mtime=1304994888" alt="" title="" /></p>
<p>I have successfully inserted 366 rows into my Dates table. </p>
<p><strong>Ta-Da!</strong> </p>
<p>I’m glad I took the time to break down the recursive CTE and learn how to use it. I know I’ll use it in the future. The CTE has limitations, and is not always the most efficient SQL, but it is useful and flexible. I suggest you learn to write CTEs and recursive CTEs, to have another tool in your SQL toolbox.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbadmin/sql-server-filegroup-piecemeal-restores-1/'>SQL Server Filegroup Piecemeal Restores</a><p>Learn how to use multiple filegroups to perform partial restores in a SQL Server database.</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-016-count-and-delete-duplicates/'>T-SQL Tuesday #016 - COUNT and DELETE duplicates</a><p>Duplicates in data can be detrimental to how you return data from tables. They can&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="/wp-content/uploads/2014/03/IMG_8755-300x300.jpg" alt="User bio image"/>Jes Borland is a Premier Field Engineer - SQL Server for Microsoft, where she is a trusted technical adviser, deep technical support, and teacher for her customers. Her experience as a DBA, consultant, and 5-time Data Platform MVP allow her to help the business and the IT teams reach their goals. She has worked with SQL Server as a developer, report writer, DBA, and consultant. Her favorite topics are administration, automation, and performance. She frequently presents at user groups, SQL Saturdays, and other community events. She is also an avid runner and chef.
<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/grrl_geek" title="grrlgeek at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/pub/jes-schultz-borland/9/393/705" title="grrlgeek at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="/index.php/author/grrlgeek/feed/" title="Blog RSS feed for grrlgeek" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 15,712 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/grrlgeek/">Read More Posts by Jes Borland</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&text=RT @LessThanDot Blog - T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is by @grrl_geek" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&title=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is&source=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&title=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&quote=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/&title=T-SQL Tuesday #18: A Recursive CTE Is: A Recursive CTE Is" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		8 Comments	</h4>
			<ol class="comments-list">
					<li class="comment byuser comment-author-thirster42 even thread-even depth-1" id="comment-4239">
				<div id="div-comment-4239" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/026f3abfbd6ac89b6dbabbd4cef2e83d?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/026f3abfbd6ac89b6dbabbd4cef2e83d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">David Forck (thirster42)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4239">
			May 10, 2011 at 8:06 am</a>		</div>

		<p>great blog, and congrats on figuring out the recursive cte.  it took me a while to figure those out.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4239#respond' onclick='return addComment.moveForm( "div-comment-4239", "4239", "respond", "1167" )' aria-label='Reply to David Forck (thirster42)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-naomi odd alt thread-odd thread-alt depth-1" id="comment-4240">
				<div id="div-comment-4240" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/61e248e3f536e25c08658d205808b113?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Naomi Nosonovsky</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4240">
			May 10, 2011 at 8:15 am</a>		</div>

		<p>Kendra Little has a good blog on the performance implications of this method</p>
<p><a href="http://www.littlekendra.com/2011/01/04/tallytables/">Filling in Data Potholes Redux: Tally Tables vs CTEs</a></p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4240#respond' onclick='return addComment.moveForm( "div-comment-4240", "4240", "respond", "1167" )' aria-label='Reply to Naomi Nosonovsky'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-4242">
				<div id="div-comment-4242" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/3a22526f60c00d5f22b97d2a62dddc59?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/3a22526f60c00d5f22b97d2a62dddc59?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://asqlb.blogspot.com/' rel='external nofollow' class='url'>Jason Yousef</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4242">
			May 10, 2011 at 1:10 pm</a>		</div>

		<p>Thanks</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4242#respond' onclick='return addComment.moveForm( "div-comment-4242", "4242", "respond", "1167" )' aria-label='Reply to Jason Yousef'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4243">
				<div id="div-comment-4243" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/6ecf9ca2f98a71666895f396c7ade403?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/6ecf9ca2f98a71666895f396c7ade403?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.SQLBalls.com/' rel='external nofollow' class='url'>Bradley Ball (@SQLBalls)</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4243">
			May 10, 2011 at 1:49 pm</a>		</div>

		<p>Great Blog Jes!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4243#respond' onclick='return addComment.moveForm( "div-comment-4243", "4243", "respond", "1167" )' aria-label='Reply to Bradley Ball (@SQLBalls)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-4244">
				<div id="div-comment-4244" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/4dc46c991ec704f7167ed9f1594ea193?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/4dc46c991ec704f7167ed9f1594ea193?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://www.bobpusateri.com/' rel='external nofollow' class='url'>Bob Pusateri</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4244">
			May 10, 2011 at 2:04 pm</a>		</div>

		<p>Excellent post &#8211; I really enjoyed this.  Had never messed with MAXRECURSION before so I totally learned something too!  Thanks so much for contributing to T-SQL Tuesday!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4244#respond' onclick='return addComment.moveForm( "div-comment-4244", "4244", "respond", "1167" )' aria-label='Reply to Bob Pusateri'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4245">
				<div id="div-comment-4245" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/244502d474a26d025df27523e5c57c54?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/244502d474a26d025df27523e5c57c54?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://bradsruminations.blogspot.com/' rel='external nofollow' class='url'>Brad Schulz</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4245">
			May 10, 2011 at 2:33 pm</a>		</div>

		<p>Hi Jes&#8230;</p>
<p>The title of your post reminded me of the title I used for a post on Recursive CTE&#8217;s last year:</p>
<p><a href="http://bradsruminations.blogspot.com/2010/03/this-article-on-recurson-is-entitled.html" rel="nofollow">http://bradsruminations.blogspot.com/2010/03/this-article-on-recurson-is-entitled.html</a></p>
<p>I guess we Schulzes are on the same wavelength.  8^)</p>
<p>&#8211;Brad</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4245#respond' onclick='return addComment.moveForm( "div-comment-4245", "4245", "respond", "1167" )' aria-label='Reply to Brad Schulz'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-4246">
				<div id="div-comment-4246" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/038abcb2c8f97821e562d1f756e9fa11?s=64&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/038abcb2c8f97821e562d1f756e9fa11?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Andy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4246">
			May 10, 2011 at 3:16 pm</a>		</div>

		<p>Thanks Jes, really good post and something which I reckon I&#8217;ll use.  Sometimes difficult to find SQL stuff that isn&#8217;t beginner or expert, and for me this sits perfectly in the middle.  Will have to re-read again tomorrow though to understand it all properly!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4246#respond' onclick='return addComment.moveForm( "div-comment-4246", "4246", "respond", "1167" )' aria-label='Reply to Andy'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-4241">
				<div id="div-comment-4241" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/89da61702ffd1f881e849f89df7d0ff5?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/89da61702ffd1f881e849f89df7d0ff5?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://sqlmd.wordpress.com/' rel='external nofollow' class='url'>Mike Donnelly</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#comment-4241">
			March 30, 2012 at 8:42 am</a>		</div>

		<p>I&#8217;ve used Recursive CTE&#8217;s before and I usually get them to do what I want, but I always have to twist my brain to try and figure out how it is going to work. This week I decided I wanted to grok how they worked. I started reading through a couple blog posts a day until I could find one that would make it click for me. This is the best explanation I have found. I just wish I had started at the bottom of the list and read it on Monday.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/?replytocom=4241#respond' onclick='return addComment.moveForm( "div-comment-4241", "4241", "respond", "1167" )' aria-label='Reply to Mike Donnelly'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/dbprogramming/t-sql-tuesday-18-a/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1167' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="a5e00132373a7031000fd987a3c9f87b"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765882"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
