<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   T-SQL Window Functions &#8211; Part 4: Analytic Functions</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   T-SQL Window Functions &#8211; Part 4: Analytic Functions" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="In the final installment of my series on SQL window functions, we will explore using analytic functions.  Analytic functions were introduced in SQL Server 2012 with the expansion of the OVER clause capabilities.  Analytic functions fall in to two primar&hellip;" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; T-SQL Window Functions &#8211; Part 4: Analytic Functions Comments Feed" href="/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Create HTML from output of Perl::Critic' href='/index.php/webdev/perl/create-html-from-output-of/' />
<link rel='next' title='SQL Saturday #149' href='/index.php/itprofessionals/professionaldevelopment/sql-saturday149/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/" />
<link rel='shortlink' href='/?p=1716' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdbprogramming%2Fmssqlserver%2Ft-sql-window-functions-part-4%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdatamgmt%2Fdbprogramming%2Fmssqlserver%2Ft-sql-window-functions-part-4%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/itprofessionals/professionaldevelopment/sql-saturday149/" rel="next">SQL Saturday #149</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/webdev/perl/create-html-from-output-of/" rel="prev">Create HTML from output of Perl::Critic</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/" class="post-title">T-SQL Window Functions &#8211; Part 4: Analytic Functions</a></h1>
					<div class="post-byline">by <a href="/index.php/author/flipster1971/" title="Posts by Steve Hughes (DataOnWheels)" rel="author">Steve Hughes (DataOnWheels)</a> on September 25, 2012 in category <a href="/index.php/category/datamgmt/dbprogramming/mssqlserver/" rel="category tag">Microsoft SQL Server</a>. Article views: 16,157 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&text=RT @LessThanDot Blog - T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions by @dataonwheels" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&title=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions&source=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&title=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&quote=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&title=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>In the final installment of my series on SQL window functions, we will explore using analytic functions.  Analytic functions were introduced in SQL Server 2012 with the expansion of the OVER clause capabilities.  Analytic functions fall in to two primary categories: values at a position and percentiles.  Four of the functions, LAG, LEAD, FIRST_VALUE and LAST_VALUE find a row in the partition and returns the desired value from that row.  CUME_DIST and PERCENT_RANK break the partition into percentiles and return a rank value for each row.  PERCENTILE_CONT and PERCENTILE_DISC a value at the requested percentile in the function for each row.  All of the functions and examples in this blog will only work with SQL Server 2012.<br />
Once again, the following CTE will be used as the query in all examples throughout the post:</p>
<p><code class="codespan">with CTEOrders as<br />
	(select cast(1 as int) as OrderID, cast('3/1/2012' as date) as OrderDate, cast(10.00 as money) as OrderAmt, 'Joe' as CustomerName<br />
	union select 2, '3/1/2012', 11.00, 'Sam'<br />
	union select 3, '3/2/2012', 10.00, 'Beth'<br />
	union select 4, '3/2/2012', 15.00, 'Joe'<br />
	union select 5, '3/2/2012', 17.00, 'Sam'<br />
	union select 6, '3/3/2012', 12.00, 'Joe'<br />
	union select 7, '3/4/2012', 10.00, 'Beth'<br />
	union select 8, '3/4/2012', 18.00, 'Sam'<br />
	union select 9, '3/4/2012', 12.00, 'Joe'<br />
	union select 10, '3/4/2012', 11.00, 'Beth'<br />
	union select 11, '3/5/2012', 14.00, 'Sam'<br />
	union select 12, '3/6/2012', 17.00, 'Beth'<br />
	union select 13, '3/6/2012', 19.00, 'Joe'<br />
	union select 14, '3/7/2012', 13.00, 'Beth'<br />
	union select 15, '3/7/2012', 16.00, 'Sam'<br />
	)<br />
select OrderID<br />
	,OrderDate<br />
	,OrderAmt<br />
	,CustomerName<br />
   from CTEOrders;<br />
</code></p>
<h1>Position Value Functions: LAG, LEAD, FIRST_VALUE, LAST_VALUE</h1>
<p>Who has not needed to use values from other rows in the current row for a report or other query?  A prime example is needing to know what the last order value was to calculate growth or just show the difference in the results.  This has never been easy in SQL Server until now.  All of these functions require the use of the OVER clause and the ORDER BY clause.  They all use the current row within the partition to find the row at the desired position.  </p>
<p>The LAG and LEAD functions allow you to specify the offset or how many rows to look forward or backward and they support a default value in cases where the value returned would be null.    These functions do not support the use of ROWS or RANGE in the OVER clause.  The FIRST_VALUE and LAST_VALUE allow you to further define the partition using ROWS or RANGE if desired. </p>
<p>The following example illustrates all of the functions with various variations on the parameters and settings.</p>
<p><em>Update 10/19/2012: One of the readers pointed out confusion between column names in the results and the functions used.  This discrepancy has been resolved.</em></p>
<p><code class="codespan">select OrderID<br />
	,OrderDate<br />
	,OrderAmt<br />
	,CustomerName<br />
	,LAG(OrderAmt) OVER (PARTITION BY CustomerName ORDER BY OrderID) as PrevOrdAmt<br />
	,LEAD(OrderAmt, 2) OVER (PARTITION BY CustomerName ORDER BY OrderID) as NextTwoOrdAmt<br />
	,LEAD(OrderDate, 2, '9999-12-31') OVER (PARTITION BY CustomerName ORDER BY OrderID) as NextTwoOrdDtNoNull<br />
	,FIRST_VALUE(OrderDate) OVER (ORDER BY OrderID) as FirstOrdDt<br />
	,LAST_VALUE(CustomerName) OVER (PARTITION BY OrderDate ORDER BY OrderID) as LastCustToOrdByDay<br />
FROM CTEOrders</code></p>
<h3>Results (with shortened column names):</h3>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td valign="top" width="52">
<p><b>ID</b></p>
</td>
<td valign="top" width="99">
<p><b>OrderDate</b></p>
</td>
<td valign="top" width="53">
<p><b>Amt</b></p>
</td>
<td valign="top" width="60">
<p><b>Cust</b></p>
</td>
<td valign="top" width="120">
<p><b>PrevOrdAmt</b></p>
</td>
<td valign="top" width="120">
<p><b>NextTwoAmt</b></p>
</td>
<td valign="top" width="107">
<p><b>NextTwoDt</b></p>
</td>
<td valign="top" width="89">
<p><b>FirstOrd</b></p>
</td>
<td valign="top" width="90">
<p><b>LastCust</b></p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>1</p>
</td>
<td valign="top" width="99">
<p>3/1/2012</p>
</td>
<td valign="top" width="53">
<p>10</p>
</td>
<td valign="top" width="60">
<p>Joe</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="120">
<p>12</p>
</td>
<td valign="top" width="107">
<p>3/3/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Joe</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>2</p>
</td>
<td valign="top" width="99">
<p>3/1/2012</p>
</td>
<td valign="top" width="53">
<p>11</p>
</td>
<td valign="top" width="60">
<p>Sam</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="120">
<p>18</p>
</td>
<td valign="top" width="107">
<p>3/4/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Sam</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>3</p>
</td>
<td valign="top" width="99">
<p>3/2/2012</p>
</td>
<td valign="top" width="53">
<p>10</p>
</td>
<td valign="top" width="60">
<p>Beth</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="120">
<p>11</p>
</td>
<td valign="top" width="107">
<p>3/4/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Beth</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>4</p>
</td>
<td valign="top" width="99">
<p>3/2/2012</p>
</td>
<td valign="top" width="53">
<p>15</p>
</td>
<td valign="top" width="60">
<p>Joe</p>
</td>
<td valign="top" width="120">
<p>10</p>
</td>
<td valign="top" width="120">
<p>12</p>
</td>
<td valign="top" width="107">
<p>3/4/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Joe</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>5</p>
</td>
<td valign="top" width="99">
<p>3/2/2012</p>
</td>
<td valign="top" width="53">
<p>17</p>
</td>
<td valign="top" width="60">
<p>Sam</p>
</td>
<td valign="top" width="120">
<p>11</p>
</td>
<td valign="top" width="120">
<p>14</p>
</td>
<td valign="top" width="107">
<p>3/5/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Sam</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>6</p>
</td>
<td valign="top" width="99">
<p>3/3/2012</p>
</td>
<td valign="top" width="53">
<p>12</p>
</td>
<td valign="top" width="60">
<p>Joe</p>
</td>
<td valign="top" width="120">
<p>15</p>
</td>
<td valign="top" width="120">
<p>19</p>
</td>
<td valign="top" width="107">
<p>3/6/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Joe</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>7</p>
</td>
<td valign="top" width="99">
<p>3/4/2012</p>
</td>
<td valign="top" width="53">
<p>10</p>
</td>
<td valign="top" width="60">
<p>Beth</p>
</td>
<td valign="top" width="120">
<p>10</p>
</td>
<td valign="top" width="120">
<p>17</p>
</td>
<td valign="top" width="107">
<p>3/6/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Beth</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>8</p>
</td>
<td valign="top" width="99">
<p>3/4/2012</p>
</td>
<td valign="top" width="53">
<p>18</p>
</td>
<td valign="top" width="60">
<p>Sam</p>
</td>
<td valign="top" width="120">
<p>17</p>
</td>
<td valign="top" width="120">
<p>16</p>
</td>
<td valign="top" width="107">
<p>3/7/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Sam</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>9</p>
</td>
<td valign="top" width="99">
<p>3/4/2012</p>
</td>
<td valign="top" width="53">
<p>12</p>
</td>
<td valign="top" width="60">
<p>Joe</p>
</td>
<td valign="top" width="120">
<p>12</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="107">
<p>12/31/9999</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Joe</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>10</p>
</td>
<td valign="top" width="99">
<p>3/4/2012</p>
</td>
<td valign="top" width="53">
<p>11</p>
</td>
<td valign="top" width="60">
<p>Beth</p>
</td>
<td valign="top" width="120">
<p>10</p>
</td>
<td valign="top" width="120">
<p>13</p>
</td>
<td valign="top" width="107">
<p>3/7/2012</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Beth</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>11</p>
</td>
<td valign="top" width="99">
<p>3/5/2012</p>
</td>
<td valign="top" width="53">
<p>14</p>
</td>
<td valign="top" width="60">
<p>Sam</p>
</td>
<td valign="top" width="120">
<p>18</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="107">
<p>12/31/9999</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Sam</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>12</p>
</td>
<td valign="top" width="99">
<p>3/6/2012</p>
</td>
<td valign="top" width="53">
<p>17</p>
</td>
<td valign="top" width="60">
<p>Beth</p>
</td>
<td valign="top" width="120">
<p>11</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="107">
<p>12/31/9999</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Beth</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>13</p>
</td>
<td valign="top" width="99">
<p>3/6/2012</p>
</td>
<td valign="top" width="53">
<p>19</p>
</td>
<td valign="top" width="60">
<p>Joe</p>
</td>
<td valign="top" width="120">
<p>12</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="107">
<p>12/31/9999</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Joe</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>14</p>
</td>
<td valign="top" width="99">
<p>3/7/2012</p>
</td>
<td valign="top" width="53">
<p>13</p>
</td>
<td valign="top" width="60">
<p>Beth</p>
</td>
<td valign="top" width="120">
<p>17</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="107">
<p>12/31/9999</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Beth</p>
</td>
</tr>
<tr>
<td valign="top" width="52">
<p>15</p>
</td>
<td valign="top" width="99">
<p>3/7/2012</p>
</td>
<td valign="top" width="53">
<p>16</p>
</td>
<td valign="top" width="60">
<p>Sam</p>
</td>
<td valign="top" width="120">
<p>14</p>
</td>
<td valign="top" width="120">
<p>NULL</p>
</td>
<td valign="top" width="107">
<p>12/31/9999</p>
</td>
<td valign="top" width="89">
<p>3/1/2012</p>
</td>
<td valign="top" width="90">
<p>Sam</p>
</td>
</tr>
</tbody>
</table>
<p>If you really like subselects, you can also mix in some subselects and have a very creative SQL statement.  The following statement uses LAG and a subselect to find the first value in a partition.  I am showing this to illustrate some more of the capabilities of the function in case you have a solution that requires this level of complexity.</p>
<p><code class="codespan">select OrderID<br />
	,OrderDate<br />
	,OrderAmt<br />
	,CustomerName<br />
	,LAG(OrderAmt,(select count(*)-1<br />
from CTEOrders c<br />
where c.CustomerName = CTEOrders.CustomerName<br />
 and c.OrderID &lt;= CTEOrders.OrderID) , 0)<br />
OVER (PARTITION BY CustomerName ORDER BY OrderDate, OrderID) as FirstOrderAmt<br />
from CTEOrders</code></p>
<h1>Percentile Functions: CUME_DIST, PERCENT_RANK, PERCENTILE_CONT, PERCENTILE_DISC</h1>
<p>As I wrap up my discussion on window functions, the percentile based functions were the functions I knew the least about.  While I have already used the position value functions above, I have not yet needed to use the percentiles. So, that meant I had to work with them for a while so I could share their usage and have some samples for you to use.  </p>
<p>The key differences in the four function have to do with ranks and values.  CUME_DIST and PERCENT_RANK return a ranking value while PERCENTILE_CONT and PERCENTILE_DISC return data values.  </p>
<p>CUME_DIST returns a value that is greater than zero and lest than or equal to one (>0 and <=1) and represents the percentage group that the value falls into based on the order specified.  PERCENT_RANK returns a value between zero and one as well (>= 0 and <=1).  However, in PERCENT_RANK the first group is always represented as 0 whereas in CUME_DIST it represents the percentage of the group.  Both functions return the last percent group as 1.  In both cases, as the ranking percentages move from lowest to highest, each group’s percent value includes all of the earlier values in the calculation as well.  

The following statement shows both of the functions using the default partition to determine the rankings of order amounts within our dataset.  

<code class="codespan">select OrderID<br />
	,OrderDate<br />
	,OrderAmt<br />
	,CustomerName<br />
	,CUME_DIST() OVER (ORDER BY OrderAmt) CumDist<br />
	,PERCENT_RANK() OVER (ORDER BY OrderAmt) PctRank<br />
from CTEOrders</code></p>
<h3>Results:</h3>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td valign="top" width="67">
<p><b>OrderID</b></p>
</td>
<td valign="top" width="87">
<p><b>OrderDate</b></p>
</td>
<td valign="top" width="82">
<p><b>OrderAmt</b></p>
</td>
<td valign="top" width="125">
<p><b>CustomerName</b></p>
</td>
<td valign="top" width="98">
<p><b>CumDist</b></p>
</td>
<td valign="top" width="133">
<p><b>PctRank</b></p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>1</p>
</td>
<td valign="top" width="87">
<p>3/1/2012</p>
</td>
<td valign="top" width="82">
<p>10</p>
</td>
<td valign="top" width="125">
<p>Joe</p>
</td>
<td valign="top" width="98">
<p>0.2</p>
</td>
<td valign="top" width="133">
<p>0</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>3</p>
</td>
<td valign="top" width="87">
<p>3/2/2012</p>
</td>
<td valign="top" width="82">
<p>10</p>
</td>
<td valign="top" width="125">
<p>Beth</p>
</td>
<td valign="top" width="98">
<p>0.2</p>
</td>
<td valign="top" width="133">
<p>0</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>7</p>
</td>
<td valign="top" width="87">
<p>3/4/2012</p>
</td>
<td valign="top" width="82">
<p>10</p>
</td>
<td valign="top" width="125">
<p>Beth</p>
</td>
<td valign="top" width="98">
<p>0.2</p>
</td>
<td valign="top" width="133">
<p>0</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>2</p>
</td>
<td valign="top" width="87">
<p>3/1/2012</p>
</td>
<td valign="top" width="82">
<p>11</p>
</td>
<td valign="top" width="125">
<p>Sam</p>
</td>
<td valign="top" width="98">
<p>0.33333333</p>
</td>
<td valign="top" width="133">
<p>0.214285714</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>10</p>
</td>
<td valign="top" width="87">
<p>3/4/2012</p>
</td>
<td valign="top" width="82">
<p>11</p>
</td>
<td valign="top" width="125">
<p>Beth</p>
</td>
<td valign="top" width="98">
<p>0.33333333</p>
</td>
<td valign="top" width="133">
<p>0.214285714</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>6</p>
</td>
<td valign="top" width="87">
<p>3/3/2012</p>
</td>
<td valign="top" width="82">
<p>12</p>
</td>
<td valign="top" width="125">
<p>Joe</p>
</td>
<td valign="top" width="98">
<p>0.46666667</p>
</td>
<td valign="top" width="133">
<p>0.357142857</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>9</p>
</td>
<td valign="top" width="87">
<p>3/4/2012</p>
</td>
<td valign="top" width="82">
<p>12</p>
</td>
<td valign="top" width="125">
<p>Joe</p>
</td>
<td valign="top" width="98">
<p>0.46666667</p>
</td>
<td valign="top" width="133">
<p>0.357142857</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>14</p>
</td>
<td valign="top" width="87">
<p>3/7/2012</p>
</td>
<td valign="top" width="82">
<p>13</p>
</td>
<td valign="top" width="125">
<p>Beth</p>
</td>
<td valign="top" width="98">
<p>0.53333333</p>
</td>
<td valign="top" width="133">
<p>0.5</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>11</p>
</td>
<td valign="top" width="87">
<p>3/5/2012</p>
</td>
<td valign="top" width="82">
<p>14</p>
</td>
<td valign="top" width="125">
<p>Sam</p>
</td>
<td valign="top" width="98">
<p>0.6</p>
</td>
<td valign="top" width="133">
<p>0.571428571</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>4</p>
</td>
<td valign="top" width="87">
<p>3/2/2012</p>
</td>
<td valign="top" width="82">
<p>15</p>
</td>
<td valign="top" width="125">
<p>Joe</p>
</td>
<td valign="top" width="98">
<p>0.66666667</p>
</td>
<td valign="top" width="133">
<p>0.642857143</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>15</p>
</td>
<td valign="top" width="87">
<p>3/7/2012</p>
</td>
<td valign="top" width="82">
<p>16</p>
</td>
<td valign="top" width="125">
<p>Sam</p>
</td>
<td valign="top" width="98">
<p>0.73333333</p>
</td>
<td valign="top" width="133">
<p>0.714285714</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>5</p>
</td>
<td valign="top" width="87">
<p>3/2/2012</p>
</td>
<td valign="top" width="82">
<p>17</p>
</td>
<td valign="top" width="125">
<p>Sam</p>
</td>
<td valign="top" width="98">
<p>0.86666667</p>
</td>
<td valign="top" width="133">
<p>0.785714286</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>12</p>
</td>
<td valign="top" width="87">
<p>3/6/2012</p>
</td>
<td valign="top" width="82">
<p>17</p>
</td>
<td valign="top" width="125">
<p>Beth</p>
</td>
<td valign="top" width="98">
<p>0.86666667</p>
</td>
<td valign="top" width="133">
<p>0.785714286</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>8</p>
</td>
<td valign="top" width="87">
<p>3/4/2012</p>
</td>
<td valign="top" width="82">
<p>18</p>
</td>
<td valign="top" width="125">
<p>Sam</p>
</td>
<td valign="top" width="98">
<p>0.93333333</p>
</td>
<td valign="top" width="133">
<p>0.928571429</p>
</td>
</tr>
<tr>
<td valign="top" width="67">
<p>13</p>
</td>
<td valign="top" width="87">
<p>3/6/2012</p>
</td>
<td valign="top" width="82">
<p>19</p>
</td>
<td valign="top" width="125">
<p>Joe</p>
</td>
<td valign="top" width="98">
<p>1</p>
</td>
<td valign="top" width="133">
<p>1</p>
</td>
</tr>
</tbody>
</table>
<p>The last two functions, PERCENTILE_CONT and PERCENTILE_DISC, return the value at the percentile requested.  PERCENTILE_CONT will return the true percentile value whether it exists in the data or not.  For instance, if the percentile group has the values 10 and 20, it will return 15.  If PERCENTILE_DISC, is applied to the same group it will return 10.  It will return the smallest value in the percentile group, which in this case is 10.  Both functions ignore NULL values and do not use the ORDER BY, ROWS, or RANGE clauses with the PARTITION BY clause.  Instead, WITHIN GROUP is introduced which must contain a numeric data type and ORDER BY clause.  Only one column can be specified here.  Both functions need a percentile value which can be between 0.0 and 1.0.  </p>
<p>The following script illustrates a couple of variations.  The first two functions return the median of the default partition.  Then next two return the median value for each day.  Finally, the last two functions return the low and high values within the partition.  The values segmented by the date partition highlight the key difference between the two functions.</p>
<p><code class="codespan">select OrderID as ID<br />
	,OrderDate as ODt<br />
	,OrderAmt as OAmt<br />
	,CustomerName as CName<br />
	,PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY OrderAmt) OVER () PerCont05<br />
	,PERCENTILE_DISC(0.5) WITHIN GROUP (ORDER BY OrderAmt) OVER () PerDisc05<br />
	,PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY OrderAmt) OVER (PARTITION BY OrderDate) PerContDt<br />
	,PERCENTILE_DISC(0.5) WITHIN GROUP (ORDER BY OrderAmt) OVER (PARTITION BY OrderDate) PerDiscDt<br />
	,PERCENTILE_CONT(0) WITHIN GROUP (ORDER BY OrderAmt) OVER() PerCont0<br />
from CTEOrders</code></p>
<h3>Results</h3>
<table cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td valign="top" width="27">
<p><b>ID</b></p>
</td>
<td valign="top" width="77">
<p><b>ODt</b></p>
</td>
<td valign="top" width="52">
<p><b>OAmt</b></p>
</td>
<td valign="top" width="63">
<p><b>CName</b></p>
</td>
<td valign="top" width="87">
<p><b>PerCont05</b></p>
</td>
<td valign="top" width="82">
<p><b>PerDisc05</b></p>
</td>
<td valign="top" width="87">
<p><b>PerContDt</b></p>
</td>
<td valign="top" width="83">
<p><b>PerDiscDt</b></p>
</td>
<td valign="top" width="77">
<p><b>PerCont0</b></p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>1</p>
</td>
<td valign="top" width="77">
<p>3/1/2012</p>
</td>
<td valign="top" width="52">
<p>10</p>
</td>
<td valign="top" width="63">
<p>Joe</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>10.5</p>
</td>
<td valign="top" width="83">
<p>10.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>2</p>
</td>
<td valign="top" width="77">
<p>3/1/2012</p>
</td>
<td valign="top" width="52">
<p>11</p>
</td>
<td valign="top" width="63">
<p>Sam</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>10.5</p>
</td>
<td valign="top" width="83">
<p>10.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>3</p>
</td>
<td valign="top" width="77">
<p>3/2/2012</p>
</td>
<td valign="top" width="52">
<p>10</p>
</td>
<td valign="top" width="63">
<p>Beth</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>15.0</p>
</td>
<td valign="top" width="83">
<p>15.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>4</p>
</td>
<td valign="top" width="77">
<p>3/2/2012</p>
</td>
<td valign="top" width="52">
<p>15</p>
</td>
<td valign="top" width="63">
<p>Joe</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>15.0</p>
</td>
<td valign="top" width="83">
<p>15.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>5</p>
</td>
<td valign="top" width="77">
<p>3/2/2012</p>
</td>
<td valign="top" width="52">
<p>17</p>
</td>
<td valign="top" width="63">
<p>Sam</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>15.0</p>
</td>
<td valign="top" width="83">
<p>15.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>6</p>
</td>
<td valign="top" width="77">
<p>3/3/2012</p>
</td>
<td valign="top" width="52">
<p>12</p>
</td>
<td valign="top" width="63">
<p>Joe</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>12.0</p>
</td>
<td valign="top" width="83">
<p>12.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>7</p>
</td>
<td valign="top" width="77">
<p>3/4/2012</p>
</td>
<td valign="top" width="52">
<p>10</p>
</td>
<td valign="top" width="63">
<p>Beth</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>11.5</p>
</td>
<td valign="top" width="83">
<p>11.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>10</p>
</td>
<td valign="top" width="77">
<p>3/4/2012</p>
</td>
<td valign="top" width="52">
<p>11</p>
</td>
<td valign="top" width="63">
<p>Beth</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>11.5</p>
</td>
<td valign="top" width="83">
<p>11.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>9</p>
</td>
<td valign="top" width="77">
<p>3/4/2012</p>
</td>
<td valign="top" width="52">
<p>12</p>
</td>
<td valign="top" width="63">
<p>Joe</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>11.5</p>
</td>
<td valign="top" width="83">
<p>11.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>8</p>
</td>
<td valign="top" width="77">
<p>3/4/2012</p>
</td>
<td valign="top" width="52">
<p>18</p>
</td>
<td valign="top" width="63">
<p>Sam</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>11.5</p>
</td>
<td valign="top" width="83">
<p>11.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>11</p>
</td>
<td valign="top" width="77">
<p>3/5/2012</p>
</td>
<td valign="top" width="52">
<p>14</p>
</td>
<td valign="top" width="63">
<p>Sam</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>14.0</p>
</td>
<td valign="top" width="83">
<p>14.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>12</p>
</td>
<td valign="top" width="77">
<p>3/6/2012</p>
</td>
<td valign="top" width="52">
<p>17</p>
</td>
<td valign="top" width="63">
<p>Beth</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>18.0</p>
</td>
<td valign="top" width="83">
<p>17.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>13</p>
</td>
<td valign="top" width="77">
<p>3/6/2012</p>
</td>
<td valign="top" width="52">
<p>19</p>
</td>
<td valign="top" width="63">
<p>Joe</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>18.0</p>
</td>
<td valign="top" width="83">
<p>17.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>14</p>
</td>
<td valign="top" width="77">
<p>3/7/2012</p>
</td>
<td valign="top" width="52">
<p>13</p>
</td>
<td valign="top" width="63">
<p>Beth</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>14.5</p>
</td>
<td valign="top" width="83">
<p>13.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
<tr>
<td valign="top" width="27">
<p>15</p>
</td>
<td valign="top" width="77">
<p>3/7/2012</p>
</td>
<td valign="top" width="52">
<p>16</p>
</td>
<td valign="top" width="63">
<p>Sam</p>
</td>
<td valign="top" width="87">
<p>13</p>
</td>
<td valign="top" width="82">
<p>13.00</p>
</td>
<td valign="top" width="87">
<p>14.5</p>
</td>
<td valign="top" width="83">
<p>13.00</p>
</td>
<td valign="top" width="77">
<p>10</p>
</td>
</tr>
</tbody>
</table>
<p>As I wrap up this post, I have to give a shout out to my daughter, Kristy, who is an honors math student.  She helped me get my head around this last group of functions.  Her honors math work and some statistical work she had done in science helped provide additional insight into the math behind the functions. (Kristy – you rock!)</p>
<h1>Series Wrap Up</h1>
<p>I hope this series helps everyone understand the power and flexibility in the window functions made available in SQL Server 2012.  If you happen to use Oracle, I know that many of these functions or there equivalent are also available in 11g and they also appear to be in 10g.  I have to admit my first real production usage was with Oracle 11g but has since used them with SQL Server 2012.  The expanded functionality in SQL Server 2012 is just one more reason to upgrade to the latest version.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-2/'>T-SQL Window Functions - Part 2: Ranking Functions</a><p>This is part 2 in my series on SQL window functions. In this post, we&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part1/'>T-SQL Window Functions - Part 1: The OVER Clause</a><p>SQL Window functions were introduced in SQL Server 2005. At the time, only a small&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://dataonwheels.files.wordpress.com/2010/11/stevescoutmaster.jpg" alt="User bio image"/>Steve Hughes is a Practice Lead at Magenic. He works with Microsoft’s SQL Server stack to deliver data and business intelligence solutions. He has been working with technology for over 15 years with much of that time spent on creating business intelligence solutions including multidimensional databases, reporting solutions, and data marts. He is passionate about using data effectively and helping customers understand that data is valuable and profitable. Steve also has experience working with a large Software as a Service vendor where he received awards for customer satisfaction and engineering excellence.  Steve believes the data in the cloud will change how information can be delivered to and consumed by the masses. He also provides insights from the field on his own blog at http://dataonwheels.wordpress.com. Steve also is active in PASS as MNPASS chapter leader and NE Regional Mentor.<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/dataonwheels" title="flipster1971 at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/pub/steve-hughes/1/a41/579" title="flipster1971 at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="http://www.dataonwheels.com/" title="flipster1971 at HomePage" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_homepage.png" alt="HomePage" /></a><a href="/index.php/author/flipster1971/feed/" title="Blog RSS feed for flipster1971" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 16,157 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/flipster1971/">Read More Posts by Steve Hughes (DataOnWheels)</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&text=RT @LessThanDot Blog - T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions by @dataonwheels" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&title=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions&source=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&title=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&quote=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/&title=T-SQL Window Functions &amp;#8211; Part 4: Analytic Functions" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		1 Comment so far	</h4>
			<ol class="comments-list">
					<li class="comment even thread-even depth-1" id="comment-5457">
				<div id="div-comment-5457" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/29fba30e46773e52f91eb50e5091b197?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/29fba30e46773e52f91eb50e5091b197?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Elizabeth Priddy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/#comment-5457">
			September 27, 2012 at 10:53 am</a>		</div>

		<p>Okay, I&#8217;ve been excited about SQL Server 2012 in general (though we are currently stuck on SQL Server 2005 at work) and this one gets me even more excited!!  We are frequently asked for averages, min, max, and medians for the data and have successfully calculated the first three but medians have been the trickiest.  This new functionality is awesome!!</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/?replytocom=5457#respond' onclick='return addComment.moveForm( "div-comment-5457", "5457", "respond", "1716" )' aria-label='Reply to Elizabeth Priddy'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/datamgmt/dbprogramming/mssqlserver/t-sql-window-functions-part-4/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1716' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="94c7bb58efc3b337800875b5d382a072"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552766546"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
