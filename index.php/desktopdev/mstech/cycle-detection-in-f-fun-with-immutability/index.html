<!DOCTYPE html>
<html lang="en-US">
<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
		<link rel="shortcut icon" href="http://lessthandot.com/favicon.ico" type="image/vnd.microsoft.icon" />
	<title>Less Than Dot - Blog -   Cycle Detection in F# &#8211; Fun With Immutability</title>
	<meta prefix="og: http://ogp.me/ns#" property="og:title" content="Less Than Dot - Blog -   Cycle Detection in F# &#8211; Fun With Immutability" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:url" content="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/" />
		<meta prefix="og: http://ogp.me/ns#" property="og:image" content="http://lessthandot.com/images/logo_prod.png" />
	<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article" />
	<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="LessThanDot" />
	<meta prefix="og: http://ogp.me/ns#" property="og:description" content="I've been going through a lot of the problems from Project Euler in F#, and finding myself needing to change my way of thinking more and more often.  I recently finished doing one problem that required use of a Cycle Detection algorithm, and as the solu&hellip;" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/index.php/feed/" />
	<link rel="alternate" type="application/atom+xml" title="Atom" href="/index.php/feed/atom/" />

	<!-- this page is the canonical URL -->	
	<link rel="stylesheet" href="/wp-content/themes/lessthandot2009/style.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsite.css" type="text/css" />
	<link rel="stylesheet" href="http://lessthandot.com/includes/allsiteprint.css" media="print" type="text/css" />

	<link rel='dns-prefetch' href='//ajax.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="LessthanDot &raquo; Cycle Detection in F# &#8211; Fun With Immutability Comments Feed" href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6.1"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='bwp-syntax-css'  href='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/css/bwp-syntax-global.css?ver=4.6.1' type='text/css' media='all' />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-content/plugins/better-wordpress-syntax-based-on-geshi/js/bwp-syntax.js?ver=4.6.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Get weekly transactions showing Monday&#8217;s date' href='/index.php/datamgmt/datadesign/get-weekly-transactions-showing-monday/' />
<link rel='next' title='First Look at IE 10' href='/index.php/webdev/webdesigngraphicsstyling/first-look-at-ie-10/' />
<meta name="generator" content="WordPress 4.6.1" />
<link rel="canonical" href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/" />
<link rel='shortlink' href='/?p=1102' />
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdesktopdev%2Fmstech%2Fcycle-detection-in-f-fun-with-immutability%2F" />
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2Findex.php%2Fdesktopdev%2Fmstech%2Fcycle-detection-in-f-fun-with-immutability%2F&#038;format=xml" />
<style type='text/css'>.rp4wp-related-posts ul{width:100%;padding:0;margin:0;float:left;}
.rp4wp-related-posts ul>li{list-style:none;padding:0;margin:0;padding-bottom:20px;clear:both;}
.rp4wp-related-posts ul>li>p{margin:0;padding:0;}
.rp4wp-related-post-image{width:35%;padding-right:25px;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;float:left;}</style>
	<script src="http://lessthandot.com/includes/allsite.js" type="text/javascript" ></script>
</head>
<body>
<div id="contain"><div id="subcontain"><div id="ttl"><div id="hdr"><div id="snav"><a href="http://lessthandot.com/login.php?backtrack=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/?">Member Login</a>
</div><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="logoc"><img src="http://lessthandot.com/images/logo_prod.png" alt="LessThanDot Site Logo" border="0" /></a><h1>LessThanDot</h1><div class="pgsttl">A decade of helpful technical content</div></div><div id="nav">
<ul>
<li><a href="http://lessthandot.com/" title="LessThanDot Launchpad" id="h" ><span>Launchpad</span></a></li>
<li class="cur"><a href="/" title="LessThanDot Blogs" id="b" ><span>Blogs</span></a></li>
<li><a href="http://forum.lessthandot.com/" title="LessThanDot Community Forums" id="f" ><span>Forum</span></a></li>
<li><a href="http://wiki.lessthandot.com/" title="LessThanDot Wiki Articles" id="w" ><span>Wiki</span></a></li>
<li><a href="http://sqlcop.lessthandot.com/" title="LessThanDot SQLCop" id="a" ><span>SQLCop</span></a></li>
<li><a href="http://lessthandot.com/account.php" title="Your Account Settings" id="r"  class="l_ie"><span>My Account</span></a></li></ul></div>
</div><div id="content">
<div id="fac"><div id="fa">
		<p>Less Than Dot is a community of passionate IT professionals and enthusiasts dedicated to sharing technical knowledge, experience, and assistance. Inside you will find reference materials, interesting technical discussions, and expert tips and commentary.</p></div></div><div class="content-sidebar">
	<div id="social" class="sdsec">
		<h2>LTD Social Sitings</h2>
		<div>
		<a id="social_twitter" href="http://twitter.com/LessThanDot/" title="Follow us on Twitter" ><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Lessthandot twitter"/></a> 
		<a href="http://www.linkedin.com/groups?home=&amp;gid=113440" title="Join us on LinkedIn" ><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="Lessthandot Linkedin" /></a> 
		<a href="http://www.facebook.com/group.php?gid=19330511063" title="Join us on Facebook" ><img src="http://lessthandot.com/images/bdg_facebook.png" alt="Lessthandot facebook"/></a> 
		<a href="http://lessthandot.com/rss.php" title="LessThanDot News Feed" ><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="Lessthandot rss"/></a> 
		</div>
		<p><em>Note: Watch for social icons on posts by your favorite authors to follow their postings on these and other social sites.</em></p>
	</div><div class="content-sidebar-section">
<h2>Tag cloud</h2>
	<p class="tag-cloud">
		<a href='/index.php/tag/net/' class='tag-link-245 tag-link-position-1' title='21 topics' style='font-size: 8.9565217391304pt;'>.net</a> <a href='/index.php/tag/asp-net/' class='tag-link-168 tag-link-position-2' title='21 topics' style='font-size: 8.9565217391304pt;'>asp.net</a> <a href='/index.php/tag/azure-2/' class='tag-link-321 tag-link-position-3' title='29 topics' style='font-size: 10.173913043478pt;'>azure</a> <a href='/index.php/tag/book/' class='tag-link-130 tag-link-position-4' title='26 topics' style='font-size: 9.7391304347826pt;'>book</a> <a href='/index.php/tag/business-intelligence-2/' class='tag-link-256 tag-link-position-5' title='30 topics' style='font-size: 10.260869565217pt;'>business intelligence</a> <a href='/index.php/tag/c/' class='tag-link-138 tag-link-position-6' title='40 topics' style='font-size: 11.304347826087pt;'>c#</a> <a href='/index.php/tag/database/' class='tag-link-134 tag-link-position-7' title='31 topics' style='font-size: 10.434782608696pt;'>database</a> <a href='/index.php/tag/excel/' class='tag-link-155 tag-link-position-8' title='16 topics' style='font-size: 8pt;'>excel</a> <a href='/index.php/tag/gotcha/' class='tag-link-240 tag-link-position-9' title='19 topics' style='font-size: 8.6086956521739pt;'>gotcha</a> <a href='/index.php/tag/how-to/' class='tag-link-272 tag-link-position-10' title='44 topics' style='font-size: 11.652173913043pt;'>how to</a> <a href='/index.php/tag/mongodb/' class='tag-link-765 tag-link-position-11' title='17 topics' style='font-size: 8.2608695652174pt;'>mongodb</a> <a href='/index.php/tag/nosql/' class='tag-link-775 tag-link-position-12' title='18 topics' style='font-size: 8.4347826086957pt;'>nosql</a> <a href='/index.php/tag/performance/' class='tag-link-179 tag-link-position-13' title='26 topics' style='font-size: 9.7391304347826pt;'>performance</a> <a href='/index.php/tag/security-2/' class='tag-link-398 tag-link-position-14' title='25 topics' style='font-size: 9.5652173913043pt;'>security</a> <a href='/index.php/tag/sql/' class='tag-link-132 tag-link-position-15' title='42 topics' style='font-size: 11.478260869565pt;'>sql</a> <a href='/index.php/tag/sql-advent-2012/' class='tag-link-1416 tag-link-position-16' title='18 topics' style='font-size: 8.4347826086957pt;'>sql advent 2012</a> <a href='/index.php/tag/sql-friday/' class='tag-link-377 tag-link-position-17' title='18 topics' style='font-size: 8.4347826086957pt;'>sql friday</a> <a href='/index.php/tag/sql-server/' class='tag-link-154 tag-link-position-18' title='145 topics' style='font-size: 16.086956521739pt;'>sql server</a> <a href='/index.php/tag/sql-server-2000/' class='tag-link-366 tag-link-position-19' title='45 topics' style='font-size: 11.739130434783pt;'>sql server 2000</a> <a href='/index.php/tag/sql-server-2005/' class='tag-link-327 tag-link-position-20' title='118 topics' style='font-size: 15.391304347826pt;'>sql server 2005</a> <a href='/index.php/tag/sql-server-2008/' class='tag-link-152 tag-link-position-21' title='237 topics' style='font-size: 18pt;'>sql server 2008</a> <a href='/index.php/tag/sql-server-2008-r2/' class='tag-link-548 tag-link-position-22' title='38 topics' style='font-size: 11.130434782609pt;'>sql server 2008 r2</a> <a href='/index.php/tag/sql-server-2012/' class='tag-link-1161 tag-link-position-23' title='76 topics' style='font-size: 13.739130434783pt;'>sql server 2012</a> <a href='/index.php/tag/ssis-2/' class='tag-link-501 tag-link-position-24' title='52 topics' style='font-size: 12.260869565217pt;'>ssis</a> <a href='/index.php/tag/ssms/' class='tag-link-640 tag-link-position-25' title='18 topics' style='font-size: 8.4347826086957pt;'>ssms</a> <a href='/index.php/tag/ssrs-2/' class='tag-link-557 tag-link-position-26' title='27 topics' style='font-size: 9.9130434782609pt;'>ssrs</a> <a href='/index.php/tag/syndicated/' class='tag-link-1407 tag-link-position-27' title='67 topics' style='font-size: 13.217391304348pt;'>syndicated</a> <a href='/index.php/tag/t-sql/' class='tag-link-185 tag-link-position-28' title='26 topics' style='font-size: 9.7391304347826pt;'>t-sql</a> <a href='/index.php/tag/tip/' class='tag-link-194 tag-link-position-29' title='46 topics' style='font-size: 11.826086956522pt;'>tip</a> <a href='/index.php/tag/unit-testing/' class='tag-link-162 tag-link-position-30' title='17 topics' style='font-size: 8.2608695652174pt;'>unit testing</a>	</p>
</div>		<div class="content-sidebar-section">
		<h2>Authors</h2>
			<ul class="author-list dimmed">
				<li><a href="/index.php/author/SQLDenis/" title="Posts by SQLDenis">SQLDenis</a> <a href="/index.php/author/SQLDenis/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (597)</li><li><a href="/index.php/author/onpnt/" title="Posts by Ted Krueger (onpnt)">Ted Krueger (onpnt)</a> <a href="/index.php/author/onpnt/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (355)</li><li><a href="/index.php/author/grrlgeek/" title="Posts by Jes Borland">Jes Borland</a> <a href="/index.php/author/grrlgeek/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (202)</li><li><a href="/index.php/author/tarwn/" title="Posts by Eli Weinstock-Herman (tarwn)">Eli Weinstock-Herman (tarwn)</a> <a href="/index.php/author/tarwn/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (190)</li><li><a href="/index.php/author/koenverbeeck/" title="Posts by Koen Verbeeck">Koen Verbeeck</a> <a href="/index.php/author/koenverbeeck/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (100)</li><li><a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich">Alex Ullrich</a> <a href="/index.php/author/alexcuse/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (55)</li><li><a href="/index.php/author/gmmastros/" title="Posts by George Mastros (gmmastros)">George Mastros (gmmastros)</a> <a href="/index.php/author/gmmastros/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (45)</li><li><a href="/index.php/author/axel8s/" title="Posts by Axel Achten (axel8s)">Axel Achten (axel8s)</a> <a href="/index.php/author/axel8s/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (28)</li><li><a href="/index.php/author/naomi/" title="Posts by Naomi Nosonovsky">Naomi Nosonovsky</a> <a href="/index.php/author/naomi/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (27)</li><li><a href="/index.php/author/thirster42/" title="Posts by David Forck (thirster42)">David Forck (thirster42)</a> <a href="/index.php/author/thirster42/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (24)</li><li><a href="/index.php/author/chopstik/" title="Posts by chopstik">chopstik</a> <a href="/index.php/author/chopstik/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (20)</li><li><a href="/index.php/author/kconan/" title="Posts by Kevin Conan">Kevin Conan</a> <a href="/index.php/author/kconan/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (18)</li><li><a href="/index.php/author/robearl/" title="Posts by Rob Earl">Rob Earl</a> <a href="/index.php/author/robearl/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (14)</li><li><a href="/index.php/author/thatrickguy/" title="Posts by ThatRickGuy">ThatRickGuy</a> <a href="/index.php/author/thatrickguy/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (12)</li><li><a href="/index.php/author/sqlarcher/" title="Posts by SQLArcher">SQLArcher</a> <a href="/index.php/author/sqlarcher/feed/"><img src="http://lessthandot.com/images/bdg_rss_icon_sm.png" style="border: none;" /></a> (11)</li>                <li><a href="http://lessthandot.com/Stats/BlogAuthors.php">More...</a></li>
			</ul>
		</div>
				<div class="content-sidebar-section">
		<h2>Categories</h2>
			<ul class="categories-list">
					<li class="cat-item cat-item-10"><a href="/index.php/category/all/" >All Blogs</a>
</li>
	<li class="cat-item cat-item-5"><a href="/index.php/category/architect/" >Architecture, Design and Strategy</a>
</li>
	<li class="cat-item cat-item-1759"><a href="/index.php/category/artificial-intelligence/" >Artificial Intelligence</a>
</li>
	<li class="cat-item cat-item-6"><a href="/index.php/category/datamgmt/" >Data Management</a>
</li>
	<li class="cat-item cat-item-7"><a href="/index.php/category/desktopdev/" >Desktop Developer</a>
</li>
	<li class="cat-item cat-item-8"><a href="/index.php/category/enterprisedev/" >Enterprise Developer</a>
</li>
	<li class="cat-item cat-item-11"><a href="/index.php/category/itprofessionals/" >IT Professionals</a>
</li>
	<li class="cat-item cat-item-12"><a href="/index.php/category/itstudents/" >IT Students and Researchers</a>
</li>
	<li class="cat-item cat-item-1743"><a href="/index.php/category/management/" >Management</a>
</li>
	<li class="cat-item cat-item-9"><a href="/index.php/category/sysadmins/" >System Admins</a>
</li>
	<li class="cat-item cat-item-1"><a href="/index.php/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-4"><a href="/index.php/category/webdev/" >Web Developer</a>
</li>
			</ul>
		</div>
		</div><div class="content-main">
				<div class="post-navigation">
				<div class="post-navigation-forward"><a href="/index.php/webdev/webdesigngraphicsstyling/first-look-at-ie-10/" rel="next">First Look at IE 10</a> &raquo; </div>
				<div class="post-navigation-back">&laquo; <a href="/index.php/datamgmt/datadesign/get-weekly-transactions-showing-monday/" rel="prev">Get weekly transactions showing Monday&#8217;s date</a></div>
			</div>
			<div class="post-area instapaper_body">
				<div class="post-title-line">
										<h1 class="instapaper_ignore"><a href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/" class="post-title">Cycle Detection in F# &#8211; Fun With Immutability</a></h1>
					<div class="post-byline">by <a href="/index.php/author/alexcuse/" title="Posts by Alex Ullrich" rel="author">Alex Ullrich</a> on April 11, 2011 in category <a href="/index.php/category/desktopdev/mstech/" rel="category tag">Microsoft Technologies</a>. Article views: 6,970 </div>
				</div>
				<div class="post-tagline"><a href="https://twitter.com/intent/tweet?url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&text=RT @LessThanDot Blog - Cycle Detection in F# &amp;#8211; Fun With Immutability by @AlexCuse" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&title=Cycle Detection in F# &amp;#8211; Fun With Immutability&source=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&title=Cycle Detection in F# &amp;#8211; Fun With Immutability" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&quote=Cycle Detection in F# &amp;#8211; Fun With Immutability" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&title=Cycle Detection in F# &amp;#8211; Fun With Immutability" class="instapaper_button">Instapaper</a></div>

				<div class="post-content"><p>I&#8217;ve been going through a lot of the problems from <a href="http://projecteuler.net/">Project Euler</a> in F#, and finding myself needing to change my way of thinking more and more often.  I recently finished doing one problem that required use of a <a href="http://en.wikipedia.org/wiki/Cycle_detection">Cycle Detection</a> algorithm, and as the solution evolved I thought it would be a good example of writing immutable code.</p>
<h3>Algorithm Being Examined</h3>
<p>For the example, I&#8217;ll use Brent&#8217;s variation on the tortoise-and-hare algorithm described at the link because it&#8217;s a little shorter.  The basic idea of the tortoise-and-hare algorithm is basically what you&#8217;d expect, a function is repeatedly applied (at different rates) to a value.  The way the value changes in response can help to identify patterns in the function&#8217;s behavior.  If you&#8217;d like to know more about it, check out the wikipedia page.  This algorithm is demonstrated with the following code:</p>
<pre>def brent(f, x0):
    # main phase: search successive powers of two
    power = lam = 1
    tortoise = x0
    hare = f(x0) # f(x0) is the element/node next to x0.
    while tortoise != hare:
        if power == lam:   # time to start a new power of two?
            tortoise = hare
            power *= 2
            lam = 0
        hare = f(hare)
        lam += 1
 
    # Find the position of the first repetition of length lambda
    mu = 0
    tortoise = hare = x0
    for i in range(lam):
    # range(lam) produces a list with the values 0, 1, ... , lam-1
        hare = f(hare)
    while tortoise != hare:
        tortoise = f(tortoise)
        hare = f(hare)
        mu += 1
 
    return lam, mu</pre>
<p>The tuple returned contains the cycle length (lam) and the point at which the cycle starts (mu).  A literal translation of this code to F# looks like this:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> brent f x <span class="sy0">=</span>
&nbsp; &nbsp; <span class="kw1">let</span> <span class="kw1">mutable</span> power <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">let</span> <span class="kw1">mutable</span> lam <span class="sy0">=</span> <span class="nu0">1</span>
&nbsp; &nbsp; <span class="kw1">let</span> <span class="kw1">mutable</span> tortoise <span class="sy0">=</span> x
&nbsp; &nbsp; <span class="kw1">let</span> <span class="kw1">mutable</span> hare <span class="sy0">=</span> f x 
&nbsp;
&nbsp; &nbsp; <span class="kw1">while</span> <span class="kw1">not</span> <span class="br0">&#40;</span>tortoise <span class="sy0">=</span> hare<span class="br0">&#41;</span> <span class="kw1">do</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> power <span class="sy0">=</span> lam <span class="kw1">then</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tortoise <span class="sy0">&lt;-</span> hare
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; power <span class="sy0">&lt;-</span> power <span class="sy0">*</span> <span class="nu0">2</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lam <span class="sy0">&lt;-</span> <span class="nu0">0</span>
&nbsp; &nbsp; &nbsp; &nbsp; hare <span class="sy0">&lt;-</span> f hare
&nbsp; &nbsp; &nbsp; &nbsp; lam <span class="sy0">&lt;-</span> lam <span class="sy0">+</span> <span class="nu0">1</span>
&nbsp;
&nbsp; &nbsp; <span class="kw1">let</span> <span class="kw1">mutable</span> mu <span class="sy0">=</span> <span class="nu0">0</span>
&nbsp; &nbsp; tortoise <span class="sy0">&lt;-</span> x
&nbsp; &nbsp; hare <span class="sy0">&lt;-</span> x
&nbsp;
&nbsp; &nbsp; <span class="kw1">for</span> i <span class="kw1">in</span> <span class="br0">&#91;</span><span class="nu0">1</span> .. <span class="me1">lam</span><span class="br0">&#93;</span> <span class="kw1">do</span>
&nbsp; &nbsp; &nbsp; &nbsp; hare <span class="sy0">&lt;-</span> f hare
&nbsp;
&nbsp; &nbsp; <span class="kw1">while</span> <span class="kw1">not</span> <span class="br0">&#40;</span>tortoise <span class="sy0">=</span> hare<span class="br0">&#41;</span> <span class="kw1">do</span>
&nbsp; &nbsp; &nbsp; &nbsp; tortoise <span class="sy0">&lt;-</span> f tortoise
&nbsp; &nbsp; &nbsp; &nbsp; hare <span class="sy0">&lt;-</span> f hare
&nbsp; &nbsp; &nbsp; &nbsp; mu <span class="sy0">&lt;-</span> mu <span class="sy0">+</span> <span class="nu0">1</span>
&nbsp;
&nbsp; &nbsp; lam, mu</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let brent f x =
    let mutable power = 1
    let mutable lam = 1
    let mutable tortoise = x
    let mutable hare = f x 

    while not (tortoise = hare) do
        if power = lam then
            tortoise &lt;- hare
            power &lt;- power * 2
            lam &lt;- 0
        hare &lt;- f hare
        lam &lt;- lam + 1

    let mutable mu = 0
    tortoise &lt;- x
    hare &lt;- x

    for i in [1 .. lam] do
        hare &lt;- f hare

    while not (tortoise = hare) do
        tortoise &lt;- f tortoise
        hare &lt;- f hare
        mu &lt;- mu + 1

    lam, mu</pre></div></div>

<p>This code isn&#8217;t necessarily bad, and actually performed quite well for my purpose (at least compared to the nasty C# string hacks I used the last time I tried this one).  It doesn&#8217;t feel like idiomatic functional code though, primarily due to the heavy use of mutable state.  Immutability is a big part of functional programming, because it leads to side-effect free code.  This is (in theory) less likely to contain bugs, and easier to run in parallel.  My friend <a href="/index.php/All/?disp=authdir&amp;author=225">Matt</a> put it quite well, saying that immutability for him is all about peace of mind.<br />
<blockquote>Who cares if I don&#8217;t synchronize access to the object! It&#8217;s immutable!</p></blockquote>
<p>With all this in mind, once I had the problem solved I decided to see how hard it&#8217;d be to implement the same algorithm without any mutable values &#8211; I&#8217;m not sure if it will end up as idiomatic F# or not, but I hope it&#8217;s at least a step in the right direction.</p>
<h3>Getting Rid of Mutable State</h3>
<p>When programming in a functional style, recursion is one of the most powerful tools we&#8217;ve got for avoiding mutable state, and the complications that come with it.  The F# compiler can perform <a href="http://en.wikipedia.org/wiki/Tail_recursion">tail call optimization</a>, which can help avoid the stack overflows you can run into with normal recursive methods.  Looking over the code above, the prime offenders for using mutable state appear to be the two main loops opened with </p>
<pre>while tortoise != hare:</pre>
<p>So let&#8217;s look at how these can be converted to recursive functions.  The upper loop is probably the most complex because of the if statement it contains, and it can be converted to something like the following:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
8
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> <span class="kw1">rec</span> applyUntilEqual <span class="br0">&#40;</span>power, lam, tortoise, hare<span class="br0">&#41;</span> <span class="sy0">=</span>
&nbsp; &nbsp; <span class="kw1">if</span> <span class="kw1">not</span> <span class="br0">&#40;</span>tortoise <span class="sy0">=</span> hare<span class="br0">&#41;</span> <span class="kw1">then</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>power <span class="sy0">=</span> lam<span class="br0">&#41;</span> <span class="kw1">then</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; applyUntilEqual <span class="br0">&#40;</span>power <span class="sy0">*</span> <span class="nu0">2</span>, <span class="nu0">0</span>, hare, hare<span class="br0">&#41;</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; applyUntilEqual <span class="br0">&#40;</span>power, lam <span class="sy0">+</span> <span class="nu0">1</span>, tortoise, f hare<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">else</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#40;</span>power, lam, tortoise, hare<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let rec applyUntilEqual (power, lam, tortoise, hare) =
    if not (tortoise = hare) then
        if (power = lam) then
            applyUntilEqual (power * 2, 0, hare, hare)
        else 
            applyUntilEqual (power, lam + 1, tortoise, f hare)
    else
        (power, lam, tortoise, hare)</pre></div></div>

<p>Note that we don&#8217;t need to pass &#8216;f&#8217; (the function passed into our brent implementation) into this function.  Because this method is declared inside the brent function, it will have access to all of the data passed in.  In all cases except when tortoise and hare are equal, the function calls itself with altered values.  The first half of the inner if statement handles the preprocessing that is done when power and lam are equal &#8211; multiplying the power by 2 and replacing the tortoise with the hare. The second half handles the normal processing, incrementing lam and applying the function to the hare.  The final case simply returns the same tuple that it receives.  </p>
<p>This is a step in the right direction, but it still seems to have 1 branch too many.  So let&#8217;s take a look at what we&#8217;re really trying to do with this recursion.  It&#8217;s not necessarily the processing of values, but the while loop itself.  With a few changes we can make the method focus a bit more on what we need it to do.  The most important change is to allow it to take another function as an argument.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> <span class="kw1">rec</span> applyUntilEqual func <span class="br0">&#40;</span>power, lam, mu, tortoise, hare<span class="br0">&#41;</span> <span class="sy0">=</span>
&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>tortoise <span class="sy0">=</span> hare<span class="br0">&#41;</span> <span class="kw1">then</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#40;</span>power, lam, mu, tortoise, hare<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">else</span>
&nbsp; &nbsp; &nbsp; &nbsp; applyUntilEqual func <span class="br0">&#40;</span>func <span class="br0">&#40;</span>power, lam, mu, tortoise, hare<span class="br0">&#41;</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let rec applyUntilEqual func (power, lam, mu, tortoise, hare) =
    if (tortoise = hare) then
        (power, lam, mu, tortoise, hare)
    else
        applyUntilEqual func (func (power, lam, mu, tortoise, hare))</pre></div></div>

<p>This sure does look simpler, but surprisingly free of any interesting logic.  As is so often the case, this is where things really get interesting.  If tortoise and hare are equal, we simply return the tuple that was passed in.  If they aren&#8217;t, then the function calls itself with the input tuple, as transformed by the function passed in.  The &#8216;func&#8217; parameter that we added can carry the logic we want to apply on each pass through our &#8216;loop&#8217;.  The following snippet shows the implementation of the first bit of logic, along with the way it can be called from code:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> phaseOne <span class="br0">&#40;</span>power, lam, mu, tortoise, hare<span class="br0">&#41;</span> <span class="sy0">=</span>
&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span>power <span class="sy0">=</span> lam<span class="br0">&#41;</span> <span class="kw1">then</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#40;</span>power <span class="sy0">*</span> <span class="nu0">2</span>, <span class="nu0">1</span>, mu, hare, <span class="br0">&#40;</span>f hare<span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="kw1">else</span> 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">&#40;</span>power, lam <span class="sy0">+</span> <span class="nu0">1</span>, mu, tortoise, <span class="br0">&#40;</span>f hare<span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">let</span> phaseOneResult <span class="sy0">=</span> applyUntilEqual func <span class="br0">&#40;</span><span class="sy0">&lt;</span>tuple containing data<span class="sy0">&gt;</span><span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let phaseOne (power, lam, mu, tortoise, hare) =
    if (power = lam) then
        (power * 2, 1, mu, hare, (f hare))
    else 
        (power, lam + 1, mu, tortoise, (f hare))

let phaseOneResult = applyUntilEqual func (&lt;tuple containing data&gt;)</pre></div></div>

<p>Because we don&#8217;t need to check whether tortoise and hare are equal, we can write this in a single if statement.  This frees us to short-circuit things a little bit, accomplishing both the pre and post processing in the (power = lam) condition, so this could save us a few passes through the function.  Notice this function includes the &#8216;mu&#8217; parameter, even though it is not used yet.  This is because by adding that parameter, we can use the same &#8216;loop&#8217; function for both of the main loops in the algorithm. </p>
<p>It takes the same bundle of data (even though it now only uses mu, tortoise and hare).  The reason for this goes beyond being able to share the loop function, as we&#8217;ll see in a second.  All we have to do this time is apply the function to tortoise and hare, and increment mu.  </p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> phaseTwo <span class="br0">&#40;</span>power, lam, mu, tortoise, hare<span class="br0">&#41;</span> <span class="sy0">=</span>
&nbsp; &nbsp; <span class="br0">&#40;</span>power, lam, mu <span class="sy0">+</span> <span class="nu0">1</span>, f tortoise, f hare<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let phaseTwo (power, lam, mu, tortoise, hare) =
    (power, lam, mu + 1, f tortoise, f hare)</pre></div></div>

<p>Finally, we need to implement the loop that starts with <em>for i in range(lam):</em> in the python code.  This code really only needs to execute the function provided <em>(lam &#8211; 1)</em> times.  It&#8217;s not too difficult, but slightly interesting.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
6
7
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> advanceHare <span class="br0">&#40;</span>power, lam, mu, tortoise, hare<span class="br0">&#41;</span> <span class="sy0">=</span>
&nbsp; &nbsp; <span class="kw1">let</span> <span class="kw1">rec</span> advance times h <span class="sy0">=</span>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> times <span class="sy0">=</span> <span class="nu0">1</span> <span class="kw1">then</span>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hare
&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; advance<span class="br0">&#40;</span>times <span class="sy0">-</span> <span class="nu0">1</span><span class="br0">&#41;</span> <span class="br0">&#40;</span>f h<span class="br0">&#41;</span>
&nbsp; &nbsp; <span class="br0">&#40;</span>power, lam, mu, tortoise, advance lam hare<span class="br0">&#41;</span></pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let advanceHare (power, lam, mu, tortoise, hare) =
    let rec advance times h =
        if times = 1 then
            hare
        else 
            advance(times - 1) (f h)
    (power, lam, mu, tortoise, advance lam hare)</pre></div></div>

<p>The interesting part is the inner &#8216;advance&#8217; function.  It only takes the number of times to execute and the current hare value.  This allows us to take (and return) the same package of data that the other functions expect from the outer function.  So, after tying up some loose ends we should have eliminated all of the mutable state.  But lets look at the reason I alluded to in the last paragraph for passing the same bundle of data through all functions.  </p>
<h3>Aside: Pipeline Operators</h3>
<p>One of my favorite features in F# is the forward pipe operator (and the less oft-used backward pipe operator), a pair of operators designed to let you string together a series of function calls.  The forward pipe operator can be explained with a simple example of a function to multiply two numbers, and another function that calls it to multiply a single number by ten:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> multiply x y <span class="sy0">=</span> x <span class="sy0">*</span> y
<span class="kw1">let</span> x10 x <span class="sy0">=</span> multiply <span class="nu0">10</span> x</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let multiply x y = x * y
let x10 x = multiply 10 x</pre></div></div>

<p>Groundbreaking, I know.  But it can be rewritten using the forward pipe operator like so:</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
</pre></td><td class="de1"><pre class="de1"><span class="kw1">let</span> multiply x y <span class="sy0">=</span> x <span class="sy0">*</span> y
<span class="kw1">let</span> x10 x <span class="sy0">=</span> x <span class="sy0">|&gt;</span> multiply <span class="nu0">10</span> </pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">let multiply x y = x * y
let x10 x = x |&gt; multiply 10 </pre></div></div>

<p>At least syntactically speaking, this transforms the code from the <em>function (arg1, arg2)</em> syntax that&#8217;s common in most languages to something like <em>arg1 |> function arg2</em>.  You can chain these together, with the operator always receiving the output of the previous function, forming a nice clean &#8216;pipeline&#8217;.  So if we wanted to get really crazy, an x100 function could be written like so: <em>let x100 = x |> multiply 10 |> multiply 10</em>.  This doesn&#8217;t seem that impressive with such a simple example, but it really shines when trying to compose complex functions from simple building blocks.  My personal favorite use for the pipeline operator is applying a chain of functions to a lazily evaluated sequence.</p>
<p>Luckily, we can use the code we&#8217;ve put together to show the pipeline operator in action.  Starting with a tuple containing our inputs, we can get the result we need by chaining the simple methods we&#8217;ve created together in order.</p>

<div class="bwp-syntax-block clearfix">
<div class="bwp-syntax-toolbar"><div class="bwp-syntax-control"><a href="javascript:;" class="bwp-syntax-source-switch" title="View Source Code"></a></div></div>
<div class="bwp-syntax-wrapper clearfix bwp-syntax-simple"><table class="fsharp"><thead><tr><td colspan="2"  class="head">F#</td></tr></thead><tbody><tr class="li1"><td class="ln"><pre class="de1">1
2
3
4
5
</pre></td><td class="de1"><pre class="de1"><span class="br0">&#40;</span><span class="nu0">1</span>, <span class="nu0">1</span>, <span class="nu0">0</span>, x, f x<span class="br0">&#41;</span> 
&nbsp; &nbsp; <span class="sy0">|&gt;</span> applyUntilEqual phaseOne
&nbsp; &nbsp; <span class="sy0">|&gt;</span> accelerateHare
&nbsp; &nbsp; <span class="sy0">|&gt;</span> applyUntilEqual phaseTwo
&nbsp; &nbsp; <span class="sy0">|&gt;</span> <span class="kw1">fun</span> <span class="br0">&#40;</span>_, lam, mu, _, _<span class="br0">&#41;</span> <span class="sy0">-&gt;</span> lam, mu</pre></td></tr></tbody></table></div>
<div class="bwp-syntax-source"><pre class="no-parse">(1, 1, 0, x, f x) 
    |&gt; applyUntilEqual phaseOne
    |&gt; accelerateHare
    |&gt; applyUntilEqual phaseTwo
    |&gt; fun (_, lam, mu, _, _) -&gt; lam, mu</pre></div></div>

<p>This is some pretty dense code, but if I&#8217;ve done a decent job explaining it you should be able to read it alright.  Notice the code following the last pipe operator &#8211; for this one we are simply using a lambda expression to extract the two values we need from our bundle of data.  This is a simple operation, but it also shows that we can apply arbitrary lambda expressions as well as defined functions using the pipeline operator.  I think it reads a little better with the predefined functions, though if there wasn&#8217;t any conditional logic in the short functions we have I&#8217;d probably favor using lambdas (except for the applyUntilEqual function).  The original and immutable implementations are included in the attached file if you&#8217;d like to take a closer look.</p>
<h3>Conclusion &#8211; Immutability Comes at a Cost</h3>
<p>So, what did this get us?  I hope that it got us closer to idiomatic F# code, though I&#8217;m not the best judge of that.  It undoubtedly succeeded in breaking the dependence on mutable state to implement the algorithm.  This came at a cost though.  In my simple use case, looking for cycles when applying a pair of functions to 1000 numeric inputs, execution time increases by about 50%.  Both implementations are quick, but the one using mutable state is noticeably quicker.  This wasn&#8217;t exactly a scientific test but it does appear consistent when I run on a few different machines with wildly varying specs.  Because the mutable state is contained within the method I suspect that both implementations would both run in parallel without much problem.</p>
<p>This leaves me suspecting that careful, localized use of mutable state can be valuable when attempting to improve the performance of F# code.  But it&#8217;s probably best to shoot for immutability first.  As always I&#8217;d love to see ways to make it perform or read better &#8211; I can&#8217;t shake the feeling that I missed something.</p>
<div class='rp4wp-related-posts'>
<h3>Related Posts</h3>
<ul>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/desktopdev/mstech/f-developer-center/'>F# Developer Center</a><p>Microsoft has launched the F# Developer Center Here you can learn everything about Microsoft's functional&hellip;</p></div>
</li>
<li><div class='rp4wp-related-post-content'>
<a href='/index.php/desktopdev/mstech/f-asynchronous-workflows/'>F# Asynchronous Workflows</a><p>Asynchronous work flows are a very powerful tool in programming. They allow your threads to&hellip;</p></div>
</li>
</ul>
</div>
</div>
				<div class="post-author">
					<div class="userInfo"><h2>About the Author</h2><img class="bioPic" src="http://forum.lessthandot.com/download/file.php?avatar=56_1270084566.jpg" alt="User bio image"/>Alex is a software engineer from southeastern PA, where he lives with a lovely wife and a veritable smorgasbord of pets.  He loves mountain biking, open source software, barbecue and Syracuse basketball.<br style="clear: left" /><div class="bioSoc"><span class="bioSocTitle">Social Sitings</span><a href="http://twitter.com/AlexCuse" title="AlexCuse at Twitter" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_twitter.png" alt="Twitter" /></a><a href="http://www.linkedin.com/in/alexullrich" title="AlexCuse at LinkedIn" class="bioSocLink" rel="author"><img src="http://lessthandot.com/images/bdg_linkedin.png" alt="LinkedIn" /></a><a href="/index.php/author/alexcuse/feed/" title="Blog RSS feed for AlexCuse" class="bioSocLink"><img src="http://lessthandot.com/images/bdg_rss_icon.png" alt="LTD RSS Feed" /></a></div></div>				</div>
				<div class="post-foot instapaper_ignore">
					<div class="post-tagline">
						<div class="post-foot-views"><label>Article views:</label> 6,970 </div>
						<div class="post-foot-more-posts">
                            <a href="/index.php/author/alexcuse/">Read More Posts by Alex Ullrich</a>
						</div>
					</div>
					<div>
						 
					</div>
					<div class="post-tagline" style="height: auto">
						<span class="social-button-label">Share:</span><a href="https://twitter.com/intent/tweet?url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&text=RT @LessThanDot Blog - Cycle Detection in F# &amp;#8211; Fun With Immutability by @AlexCuse" class="twitter-share-button-static" target="_blank"><i></i><span class="label">Tweet</span></a><a href="http://www.linkedin.com/shareArticle?mini=true&url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&title=Cycle Detection in F# &amp;#8211; Fun With Immutability&source=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/" target="_blank" title="Share on LinkedIn" class="svg-button"><img alt="Share on LinkedIn"  src="http://lessthandot.com/images/LinkedIn.svg" /></a><a href="http://www.reddit.com/submit?url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&title=Cycle Detection in F# &amp;#8211; Fun With Immutability" target="_blank" title="Submit to Reddit" class="svg-button"><img alt="Submit to Reddit" src="http://lessthandot.com/images/Reddit.svg" /></a><a href="https://www.facebook.com/sharer/sharer.php?u=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&quote=Cycle Detection in F# &amp;#8211; Fun With Immutability" title="Share on Facebook" target="_blank" class="svg-button"><img alt="Share on Facebook" src="http://lessthandot.com/images/Facebook.svg" /></a> <a href="http://www.instapaper.com/hello2?url=/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/&title=Cycle Detection in F# &amp;#8211; Fun With Immutability" class="instapaper_button">Instapaper</a>					</div>			
				</div>
				<div class="comments-area instapaper_ignore">
	<h4 class="comments-title">
		5 Comments	</h4>
			<ol class="comments-list">
					<li class="comment byuser comment-author-SQLDenis even thread-even depth-1" id="comment-4066">
				<div id="div-comment-4066" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7a49149d4d4b9242348b95a2c561c20d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">SQLDenis</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/#comment-4066">
			April 11, 2011 at 9:41 am</a>		</div>

		<p>Looks really cool, when I look at F# I am thinking I am looking at a foreign programming language so to speak</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/?replytocom=4066#respond' onclick='return addComment.moveForm( "div-comment-4066", "4066", "respond", "1102" )' aria-label='Reply to SQLDenis'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-chaospandion odd alt thread-odd thread-alt depth-1" id="comment-4067">
				<div id="div-comment-4067" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/7dcad6d7e959ef6d6cfd67c6fb15c171?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/7dcad6d7e959ef6d6cfd67c6fb15c171?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">chaospandion</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/#comment-4067">
			April 11, 2011 at 10:05 am</a>		</div>

		<p>That <em>&#8220;Matt&#8221;</em> fellow sounds like a complete moron.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/?replytocom=4067#respond' onclick='return addComment.moveForm( "div-comment-4067", "4067", "respond", "1102" )' aria-label='Reply to chaospandion'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcuse bypostauthor even thread-even depth-1" id="comment-4068">
				<div id="div-comment-4068" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Alex Ullrich</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/#comment-4068">
			April 11, 2011 at 4:29 pm</a>		</div>

		<p>Eh, you&#8217;re mostly right but he&#8217;s a bit too hard on himself at times 🙂</p>
<p>Denis, it does look strange at first but after a little while it starts to read quite well.  It&#8217;s definitely worth playing around with a bit, especially if you&#8217;ve liked all the stuff linq makes possible in .net 3.5 and up.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/?replytocom=4068#respond' onclick='return addComment.moveForm( "div-comment-4068", "4068", "respond", "1102" )' aria-label='Reply to Alex Ullrich'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-679291">
				<div id="div-comment-679291" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://1.gravatar.com/avatar/147e346ef76c7b6808ba9108fb9539a1?s=64&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/147e346ef76c7b6808ba9108fb9539a1?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn"><a href='http://typedandnerdy.blogspot.com/' rel='external nofollow' class='url'>Daniel Fabian (@iceypoi)</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/#comment-679291">
			April 28, 2014 at 4:37 pm</a>		</div>

		<p>Dear Alex, sorry for the necro, but I just stumbled upon your post and used the code. Turns out, that your functional solution is incorrect, the mu is always 0, because you start off at tortoise and hare, as opposed to x.</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/?replytocom=679291#respond' onclick='return addComment.moveForm( "div-comment-679291", "679291", "respond", "1102" )' aria-label='Reply to Daniel Fabian (@iceypoi)'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alexcuse bypostauthor even thread-even depth-1" id="comment-4518709">
				<div id="div-comment-4518709" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=64&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/5e8bfdc77e52098a1ab2ddd1cd2a176f?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />			<cite class="fn">Alex Ullrich</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/#comment-4518709">
			August 5, 2015 at 12:25 pm</a>		</div>

		<p>Hmm guess notifications weren&#8217;t working for a while.</p>
<p>Should be fun to see where the problem lies, I haven&#8217;t really done much with F# since 2011.  At least it got me the right answer for project euler tho?  😉</p>

		<div class="reply"><a rel='nofollow' class='comment-reply-link' href='/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/?replytocom=4518709#respond' onclick='return addComment.moveForm( "div-comment-4518709", "4518709", "respond", "1102" )' aria-label='Reply to Alex Ullrich'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol>
						<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/index.php/desktopdev/mstech/cycle-detection-in-f-fun-with-immutability/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='1102' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><input type="hidden" id="killer_value" name="killer_value" value="5ef059938ba799aaa845e1c2e8a762bd"/><noscript>Sorry, but you are required to use a javascript enabled brower to comment here.</noscript>				</form>
					</div><!-- #respond -->
		</div>			</div>
				<br style="clear: both;" />
</div>
		</div>
		<div id="page-footer">
			<div id="botnav"><a href="http://lessthandot.com/" title="LessThanDot Launchpad">Launchpad</a> | <a href="http://lessthandot.com/account.php" title="Your Account Settings">My Account</a> | <a href="http://lessthandot.com/statistics.php" title="Statistics">Statistics</a> | <a href="http://lessthandot.com/donate.php" title="Donate">Donate</a> | <a href="http://lessthandot.com/contactus.php" title="Contact Us">Contact Us</a> | <a href="http://lessthandot.com/aboutus.php" title="About the LessThanDot Team">&copy;2008 - 2019 LessThanDot, LLC</a></div>

		<script type='text/javascript'>
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-4471405-1']);
		_gaq.push(['_trackPageview']);
		_gaq.push(['_setCustomVar', 1, 'Environment', 'lessthandot.com', 3]);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	  </script>			<div class="validator"><a href="http://validator.w3.org/check?uri=referer">Valid XHTML</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Validate the CSS for this page at the W3C website">Valid CSS</a> | 2018-11-11 15:52</div>
		</div>
	</div>
</div>
<!-- <script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script> -->
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var spam_destroyer = {"key":"159ff9dcc225580310c2de238cdd1f1a","lifetime":"3600","limit":"1552765966"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/spam-destroyer/kill.js?ver=1.2'></script>
</body>
</html>
